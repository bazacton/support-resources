import{h as S,r as c,j as e,T as a,al as f,d as C,i as y,am as T,an as A,ap as I,aP as q,F as j,aq as E,B as u,aZ as O,av as h,H as k,s as w,k as b,q as D,t as F,m as v,aw as H,aj as L,ax as M,az as x,L as _}from"./client-OfhJa1Pp.js";import{A as B}from"./ai-agent-page-header-BnoGBePt.js";import{g as p,h as K}from"./main-CqFMqK8-.js";import{P as Q}from"./toggle-preview-button-xp_UTzfM.js";import{G as R}from"./global-loading-progress-CKXIm6JS.js";import{D as V}from"./data-table-add-item-button-2jwTYQ5G.js";import{D as $}from"./data-table-header-CeAVoFvI.js";import{D as W}from"./data-table-pagination-footer-CEEx1VtI.js";import{u as G}from"./use-datatable-search-params-CQGreY35.js";import{D as U}from"./data-table-emty-state-message-DLsG3g03.js";import{a as z,b as Z,c as J}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{u as X}from"./use-datatable-query-BQ-GXlzU.js";import{u as N}from"./custom-menu-BbwshV9x.js";import{T as Y}from"./table-BifRiqkr.js";import{F as ee}from"./formatted-number-DuD1Sa1W.js";import{A as ae}from"./AccountTree-Dxk2iKnz.js";import{M as te}from"./MoreVert-Ci70_mZh.js";import{C as se}from"./confirmation-dialog-BIOq1A-h.js";import"./admin-config-tfY5n3F7.js";import"./dashboard-icons-CHop3mns.js";import"./library-icon-CHCHM-UW.js";import"./messages-square-icon-CTmom_u4.js";import"./Delete-BhyMZiPM.js";import"./Home--R_oEr6a.js";import"./SupervisorAccount-k9OnPB-d.js";import"./Translate-Cs-ut2nW.js";import"./TextFields-8TfbEP0O.js";import"./use-url-backed-tabs-D_W8N2tz.js";import"./tabs-BfUlcoJh.js";import"./book-open-Cbdc52Ur.js";import"./Add-CN0r1QLK.js";import"./widget-flags-DGIUgINI.js";import"./use-widget-bootstrap-data-BlKRRco5.js";import"./RestartAlt-BBLLDvr_.js";import"./use-is-module-installed-FCoToztC.js";import"./FilterAlt-CXibH0wr.js";import"./select-filter-panel-C_zo36WK.js";import"./form-chip-field-sH5S7-lx.js";import"./chip-list-CkGaRoaT.js";import"./filter-operator-names-BZog1mvA.js";import"./select-Dsco87dL.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./normalized-model-field-COxh0lBC.js";import"./Edit-JNj6SFDx.js";import"./skeleton-Cp2m1Uyc.js";import"./accordion-DWEV-mKU.js";import"./accordtion-animation-BGCK95Hj.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import"./ArrowDownward-mN9PlQJw.js";import"./useEffectEvent-DQn3o5L0.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./useGlobalListeners-CeWFSHKo.js";function ca(){const{aiAgentId:t}=N(["aiAgentId"]),i=S(),{searchParams:s,sortDescriptor:r,mergeIntoSearchParams:o,setSearchQuery:n,isFiltering:l}=G(O),m=X(p.flows.index(t,s)),[g,P]=c.useState(!1);return e.jsxs(c.Fragment,{children:[e.jsxs(z,{className:"dashboard-grid-content dashboard-rounded-panel",children:[e.jsx(R,{query:m}),e.jsx(K,{children:e.jsx(a,{message:"Flows"})}),e.jsx(B,{previewVisible:g,onTogglePreview:()=>P(!g)}),e.jsxs(Z,{children:[e.jsx($,{searchValue:s.query,onSearchChange:n,actions:e.jsx(re,{})}),e.jsxs(J,{children:[!m.isEmpty||l?e.jsx(Y,{columns:oe,data:m.items,sortDescriptor:r,onSortChange:o,cellHeight:"h-64",enableSelection:!1,onAction:d=>i(`../flows/${d.id}/edit`)}):null,m.isEmpty?e.jsx(U,{isFiltering:l,icon:e.jsx(ae,{}),title:e.jsx(a,{message:"No flows yet"}),filteringTitle:e.jsx(a,{message:"No matching flows"}),description:e.jsx(a,{message:"Get started by adding a new flow."})}):null,e.jsx(W,{query:m,onPageChange:d=>o({page:d}),onPerPageChange:d=>o({perPage:d}),hideIfOnlyOnePage:!0})]})]})]}),g&&e.jsx(Q,{onClose:()=>P(!1)})]})}const oe=[{key:"name",width:"flex-3",visibleInMode:"all",header:()=>e.jsx(a,{message:"Name"}),body:t=>t.name},{key:"activation_count",allowsSorting:!0,maxWidth:"max-w-100",header:()=>e.jsx(a,{message:"Activations"}),body:t=>t.activation_count?e.jsx(ee,{value:t.activation_count}):""},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-124",header:()=>e.jsx(a,{message:"Last updated"}),body:t=>t.updated_at?e.jsx(k,{date:t.updated_at}):""},{key:"actions",header:()=>e.jsx(a,{message:"Actions"}),hideHeader:!0,visibleInMode:"all",align:"end",width:"w-84 flex-shrink-0",body:t=>e.jsx(ie,{flow:t})}];function ie({flow:t}){const[i,s]=c.useState(!1),[r,o]=c.useState(!1);return e.jsxs(c.Fragment,{children:[e.jsxs(H,{children:[e.jsx(L,{className:"text-muted",children:e.jsx(te,{})}),e.jsxs(M,{children:[e.jsx(x,{value:"edit",elementType:_,to:`../flows/${t.id}/edit`,children:e.jsx(a,{message:"Edit"})}),e.jsx(x,{value:"rename",onSelected:()=>s(!0),children:e.jsx(a,{message:"Rename"})}),e.jsx(x,{value:"delete",onSelected:()=>o(!0),children:e.jsx(a,{message:"Delete"})})]})]}),e.jsx(h,{type:"modal",isOpen:i,onOpenChange:s,children:e.jsx(le,{flow:t})}),e.jsx(h,{type:"modal",isOpen:r,onOpenChange:o,children:e.jsx(me,{flow:t})})]})}function re(){return e.jsxs(h,{type:"modal",children:[e.jsx(V,{children:e.jsx(a,{message:"Add new flow"})}),e.jsx(ne,{})]})}function ne(){const{aiAgentId:t}=N(["aiAgentId"]),i=S(),{formId:s,close:r}=f(),o=C(),n=y({mutationFn:l=>b.post("lc/ai-agent/flows",{name:l.name,ai_agent_id:t}),onSuccess:async l=>{await D.invalidateQueries({queryKey:p.flows.invalidateKey}),F(v("Flow created")),r(),i(`../flows/${l.data.flow.id}/edit`,{relative:"path"})},onError:l=>w(l)});return e.jsxs(T,{children:[e.jsx(A,{children:e.jsx(a,{message:"New flow"})}),e.jsx(I,{children:e.jsx(q,{id:s,form:o,onSubmit:l=>{n.mutate(l)},children:e.jsx(j,{required:!0,name:"name",autoFocus:!0,label:e.jsx(a,{message:"Name"})})})}),e.jsxs(E,{children:[e.jsx(u,{type:"button",onClick:()=>r(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(u,{type:"submit",disabled:n.isPending,variant:"flat",color:"primary",form:s,children:e.jsx(a,{message:"Create"})})]})]})}function le({flow:t}){const{formId:i,close:s}=f(),r=C({defaultValues:{name:t.name,intent:t.intent}}),o=y({mutationFn:n=>b.put(`lc/ai-agent/flows/${t.id}`,n),onSuccess:async()=>{await D.invalidateQueries({queryKey:p.flows.invalidateKey}),F(v("Flow updated")),s()},onError:n=>w(n)});return e.jsxs(T,{children:[e.jsx(A,{children:e.jsx(a,{message:"Update flow"})}),e.jsx(I,{children:e.jsxs(q,{id:i,form:r,onSubmit:n=>o.mutate(n),children:[e.jsx(j,{required:!0,name:"name",autoFocus:!0,label:e.jsx(a,{message:"Name"}),className:"mb-24"}),e.jsx(j,{name:"intent",autoFocus:!0,label:e.jsx(a,{message:"Intent"}),inputElementType:"textarea",rows:2,minLength:10,maxLength:200})]})}),e.jsxs(E,{children:[e.jsx(u,{type:"button",onClick:()=>s(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(u,{type:"submit",disabled:o.isPending,variant:"flat",color:"primary",form:i,children:e.jsx(a,{message:"Update"})})]})]})}function me({flow:t}){const{close:i}=f(),s=y({mutationFn:()=>b.delete(`lc/ai-agent/flows/${t.id}`),onSuccess:async()=>{await D.invalidateQueries({queryKey:p.flows.invalidateKey}),F(v("Flow deleted")),i()},onError:r=>w(r)});return e.jsx(se,{isDanger:!0,isLoading:s.isPending,title:e.jsx(a,{message:"Delete flow"}),body:e.jsx(a,{message:"Are you sure you want to delete this flow?"}),confirm:e.jsx(a,{message:"Delete"}),onConfirm:()=>s.mutate()})}export{ca as Component,me as DeleteFlowDialog,le as RenameFlowDialog};
