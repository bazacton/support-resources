import{i as S,s as C,t as w,m as r,k as D,j as e,T as t,L as u,a_ as k,b7 as T,H as _,J as U,u as q,r as d,aw as B,aj as V,ax as M,az as b,av as f,Z as R,l as F,b1 as m,b2 as n,bE as H,bD as Q,q as P,d as $,h as z,al as N,am as K,an as W,ap as G,aP as X,aR as J,F as v,aq as Z,B as h,cq as Y,aL as ee}from"./client-OfhJa1Pp.js";import{A as se}from"./admin-config-tfY5n3F7.js";import{u as te}from"./use-is-customer-online-Dt4E9Uxw.js";import{a as ae,C as re}from"./customer-avatar-DNefi2od.js";import{h as oe}from"./helpdesk-channel-CQKSbeKg.js";import{u as ie,O as ne}from"./online-status-circle-QXiKm4xe.js";import{C as O}from"./confirmation-dialog-BIOq1A-h.js";import{M as le}from"./MoreHoriz-hMMIYAbm.js";import{P as me}from"./PersonOff-hROtNsgz.js";import{S as ue}from"./skeleton-Cp2m1Uyc.js";import{i as A,$ as ce,o as de,j as pe,c as xe,h as ge}from"./main-CqFMqK8-.js";import{t as je}from"./team-DYmDDGxN.js";import{D as he}from"./settings-links-D22SAe6v.js";import{u as fe,B as ye}from"./use-unban-users-TBy06zKy.js";import{F as be}from"./image-selector-Bwr5VwEQ.js";import{F as ve}from"./file-upload-provider-DTPBUrkd.js";import{o as Se}from"./custom-menu-BbwshV9x.js";import"./AddAPhoto-eWqbbo4Z.js";import"./Edit-JNj6SFDx.js";import"./Login-D6kg4ucG.js";import"./FileDownload-DoJWzr8l.js";import{D as we}from"./data-table-add-item-button-2jwTYQ5G.js";import"./FilterAlt-CXibH0wr.js";import"./accordion-DWEV-mKU.js";import"./checkbox-C4s6ROxp.js";import"./filter-operator-names-BZog1mvA.js";import"./formatted-number-DuD1Sa1W.js";import{D as De}from"./datatable-filters-C2DdpqvR.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import{T as Ce}from"./table-BifRiqkr.js";import"./ArrowDownward-mN9PlQJw.js";import{G as ke}from"./global-loading-progress-CKXIm6JS.js";import{D as Te}from"./data-table-export-csv-button-9QYFEqF2.js";import{D as _e}from"./data-table-header-CeAVoFvI.js";import{D as Fe}from"./data-table-pagination-footer-CEEx1VtI.js";import{u as Pe}from"./use-datatable-search-params-CQGreY35.js";import{D as Ne}from"./data-table-emty-state-message-DLsG3g03.js";import{a as Oe,D as Ae,b as Ie,c as Ee}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{u as Le}from"./use-datatable-query-BQ-GXlzU.js";import{T as Ue,a as qe,b as j}from"./tabs-BfUlcoJh.js";import"./dashboard-icons-CHop3mns.js";import"./library-icon-CHCHM-UW.js";import"./messages-square-icon-CTmom_u4.js";import"./Delete-BhyMZiPM.js";import"./Home--R_oEr6a.js";import"./SupervisorAccount-k9OnPB-d.js";import"./Translate-Cs-ut2nW.js";import"./TextFields-8TfbEP0O.js";import"./HourglassEmpty-BpvqVftp.js";import"./external-link-DbBk1ItZ.js";import"./book-open-Cbdc52Ur.js";import"./date-picker-CUWok1XJ.js";import"./use-active-upload-CCDRf1Tl.js";import"./open-upload-window-CSDcieK1.js";import"./uploaded-file-DN6fXT4v.js";import"./shallow-BSWIanyL.js";import"./progress-bar-iRLStr1h.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./with-selector-CDgEpx5P.js";import"./Add-CN0r1QLK.js";import"./accordtion-animation-BGCK95Hj.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./select-filter-panel-C_zo36WK.js";import"./form-chip-field-sH5S7-lx.js";import"./chip-list-CkGaRoaT.js";import"./select-Dsco87dL.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./normalized-model-field-COxh0lBC.js";import"./useEffectEvent-DQn3o5L0.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./useGlobalListeners-CeWFSHKo.js";import"./download-file-from-url-hJ3EUwXO.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";function Be(){return S({mutationFn:s=>Ve(s),onSuccess:async s=>{w(r(`Impersonating user "${s.user.name}"`)),window.location.href="/"},onError:s=>C(s)})}function Ve(s){return D.post(`admin/users/impersonate/${s.userId}`,s).then(a=>a.data)}function Me({user:s}){const a=Be();return e.jsx(O,{title:e.jsx(t,{message:"Impersonate user"}),isLoading:a.isPending,body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx(t,{message:"Are you sure you want to login as this user?"})}),e.jsx("p",{className:"mt-8",children:e.jsx(t,{message:"This will log you out of your current account and log you in as the user."})})]}),confirm:e.jsx(t,{message:"Login"}),onConfirm:()=>{a.mutate({userId:s.id})}})}const Re=[{key:"name",visibleInMode:"all",width:"flex-3 min-w-200",header:()=>e.jsx(t,{message:"User"}),body:s=>e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsx(ae,{size:"w-30 h-30",user:s}),e.jsxs("div",{children:[e.jsx(u,{to:`../customers/${s.id}`,className:"hover:underline",children:e.jsx(re,{user:s})}),e.jsx("div",{className:"text-xs text-muted",children:s.email})]}),s.banned_at?e.jsx(me,{className:"text-danger"}):null]})},{key:"country",width:"w-160",allowsSorting:!0,header:()=>e.jsx(t,{message:"Country"}),body:s=>e.jsx(He,{customer:s})},{key:"last_active_at",width:"w-160",allowsSorting:!0,header:()=>e.jsx(t,{message:"Last active"}),body:s=>e.jsx(Qe,{customer:s})},{key:"created_at",allowsSorting:!0,width:"w-160",header:()=>e.jsx(t,{message:"Created"}),body:s=>e.jsx(k,{label:e.jsx(_,{date:s.created_at}),children:e.jsx("time",{className:"hover:underline",children:e.jsx(T,{date:s.created_at})})})},{key:"page_visits_count",width:"w-160",allowsSorting:!0,header:()=>e.jsx(t,{message:"Page visits"}),body:s=>s.page_visits_count?s.page_visits_count:""},{key:"conversations_count",width:"w-160",allowsSorting:!0,header:()=>e.jsx(t,{message:"Conversations"}),body:s=>s.conversations_count?s.conversations_count:""},{key:"actions",header:()=>e.jsx(t,{message:"Actions"}),width:"w-42 flex-shrink-0",hideHeader:!0,align:"end",visibleInMode:"all",body:s=>e.jsx($e,{customer:s})}];function He({customer:s}){const o=U().find(i=>s.country&&i.code===s.country.toLowerCase());return o==null?void 0:o.name}function Qe({customer:s}){const{websockets_setup:a}=q(),o=ie(l=>!!l.presence[oe.name]),i=te(s.id);return!o&&a?e.jsx(ue,{size:"w-70"}):i?e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(ne,{color:"bg-positive"}),e.jsx(t,{message:"Active"})]}):s.last_active_at?e.jsx(k,{label:e.jsx(_,{date:s.last_active_at}),children:e.jsx("time",{className:"hover:underline",children:e.jsx(T,{date:s.last_active_at})})}):"-"}function $e({customer:s}){const[a,o]=d.useState(!1);return e.jsxs(d.Fragment,{children:[e.jsxs(B,{children:[e.jsx(V,{className:"text-muted",children:e.jsx(le,{})}),e.jsxs(M,{children:[e.jsx(b,{value:"view",elementType:u,to:`../customers/${s.id}`,children:e.jsx(t,{message:"View"})}),e.jsx(b,{value:"impersonate",onSelected:()=>o(!0),children:e.jsx(t,{message:"Impersonate"})}),e.jsx(b,{value:"startConversation",elementType:u,to:`/dashboard/conversations/new?customer_id=${s.id}`,children:e.jsx(t,{message:"Start conversation"})})]})]}),e.jsx(f,{type:"modal",isOpen:a,onOpenChange:o,children:e.jsx(Me,{user:s})})]})}function ze(){var o;const a=(o=R(F.attributes.normalizedList({type:"user",for:"agent"})).data)==null?void 0:o.attributes;return d.useMemo(()=>a?[{key:"is_returning",label:r("Returning visitor"),defaultOperator:n.eq,control:{type:m.BooleanToggle,defaultValue:!0}},{key:"page_visits_count",label:r("Number of visits"),defaultOperator:n.gte,operators:H,control:{type:m.Input,inputType:"number",defaultValue:5}},A({description:r("First visit date")}),{key:"browser",label:r("Browser"),defaultOperator:n.eq,control:{type:m.Select,defaultValue:"chrome",options:[{key:"chrome",value:"chrome",label:"Chrome"},{key:"firefox",value:"firefox",label:"Firefox"},{key:"safari",value:"safari",label:"Safari"},{key:"edge",value:"edge",label:"Edge"}]}},{key:"device",label:r("Device"),defaultOperator:n.eq,control:{type:m.Select,defaultValue:"desktop",options:[{key:"desktop",value:"desktop",label:r("Desktop")},{key:"phone",value:"phone",label:r("Phone")},{key:"tablet",value:"tablet",label:r("Tablet")}]}},{key:"platform",label:r("Platform"),defaultOperator:n.eq,control:{type:m.Select,defaultValue:"windows",options:[{key:"windows",value:"windows",label:r("Windows")},{key:"OS X",value:"OS X",label:r("Mac")},{key:"linux",value:"linux",label:r("Linux")}]}},...ce(a).filter(i=>i.key!=="name"&&i.key!=="email"),{key:"city",label:r("City"),defaultOperator:n.eq,operators:Q,control:{type:m.Input,inputType:"string",defaultValue:""}},{key:"ip_address",label:r("IP address"),defaultOperator:n.eq,control:{type:m.Input,inputType:"string",defaultValue:""}}]:[],[a])}function Ke(s){return S({mutationFn:a=>We(a),onSuccess:()=>{w(r("User created")),P.invalidateQueries({queryKey:de.users.invalidateKey})},onError:a=>Se(a,s)})}function We(s){return s.roles&&(s.roles=s.roles.map(a=>a.id)),D.post("users",s).then(a=>a.data)}function Ge(){const s=$(),a=Ke(s),o=z(),{close:i,formId:l}=N();return e.jsxs(K,{children:[e.jsx(W,{children:e.jsx(t,{message:"Create user"})}),e.jsx(G,{children:e.jsxs(X,{id:l,form:s,onSubmit:c=>{a.mutate(c,{onSuccess:p=>{i(),o(`${p.user.id}`,{replace:!0})}})},children:[e.jsx(ve,{children:e.jsx(be,{className:"mb-24",name:"image",uploadType:J.avatars,label:e.jsx(t,{message:"Avatar"}),showRemoveButton:!0})}),e.jsx(v,{required:!0,className:"mb-24",name:"email",type:"email",label:e.jsx(t,{message:"Email"})}),e.jsx(v,{className:"mb-24",name:"name",label:e.jsx(t,{message:"Name"})}),e.jsx(v,{required:!0,name:"password",type:"password",label:e.jsx(t,{message:"Password"})})]})}),e.jsxs(Z,{children:[e.jsx(h,{variant:"outline",onClick:()=>i(),children:e.jsx(t,{message:"Cancel"})}),e.jsx(h,{variant:"flat",color:"primary",type:"submit",form:l,disabled:a.isPending,children:e.jsx(t,{message:"Create"})})]})]})}r("Email"),r("Email verification status"),n.ne,m.Select,r("is confirmed"),n.ne,r("is not confirmed"),n.eq,A({description:r("Date user registered or was created")}),pe({description:r("Date user was last updated")}),r("Subscription"),r("Whether user is subscribed or not"),n.eq,m.Select,r("is subscribed"),n.has,r("is not subscribed"),n.doesntHave;function Xe({selectedIds:s,onDelete:a}){const{close:o}=N(),i=S({mutationFn:()=>D.delete(`users/${s.join(",")}`),onSuccess:async()=>{await P.invalidateQueries({queryKey:xe.users.invalidateKey}),w(r("Users deleted")),a(),o()},onError:l=>C(l)});return e.jsx(O,{isDanger:!0,isLoading:i.isPending,title:e.jsx(t,{message:"Delete users"}),body:e.jsx(t,{message:"Are you sure you want to delete selected users?",values:{count:s.length}}),confirm:e.jsx(t,{message:"Delete"}),onConfirm:()=>i.mutate()})}function Je(s){switch(s){case"verified":return 1;case"visitors":return 2;case"active":return 3;case"suspended":return 4;default:return 0}}function bt(){const s=ze(),[a,o]=d.useState([]),{searchParams:i,sortDescriptor:l,mergeIntoSearchParams:c,setSearchQuery:p,isFiltering:x}=Pe(Y),[I,E]=d.useState(()=>Je(i.type)),g=Le(F.customers.index(i)),L=e.jsxs(d.Fragment,{children:[e.jsx(Te,{endpoint:"users/csv/export"}),e.jsxs(f,{type:"modal",children:[e.jsx(we,{children:e.jsx(t,{message:"Add new user"})}),e.jsx(Ge,{})]})]});return e.jsxs(Oe,{children:[e.jsx(ke,{query:g}),e.jsx(ge,{children:e.jsx(t,{message:"Customers"})}),e.jsx(Ae,{title:e.jsx(t,{message:"Customers"}),showSidebarToggleButton:!0,border:"border-none",rightContent:e.jsx(he,{variant:"button",link:se.pages.customers,size:"xs"})}),e.jsx(Ue,{className:"flex-shrink-0",selectedTab:I,onTabChange:E,children:e.jsxs(qe,{className:"mx-24",children:[e.jsx(j,{elementType:u,to:"../customers",children:e.jsx(t,{message:"All"})}),e.jsx(j,{elementType:u,to:"?type=verified",children:e.jsx(t,{message:"Verified"})}),e.jsx(j,{elementType:u,to:"?type=visitors",children:e.jsx(t,{message:"Visitors"})}),e.jsx(j,{elementType:u,to:"?type=active",children:e.jsx(t,{message:"Active"})}),e.jsx(j,{elementType:u,to:"?type=suspended",children:e.jsx(t,{message:"Suspended"})})]})}),e.jsxs(Ie,{children:[e.jsx(_e,{searchValue:i.query,onSearchChange:p,actions:L,selectedItems:a,selectedActions:e.jsx(Ze,{selectedIds:a,setSelectedIds:o,customers:g.items}),filters:s}),e.jsx(De,{filters:s}),e.jsxs(Ee,{children:[e.jsx(Ce,{columns:Re,data:g.items,sortDescriptor:l,onSortChange:c,enableSelection:!0,selectedRows:a,onSelectionChange:o,cellHeight:"h-56"}),g.isEmpty&&e.jsx(Ye,{isFiltering:x}),e.jsx(Fe,{query:g,onPageChange:y=>c({page:y}),onPerPageChange:y=>c({perPage:y})})]})]})]})}function Ze({selectedIds:s,setSelectedIds:a,customers:o}){const i=o.filter(x=>s.includes(x.id)).every(x=>x.banned_at),l=fe(s),c=e.jsxs(f,{type:"modal",children:[e.jsx(h,{variant:"outline",color:"danger",children:e.jsx(t,{message:"Suspend"})}),e.jsx(ye,{userIds:s,onSuccess:()=>a([])})]}),p=e.jsx(h,{variant:"outline",onClick:()=>l.mutate(void 0,{onSuccess:()=>a([])}),children:e.jsx(t,{message:"Unsuspend"})});return e.jsxs(d.Fragment,{children:[i?p:c,e.jsxs(f,{type:"modal",children:[e.jsx(h,{variant:"flat",color:"danger",children:e.jsx(t,{message:"Delete"})}),e.jsx(Xe,{selectedIds:s,onDelete:()=>a([])})]})]})}function Ye({isFiltering:s}){const[a]=ee(),o=a.get("type");let i=e.jsx(t,{message:"No customers have been created yet"});return o==="verified"&&(i=e.jsx(t,{message:"No customers with verified email"})),o==="visitors"&&(i=e.jsx(t,{message:"No customers have visited the site recently"})),o==="active"&&(i=e.jsx(t,{message:"No customers have been active recently"})),o==="suspended"&&(i=e.jsx(t,{message:"No customers have been suspended"})),e.jsx(Ne,{className:"mt-44",isFiltering:s,image:je,title:i,filteringTitle:e.jsx(t,{message:"No matching customers"})})}export{bt as Component,Je as getTabIndexFromName};
