import{r as c,cm as I,j as u,p as D,u as j,m as n,b as R,S as T,bl as F,bb as k,bm as B,b7 as H,cn as L,H as C,co as P,T as Y,aO as _}from"./client-OfhJa1Pp.js";import{I as G}from"./infinite-scroll-sentinel-sZcqy_uF.js";import{$ as N}from"./isScrollable-BSEN4xi5.js";import{A as V,a as O}from"./agent-avatar-CN8Be1Dj.js";import{u as Q}from"./use-widget-bootstrap-data-BlKRRco5.js";import{a as U}from"./customer-avatar-DNefi2od.js";var J=K;function K(e,t,r){var s=null,l=null,a=function(){s&&(clearTimeout(s),l=null,s=null)},i=function(){var d=l;a(),d&&d()},f=function(){if(!t)return e.apply(this,arguments);var d=this,m=arguments,h=r&&!s;if(a(),l=function(){e.apply(d,m)},s=setTimeout(function(){if(s=null,!h){var g=l;return l=null,g()}},t),h)return l()};return f.cancel=a,f.flush=i,f}function oe({children:e,className:t,query:r,messageIds:s}){var w;const l=c.useRef(null),a=c.useRef(null),i=c.useRef(0),f=c.useRef(null),d=c.useRef(!1),m=c.useRef(null),h=s||((w=r==null?void 0:r.data)==null?void 0:w.items.map(o=>o.id).join(",")),g=c.useCallback(({amount:o,force:b}={})=>{a.current&&(d.current&&!b||a.current.scrollTo({top:o??a.current.scrollHeight}))},[]);return c.useEffect(()=>{if(!h)return;const o=h.split(",");if(!m.current){m.current=o;return}const b=m.current.at(-1),p=m.current.length;if(b!==o.at(-1))g({force:!0});else{if(p>=o.length)return;const y=a.current,v=l.current,A=f.current;if(!y||!v||!A)return;const x=v.getBoundingClientRect().height;A!==x&&(g({amount:x-A,force:!0}),f.current=x)}m.current=o},[h]),c.useEffect(()=>{if(!a.current)return;const o=a.current,b=J(()=>{o.scrollTop<i.current&&(d.current=!0),o.scrollTop-(o.scrollHeight-o.clientHeight)>=-10&&(d.current=!1),i.current=o.scrollTop},10),p=()=>{document.visibilityState==="visible"&&g()};o.addEventListener("scroll",b),document.addEventListener("visibilitychange",p);const y=I(l,({height:v})=>{Math.ceil(f.current??0)!==Math.ceil(v)&&(f.current=v,g())});return()=>{o.removeEventListener("scroll",b),document.removeEventListener("visibilitychange",p),y()}},[g]),u.jsxs(c.Fragment,{children:[r?u.jsx(G,{query:r,className:D(r.hasNextPage&&"h-64 py-16"),loaderMarginTop:"m-0"}):null,u.jsx("div",{ref:o=>{o&&(a.current=S(o),l.current=o,a.current&&(i.current=a.current.scrollTop))},className:t,id:"feed-container",children:e})]})}function S(e){return e?N(e)?e:S(e.parentElement):null}function se({message:e,variant:t}){var a,i;const{lc:r}=j(),s=((a=r==null?void 0:r.timeout)==null?void 0:a.inactive)??10,l=((i=r==null?void 0:r.timeout)==null?void 0:i.archive)??15;if(e.type==="collectDetailsForm")return n("Collect details form shown");if(e.type==="cards")return n("Cards shown");if(e.type!=="event")return null;switch(e.body.name){case"closed.inactivity":return t==="agent"?n("Automatically closed - :minutes min inactivity",{values:{minutes:l}}):n("The chat has been closed due to long user inactivity.");case"closed.byTrigger":return t==="agent"?n("Closed by trigger"):n("Chat was closed by one of our agents");case"closed.byAgent":return t==="agent"?n("Closed by :agent",{values:{agent:e.body.closedBy}}):n(":agent has closed the chat",{values:{agent:e.body.closedBy}});case"closed.byCustomer":return t==="agent"?n("Closed by customer",{values:{customer:e.body.closedBy}}):n("You have closed the conversation",{values:{customer:e.body.closedBy}});case"closed.byAiAgent":return t==="agent"?n("Closed by AI agent"):n("Chat closed");case"customer.enteredEmail":return t==="agent"?n("Customer entered ':email' as email",{values:{email:e.body.email}}):n("You have entered ':email' as email",{values:{email:e.body.email}});case"customer.idle":return t==="agent"?n("Idle - :minutes min inactivity",{values:{minutes:s}}):null;case"customer.leftChat":return t==="agent"?n("Closed - customer left the chat"):n("You have left the chat");case"agent.leftChat":return t==="customer"?e.body.newAgent?n("You have been transferred to: :agent",{values:{agent:e.body.newAgent}}):null:e.body.oldAgent&&e.body.newAgent?n("Chat assigned to :newAgent because :oldAgent left the chat",{values:{newAgent:e.body.newAgent,oldAgent:e.body.oldAgent}}):e.body.oldAgent?n(":agent left the chat",{values:{agent:e.body.oldAgent}}):null;case"agent.changed":return e.body.newAgent?t==="agent"?n("Reassigned to :agent",{values:{agent:e.body.newAgent}}):n(":agent has joined the conversation",{values:{agent:e.body.newAgent}}):n("Conversation reassigned");case"customer.addedToQueue":return t==="agent"?n("Added to queue"):n("Waiting for an agent");case"group.changed":return e.body.newGroup?n("Transfered to :name group",{values:{name:e.body.newGroup}}):n("Group changed");default:return null}}function M(){const e=R(),{chatWidget:t}=j(),r=t==null?void 0:t.logo_dark;return e&&(t!=null&&t.logo_light)?t==null?void 0:t.logo_light:r}function W({className:e,size:t}){const{aiAgent:r}=Q(),s=M(),l=(r==null?void 0:r.name)||"AI assistant",a=(r==null?void 0:r.image)||s;return u.jsx(T,{circle:!1,fallback:"initials",label:l,labelForBackground:l,src:a,className:e,size:t})}function X({size:e}){const{branding:t}=j(),r=M();return u.jsx(T,{src:r||(t==null?void 0:t.logo_light_mobile),label:(t==null?void 0:t.site_name)??"Support",fallback:"initials",circle:!1,size:e})}function ae({message:e,size:t,agentWithIndicator:r}){return e.author==="bot"?u.jsx(W,{size:t}):e.author==="user"?e.user?u.jsx(U,{user:e.user,size:t}):null:e.author==="system"?u.jsx(X,{size:t}):e.user?r?u.jsx(V,{user:e.user,size:t,showAwayIcon:!0}):u.jsx(O,{user:e.user,size:t}):null}const Z={hour:"numeric",minute:"numeric"},E={month:"short",day:"numeric",hour:"numeric",minute:"numeric"},z={...E,year:"numeric"},ue=c.memo(({date:e})=>{const t=F(),r=k();if(!e)return null;try{const s=B(e,t);return s.hour===r.hour?u.jsx(H,{date:e,style:"narrow"}):L(s,t)?u.jsx(C,{date:e,options:Z}):P(s,r)?u.jsx(c.Fragment,{children:u.jsx(C,{date:e,options:E})}):u.jsx(c.Fragment,{children:u.jsx(C,{date:e,options:z})})}catch{return u.jsx(Y,{message:"Invalid date"})}},_);function le(e){const t=[...e.pages].reverse();return{...e,pages:t,pageParams:[...e.pageParams].reverse(),items:t.flatMap(r=>r.pagination.data)||[]}}export{W as A,oe as M,ue as a,ae as b,M as c,le as r,se as u};
