const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./reply-composer-container-CGWK_3_X.js","./client-OfhJa1Pp.js","./formatted-message-body-WNPn2fpJ.js","./variable-extension-Cjf6-ocs.js","./get-default-values-for-form-with-attributes-htMbgWW2.js","./campaign-conditions-config-DJxMZaUr.js","./select-Dsco87dL.js","./combobox-end-adornment-CaH5Sr_u.js","./Event-7FmyLdJJ.js","./ToggleOn-DZgCezoB.js","./TextFields-8TfbEP0O.js","./Add-CN0r1QLK.js","./index-W-EjzbYI.js","./with-selector-CDgEpx5P.js","./DataObject-XQLwxsph.js","./index-DTFmR8Ac.js","./core-Dg-ESrC8.js","./index-RecbqAl0.js","./tiptap-editor-context-BAgvnYfz.js","./index-DWTqIH3t.css"])))=>i.map(i=>d[i]);
import{r as m,j as e,c1 as re,c0 as ie,T as r,az as l,aR as P,a3 as le,av as B,bB as ce,ae as b,ac as f,m as w,B as h,p as L,aj as O,as as U,l as R,b2 as de,al as me,am as ue,an as xe,ap as pe,aq as ge,bd as je,P as he,aw as fe,ax as ve,bF as Ce,bg as be,aX as ye,q as Ie,aL as we,bI as k,bJ as Se,h as Ne,t as Ae}from"./client-OfhJa1Pp.js";import{a as q,I as Re,S as Fe,u as _}from"./custom-menu-BbwshV9x.js";import{b as ke}from"./crupdate-resource-layout-D52z_ZDE.js";import{B as Te}from"./background-selector-BILI5Vtb.js";import{B as ze,F as Ee}from"./font-selector-X9xeL-3L.js";import{m as Me,u as Ve}from"./use-sortable-DQoLtUe2.js";import{C as Pe,O as Be}from"./color-picker-dialog-C1vQg-H6.js";import{S as j}from"./select-Dsco87dL.js";import{A as Le}from"./attribute-input-renderer-BJ7XGaGf.js";import{g as Oe}from"./get-default-values-for-form-with-attributes-htMbgWW2.js";import{C as y,g as D}from"./campaign-conditions-config-DJxMZaUr.js";import{F as Ue}from"./filter-operator-names-BZog1mvA.js";import{t as qe,T as _e}from"./technology-or-locale-select-BVTh5G63.js";import{A}from"./Add-CN0r1QLK.js";import{a as W}from"./use-compact-agents-VrJm5fj6.js";import{a as H}from"./agent-avatar-CN8Be1Dj.js";import{D as De}from"./DragIndicator-BbWWPJ1P.js";import{E as We}from"./Edit-JNj6SFDx.js";import{I as He}from"./image-selector-Bwr5VwEQ.js";import{F as Ke}from"./file-upload-provider-DTPBUrkd.js";import{R as Qe}from"./emoji-picker-button-CQGpXygB.js";import{E as Ge}from"./enhance-text-with-ai-button-CxIfCpJn.js";import{F as Je,R as Xe}from"./floating-toolbar-Db61G721.js";import{c as Ye,s as K,C as Ze}from"./campaign-renderer-DoUgJ45b.js";import{c as $e,u as es}from"./email-campaign-CZFBcnz-.js";import{I as ss}from"./Image-CLhNm6Gt.js";import{M as ns,I as ts,V as as}from"./VideoLibrary-DdQlyMIC.js";import{S as os}from"./main-CqFMqK8-.js";import{T as rs}from"./TextFields-8TfbEP0O.js";import{B as is,a as T}from"./breadcrumb-DMWJORWM.js";import{T as ls,a as cs,b as N}from"./tabs-BfUlcoJh.js";import"./datatable-page-with-header-layout-B1YkbSHJ.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import"./FormatColorFill-8XiV_8LV.js";import"./ArrowDownward-mN9PlQJw.js";import"./ArrowForward-COs0hk5q.js";import"./ArrowUpward-0cWC32BO.js";import"./css-props-from-bg-config-CgypBlFP.js";import"./radio-group-DQLhD511.js";import"./radio-Db_caP9D.js";import"./simple-background-position-selector-DK2xckgz.js";import"./use-filter-KNtT5Txy.js";import"./skeleton-Cp2m1Uyc.js";import"./isScrollable-BSEN4xi5.js";import"./use-droppable-DqkAoZym.js";import"./uploaded-file-DN6fXT4v.js";import"./useGlobalListeners-CeWFSHKo.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./button-group-Cs5CuUiC.js";import"./date-picker-CUWok1XJ.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./ThumbDown-CmU9VZYm.js";import"./ThumbUp-B7v5mSGQ.js";import"./helpdesk-channel-CQKSbeKg.js";import"./online-status-circle-QXiKm4xe.js";import"./HourglassEmpty-BpvqVftp.js";import"./use-active-upload-CCDRf1Tl.js";import"./open-upload-window-CSDcieK1.js";import"./shallow-BSWIanyL.js";import"./AddAPhoto-eWqbbo4Z.js";import"./progress-bar-iRLStr1h.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./with-selector-CDgEpx5P.js";import"./tiptap-editor-context-BAgvnYfz.js";import"./use-is-module-installed-FCoToztC.js";import"./OpenInFull-HWkxb3KN.js";import"./Spellcheck-Bs1hoM4Q.js";import"./list-buttons-BgDZUgyW.js";import"./FormatListNumbered-rvs8UAfH.js";import"./index-W-EjzbYI.js";import"./Link-DfTxpaxj.js";import"./Send-CHhhtcWL.js";import"./useEffectEvent-DQn3o5L0.js";import"./ChevronRight-T5gg5A4x.js";import"./MoreHoriz-hMMIYAbm.js";const ds=({initialData:s})=>re()((n,t)=>({name:(s==null?void 0:s.label)??(s==null?void 0:s.name)??"New campaign",content:(s==null?void 0:s.content)??[],conditions:(s==null?void 0:s.conditions)??[],appearance:(s==null?void 0:s.appearance)??{},setName:o=>n({name:o}),setAppearance:o=>n({appearance:{...t().appearance,...o}}),setContent:o=>n({content:o}),sortContent:(o,a)=>{n({content:Me(t().content,o,a)})},updateContentItem:(o,a)=>{n({content:t().content.map(i=>i.id===o?{...i,value:a}:i)})},removeContentItem:o=>{n({content:t().content.filter(a=>a.id!==o)})},setConditions:o=>n({conditions:o}),appendCondition:o=>{n({conditions:[...t().conditions,o]})},updateCondition:(o,a)=>{n({conditions:t().conditions.map((i,c)=>c===o?{...i,...a}:i)})},removeCondition:o=>{n({conditions:t().conditions.filter((a,i)=>i!==o)})},getPayload:()=>({name:t().name,content:t().content,conditions:t().conditions,appearance:t().appearance})})),Q=m.createContext(null);function ms({children:s,initialData:n}){const t=m.useRef(ds({initialData:n})).current;return e.jsx(Q.Provider,{value:t,children:s})}function d(s){const n=m.useContext(Q);return ie(n,s)}function us(){return e.jsxs("div",{children:[e.jsx(xs,{}),e.jsx(gs,{}),e.jsx(js,{})]})}function xs(){const s=d(a=>a.appearance.textColor??""),n=d(a=>a.setAppearance),t=d(a=>a.appearance.textSize??"md"),o=d(a=>a.appearance.size??"sm");return e.jsxs("div",{className:"mb-60",children:[e.jsx(F,{children:e.jsx(r,{message:"Style"})}),e.jsxs("div",{className:"grid-cols-3 items-center gap-24 max-md:space-y-12 md:grid",children:[e.jsx(ps,{label:e.jsx(r,{message:"Text color"}),value:s,onChange:a=>{n({textColor:a})}}),e.jsxs(j,{selectionMode:"single",label:e.jsx(r,{message:"Text size"}),selectedValue:t,onSelectionChange:a=>{n({textSize:a})},children:[e.jsx(l,{value:"sm",children:e.jsx(r,{message:"Small"})}),e.jsx(l,{value:"md",children:e.jsx(r,{message:"Medium"})}),e.jsx(l,{value:"lg",children:e.jsx(r,{message:"Large"})})]}),e.jsxs(j,{selectionMode:"single",label:e.jsx(r,{message:"Popup size"}),selectedValue:o,onSelectionChange:a=>{n({size:a})},children:[e.jsx(l,{value:"sm",children:e.jsx(r,{message:"Small"})}),e.jsx(l,{value:"md",children:e.jsx(r,{message:"Medium"})}),e.jsx(l,{value:"lg",children:e.jsx(r,{message:"Large"})})]})]})]})}function ps({value:s,onChange:n,label:t}){const o=le({size:"md",startAppend:e.jsx(m.Fragment,{})}),a=m.useId();return e.jsxs("div",{children:[e.jsx("label",{className:o.label,htmlFor:a,children:t}),e.jsxs("div",{className:"flex",children:[e.jsxs(B,{type:"popover",value:s,onValueChange:n,onClose:n,children:[e.jsx(ce,{className:"h-42 w-42 flex-shrink-0 rounded-input border bg-black",style:{backgroundColor:s}}),e.jsx(Pe,{showInput:!1})]}),e.jsx(Be,{id:a,autoComplete:"off",role:"textbox",autoCorrect:"off",spellCheck:"false",required:!0,prefixed:!0,className:o.input,color:s,onChange:n})]})]})}function gs(){const s=d(t=>t.appearance.bgConfig),n=d(t=>t.setAppearance);return e.jsxs("div",{className:"mb-60",children:[e.jsx(F,{children:e.jsx(r,{message:"Background"})}),e.jsx(Te,{uploadType:P.brandingImages,value:s,onChange:t=>{n({bgConfig:t})}})]})}function js(){const s=d(t=>t.appearance.fontConfig??ze[0]),n=d(t=>t.setAppearance);return e.jsxs("div",{children:[e.jsx(F,{children:e.jsx(r,{message:"Font"})}),e.jsx(Ee,{value:s,onChange:t=>{n({fontConfig:t})}})]})}function F({children:s}){return e.jsx("h2",{className:"mb-20 text-xl font-semibold",children:s})}function hs({name:s,value:n,className:t,onChange:o,size:a,label:i}){const{trans:c}=b(),x=y[s];if(!("inputConfig"in x))return null;const p=x.inputConfig.type;return qe.includes(p)?e.jsx(_e,{type:p,label:i,size:a,className:t,value:n,onChange:u=>o==null?void 0:o(u)}):e.jsx(f,{size:a,label:i,type:x.inputConfig.type??"text",className:t,inputClassName:"hide-number-input-arrows",value:n,onChange:u=>o==null?void 0:o(u.target.value),placeholder:c(w("Enter value")),endAdornment:"description"in x.inputConfig&&e.jsx("div",{className:"pr-12 text-xs",children:e.jsx(r,{...x.inputConfig.description})})})}function fs(){const s=d(o=>o.conditions),n=d(o=>o.appendCondition),t=o=>{const a=s,i=Object.entries(y),c=i.find(p=>!(a!=null&&a.some(u=>u.name===p[0])))??i[0],[x]=c;n({...G(x),match_type:o})};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-44",children:[e.jsx(E,{type:"all"}),s.map((o,a)=>o.match_type==="all"?e.jsx(z,{index:a},a):null),e.jsx(h,{variant:"outline",startIcon:e.jsx(A,{}),onClick:()=>t("all"),size:"xs",className:"mt-12",children:e.jsx(r,{message:"Add condition"})})]}),e.jsxs("div",{className:"mb-44",children:[e.jsx(E,{type:"any"}),s.map((o,a)=>o.match_type==="any"?e.jsx(z,{index:a},a):null),e.jsx(h,{variant:"outline",startIcon:e.jsx(A,{}),onClick:()=>t("any"),size:"xs",className:"mt-12",children:e.jsx(r,{message:"Add condition"})})]})]})}function z({index:s}){const n=d(u=>u.conditions[s]),t=d(u=>u.updateCondition),o=d(u=>u.removeCondition),a=n.name==="attribute",i=J(),c=n.valueKey?i==null?void 0:i.find(u=>u.key===n.valueKey):null,x=e.jsx(j,{selectionMode:"single",minWidth:"min-w-[246px]",selectedValue:n.name,onSelectionChange:u=>{t(s,G(u,i))},children:Object.entries(y).map(([u,I])=>e.jsx(l,{value:u,children:e.jsx(r,{...I.label})},u))}),p=c?e.jsx(Le,{className:"max-w-264 flex-auto flex-shrink-0",attribute:c,value:n.value,onChange:u=>t(s,{value:u}),renderAsFormElement:!1,hideLabel:!0,inputTypeAlwaysText:!0,preferSelects:!0}):e.jsx(hs,{className:"max-w-264 flex-auto flex-shrink-0",name:n.name,value:n.value,onChange:u=>t(s,{value:u})});return e.jsxs("div",{className:L("items-center gap-x-14 border-b border-b-divider-lighter py-14 max-lg:space-y-12 lg:flex",a&&"flex-wrap"),children:[x,a&&e.jsxs(m.Fragment,{children:[e.jsx("div",{className:"my-6 ml-auto h-1 w-full"}),e.jsx(Cs,{index:s})]}),e.jsx(vs,{index:s,attribute:c}),p,e.jsx(O,{color:"danger",onClick:()=>o(s),children:e.jsx(U,{})})]})}function vs({index:s,attribute:n}){const t=d(c=>c.updateCondition),o=d(c=>c.conditions[s]),a=y[o.name],i="operators"in a?a.operators:n?D(n):[];return!i||i.length<2?null:e.jsx(j,{selectionMode:"single",minWidth:"min-w-160",selectedValue:o.operator,onSelectionChange:c=>t(s,{operator:c}),children:i.map(c=>e.jsx(l,{value:c,capitalizeFirst:!0,children:e.jsx(r,{...Ue[c]})},c))})}function Cs({index:s}){const n=J(),t=d(a=>a.conditions[s].valueKey),o=d(a=>a.updateCondition);return e.jsx(j,{className:"flex-shrink-0",minWidth:"min-w-[246px]",selectionMode:"single",selectedValue:t,floatingWidth:"auto",onSelectionChange:a=>{var c;const i=n.find(x=>x.key===a);if(i){const x=Oe([i]),p=(c=D(i))==null?void 0:c[0];o(s,{valueKey:a,value:x[i.key],operator:p})}},children:n==null?void 0:n.map(a=>e.jsx(l,{value:a.key,capitalizeFirst:!0,children:a.name},a.key))})}function G(s,n){const t=y[s];return{name:s,value:"defaultValue"in t?t.defaultValue:"",operator:"operators"in t?"defaultOperator"in t?t.defaultOperator:t.operators[0]:de.eq,valueKey:s==="attribute"&&(n!=null&&n.length)?n[0].key:""}}function E({type:s}){const n={b:t=>e.jsx("span",{className:"mx-4 rounded border bg-alt px-6 py-2 font-bold",children:t})};return e.jsx("h2",{className:"border-b pb-8 text-sm font-bold",children:s==="all"?e.jsx(r,{message:"Meet <b>all</b> the following conditions",values:n}):e.jsx(r,{message:"Meet <b>any</b> of the following conditions",values:n})})}function J(){return q({...R.attributes.normalizedList({type:"user",for:"agent"}),select:s=>s.attributes.filter(n=>!n.materialized)}).data}function v({children:s,value:n,defaultValue:t,size:o="md"}){const{close:a,formId:i}=me(),[c,x]=s;return e.jsxs(ue,{size:o,children:[e.jsx(xe,{children:c}),e.jsx(pe,{children:e.jsx("form",{id:i,onSubmit:p=>{p.preventDefault(),a(n)},children:x})}),e.jsxs(ge,{children:[e.jsx(h,{onClick:()=>a(),children:e.jsx(r,{message:"Cancel"})}),e.jsx(h,{type:"submit",color:"primary",variant:"flat",form:i,children:t!=null?e.jsx(r,{message:"Update"}):e.jsx(r,{message:"Add"})})]})]})}function X({defaultValue:s}){const[n,t]=m.useState(s??{agentId:0}),{agents:o}=W();return e.jsxs(v,{defaultValue:s,value:n,children:[e.jsx(r,{message:"Agent"}),e.jsx("div",{children:e.jsxs(j,{selectionMode:"single",selectedValue:n.agentId,label:e.jsx(r,{message:"Agent"}),onItemSelected:a=>{t({...n,agentId:a})},children:[e.jsx(l,{value:0,children:e.jsx(r,{message:"First available agent"})}),o.map(a=>e.jsx(l,{value:a.id,startIcon:e.jsx(H,{user:a,size:"sm"}),children:a.name},a.id))]})})]})}function C({item:s,children:n,editDialog:t,pinnedToBottom:o,pinnedToTop:a,displayName:i}){const c=d(g=>g.sortContent),x=d(g=>g.updateContentItem),p=d(g=>g.removeContentItem),u=d(g=>g.content),I=m.useRef(null),S=o||a,{sortableProps:te,dragHandleRef:ae}=Ve({item:s||"noop",items:u,type:"campaignEditorSortable",ref:I,disabled:S,onSortEnd:(g,oe)=>{c(g,oe)}});return e.jsxs("div",{className:"mb-20 flex h-86 items-stretch overflow-hidden rounded-panel border bg-elevated shadow",ref:I,...te,children:[e.jsx("button",{type:"button",className:L("shrink-0 border-r px-10 transition-colors hover:text-primary",S?"pointer-events-none text-disabled":"text-muted"),ref:ae,disabled:o,children:e.jsx(De,{})}),e.jsxs("div",{className:"min-w-0 flex-auto px-14 pb-10 pt-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mb-4 mr-auto flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap text-sm font-semibold first-letter:capitalize",children:i||s.name}),e.jsxs(B,{type:"modal",onClose:g=>{g!=null&&x(s.id,g)},children:[e.jsx(h,{startIcon:e.jsx(We,{}),color:"primary",size:"sm",className:"ml-20",children:e.jsx(r,{message:"Edit"})}),t]}),e.jsx(O,{className:"text-muted",onClick:()=>p(s.id),size:"sm",children:e.jsx(U,{})})]}),e.jsxs("div",{className:"flex items-end justify-between gap-10",children:[n,S&&e.jsxs("div",{className:"whitespace-nowrap rounded-full border px-10 py-2 text-xs text-muted",children:[e.jsx("span",{className:"max-md:hidden",children:o?e.jsx(r,{message:"Pinned to bottom"}):e.jsx(r,{message:"Pinned to top"})}),e.jsx("span",{className:"md:hidden",children:e.jsx(r,{message:"Pinned"})})]})]})]})]},s.id)}function bs({item:s}){const{agents:n}=W(),t=s.value.agentId,o=n.find(a=>a.id===t)??n[0];return e.jsx(C,{item:s,editDialog:e.jsx(X,{defaultValue:s.value}),children:o?e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx(H,{user:o,size:"sm"}),e.jsx("div",{children:o.name})]}):null})}function Y({defaultValue:s}){const[n,t]=m.useState(s??{label:""});return e.jsxs(v,{defaultValue:s,value:n,children:[e.jsx(r,{message:"Button"}),e.jsxs(m.Fragment,{children:[e.jsx(f,{autoFocus:!0,value:n.label,label:e.jsx(r,{message:"Button label"}),onChange:o=>t({...n,label:o.target.value}),required:!0,className:"mb-24"}),e.jsxs(j,{selectionMode:"single",label:e.jsx(r,{message:"Action"}),selectedValue:n.action??"dismiss",onItemSelected:o=>t({...n,action:o}),className:"mb-24",children:[e.jsx(l,{value:"dismiss",children:e.jsx(r,{message:"Dismiss campaign"})}),e.jsx(l,{value:"openUrl",children:e.jsx(r,{message:"Open a link"})}),e.jsx(l,{value:"copyToClipboard",children:e.jsx(r,{message:"Copy text to clipboard"})}),e.jsx(l,{value:"openEmbed",children:e.jsx(r,{message:"Show link in embedded window"})}),e.jsx(l,{value:"sendMessage",children:e.jsx(r,{message:"Send message"})})]}),n.action&&n.action!=="dismiss"&&e.jsx(f,{label:e.jsx(ys,{action:n.action}),value:n.actionValue??"",onChange:o=>t({...n,actionValue:o.target.value}),className:"mb-24",required:!0}),e.jsxs(j,{selectionMode:"single",label:e.jsx(r,{message:"Size"}),selectedValue:n.size??"sm",onItemSelected:o=>t({...n,size:o}),className:"mb-24",children:[e.jsx(l,{value:"xs",children:e.jsx(r,{message:"Small"})}),e.jsx(l,{value:"sm",children:e.jsx(r,{message:"Medium"})}),e.jsx(l,{value:"md",children:e.jsx(r,{message:"Large"})})]}),e.jsxs(j,{selectionMode:"single",label:e.jsx(r,{message:"Style"}),className:"mb-24",selectedValue:n.variant??"flat",onItemSelected:o=>t({...n,variant:o}),children:[e.jsx(l,{value:"",children:e.jsx(r,{message:"Basic"})}),e.jsx(l,{value:"flat",children:e.jsx(r,{message:"Filled"})}),e.jsx(l,{value:"outline",children:e.jsx(r,{message:"Outlined"})})]}),e.jsxs(j,{selectionMode:"single",label:e.jsx(r,{message:"Color"}),selectedValue:n.color??"primary",onItemSelected:o=>t({...n,color:o}),children:[e.jsx(l,{value:"primary",children:e.jsx(r,{message:"Primary"})}),e.jsx(l,{value:"danger",children:e.jsx(r,{message:"Danger"})}),e.jsx(l,{value:"positive",children:e.jsx(r,{message:"Sucess"})}),e.jsx(l,{value:"chip",children:e.jsx(r,{message:"Gray"})}),e.jsx(l,{value:"white",children:e.jsx(r,{message:"White"})})]})]})]})}function ys({action:s}){switch(s){case"dismiss":return e.jsx(r,{message:"Action value"});case"openUrl":return e.jsx(r,{message:"URL to open"});case"copyToClipboard":return e.jsx(r,{message:"Text to copy"});case"openEmbed":return e.jsx(r,{message:"Embed URL"});case"sendMessage":return e.jsx(r,{message:"Message to send"})}}function Is({item:s}){return e.jsx(C,{item:s,editDialog:e.jsx(Y,{defaultValue:s.value}),children:e.jsx(h,{variant:s.value.variant||void 0,color:s.value.color??"primary",size:"xs",children:e.jsx(r,{message:s.value.label??"Text"})})})}function Z({defaultValue:s}){const[n,t]=m.useState(s??{url:"",width:0,height:0});return e.jsxs(v,{defaultValue:s,value:n,children:[e.jsx(r,{message:"Embed"}),e.jsx(f,{required:!0,autoFocus:!0,type:"url",value:n.url,onChange:o=>t({...n,url:o.target.value}),label:e.jsx(r,{message:"Embed URL"})})]})}function ws({item:s}){return e.jsx(C,{item:s,editDialog:e.jsx(Z,{defaultValue:s.value}),children:s.value.url?e.jsx("a",{href:s.value.url,target:"_blank",className:"hover:underline",children:new URL(s.value.url).hostname}):null})}function $({defaultValue:s}){const{trans:n}=b(),[t,o]=m.useState(s??{size:"stretch",radius:"none"});return e.jsxs(v,{defaultValue:s,value:t,children:[e.jsx(r,{message:"Image"}),e.jsxs(m.Fragment,{children:[e.jsx(Ke,{children:e.jsx(He,{uploadType:P.brandingImages,onChange:a=>o(i=>({...i,url:a})),value:t.url,className:"mb-24",required:!0,onFileSelected:async a=>{const{width:i,height:c}=await Ss(a);o(x=>({...x,width:i,height:c}))}})}),e.jsxs(j,{selectionMode:"single",selectedValue:t.size,label:e.jsx(r,{message:"Image size"}),className:"mb-24",onItemSelected:a=>{o({...t,size:a})},children:[e.jsx(l,{value:"stretch",children:e.jsx(r,{message:"Stretch to fit"})}),e.jsx(l,{value:"original",children:e.jsx(r,{message:"Original"})})]}),e.jsxs(j,{selectionMode:"single",selectedValue:t.radius,label:e.jsx(r,{message:"Rounding"}),className:"mb-24",onItemSelected:a=>{o({...t,radius:a})},children:[e.jsx(l,{value:"none",children:e.jsx(r,{message:"None"})}),e.jsx(l,{value:"sm",children:e.jsx(r,{message:"Small"})}),e.jsx(l,{value:"md",children:e.jsx(r,{message:"Medium"})}),e.jsx(l,{value:"circle",children:e.jsx(r,{message:"Circle"})})]}),e.jsx(f,{placeholder:n(w("Optional")),name:"destinationUrl",type:"url",value:t.destinationUrl,onChange:a=>o({...t,destinationUrl:a.target.value}),label:e.jsx(r,{message:"Destination url"}),description:e.jsx(r,{message:"Open this link in new window when clicking the image."})})]})]})}function Ss(s){return new Promise(n=>{const t=new Image;t.onload=()=>{n({width:t.width,height:t.height}),URL.revokeObjectURL(t.src)},t.src=URL.createObjectURL(s)})}function Ns({item:s}){return e.jsx(C,{item:s,editDialog:e.jsx($,{defaultValue:s.value}),children:e.jsx("img",{src:s.value.url,alt:"",className:"h-32 overflow-hidden rounded-panel"})})}function ee({defaultValue:s}){const{trans:n}=b(),[t,o]=m.useState(s??{placeholder:"Write a message..."});return e.jsxs(v,{defaultValue:s,value:t,children:[e.jsx(r,{message:"Message input"}),e.jsx(f,{required:!0,placeholder:n(w("Write a message...")),name:"placeholder",value:t.placeholder,onChange:a=>o({...t,placeholder:a.target.value}),label:e.jsx(r,{message:"Placeholder"})})]})}function As({item:s}){const{trans:n}=b();return e.jsx(C,{item:s,editDialog:e.jsx(ee,{defaultValue:s.value}),pinnedToBottom:!0,displayName:"Message input",children:e.jsx(f,{className:"max-w-200",placeholder:n({message:s.value.placeholder||""}),size:"xs"})})}const Rs=m.lazy(()=>je(()=>import("./reply-composer-container-CGWK_3_X.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]),import.meta.url));function se({defaultValue:s}){const[n,t]=m.useState(s??{text:""});return e.jsxs(v,{defaultValue:s,value:n,size:"lg",children:[e.jsx(r,{message:"Text"}),e.jsx(m.Suspense,{fallback:e.jsx(Fs,{}),children:e.jsxs(Rs,{bodyClassName:Ye,height:"h-240",initialContent:n.text,onChange:o=>t({...n,text:o}),submitToClosestForm:!0,children:[e.jsx(Je,{}),e.jsxs(Xe,{children:[e.jsx(Qe,{}),e.jsx(Ge,{disabled:!n.text.length})]})]})})]})}function Fs(){return e.jsx("div",{className:"flex h-240 items-center justify-center",children:e.jsx(he,{isIndeterminate:!0})})}function ks({item:s}){const n=m.useMemo(()=>s.value.text.replace(/<[^>]*>?/gm,""),[s.value.text]);return e.jsx(C,{item:s,editDialog:e.jsx(se,{defaultValue:s.value}),children:e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap text-sm",children:n})})}const Ts={text:se,image:$,embed:Z,button:Y,messageInput:ee,agent:X};function zs(){const s=d(o=>o.content),n=m.useMemo(()=>K(s),[s]),t=e.jsx(Re,{className:"mt-84",title:e.jsx(r,{message:"This campaign has no content yet"}),description:e.jsx(M,{size:"xs",className:"mt-12"}),image:e.jsx(Fe,{src:$e})});return e.jsxs("div",{className:"min-w-0 flex-auto",children:[e.jsx(M,{}),e.jsxs("div",{className:"mt-20",children:[n.map(o=>e.jsx(Es,{item:o},o.id)),n.length===0&&t]})]})}function Es({item:s}){switch(s.name){case"text":return e.jsx(ks,{item:s});case"image":return e.jsx(Ns,{item:s});case"button":return e.jsx(Is,{item:s});case"messageInput":return e.jsx(As,{item:s});case"agent":return e.jsx(bs,{item:s});case"embed":return e.jsx(ws,{item:s})}}function M({size:s="xs",className:n}){const t=d(a=>a.content),o=d(a=>a.setContent);return e.jsxs(fe,{onItemSelected:async a=>{const i=a,c=await Ce(Ts[i]);c!=null&&o([...t,{id:be(6),name:i,value:c}])},children:[e.jsx(h,{variant:"flat",color:"primary",size:s,startIcon:e.jsx(A,{}),className:n,children:e.jsx(r,{message:"Add content"})}),e.jsxs(ve,{children:[e.jsx(l,{value:"image",startIcon:e.jsx(ss,{}),children:e.jsx(r,{message:"Image"})}),e.jsx(l,{value:"text",startIcon:e.jsx(rs,{}),children:e.jsx(r,{message:"Text"})}),e.jsx(l,{value:"button",startIcon:e.jsx(ns,{}),children:e.jsx(r,{message:"Button"})}),e.jsx(l,{value:"agent",startIcon:e.jsx(os,{}),children:e.jsx(r,{message:"Agent name"})}),e.jsx(l,{value:"messageInput",startIcon:e.jsx(ts,{}),children:e.jsx(r,{message:"Message input"})}),e.jsx(l,{value:"embed",startIcon:e.jsx(as,{}),children:e.jsx(r,{message:"Embed"})})]})]})}function Ms(){return e.jsxs("div",{className:"sticky top-0 mr-auto hidden flex-shrink-0 lg:block",children:[e.jsx(ye,{size:"sm",color:"positive",radius:"rounded",className:"m-auto mb-24 w-max",children:e.jsx(r,{message:"Live preview"})}),e.jsx(ne,{})]})}function ne(){const s=d(a=>a.appearance.size),n=d(a=>a.appearance),t=d(a=>a.content),o=m.useMemo(()=>K(t),[t]);return e.jsx("div",{className:Vs(s),children:e.jsx(Ze,{campaign:{content:o,appearance:n}})})}function Vs(s){switch(s){case"sm":return"w-240";case"md":return"w-[300px]";case"lg":return"w-375";default:return"w-240"}}const V=["content","appearance","conditions"];function Ps({saveButton:s}){Ie.ensureQueryData(R.agents.compact);const n=d(i=>i.name),[t,o]=we(),a=V.indexOf(t.get("tab")??"content")??0;return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(ke,{endActions:s,border:"border-none",children:e.jsxs(is,{size:"xl",children:[e.jsx(T,{to:"..",children:e.jsx(r,{message:"Campaigns"})}),e.jsx(T,{children:n})]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ls,{selectedTab:a,onTabChange:i=>{o({tab:V[i]},{replace:!0})},children:e.jsxs(cs,{className:"mx-24",children:[e.jsx(N,{children:e.jsx(r,{message:"Content"})}),e.jsx(N,{children:e.jsx(r,{message:"Appearance"})}),e.jsx(N,{children:e.jsx(r,{message:"Conditions"})})]})})}),e.jsxs("div",{className:"gap-60 overflow-y-auto px-24 py-56 stable-scrollbar lg:flex",children:[e.jsxs("div",{className:"ml-auto min-w-0 flex-auto lg:max-w-780",children:[a===0&&e.jsx(zs,{}),a===1&&e.jsx(us,{}),a===2&&e.jsx(fs,{})]}),e.jsx(Ms,{})]})]})}const Bs=m.forwardRef((s,n)=>{const[t,o]=m.useState(null),a=m.useRef(null);return m.useImperativeHandle(n,()=>i=>{k.flushSync(()=>o(e.jsx(ne,{}))),i(a.current),requestAnimationFrame(()=>o(null))},[]),t?k.createPortal(e.jsx("div",{style:{zIndex:-100,position:"absolute",top:0,left:-1e5},children:e.jsx("div",{ref:a,className:"h-max w-max",children:t})}),Se):null});function dt(){const{campaignId:s}=_(["campaignId"]),n=q(R.campaigns.get(s));return e.jsx(ms,{initialData:n.data.campaign,children:e.jsx(Ls,{})})}function Ls(){const{trans:s}=b(),{campaignId:n}=_(["campaignId"]),t=d(c=>c.getPayload),o=es(n),a=Ne(),i=m.useRef(null);return e.jsxs(m.Fragment,{children:[e.jsx(Ps,{saveButton:e.jsx(h,{variant:"flat",color:"primary",disabled:o.isPending,onClick:()=>{i.current(c=>{const{width:x,height:p}=c.getBoundingClientRect();o.mutate({...t(),width:x,height:p},{onSuccess:()=>{Ae(s(w("Campaign updated"))),a("../..",{relative:"path"})}})})},children:e.jsx(r,{message:"Save"})})}),e.jsx(Bs,{ref:i})]})}export{dt as Component};
