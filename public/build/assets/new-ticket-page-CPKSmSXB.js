import{b4 as v,f as w,j as e,aR as E,b3 as P,a3 as R,i as B,q as C,l as I,t as f,m as y,k as D,aP as A,F as Q,T as o,B as U,by as q,h as V,r as M,bT as H}from"./client-OfhJa1Pp.js";import{o as K,a as L,h as b}from"./custom-menu-BbwshV9x.js";import{H as z}from"./hc-search-bar-BR0l8lH9.js";import{A as _}from"./attribute-input-renderer-BJ7XGaGf.js";import{u as Y,C as $,S as G}from"./use-customer-new-ticket-form-DC875_si.js";import{R as J}from"./emoji-picker-button-CQGpXygB.js";import{R as O,U as W,I as X,a as Z}from"./upload-attachments-button-BWcvmOOE.js";import ee from"./reply-composer-container-CGWK_3_X.js";import{F as se,R as te}from"./floating-toolbar-Db61G721.js";import{F as re}from"./file-upload-provider-DTPBUrkd.js";import{u as ae,C as ie}from"./use-captcha-CGFhx3Qc.js";import{N as oe}from"./main-CqFMqK8-.js";import{B as me,a as u}from"./breadcrumb-DMWJORWM.js";import"./article-link-xsQ04UkN.js";import"./slugify-string-aubjgLQq.js";import"./article-path-Da7o5kHE.js";import"./category-link-0Q_zOKi3.js";import"./use-keybind-7f4ijAco.js";import"./useGlobalListeners-CeWFSHKo.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./combobox-pHOmOE77.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./button-group-Cs5CuUiC.js";import"./date-picker-CUWok1XJ.js";import"./radio-Db_caP9D.js";import"./radio-group-DQLhD511.js";import"./select-Dsco87dL.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./ThumbDown-CmU9VZYm.js";import"./ThumbUp-B7v5mSGQ.js";import"./accordtion-animation-BGCK95Hj.js";import"./get-default-values-for-form-with-attributes-htMbgWW2.js";import"./tiptap-editor-context-BAgvnYfz.js";import"./image-button-ExYLUK-F.js";import"./image-up-DCwS84Wx.js";import"./use-active-upload-CCDRf1Tl.js";import"./open-upload-window-CSDcieK1.js";import"./uploaded-file-DN6fXT4v.js";import"./shallow-BSWIanyL.js";import"./file-preview-dialog-DZbR1Zhl.js";import"./file-thumbnail-D9-TxWtC.js";import"./file-type-icon-Dok_AF4H.js";import"./ChevronLeft-B96ua4ZU.js";import"./ChevronRight-T5gg5A4x.js";import"./FileDownload-DoJWzr8l.js";import"./download-file-from-url-hJ3EUwXO.js";import"./formatted-bytes-CmuQhzYn.js";import"./pretty-bytes-bO14ePu9.js";import"./progress-bar-iRLStr1h.js";import"./use-upload-attachments-D0EFLOL9.js";import"./use-droppable-DqkAoZym.js";import"./paperclip-DIi_RQSY.js";import"./formatted-message-body-WNPn2fpJ.js";import"./variable-extension-Cjf6-ocs.js";import"./campaign-conditions-config-DJxMZaUr.js";import"./Event-7FmyLdJJ.js";import"./ToggleOn-DZgCezoB.js";import"./TextFields-8TfbEP0O.js";import"./Add-CN0r1QLK.js";import"./index-W-EjzbYI.js";import"./with-selector-CDgEpx5P.js";import"./DataObject-XQLwxsph.js";import"./index-DTFmR8Ac.js";import"./core-Dg-ESrC8.js";import"./index-RecbqAl0.js";import"./list-buttons-BgDZUgyW.js";import"./FormatListNumbered-rvs8UAfH.js";import"./Link-DfTxpaxj.js";import"./useEffectEvent-DQn3o5L0.js";import"./MoreHoriz-hMMIYAbm.js";function ne({attachments:t,errorMessage:m}){const{hasPermission:r}=v(),n=!r("files.create"),c=w(),p=a=>{c.setValue("message.attachments",[a,...t],{shouldDirty:!0})};return e.jsxs(re,{children:[e.jsx(O,{isDisabled:n,onUpload:p,children:e.jsxs(ee,{submitToClosestForm:!0,autoFocus:!1,onChange:a=>c.setValue("message.body",a,{shouldDirty:!0}),children:[e.jsx(se,{}),e.jsxs(te,{children:[e.jsx(J,{}),!n&&e.jsx(W,{onUpload:p}),!n&&e.jsx(X,{uploadType:E.conversationImages})]})]})}),m,e.jsx(Z,{className:"mt-12",attachments:t,onRemove:a=>{c.setValue("message.attachments",t.filter(i=>i.id!==a.id),{shouldDirty:!0})}})]})}function ce({data:t}){var g,j;const{isLoggedIn:m}=v(),r=P(),n=R(),{captchaToken:c,captchaEnabled:p,resetCaptcha:a}=ae("new_ticket"),{form:i,attachments:l,searchQuery:N,searchTermLogger:k,hcCategoryIds:T,attributes:F}=Y(t),h=(j=(g=i.formState.errors.message)==null?void 0:g.body)==null?void 0:j.message,x=B({mutationFn:async s=>D.post("helpdesk/customer/tickets",{...s,message:{...s.message,attachments:s.message.attachments.map(d=>d.id)},captcha_token:c}).then(d=>d.data),onSuccess:async()=>{await C.invalidateQueries({queryKey:I.conversations.invalidateKey}),f(y("Ticket created")),k.updateLastSearch({createdTicket:!0}),r(m?"/hc/tickets":"/hc")},onError:s=>(a(),K(s,i))}),S=async()=>{if(p&&!c){f.danger(y("Please solve the captcha challenge."));return}x.mutate(i.getValues())};return e.jsxs(A,{form:i,onSubmit:()=>S(),onBeforeSubmit:()=>i.clearErrors(),className:"overflow-x-hidden",children:[!t.customerEmail&&e.jsx(Q,{name:"email",type:"email",label:e.jsx(o,{message:"Your email address"}),className:"mb-24",required:!0}),F.map(s=>s?s.key==="category"?e.jsx($,{attribute:s},s.id):s.key==="subject"?e.jsx(G,{searchQuery:N,hcCategoryIds:T,attribute:s},s.id):s.key==="description"?e.jsxs("div",{className:"mb-24",children:[e.jsx("div",{className:n.label,children:e.jsx(o,{message:s.name})}),e.jsx(ne,{attachments:l,errorMessage:h&&e.jsx("div",{className:n.error,children:h})})]},s.id):e.jsx(_,{formPrefix:"attributes",attribute:s,className:"mb-24"},s.id):null),p&&e.jsx(ie,{className:"mb-24"}),e.jsx(U,{variant:"flat",color:"primary",type:"submit",disabled:x.isPending,children:e.jsx(o,{message:t.config.submitButtonText})})]})}function ws(){const{isInsideSettingsPreview:t}=q(),m=V(),r=L(b.customerConversations.newTicketPageData());return M.useEffect(()=>t?H(c=>{c.type==="setValues"&&C.setQueryData(b.customerConversations.newTicketPageData().queryKey,p=>{var a,i,l;return p&&{...p,config:(l=(i=(a=c.values.client)==null?void 0:a.hc)==null?void 0:i.newTicket)==null?void 0:l.appearance}})}):void 0,[t]),e.jsxs("div",{children:[e.jsx(oe,{color:"bg",menuPosition:"header",className:"sticky top-0 z-10",children:e.jsx(z,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(me,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(u,{onSelected:()=>m("/hc"),children:e.jsx(o,{message:"Help center"})}),e.jsx(u,{onSelected:()=>m("/hc/tickets"),children:e.jsx(o,{message:"Tickets"})}),e.jsx(u,{children:e.jsx(o,{message:"New ticket"})})]}),e.jsxs("div",{className:"flex items-stretch gap-44",children:[e.jsxs("main",{className:"min-w-0 grow basis-3/4",children:[e.jsx("h1",{className:"mb-34 mt-14 text-3xl font-light",children:e.jsx(o,{message:r.data.config.title})}),e.jsx(ce,{data:r.data})]}),e.jsx(pe,{data:r.data})]})]})]})}function pe({data:t}){var m;return e.jsxs("aside",{className:"min-w-320 basis-2/4 border-l px-40 max-md:hidden",children:[e.jsx("h2",{className:"mb-34 text-xl font-medium",children:e.jsx(o,{message:t.config.sidebarTitle})}),(m=t.config.sidebarTips)==null?void 0:m.map((r,n)=>e.jsxs("div",{className:"mb-30",children:[e.jsx("h3",{className:"text-lg font-medium",children:e.jsx(o,{message:r.title})}),e.jsx("p",{children:e.jsx(o,{message:r.content})})]},n))]})}export{ws as Component};
