import{u as b,r as n,j as e,T as r,a_ as m,aj as x,as as I,P as C,D as P,G as R,i as y,s as A,k,g as S,B as T}from"./client-OfhJa1Pp.js";import{a as f,W as g}from"./widget-flags-DGIUgINI.js";import{D as L}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{u as N}from"./custom-menu-BbwshV9x.js";import{R as B}from"./RestartAlt-BBLLDvr_.js";import{u as E}from"./use-is-module-installed-FCoToztC.js";import{C as M}from"./dashboard-icons-CHop3mns.js";function Q({flowId:s,resetConversationMessage:t,onClose:a}){const{base_url:i}=b(),l=n.useRef(null),[c,h]=n.useState(null),[v,d]=n.useState(!0),j=W(),{aiAgentId:p}=N(["aiAgentId"]);n.useEffect(()=>f.listen(window,{onPreviewLoaded:()=>{d(!1)},onConversationIdChanged:w=>{h(w)}}),[]);const o=new URL(i);o.pathname="/lc/widget/ai-agent-preview-mode",o.searchParams.set(g.keys.url.aiAgentId,p.toString()),s&&o.searchParams.set(g.keys.url.flowId,s.toString());const u=()=>{if(l.current)return c||d(!0),j.mutateAsync({conversationId:c,iframe:l.current})};return e.jsxs(n.Fragment,{children:[e.jsxs("div",{className:"dashboard-rounded-panel dashboard-grid-sidenav-right relative flex w-[400px] flex-shrink-0 flex-col overflow-hidden max-xl:fixed max-xl:bottom-8 max-xl:right-8 max-xl:top-8 max-xl:max-h-[calc(100%-16px)] max-xl:shadow-lg xl:ml-8",children:[e.jsx(L,{rightContent:e.jsxs(n.Fragment,{children:[e.jsx(m,{label:e.jsx(r,{message:"Reset preview"}),children:e.jsx(x,{onClick:()=>u(),children:e.jsx(B,{})})}),e.jsx(m,{label:e.jsx(r,{message:"Close preview"}),children:e.jsx(x,{onClick:()=>a(),children:e.jsx(I,{})})})]}),children:e.jsx(r,{message:"Preview"})}),e.jsxs("div",{className:"relative flex-auto",children:[e.jsx("iframe",{ref:l,src:o.toString(),className:"h-full w-full"}),t?e.jsx("div",{className:"absolute bottom-86 left-0 right-0 mx-20 bg",children:t(u)}):null,v&&e.jsx("div",{className:"absolute inset-0 m-auto flex h-full w-full items-center justify-center bg",children:e.jsx(C,{isIndeterminate:!0})})]})]}),e.jsx(P.div,{...R,className:"fixed inset-0 z-[1] bg-[rgba(34,48,74,.4)] xl:hidden",onClick:()=>a()},"preview-underlay")]})}function W(){return y({mutationFn:async({conversationId:s,iframe:t})=>{var a;return s?k.delete(`lc/ai-agent-preview/conversations/${s}`).then(i=>i.data):Promise.resolve((a=t.contentWindow)==null?void 0:a.location.reload())},onSuccess:(s,{iframe:t})=>{t.contentWindow&&f.postConversationReset(t.contentWindow)},onError:s=>A(s)})}function U({previewIsVisible:s,onTogglePreview:t}){const a=S();return E("livechat")?e.jsx(T,{startIcon:e.jsx(M,{}),size:"xs",variant:"outline",color:s?"primary":void 0,onClick:()=>{t()},children:a?e.jsx(r,{message:"Test"}):e.jsx(r,{message:"Test AI Agent"})}):null}export{Q as P,U as T};
