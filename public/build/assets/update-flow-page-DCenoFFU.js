var Md=Object.defineProperty;var Td=(e,t,n)=>t in e?Md(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var fe=(e,t,n)=>Td(e,typeof t!="symbol"?t+"":t,n);import{r as L,j as l,ak as Pd,m as ae,bg as nr,bf as Dd,bX as zd,_ as Rd,c1 as Ld,bA as Bo,aP as rr,ae as je,F as an,T as $,d as xe,az as le,f as Oe,Z as Ae,aG as Ne,aj as Ie,as as Qs,a_ as mt,E as $d,cj as Od,ck as Za,b$ as Bd,P as ln,b as Ka,be as et,B as ie,p as ge,a3 as Vd,aX as Js,av as Ut,q as Qa,aR as eo,al as sr,am as to,an as no,ap as ro,aq as so,D as On,G as oo,aw as or,ax as ir,bF as Fd,b2 as Ds,bD as Hd,b0 as qd,ag as Gd,e as io,t as Ja,aJ as Yd,aK as Wd,l as zs,L as el,C as Xd,aQ as Ud,cm as Zd,ao as Kd,i as Qd,s as Jd,k as ef}from"./client-OfhJa1Pp.js";import{P as Vo,g as ke,A as tl,k as tf,U as Fo}from"./main-CqFMqK8-.js";import{L as nf}from"./library-icon-CHCHM-UW.js";import{A as rf}from"./AccountTree-Dxk2iKnz.js";import{C as sf}from"./Chat-Ct1un6CP.js";import{F as Ho,C as yn,V as qo,a as of,R as af}from"./Remove-DknY9bfu.js";import{D as nl}from"./DataObject-XQLwxsph.js";import{H as lf}from"./HelpOutline-BWHaeyMp.js";import{H as rl}from"./Home--R_oEr6a.js";import{P as cf}from"./Power-B-bD5HaX.js";import{R as uf}from"./Route-BmvB1Yb9.js";import{S as df}from"./dashboard-icons-CHop3mns.js";import{a as ff,u as It,r as hf,F as sl}from"./file-upload-provider-DTPBUrkd.js";import{u as mf}from"./use-tags-BR3jky3Z.js";import{F as pf}from"./form-chip-field-sH5S7-lx.js";import{u as Me,h as gf,a as ol}from"./custom-menu-BbwshV9x.js";import{a as xf}from"./file-thumbnail-D9-TxWtC.js";import{u as il}from"./shallow-BSWIanyL.js";import{F as Le}from"./tiptap-text-field-CQWqZT9l.js";import{F as Ge}from"./select-Dsco87dL.js";import{a as Bn,u as lt,A as al,b as yf}from"./variable-extension-Cjf6-ocs.js";import{A as ll}from"./attribute-input-renderer-BJ7XGaGf.js";import{t as cl,T as ul}from"./technology-or-locale-select-BVTh5G63.js";import{A as Be}from"./Add-CN0r1QLK.js";import{I as wf}from"./image-up-DCwS84Wx.js";import{P as bf}from"./paperclip-DIi_RQSY.js";import{o as vf}from"./open-upload-window-CSDcieK1.js";import{C as Nf}from"./combobox-pHOmOE77.js";import{D as ao}from"./DragHandle-DNpm5kSf.js";import{u as ar,a as jf}from"./use-sortable-DQoLtUe2.js";import{D as Ef}from"./DragIndicator-BbWWPJ1P.js";import{M as _f}from"./MoreHoriz-hMMIYAbm.js";import{C as If}from"./confirmation-dialog-BIOq1A-h.js";import{F as dl}from"./filter-operator-names-BZog1mvA.js";import{A as Sf}from"./attribute-renderer-BAh3glGI.js";import{F as Cf}from"./formatted-country-name-BJ5sEUDs.js";import{A as kf}from"./ArrowBack-DcV9hHRo.js";import{D as Vn}from"./Delete-BhyMZiPM.js";import{E as fl}from"./Edit-JNj6SFDx.js";import{F as Af}from"./image-selector-Bwr5VwEQ.js";import{A as hl,a as ml}from"./accordion-DWEV-mKU.js";import{A as Mf}from"./attributes-manager-B56TrvQx.js";import{O as pl}from"./OpenInNew-Q67MT6Ae.js";import{C as gl}from"./chip-list-CkGaRoaT.js";import{C as Tf}from"./check-circle-filled-DBwRd3aX.js";import{i as Pf,u as Ar}from"./use-keybind-7f4ijAco.js";import{u as Df}from"./with-selector-CDgEpx5P.js";import{P as zf,T as Rf}from"./toggle-preview-button-xp_UTzfM.js";import{A as Lf}from"./admin-config-tfY5n3F7.js";import{D as $f}from"./settings-links-D22SAe6v.js";import{D as Of}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{S as Bf}from"./section-helper-Cq13cJUI.js";import{u as Vf}from"./useMutationState-V1q6F41O.js";import{B as Ff,a as Go}from"./breadcrumb-DMWJORWM.js";import{B as Hf}from"./blocker-dialog-B5ey95II.js";import"./messages-square-icon-CTmom_u4.js";import"./SupervisorAccount-k9OnPB-d.js";import"./uploaded-file-DN6fXT4v.js";import"./pretty-bytes-bO14ePu9.js";import"./file-type-icon-Dok_AF4H.js";import"./emoji-picker-button-CQGpXygB.js";import"./tiptap-editor-context-BAgvnYfz.js";import"./index-RecbqAl0.js";import"./index-W-EjzbYI.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./get-default-values-for-form-with-attributes-htMbgWW2.js";import"./campaign-conditions-config-DJxMZaUr.js";import"./Event-7FmyLdJJ.js";import"./ToggleOn-DZgCezoB.js";import"./TextFields-8TfbEP0O.js";import"./button-group-Cs5CuUiC.js";import"./date-picker-CUWok1XJ.js";import"./radio-Db_caP9D.js";import"./radio-group-DQLhD511.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./ThumbDown-CmU9VZYm.js";import"./ThumbUp-B7v5mSGQ.js";import"./isScrollable-BSEN4xi5.js";import"./use-droppable-DqkAoZym.js";import"./useGlobalListeners-CeWFSHKo.js";import"./use-active-upload-CCDRf1Tl.js";import"./AddAPhoto-eWqbbo4Z.js";import"./progress-bar-iRLStr1h.js";import"./file-input-config-DrcTpI3-.js";import"./accordtion-animation-BGCK95Hj.js";import"./pretty-attribute-type-CZh-32ZO.js";import"./Lock-CrI8g69F.js";import"./skeleton-Cp2m1Uyc.js";import"./group-array-by-5IjT7qk6.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./widget-flags-DGIUgINI.js";import"./use-widget-bootstrap-data-BlKRRco5.js";import"./RestartAlt-BBLLDvr_.js";import"./use-is-module-installed-FCoToztC.js";import"./Translate-Cs-ut2nW.js";import"./external-link-DbBk1ItZ.js";import"./book-open-Cbdc52Ur.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import"./useEffectEvent-DQn3o5L0.js";import"./ChevronRight-T5gg5A4x.js";const qf=L.forwardRef((e,t)=>l.jsxs(Pd,{...e,ref:t,children:[l.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}),l.jsx("path",{d:"m14.5 7.5-5 5"}),l.jsx("path",{d:"m9.5 7.5 5 5"})]}));var K=(e=>(e.start="start",e.message="message",e.buttons="buttons",e.dynamicButtons="dynamicButtons",e.buttonsItem="buttonsItem",e.articles="articles",e.cards="cards",e.dynamicCards="dynamicCards",e.transfer="transfer",e.closeConversation="closeConversation",e.goToStep="goToStep",e.goToFlow="goToFlow",e.collectDetails="collectDetails",e.tool="tool",e.toolResult="toolResult",e.setAttribute="setAttribute",e.addTags="addTags",e.branches="branches",e.branchesItem="branchesItem",e.placeholder="placeholder",e))(K||{});const wn={width:200,height:100},Gf={width:60,height:60},Te={width:200,height:60},Mr={width:120,height:40};function he(e,t){return{...t,type:e,createNewStoredNode:t.createNewStoredNode||(n=>[ye({type:e,parentId:n})])}}const ce={start:he(K.start,{size:Te,icon:rl,displayName:ae("Start point")}),message:he(K.message,{size:wn,icon:sf,displayName:ae("Message"),createNewStoredNode:e=>[ye({type:K.message,parentId:e,data:{message:"",buttons:[],attachmentIds:[]}})]}),buttons:he(K.buttons,{size:wn,icon:yn,displayName:ae("Buttons"),disallowChildren:!0,forceDeleteAllChildren:!0,createNewStoredNode:e=>{const t=ye({type:K.buttons,parentId:e,data:{message:"Select one of these options",attachmentIds:[]}});return[t,...ce.buttonsItem.createNewStoredNode(t.id)]}}),buttonsItem:he(K.buttonsItem,{size:Mr,icon:yn,displayName:ae("Buttons item"),createNewStoredNode:e=>[ye({type:K.buttonsItem,parentId:e,data:{name:"Button"}})]}),dynamicButtons:he(K.dynamicButtons,{size:Te,icon:yn,displayName:ae("Dynamic buttons"),requiredAnsector:K.tool}),articles:he(K.articles,{size:Te,icon:nf,displayName:ae("Help center articles"),createNewStoredNode:e=>[ye({type:K.articles,parentId:e,data:{message:"",attachmentIds:[],articleIds:[]}})]}),cards:he(K.cards,{size:Te,icon:qo,displayName:ae("Cards"),createNewStoredNode:e=>[ye({type:K.cards,parentId:e,data:{message:"",attachmentIds:[],cards:[{title:"Card title",description:"Card description",buttons:[{name:"Button",actionType:"openUrl",actionValue:"https://example.com"}]}]}})]}),dynamicCards:he(K.dynamicCards,{size:Te,icon:qo,displayName:ae("Dynamic cards"),requiredAnsector:K.tool,createNewStoredNode:e=>[ye({type:K.dynamicCards,parentId:e,data:{message:"",listPath:"",attachmentIds:[],toolId:0,card:{title:"",description:"",buttons:[{name:"",actionType:"sendMessage",actionValue:""}]}}})]}),collectDetails:he(K.collectDetails,{size:Te,icon:lf,displayName:ae("Ask for details"),createNewStoredNode:e=>[ye({type:K.collectDetails,parentId:e,data:{attributeIds:[]}})]}),tool:he(K.tool,{size:Te,icon:cf,displayName:ae("Use tool"),disallowChildren:!0,forceDeleteAllChildren:!0,createNewStoredNode:e=>{const t=ye({type:K.tool,parentId:e});return[t,...ce.toolResult.createNewStoredNode(t.id,{type:"success"}),...ce.toolResult.createNewStoredNode(t.id,{type:"failure"})]}}),toolResult:he(K.toolResult,{size:Mr,icon:yn,displayName:ae("Tool result"),createNewStoredNode:(e,t)=>[ye({type:K.toolResult,parentId:e,data:{type:(t==null?void 0:t.type)??"success"}})]}),setAttribute:he(K.setAttribute,{size:Te,icon:nl,displayName:ae("Set attribute")}),addTags:he(K.addTags,{size:Te,icon:df,displayName:ae("Add tags")}),branches:he(K.branches,{size:Gf,icon:Ho,displayName:ae("Branches"),disallowChildren:!0,forceDeleteAllChildren:!0,createNewStoredNode:e=>{const t=ye({type:K.branches,parentId:e});return[t,ce.branchesItem.createNewStoredNode(t.id,{name:"If this"})[0],ce.branchesItem.createNewStoredNode(t.id,{name:"Else",isElseBranch:!0})[0]]}}),branchesItem:he(K.branchesItem,{size:Mr,icon:Ho,displayName:ae("Branch item"),createNewStoredNode:(e,t)=>[ye({type:K.branchesItem,parentId:e,data:{name:"Branch",branchMatchType:"or",conditionGroups:[{conditions:[],matchType:"or"}],...t}})]}),goToStep:he(K.goToStep,{size:Te,icon:uf,displayName:ae("Go to step"),isTerminal:!0,createNewStoredNode:e=>[ye({type:K.goToStep,parentId:e,data:{targetNodeId:""}})]}),goToFlow:he(K.goToFlow,{size:Te,icon:rf,displayName:ae("Go to flow"),isTerminal:!0,createNewStoredNode:e=>[ye({type:K.goToFlow,parentId:e,data:{targetFlowId:0}})]}),transfer:he(K.transfer,{size:wn,icon:Vo,displayName:ae("Transfer"),isTerminal:!0,createNewStoredNode:e=>[ye({type:K.transfer,parentId:e,data:{message:"",attachmentIds:[]}})]}),closeConversation:he(K.closeConversation,{size:wn,icon:qf,displayName:ae("Close conversation"),isTerminal:!0}),placeholder:he(K.placeholder,{size:{width:200,height:28},icon:Vo,displayName:ae("Placeholder")})};function Yf(e,t){let{type:n,parentId:s,asNewBranch:r,data:i}=t,o=ce[n].createNewStoredNode(s,i);const a=e.findLastIndex(c=>c.parentId===s);if(a!==-1)e.splice(a+1,0,...o);else{const c=e.findIndex(u=>u.id===s);e.splice(c+1,0,...o)}return r||(e=e.map(c=>c.parentId===s&&c.id!==o[0].id?{...c,parentId:o[0].id}:c)),{allNodes:e,newNodes:o}}function lo(e,t,n){const s=e.findIndex(i=>i.id===t),r=e[s];return e[s]={...r,data:{...r.data,...n}},e}function Wf(e,t){var r;const n=(r=e.find(i=>i.id===t))==null?void 0:r.parentId;return!e.find(i=>i.id===t)||!n?null:(e=e.filter(i=>i.id!==t),e=e.map(i=>i.parentId===t?{...i,parentId:n}:i),{allNodes:e,parentId:n})}function Xf(e,t){var i;const n=(i=e.find(o=>o.id===t))==null?void 0:i.parentId;if(!n)return null;const s=[];return{allNodes:e.filter(o=>o.id===t||o.parentId===t||s.includes(o.parentId)?(s.push(o.id),!1):!0),parentId:n}}function ye({id:e,type:t,parentId:n,data:s}){let r=s;r||(r={});const i=e??nr();return r.parentId=n,r.flowId=i,{id:i,parentId:n,type:t,data:r}}const xl="TB",Rt=()=>{const[e,t]=Dd("flow-direction",xl);return{flowDirection:e,setFlowDirection:t}},Uf=()=>localStorage.getItem("flow-direction")??xl;var Tr,Yo;function co(){if(Yo)return Tr;Yo=1;var e="\0",t="\0",n="";class s{constructor(d){fe(this,"_isDirected",!0);fe(this,"_isMultigraph",!1);fe(this,"_isCompound",!1);fe(this,"_label");fe(this,"_defaultNodeLabelFn",()=>{});fe(this,"_defaultEdgeLabelFn",()=>{});fe(this,"_nodes",{});fe(this,"_in",{});fe(this,"_preds",{});fe(this,"_out",{});fe(this,"_sucs",{});fe(this,"_edgeObjs",{});fe(this,"_edgeLabels",{});fe(this,"_nodeCount",0);fe(this,"_edgeCount",0);fe(this,"_parent");fe(this,"_children");d&&(this._isDirected=Object.hasOwn(d,"directed")?d.directed:!0,this._isMultigraph=Object.hasOwn(d,"multigraph")?d.multigraph:!1,this._isCompound=Object.hasOwn(d,"compound")?d.compound:!1),this._isCompound&&(this._parent={},this._children={},this._children[t]={})}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(d){return this._label=d,this}graph(){return this._label}setDefaultNodeLabel(d){return this._defaultNodeLabelFn=d,typeof d!="function"&&(this._defaultNodeLabelFn=()=>d),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var d=this;return this.nodes().filter(f=>Object.keys(d._in[f]).length===0)}sinks(){var d=this;return this.nodes().filter(f=>Object.keys(d._out[f]).length===0)}setNodes(d,f){var h=arguments,m=this;return d.forEach(function(p){h.length>1?m.setNode(p,f):m.setNode(p)}),this}setNode(d,f){return Object.hasOwn(this._nodes,d)?(arguments.length>1&&(this._nodes[d]=f),this):(this._nodes[d]=arguments.length>1?f:this._defaultNodeLabelFn(d),this._isCompound&&(this._parent[d]=t,this._children[d]={},this._children[t][d]=!0),this._in[d]={},this._preds[d]={},this._out[d]={},this._sucs[d]={},++this._nodeCount,this)}node(d){return this._nodes[d]}hasNode(d){return Object.hasOwn(this._nodes,d)}removeNode(d){var f=this;if(Object.hasOwn(this._nodes,d)){var h=m=>f.removeEdge(f._edgeObjs[m]);delete this._nodes[d],this._isCompound&&(this._removeFromParentsChildList(d),delete this._parent[d],this.children(d).forEach(function(m){f.setParent(m)}),delete this._children[d]),Object.keys(this._in[d]).forEach(h),delete this._in[d],delete this._preds[d],Object.keys(this._out[d]).forEach(h),delete this._out[d],delete this._sucs[d],--this._nodeCount}return this}setParent(d,f){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(f===void 0)f=t;else{f+="";for(var h=f;h!==void 0;h=this.parent(h))if(h===d)throw new Error("Setting "+f+" as parent of "+d+" would create a cycle");this.setNode(f)}return this.setNode(d),this._removeFromParentsChildList(d),this._parent[d]=f,this._children[f][d]=!0,this}_removeFromParentsChildList(d){delete this._children[this._parent[d]][d]}parent(d){if(this._isCompound){var f=this._parent[d];if(f!==t)return f}}children(d=t){if(this._isCompound){var f=this._children[d];if(f)return Object.keys(f)}else{if(d===t)return this.nodes();if(this.hasNode(d))return[]}}predecessors(d){var f=this._preds[d];if(f)return Object.keys(f)}successors(d){var f=this._sucs[d];if(f)return Object.keys(f)}neighbors(d){var f=this.predecessors(d);if(f){const m=new Set(f);for(var h of this.successors(d))m.add(h);return Array.from(m.values())}}isLeaf(d){var f;return this.isDirected()?f=this.successors(d):f=this.neighbors(d),f.length===0}filterNodes(d){var f=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});f.setGraph(this.graph());var h=this;Object.entries(this._nodes).forEach(function([b,x]){d(b)&&f.setNode(b,x)}),Object.values(this._edgeObjs).forEach(function(b){f.hasNode(b.v)&&f.hasNode(b.w)&&f.setEdge(b,h.edge(b))});var m={};function p(b){var x=h.parent(b);return x===void 0||f.hasNode(x)?(m[b]=x,x):x in m?m[x]:p(x)}return this._isCompound&&f.nodes().forEach(b=>f.setParent(b,p(b))),f}setDefaultEdgeLabel(d){return this._defaultEdgeLabelFn=d,typeof d!="function"&&(this._defaultEdgeLabelFn=()=>d),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(d,f){var h=this,m=arguments;return d.reduce(function(p,b){return m.length>1?h.setEdge(p,b,f):h.setEdge(p,b),b}),this}setEdge(){var d,f,h,m,p=!1,b=arguments[0];typeof b=="object"&&b!==null&&"v"in b?(d=b.v,f=b.w,h=b.name,arguments.length===2&&(m=arguments[1],p=!0)):(d=b,f=arguments[1],h=arguments[3],arguments.length>2&&(m=arguments[2],p=!0)),d=""+d,f=""+f,h!==void 0&&(h=""+h);var x=o(this._isDirected,d,f,h);if(Object.hasOwn(this._edgeLabels,x))return p&&(this._edgeLabels[x]=m),this;if(h!==void 0&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(d),this.setNode(f),this._edgeLabels[x]=p?m:this._defaultEdgeLabelFn(d,f,h);var y=a(this._isDirected,d,f,h);return d=y.v,f=y.w,Object.freeze(y),this._edgeObjs[x]=y,r(this._preds[f],d),r(this._sucs[d],f),this._in[f][x]=y,this._out[d][x]=y,this._edgeCount++,this}edge(d,f,h){var m=arguments.length===1?c(this._isDirected,arguments[0]):o(this._isDirected,d,f,h);return this._edgeLabels[m]}edgeAsObj(){const d=this.edge(...arguments);return typeof d!="object"?{label:d}:d}hasEdge(d,f,h){var m=arguments.length===1?c(this._isDirected,arguments[0]):o(this._isDirected,d,f,h);return Object.hasOwn(this._edgeLabels,m)}removeEdge(d,f,h){var m=arguments.length===1?c(this._isDirected,arguments[0]):o(this._isDirected,d,f,h),p=this._edgeObjs[m];return p&&(d=p.v,f=p.w,delete this._edgeLabels[m],delete this._edgeObjs[m],i(this._preds[f],d),i(this._sucs[d],f),delete this._in[f][m],delete this._out[d][m],this._edgeCount--),this}inEdges(d,f){var h=this._in[d];if(h){var m=Object.values(h);return f?m.filter(p=>p.v===f):m}}outEdges(d,f){var h=this._out[d];if(h){var m=Object.values(h);return f?m.filter(p=>p.w===f):m}}nodeEdges(d,f){var h=this.inEdges(d,f);if(h)return h.concat(this.outEdges(d,f))}}function r(u,d){u[d]?u[d]++:u[d]=1}function i(u,d){--u[d]||delete u[d]}function o(u,d,f,h){var m=""+d,p=""+f;if(!u&&m>p){var b=m;m=p,p=b}return m+n+p+n+(h===void 0?e:h)}function a(u,d,f,h){var m=""+d,p=""+f;if(!u&&m>p){var b=m;m=p,p=b}var x={v:m,w:p};return h&&(x.name=h),x}function c(u,d){return o(u,d.v,d.w,d.name)}return Tr=s,Tr}var Pr,Wo;function Zf(){return Wo||(Wo=1,Pr="2.2.4"),Pr}var Dr,Xo;function Kf(){return Xo||(Xo=1,Dr={Graph:co(),version:Zf()}),Dr}var zr,Uo;function Qf(){if(Uo)return zr;Uo=1;var e=co();zr={write:t,read:r};function t(i){var o={options:{directed:i.isDirected(),multigraph:i.isMultigraph(),compound:i.isCompound()},nodes:n(i),edges:s(i)};return i.graph()!==void 0&&(o.value=structuredClone(i.graph())),o}function n(i){return i.nodes().map(function(o){var a=i.node(o),c=i.parent(o),u={v:o};return a!==void 0&&(u.value=a),c!==void 0&&(u.parent=c),u})}function s(i){return i.edges().map(function(o){var a=i.edge(o),c={v:o.v,w:o.w};return o.name!==void 0&&(c.name=o.name),a!==void 0&&(c.value=a),c})}function r(i){var o=new e(i.options).setGraph(i.value);return i.nodes.forEach(function(a){o.setNode(a.v,a.value),a.parent&&o.setParent(a.v,a.parent)}),i.edges.forEach(function(a){o.setEdge({v:a.v,w:a.w,name:a.name},a.value)}),o}return zr}var Rr,Zo;function Jf(){if(Zo)return Rr;Zo=1,Rr=e;function e(t){var n={},s=[],r;function i(o){Object.hasOwn(n,o)||(n[o]=!0,r.push(o),t.successors(o).forEach(i),t.predecessors(o).forEach(i))}return t.nodes().forEach(function(o){r=[],i(o),r.length&&s.push(r)}),s}return Rr}var Lr,Ko;function yl(){if(Ko)return Lr;Ko=1;class e{constructor(){fe(this,"_arr",[]);fe(this,"_keyIndices",{})}size(){return this._arr.length}keys(){return this._arr.map(function(n){return n.key})}has(n){return Object.hasOwn(this._keyIndices,n)}priority(n){var s=this._keyIndices[n];if(s!==void 0)return this._arr[s].priority}min(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key}add(n,s){var r=this._keyIndices;if(n=String(n),!Object.hasOwn(r,n)){var i=this._arr,o=i.length;return r[n]=o,i.push({key:n,priority:s}),this._decrease(o),!0}return!1}removeMin(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key}decrease(n,s){var r=this._keyIndices[n];if(s>this._arr[r].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[r].priority+" New: "+s);this._arr[r].priority=s,this._decrease(r)}_heapify(n){var s=this._arr,r=2*n,i=r+1,o=n;r<s.length&&(o=s[r].priority<s[o].priority?r:o,i<s.length&&(o=s[i].priority<s[o].priority?i:o),o!==n&&(this._swap(n,o),this._heapify(o)))}_decrease(n){for(var s=this._arr,r=s[n].priority,i;n!==0&&(i=n>>1,!(s[i].priority<r));)this._swap(n,i),n=i}_swap(n,s){var r=this._arr,i=this._keyIndices,o=r[n],a=r[s];r[n]=a,r[s]=o,i[a.key]=n,i[o.key]=s}}return Lr=e,Lr}var $r,Qo;function wl(){if(Qo)return $r;Qo=1;var e=yl();$r=n;var t=()=>1;function n(r,i,o,a){return s(r,String(i),o||t,a||function(c){return r.outEdges(c)})}function s(r,i,o,a){var c={},u=new e,d,f,h=function(m){var p=m.v!==d?m.v:m.w,b=c[p],x=o(m),y=f.distance+x;if(x<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+m+" Weight: "+x);y<b.distance&&(b.distance=y,b.predecessor=d,u.decrease(p,y))};for(r.nodes().forEach(function(m){var p=m===i?0:Number.POSITIVE_INFINITY;c[m]={distance:p},u.add(m,p)});u.size()>0&&(d=u.removeMin(),f=c[d],f.distance!==Number.POSITIVE_INFINITY);)a(d).forEach(h);return c}return $r}var Or,Jo;function eh(){if(Jo)return Or;Jo=1;var e=wl();Or=t;function t(n,s,r){return n.nodes().reduce(function(i,o){return i[o]=e(n,o,s,r),i},{})}return Or}var Br,ei;function bl(){if(ei)return Br;ei=1,Br=e;function e(t){var n=0,s=[],r={},i=[];function o(a){var c=r[a]={onStack:!0,lowlink:n,index:n++};if(s.push(a),t.successors(a).forEach(function(f){Object.hasOwn(r,f)?r[f].onStack&&(c.lowlink=Math.min(c.lowlink,r[f].index)):(o(f),c.lowlink=Math.min(c.lowlink,r[f].lowlink))}),c.lowlink===c.index){var u=[],d;do d=s.pop(),r[d].onStack=!1,u.push(d);while(a!==d);i.push(u)}}return t.nodes().forEach(function(a){Object.hasOwn(r,a)||o(a)}),i}return Br}var Vr,ti;function th(){if(ti)return Vr;ti=1;var e=bl();Vr=t;function t(n){return e(n).filter(function(s){return s.length>1||s.length===1&&n.hasEdge(s[0],s[0])})}return Vr}var Fr,ni;function nh(){if(ni)return Fr;ni=1,Fr=t;var e=()=>1;function t(s,r,i){return n(s,r||e,i||function(o){return s.outEdges(o)})}function n(s,r,i){var o={},a=s.nodes();return a.forEach(function(c){o[c]={},o[c][c]={distance:0},a.forEach(function(u){c!==u&&(o[c][u]={distance:Number.POSITIVE_INFINITY})}),i(c).forEach(function(u){var d=u.v===c?u.w:u.v,f=r(u);o[c][d]={distance:f,predecessor:c}})}),a.forEach(function(c){var u=o[c];a.forEach(function(d){var f=o[d];a.forEach(function(h){var m=f[c],p=u[h],b=f[h],x=m.distance+p.distance;x<b.distance&&(b.distance=x,b.predecessor=p.predecessor)})})}),o}return Fr}var Hr,ri;function vl(){if(ri)return Hr;ri=1;function e(n){var s={},r={},i=[];function o(a){if(Object.hasOwn(r,a))throw new t;Object.hasOwn(s,a)||(r[a]=!0,s[a]=!0,n.predecessors(a).forEach(o),delete r[a],i.push(a))}if(n.sinks().forEach(o),Object.keys(s).length!==n.nodeCount())throw new t;return i}class t extends Error{constructor(){super(...arguments)}}return Hr=e,e.CycleException=t,Hr}var qr,si;function rh(){if(si)return qr;si=1;var e=vl();qr=t;function t(n){try{e(n)}catch(s){if(s instanceof e.CycleException)return!1;throw s}return!0}return qr}var Gr,oi;function Nl(){if(oi)return Gr;oi=1,Gr=e;function e(r,i,o){Array.isArray(i)||(i=[i]);var a=r.isDirected()?f=>r.successors(f):f=>r.neighbors(f),c=o==="post"?t:n,u=[],d={};return i.forEach(f=>{if(!r.hasNode(f))throw new Error("Graph does not have node: "+f);c(f,a,d,u)}),u}function t(r,i,o,a){for(var c=[[r,!1]];c.length>0;){var u=c.pop();u[1]?a.push(u[0]):Object.hasOwn(o,u[0])||(o[u[0]]=!0,c.push([u[0],!0]),s(i(u[0]),d=>c.push([d,!1])))}}function n(r,i,o,a){for(var c=[r];c.length>0;){var u=c.pop();Object.hasOwn(o,u)||(o[u]=!0,a.push(u),s(i(u),d=>c.push(d)))}}function s(r,i){for(var o=r.length;o--;)i(r[o],o,r);return r}return Gr}var Yr,ii;function sh(){if(ii)return Yr;ii=1;var e=Nl();Yr=t;function t(n,s){return e(n,s,"post")}return Yr}var Wr,ai;function oh(){if(ai)return Wr;ai=1;var e=Nl();Wr=t;function t(n,s){return e(n,s,"pre")}return Wr}var Xr,li;function ih(){if(li)return Xr;li=1;var e=co(),t=yl();Xr=n;function n(s,r){var i=new e,o={},a=new t,c;function u(f){var h=f.v===c?f.w:f.v,m=a.priority(h);if(m!==void 0){var p=r(f);p<m&&(o[h]=c,a.decrease(h,p))}}if(s.nodeCount()===0)return i;s.nodes().forEach(function(f){a.add(f,Number.POSITIVE_INFINITY),i.setNode(f)}),a.decrease(s.nodes()[0],0);for(var d=!1;a.size()>0;){if(c=a.removeMin(),Object.hasOwn(o,c))i.setEdge(c,o[c]);else{if(d)throw new Error("Input graph is not connected: "+s);d=!0}s.nodeEdges(c).forEach(u)}return i}return Xr}var Ur,ci;function ah(){return ci||(ci=1,Ur={components:Jf(),dijkstra:wl(),dijkstraAll:eh(),findCycles:th(),floydWarshall:nh(),isAcyclic:rh(),postorder:sh(),preorder:oh(),prim:ih(),tarjan:bl(),topsort:vl()}),Ur}var Zr,ui;function $e(){if(ui)return Zr;ui=1;var e=Kf();return Zr={Graph:e.Graph,json:Qf(),alg:ah(),version:e.version},Zr}var Kr,di;function lh(){if(di)return Kr;di=1;class e{constructor(){let r={};r._next=r._prev=r,this._sentinel=r}dequeue(){let r=this._sentinel,i=r._prev;if(i!==r)return t(i),i}enqueue(r){let i=this._sentinel;r._prev&&r._next&&t(r),r._next=i._next,i._next._prev=r,i._next=r,r._prev=i}toString(){let r=[],i=this._sentinel,o=i._prev;for(;o!==i;)r.push(JSON.stringify(o,n)),o=o._prev;return"["+r.join(", ")+"]"}}function t(s){s._prev._next=s._next,s._next._prev=s._prev,delete s._next,delete s._prev}function n(s,r){if(s!=="_next"&&s!=="_prev")return r}return Kr=e,Kr}var Qr,fi;function ch(){if(fi)return Qr;fi=1;let e=$e().Graph,t=lh();Qr=s;let n=()=>1;function s(u,d){if(u.nodeCount()<=1)return[];let f=o(u,d||n);return r(f.graph,f.buckets,f.zeroIdx).flatMap(m=>u.outEdges(m.v,m.w))}function r(u,d,f){let h=[],m=d[d.length-1],p=d[0],b;for(;u.nodeCount();){for(;b=p.dequeue();)i(u,d,f,b);for(;b=m.dequeue();)i(u,d,f,b);if(u.nodeCount()){for(let x=d.length-2;x>0;--x)if(b=d[x].dequeue(),b){h=h.concat(i(u,d,f,b,!0));break}}}return h}function i(u,d,f,h,m){let p=m?[]:void 0;return u.inEdges(h.v).forEach(b=>{let x=u.edge(b),y=u.node(b.v);m&&p.push({v:b.v,w:b.w}),y.out-=x,a(d,f,y)}),u.outEdges(h.v).forEach(b=>{let x=u.edge(b),y=b.w,v=u.node(y);v.in-=x,a(d,f,v)}),u.removeNode(h.v),p}function o(u,d){let f=new e,h=0,m=0;u.nodes().forEach(x=>{f.setNode(x,{v:x,in:0,out:0})}),u.edges().forEach(x=>{let y=f.edge(x.v,x.w)||0,v=d(x),g=y+v;f.setEdge(x.v,x.w,g),m=Math.max(m,f.node(x.v).out+=v),h=Math.max(h,f.node(x.w).in+=v)});let p=c(m+h+3).map(()=>new t),b=h+1;return f.nodes().forEach(x=>{a(p,b,f.node(x))}),{graph:f,buckets:p,zeroIdx:b}}function a(u,d,f){f.out?f.in?u[f.out-f.in+d].enqueue(f):u[u.length-1].enqueue(f):u[0].enqueue(f)}function c(u){const d=[];for(let f=0;f<u;f++)d.push(f);return d}return Qr}var Jr,hi;function me(){if(hi)return Jr;hi=1;let e=$e().Graph;Jr={addBorderNode:d,addDummyNode:t,applyWithChunking:m,asNonCompoundGraph:s,buildLayerMatrix:a,intersectRect:o,mapValues:_,maxRank:p,normalizeRanks:c,notime:y,partition:b,pick:S,predecessorWeights:i,range:w,removeEmptyRanks:u,simplify:n,successorWeights:r,time:x,uniqueId:g,zipObject:k};function t(N,E,A,I){for(var C=I;N.hasNode(C);)C=g(I);return A.dummy=E,N.setNode(C,A),C}function n(N){let E=new e().setGraph(N.graph());return N.nodes().forEach(A=>E.setNode(A,N.node(A))),N.edges().forEach(A=>{let I=E.edge(A.v,A.w)||{weight:0,minlen:1},C=N.edge(A);E.setEdge(A.v,A.w,{weight:I.weight+C.weight,minlen:Math.max(I.minlen,C.minlen)})}),E}function s(N){let E=new e({multigraph:N.isMultigraph()}).setGraph(N.graph());return N.nodes().forEach(A=>{N.children(A).length||E.setNode(A,N.node(A))}),N.edges().forEach(A=>{E.setEdge(A,N.edge(A))}),E}function r(N){let E=N.nodes().map(A=>{let I={};return N.outEdges(A).forEach(C=>{I[C.w]=(I[C.w]||0)+N.edge(C).weight}),I});return k(N.nodes(),E)}function i(N){let E=N.nodes().map(A=>{let I={};return N.inEdges(A).forEach(C=>{I[C.v]=(I[C.v]||0)+N.edge(C).weight}),I});return k(N.nodes(),E)}function o(N,E){let A=N.x,I=N.y,C=E.x-A,O=E.y-I,j=N.width/2,P=N.height/2;if(!C&&!O)throw new Error("Not possible to find intersection inside of the rectangle");let T,B;return Math.abs(O)*j>Math.abs(C)*P?(O<0&&(P=-P),T=P*C/O,B=P):(C<0&&(j=-j),T=j,B=j*O/C),{x:A+T,y:I+B}}function a(N){let E=w(p(N)+1).map(()=>[]);return N.nodes().forEach(A=>{let I=N.node(A),C=I.rank;C!==void 0&&(E[C][I.order]=A)}),E}function c(N){let E=N.nodes().map(I=>{let C=N.node(I).rank;return C===void 0?Number.MAX_VALUE:C}),A=m(Math.min,E);N.nodes().forEach(I=>{let C=N.node(I);Object.hasOwn(C,"rank")&&(C.rank-=A)})}function u(N){let E=N.nodes().map(j=>N.node(j).rank),A=m(Math.min,E),I=[];N.nodes().forEach(j=>{let P=N.node(j).rank-A;I[P]||(I[P]=[]),I[P].push(j)});let C=0,O=N.graph().nodeRankFactor;Array.from(I).forEach((j,P)=>{j===void 0&&P%O!==0?--C:j!==void 0&&C&&j.forEach(T=>N.node(T).rank+=C)})}function d(N,E,A,I){let C={width:0,height:0};return arguments.length>=4&&(C.rank=A,C.order=I),t(N,"border",C,E)}function f(N,E=h){const A=[];for(let I=0;I<N.length;I+=E){const C=N.slice(I,I+E);A.push(C)}return A}const h=65535;function m(N,E){if(E.length>h){const A=f(E);return N.apply(null,A.map(I=>N.apply(null,I)))}else return N.apply(null,E)}function p(N){const A=N.nodes().map(I=>{let C=N.node(I).rank;return C===void 0?Number.MIN_VALUE:C});return m(Math.max,A)}function b(N,E){let A={lhs:[],rhs:[]};return N.forEach(I=>{E(I)?A.lhs.push(I):A.rhs.push(I)}),A}function x(N,E){let A=Date.now();try{return E()}finally{console.log(N+" time: "+(Date.now()-A)+"ms")}}function y(N,E){return E()}let v=0;function g(N){var E=++v;return N+(""+E)}function w(N,E,A=1){E==null&&(E=N,N=0);let I=O=>O<E;A<0&&(I=O=>E<O);const C=[];for(let O=N;I(O);O+=A)C.push(O);return C}function S(N,E){const A={};for(const I of E)N[I]!==void 0&&(A[I]=N[I]);return A}function _(N,E){let A=E;return typeof E=="string"&&(A=I=>I[E]),Object.entries(N).reduce((I,[C,O])=>(I[C]=A(O,C),I),{})}function k(N,E){return N.reduce((A,I,C)=>(A[I]=E[C],A),{})}return Jr}var es,mi;function uh(){if(mi)return es;mi=1;let e=ch(),t=me().uniqueId;es={run:n,undo:r};function n(i){(i.graph().acyclicer==="greedy"?e(i,a(i)):s(i)).forEach(c=>{let u=i.edge(c);i.removeEdge(c),u.forwardName=c.name,u.reversed=!0,i.setEdge(c.w,c.v,u,t("rev"))});function a(c){return u=>c.edge(u).weight}}function s(i){let o=[],a={},c={};function u(d){Object.hasOwn(c,d)||(c[d]=!0,a[d]=!0,i.outEdges(d).forEach(f=>{Object.hasOwn(a,f.w)?o.push(f):u(f.w)}),delete a[d])}return i.nodes().forEach(u),o}function r(i){i.edges().forEach(o=>{let a=i.edge(o);if(a.reversed){i.removeEdge(o);let c=a.forwardName;delete a.reversed,delete a.forwardName,i.setEdge(o.w,o.v,a,c)}})}return es}var ts,pi;function dh(){if(pi)return ts;pi=1;let e=me();ts={run:t,undo:s};function t(r){r.graph().dummyChains=[],r.edges().forEach(i=>n(r,i))}function n(r,i){let o=i.v,a=r.node(o).rank,c=i.w,u=r.node(c).rank,d=i.name,f=r.edge(i),h=f.labelRank;if(u===a+1)return;r.removeEdge(i);let m,p,b;for(b=0,++a;a<u;++b,++a)f.points=[],p={width:0,height:0,edgeLabel:f,edgeObj:i,rank:a},m=e.addDummyNode(r,"edge",p,"_d"),a===h&&(p.width=f.width,p.height=f.height,p.dummy="edge-label",p.labelpos=f.labelpos),r.setEdge(o,m,{weight:f.weight},d),b===0&&r.graph().dummyChains.push(m),o=m;r.setEdge(o,c,{weight:f.weight},d)}function s(r){r.graph().dummyChains.forEach(i=>{let o=r.node(i),a=o.edgeLabel,c;for(r.setEdge(o.edgeObj,a);o.dummy;)c=r.successors(i)[0],r.removeNode(i),a.points.push({x:o.x,y:o.y}),o.dummy==="edge-label"&&(a.x=o.x,a.y=o.y,a.width=o.width,a.height=o.height),i=c,o=r.node(i)})}return ts}var ns,gi;function Fn(){if(gi)return ns;gi=1;const{applyWithChunking:e}=me();ns={longestPath:t,slack:n};function t(s){var r={};function i(o){var a=s.node(o);if(Object.hasOwn(r,o))return a.rank;r[o]=!0;let c=s.outEdges(o).map(d=>d==null?Number.POSITIVE_INFINITY:i(d.w)-s.edge(d).minlen);var u=e(Math.min,c);return u===Number.POSITIVE_INFINITY&&(u=0),a.rank=u}s.sources().forEach(i)}function n(s,r){return s.node(r.w).rank-s.node(r.v).rank-s.edge(r).minlen}return ns}var rs,xi;function jl(){if(xi)return rs;xi=1;var e=$e().Graph,t=Fn().slack;rs=n;function n(o){var a=new e({directed:!1}),c=o.nodes()[0],u=o.nodeCount();a.setNode(c,{});for(var d,f;s(a,o)<u;)d=r(a,o),f=a.hasNode(d.v)?t(o,d):-t(o,d),i(a,o,f);return a}function s(o,a){function c(u){a.nodeEdges(u).forEach(d=>{var f=d.v,h=u===f?d.w:f;!o.hasNode(h)&&!t(a,d)&&(o.setNode(h,{}),o.setEdge(u,h,{}),c(h))})}return o.nodes().forEach(c),o.nodeCount()}function r(o,a){return a.edges().reduce((u,d)=>{let f=Number.POSITIVE_INFINITY;return o.hasNode(d.v)!==o.hasNode(d.w)&&(f=t(a,d)),f<u[0]?[f,d]:u},[Number.POSITIVE_INFINITY,null])[1]}function i(o,a,c){o.nodes().forEach(u=>a.node(u).rank+=c)}return rs}var ss,yi;function fh(){if(yi)return ss;yi=1;var e=jl(),t=Fn().slack,n=Fn().longestPath,s=$e().alg.preorder,r=$e().alg.postorder,i=me().simplify;ss=o,o.initLowLimValues=d,o.initCutValues=a,o.calcCutValue=u,o.leaveEdge=h,o.enterEdge=m,o.exchangeEdges=p;function o(v){v=i(v),n(v);var g=e(v);d(g),a(g,v);for(var w,S;w=h(g);)S=m(g,v,w),p(g,v,w,S)}function a(v,g){var w=r(v,v.nodes());w=w.slice(0,w.length-1),w.forEach(S=>c(v,g,S))}function c(v,g,w){var S=v.node(w),_=S.parent;v.edge(w,_).cutvalue=u(v,g,w)}function u(v,g,w){var S=v.node(w),_=S.parent,k=!0,N=g.edge(w,_),E=0;return N||(k=!1,N=g.edge(_,w)),E=N.weight,g.nodeEdges(w).forEach(A=>{var I=A.v===w,C=I?A.w:A.v;if(C!==_){var O=I===k,j=g.edge(A).weight;if(E+=O?j:-j,x(v,w,C)){var P=v.edge(w,C).cutvalue;E+=O?-P:P}}}),E}function d(v,g){arguments.length<2&&(g=v.nodes()[0]),f(v,{},1,g)}function f(v,g,w,S,_){var k=w,N=v.node(S);return g[S]=!0,v.neighbors(S).forEach(E=>{Object.hasOwn(g,E)||(w=f(v,g,w,E,S))}),N.low=k,N.lim=w++,_?N.parent=_:delete N.parent,w}function h(v){return v.edges().find(g=>v.edge(g).cutvalue<0)}function m(v,g,w){var S=w.v,_=w.w;g.hasEdge(S,_)||(S=w.w,_=w.v);var k=v.node(S),N=v.node(_),E=k,A=!1;k.lim>N.lim&&(E=N,A=!0);var I=g.edges().filter(C=>A===y(v,v.node(C.v),E)&&A!==y(v,v.node(C.w),E));return I.reduce((C,O)=>t(g,O)<t(g,C)?O:C)}function p(v,g,w,S){var _=w.v,k=w.w;v.removeEdge(_,k),v.setEdge(S.v,S.w,{}),d(v),a(v,g),b(v,g)}function b(v,g){var w=v.nodes().find(_=>!g.node(_).parent),S=s(v,w);S=S.slice(1),S.forEach(_=>{var k=v.node(_).parent,N=g.edge(_,k),E=!1;N||(N=g.edge(k,_),E=!0),g.node(_).rank=g.node(k).rank+(E?N.minlen:-N.minlen)})}function x(v,g,w){return v.hasEdge(g,w)}function y(v,g,w){return w.low<=g.lim&&g.lim<=w.lim}return ss}var os,wi;function hh(){if(wi)return os;wi=1;var e=Fn(),t=e.longestPath,n=jl(),s=fh();os=r;function r(c){var u=c.graph().ranker;if(u instanceof Function)return u(c);switch(c.graph().ranker){case"network-simplex":a(c);break;case"tight-tree":o(c);break;case"longest-path":i(c);break;case"none":break;default:a(c)}}var i=t;function o(c){t(c),n(c)}function a(c){s(c)}return os}var is,bi;function mh(){if(bi)return is;bi=1,is=e;function e(s){let r=n(s);s.graph().dummyChains.forEach(i=>{let o=s.node(i),a=o.edgeObj,c=t(s,r,a.v,a.w),u=c.path,d=c.lca,f=0,h=u[f],m=!0;for(;i!==a.w;){if(o=s.node(i),m){for(;(h=u[f])!==d&&s.node(h).maxRank<o.rank;)f++;h===d&&(m=!1)}if(!m){for(;f<u.length-1&&s.node(h=u[f+1]).minRank<=o.rank;)f++;h=u[f]}s.setParent(i,h),i=s.successors(i)[0]}})}function t(s,r,i,o){let a=[],c=[],u=Math.min(r[i].low,r[o].low),d=Math.max(r[i].lim,r[o].lim),f,h;f=i;do f=s.parent(f),a.push(f);while(f&&(r[f].low>u||d>r[f].lim));for(h=f,f=o;(f=s.parent(f))!==h;)c.push(f);return{path:a.concat(c.reverse()),lca:h}}function n(s){let r={},i=0;function o(a){let c=i;s.children(a).forEach(o),r[a]={low:c,lim:i++}}return s.children().forEach(o),r}return is}var as,vi;function ph(){if(vi)return as;vi=1;let e=me();as={run:t,cleanup:i};function t(o){let a=e.addDummyNode(o,"root",{},"_root"),c=s(o),u=Object.values(c),d=e.applyWithChunking(Math.max,u)-1,f=2*d+1;o.graph().nestingRoot=a,o.edges().forEach(m=>o.edge(m).minlen*=f);let h=r(o)+1;o.children().forEach(m=>n(o,a,f,h,d,c,m)),o.graph().nodeRankFactor=f}function n(o,a,c,u,d,f,h){let m=o.children(h);if(!m.length){h!==a&&o.setEdge(a,h,{weight:0,minlen:c});return}let p=e.addBorderNode(o,"_bt"),b=e.addBorderNode(o,"_bb"),x=o.node(h);o.setParent(p,h),x.borderTop=p,o.setParent(b,h),x.borderBottom=b,m.forEach(y=>{n(o,a,c,u,d,f,y);let v=o.node(y),g=v.borderTop?v.borderTop:y,w=v.borderBottom?v.borderBottom:y,S=v.borderTop?u:2*u,_=g!==w?1:d-f[h]+1;o.setEdge(p,g,{weight:S,minlen:_,nestingEdge:!0}),o.setEdge(w,b,{weight:S,minlen:_,nestingEdge:!0})}),o.parent(h)||o.setEdge(a,p,{weight:0,minlen:d+f[h]})}function s(o){var a={};function c(u,d){var f=o.children(u);f&&f.length&&f.forEach(h=>c(h,d+1)),a[u]=d}return o.children().forEach(u=>c(u,1)),a}function r(o){return o.edges().reduce((a,c)=>a+o.edge(c).weight,0)}function i(o){var a=o.graph();o.removeNode(a.nestingRoot),delete a.nestingRoot,o.edges().forEach(c=>{var u=o.edge(c);u.nestingEdge&&o.removeEdge(c)})}return as}var ls,Ni;function gh(){if(Ni)return ls;Ni=1;let e=me();ls=t;function t(s){function r(i){let o=s.children(i),a=s.node(i);if(o.length&&o.forEach(r),Object.hasOwn(a,"minRank")){a.borderLeft=[],a.borderRight=[];for(let c=a.minRank,u=a.maxRank+1;c<u;++c)n(s,"borderLeft","_bl",i,a,c),n(s,"borderRight","_br",i,a,c)}}s.children().forEach(r)}function n(s,r,i,o,a,c){let u={width:0,height:0,rank:c,borderType:r},d=a[r][c-1],f=e.addDummyNode(s,"border",u,i);a[r][c]=f,s.setParent(f,o),d&&s.setEdge(d,f,{weight:1})}return ls}var cs,ji;function xh(){if(ji)return cs;ji=1,cs={adjust:e,undo:t};function e(c){let u=c.graph().rankdir.toLowerCase();(u==="lr"||u==="rl")&&n(c)}function t(c){let u=c.graph().rankdir.toLowerCase();(u==="bt"||u==="rl")&&r(c),(u==="lr"||u==="rl")&&(o(c),n(c))}function n(c){c.nodes().forEach(u=>s(c.node(u))),c.edges().forEach(u=>s(c.edge(u)))}function s(c){let u=c.width;c.width=c.height,c.height=u}function r(c){c.nodes().forEach(u=>i(c.node(u))),c.edges().forEach(u=>{let d=c.edge(u);d.points.forEach(i),Object.hasOwn(d,"y")&&i(d)})}function i(c){c.y=-c.y}function o(c){c.nodes().forEach(u=>a(c.node(u))),c.edges().forEach(u=>{let d=c.edge(u);d.points.forEach(a),Object.hasOwn(d,"x")&&a(d)})}function a(c){let u=c.x;c.x=c.y,c.y=u}return cs}var us,Ei;function yh(){if(Ei)return us;Ei=1;let e=me();us=t;function t(n){let s={},r=n.nodes().filter(d=>!n.children(d).length),i=r.map(d=>n.node(d).rank),o=e.applyWithChunking(Math.max,i),a=e.range(o+1).map(()=>[]);function c(d){if(s[d])return;s[d]=!0;let f=n.node(d);a[f.rank].push(d),n.successors(d).forEach(c)}return r.sort((d,f)=>n.node(d).rank-n.node(f).rank).forEach(c),a}return us}var ds,_i;function wh(){if(_i)return ds;_i=1;let e=me().zipObject;ds=t;function t(s,r){let i=0;for(let o=1;o<r.length;++o)i+=n(s,r[o-1],r[o]);return i}function n(s,r,i){let o=e(i,i.map((h,m)=>m)),a=r.flatMap(h=>s.outEdges(h).map(m=>({pos:o[m.w],weight:s.edge(m).weight})).sort((m,p)=>m.pos-p.pos)),c=1;for(;c<i.length;)c<<=1;let u=2*c-1;c-=1;let d=new Array(u).fill(0),f=0;return a.forEach(h=>{let m=h.pos+c;d[m]+=h.weight;let p=0;for(;m>0;)m%2&&(p+=d[m+1]),m=m-1>>1,d[m]+=h.weight;f+=h.weight*p}),f}return ds}var fs,Ii;function bh(){if(Ii)return fs;Ii=1,fs=e;function e(t,n=[]){return n.map(s=>{let r=t.inEdges(s);if(r.length){let i=r.reduce((o,a)=>{let c=t.edge(a),u=t.node(a.v);return{sum:o.sum+c.weight*u.order,weight:o.weight+c.weight}},{sum:0,weight:0});return{v:s,barycenter:i.sum/i.weight,weight:i.weight}}else return{v:s}})}return fs}var hs,Si;function vh(){if(Si)return hs;Si=1;let e=me();hs=t;function t(r,i){let o={};r.forEach((c,u)=>{let d=o[c.v]={indegree:0,in:[],out:[],vs:[c.v],i:u};c.barycenter!==void 0&&(d.barycenter=c.barycenter,d.weight=c.weight)}),i.edges().forEach(c=>{let u=o[c.v],d=o[c.w];u!==void 0&&d!==void 0&&(d.indegree++,u.out.push(o[c.w]))});let a=Object.values(o).filter(c=>!c.indegree);return n(a)}function n(r){let i=[];function o(c){return u=>{u.merged||(u.barycenter===void 0||c.barycenter===void 0||u.barycenter>=c.barycenter)&&s(c,u)}}function a(c){return u=>{u.in.push(c),--u.indegree===0&&r.push(u)}}for(;r.length;){let c=r.pop();i.push(c),c.in.reverse().forEach(o(c)),c.out.forEach(a(c))}return i.filter(c=>!c.merged).map(c=>e.pick(c,["vs","i","barycenter","weight"]))}function s(r,i){let o=0,a=0;r.weight&&(o+=r.barycenter*r.weight,a+=r.weight),i.weight&&(o+=i.barycenter*i.weight,a+=i.weight),r.vs=i.vs.concat(r.vs),r.barycenter=o/a,r.weight=a,r.i=Math.min(i.i,r.i),i.merged=!0}return hs}var ms,Ci;function Nh(){if(Ci)return ms;Ci=1;let e=me();ms=t;function t(r,i){let o=e.partition(r,p=>Object.hasOwn(p,"barycenter")),a=o.lhs,c=o.rhs.sort((p,b)=>b.i-p.i),u=[],d=0,f=0,h=0;a.sort(s(!!i)),h=n(u,c,h),a.forEach(p=>{h+=p.vs.length,u.push(p.vs),d+=p.barycenter*p.weight,f+=p.weight,h=n(u,c,h)});let m={vs:u.flat(!0)};return f&&(m.barycenter=d/f,m.weight=f),m}function n(r,i,o){let a;for(;i.length&&(a=i[i.length-1]).i<=o;)i.pop(),r.push(a.vs),o++;return o}function s(r){return(i,o)=>i.barycenter<o.barycenter?-1:i.barycenter>o.barycenter?1:r?o.i-i.i:i.i-o.i}return ms}var ps,ki;function jh(){if(ki)return ps;ki=1;let e=bh(),t=vh(),n=Nh();ps=s;function s(o,a,c,u){let d=o.children(a),f=o.node(a),h=f?f.borderLeft:void 0,m=f?f.borderRight:void 0,p={};h&&(d=d.filter(v=>v!==h&&v!==m));let b=e(o,d);b.forEach(v=>{if(o.children(v.v).length){let g=s(o,v.v,c,u);p[v.v]=g,Object.hasOwn(g,"barycenter")&&i(v,g)}});let x=t(b,c);r(x,p);let y=n(x,u);if(h&&(y.vs=[h,y.vs,m].flat(!0),o.predecessors(h).length)){let v=o.node(o.predecessors(h)[0]),g=o.node(o.predecessors(m)[0]);Object.hasOwn(y,"barycenter")||(y.barycenter=0,y.weight=0),y.barycenter=(y.barycenter*y.weight+v.order+g.order)/(y.weight+2),y.weight+=2}return y}function r(o,a){o.forEach(c=>{c.vs=c.vs.flatMap(u=>a[u]?a[u].vs:u)})}function i(o,a){o.barycenter!==void 0?(o.barycenter=(o.barycenter*o.weight+a.barycenter*a.weight)/(o.weight+a.weight),o.weight+=a.weight):(o.barycenter=a.barycenter,o.weight=a.weight)}return ps}var gs,Ai;function Eh(){if(Ai)return gs;Ai=1;let e=$e().Graph,t=me();gs=n;function n(r,i,o,a){a||(a=r.nodes());let c=s(r),u=new e({compound:!0}).setGraph({root:c}).setDefaultNodeLabel(d=>r.node(d));return a.forEach(d=>{let f=r.node(d),h=r.parent(d);(f.rank===i||f.minRank<=i&&i<=f.maxRank)&&(u.setNode(d),u.setParent(d,h||c),r[o](d).forEach(m=>{let p=m.v===d?m.w:m.v,b=u.edge(p,d),x=b!==void 0?b.weight:0;u.setEdge(p,d,{weight:r.edge(m).weight+x})}),Object.hasOwn(f,"minRank")&&u.setNode(d,{borderLeft:f.borderLeft[i],borderRight:f.borderRight[i]}))}),u}function s(r){for(var i;r.hasNode(i=t.uniqueId("_root")););return i}return gs}var xs,Mi;function _h(){if(Mi)return xs;Mi=1,xs=e;function e(t,n,s){let r={},i;s.forEach(o=>{let a=t.parent(o),c,u;for(;a;){if(c=t.parent(a),c?(u=r[c],r[c]=a):(u=i,i=a),u&&u!==a){n.setEdge(u,a);return}a=c}})}return xs}var ys,Ti;function Ih(){if(Ti)return ys;Ti=1;let e=yh(),t=wh(),n=jh(),s=Eh(),r=_h(),i=$e().Graph,o=me();ys=a;function a(f,h){if(h&&typeof h.customOrder=="function"){h.customOrder(f,a);return}let m=o.maxRank(f),p=c(f,o.range(1,m+1),"inEdges"),b=c(f,o.range(m-1,-1,-1),"outEdges"),x=e(f);if(d(f,x),h&&h.disableOptimalOrderHeuristic)return;let y=Number.POSITIVE_INFINITY,v;for(let g=0,w=0;w<4;++g,++w){u(g%2?p:b,g%4>=2),x=o.buildLayerMatrix(f);let S=t(f,x);S<y&&(w=0,v=Object.assign({},x),y=S)}d(f,v)}function c(f,h,m){const p=new Map,b=(x,y)=>{p.has(x)||p.set(x,[]),p.get(x).push(y)};for(const x of f.nodes()){const y=f.node(x);if(typeof y.rank=="number"&&b(y.rank,x),typeof y.minRank=="number"&&typeof y.maxRank=="number")for(let v=y.minRank;v<=y.maxRank;v++)v!==y.rank&&b(v,x)}return h.map(function(x){return s(f,x,m,p.get(x)||[])})}function u(f,h){let m=new i;f.forEach(function(p){let b=p.graph().root,x=n(p,b,m,h);x.vs.forEach((y,v)=>p.node(y).order=v),r(p,m,x.vs)})}function d(f,h){Object.values(h).forEach(m=>m.forEach((p,b)=>f.node(p).order=b))}return ys}var ws,Pi;function Sh(){if(Pi)return ws;Pi=1;let e=$e().Graph,t=me();ws={positionX:m,findType1Conflicts:n,findType2Conflicts:s,addConflict:i,hasConflict:o,verticalAlignment:a,horizontalCompaction:c,alignCoordinates:f,findSmallestWidthAlignment:d,balance:h};function n(x,y){let v={};function g(w,S){let _=0,k=0,N=w.length,E=S[S.length-1];return S.forEach((A,I)=>{let C=r(x,A),O=C?x.node(C).order:N;(C||A===E)&&(S.slice(k,I+1).forEach(j=>{x.predecessors(j).forEach(P=>{let T=x.node(P),B=T.order;(B<_||O<B)&&!(T.dummy&&x.node(j).dummy)&&i(v,P,j)})}),k=I+1,_=O)}),S}return y.length&&y.reduce(g),v}function s(x,y){let v={};function g(S,_,k,N,E){let A;t.range(_,k).forEach(I=>{A=S[I],x.node(A).dummy&&x.predecessors(A).forEach(C=>{let O=x.node(C);O.dummy&&(O.order<N||O.order>E)&&i(v,C,A)})})}function w(S,_){let k=-1,N,E=0;return _.forEach((A,I)=>{if(x.node(A).dummy==="border"){let C=x.predecessors(A);C.length&&(N=x.node(C[0]).order,g(_,E,I,k,N),E=I,k=N)}g(_,E,_.length,N,S.length)}),_}return y.length&&y.reduce(w),v}function r(x,y){if(x.node(y).dummy)return x.predecessors(y).find(v=>x.node(v).dummy)}function i(x,y,v){if(y>v){let w=y;y=v,v=w}let g=x[y];g||(x[y]=g={}),g[v]=!0}function o(x,y,v){if(y>v){let g=y;y=v,v=g}return!!x[y]&&Object.hasOwn(x[y],v)}function a(x,y,v,g){let w={},S={},_={};return y.forEach(k=>{k.forEach((N,E)=>{w[N]=N,S[N]=N,_[N]=E})}),y.forEach(k=>{let N=-1;k.forEach(E=>{let A=g(E);if(A.length){A=A.sort((C,O)=>_[C]-_[O]);let I=(A.length-1)/2;for(let C=Math.floor(I),O=Math.ceil(I);C<=O;++C){let j=A[C];S[E]===E&&N<_[j]&&!o(v,E,j)&&(S[j]=E,S[E]=w[E]=w[j],N=_[j])}}})}),{root:w,align:S}}function c(x,y,v,g,w){let S={},_=u(x,y,v,w),k=w?"borderLeft":"borderRight";function N(I,C){let O=_.nodes(),j=O.pop(),P={};for(;j;)P[j]?I(j):(P[j]=!0,O.push(j),O=O.concat(C(j))),j=O.pop()}function E(I){S[I]=_.inEdges(I).reduce((C,O)=>Math.max(C,S[O.v]+_.edge(O)),0)}function A(I){let C=_.outEdges(I).reduce((j,P)=>Math.min(j,S[P.w]-_.edge(P)),Number.POSITIVE_INFINITY),O=x.node(I);C!==Number.POSITIVE_INFINITY&&O.borderType!==k&&(S[I]=Math.max(S[I],C))}return N(E,_.predecessors.bind(_)),N(A,_.successors.bind(_)),Object.keys(g).forEach(I=>S[I]=S[v[I]]),S}function u(x,y,v,g){let w=new e,S=x.graph(),_=p(S.nodesep,S.edgesep,g);return y.forEach(k=>{let N;k.forEach(E=>{let A=v[E];if(w.setNode(A),N){var I=v[N],C=w.edge(I,A);w.setEdge(I,A,Math.max(_(x,E,N),C||0))}N=E})}),w}function d(x,y){return Object.values(y).reduce((v,g)=>{let w=Number.NEGATIVE_INFINITY,S=Number.POSITIVE_INFINITY;Object.entries(g).forEach(([k,N])=>{let E=b(x,k)/2;w=Math.max(N+E,w),S=Math.min(N-E,S)});const _=w-S;return _<v[0]&&(v=[_,g]),v},[Number.POSITIVE_INFINITY,null])[1]}function f(x,y){let v=Object.values(y),g=t.applyWithChunking(Math.min,v),w=t.applyWithChunking(Math.max,v);["u","d"].forEach(S=>{["l","r"].forEach(_=>{let k=S+_,N=x[k];if(N===y)return;let E=Object.values(N),A=g-t.applyWithChunking(Math.min,E);_!=="l"&&(A=w-t.applyWithChunking(Math.max,E)),A&&(x[k]=t.mapValues(N,I=>I+A))})})}function h(x,y){return t.mapValues(x.ul,(v,g)=>{if(y)return x[y.toLowerCase()][g];{let w=Object.values(x).map(S=>S[g]).sort((S,_)=>S-_);return(w[1]+w[2])/2}})}function m(x){let y=t.buildLayerMatrix(x),v=Object.assign(n(x,y),s(x,y)),g={},w;["u","d"].forEach(_=>{w=_==="u"?y:Object.values(y).reverse(),["l","r"].forEach(k=>{k==="r"&&(w=w.map(I=>Object.values(I).reverse()));let N=(_==="u"?x.predecessors:x.successors).bind(x),E=a(x,w,v,N),A=c(x,w,E.root,E.align,k==="r");k==="r"&&(A=t.mapValues(A,I=>-I)),g[_+k]=A})});let S=d(x,g);return f(g,S),h(g,x.graph().align)}function p(x,y,v){return(g,w,S)=>{let _=g.node(w),k=g.node(S),N=0,E;if(N+=_.width/2,Object.hasOwn(_,"labelpos"))switch(_.labelpos.toLowerCase()){case"l":E=-_.width/2;break;case"r":E=_.width/2;break}if(E&&(N+=v?E:-E),E=0,N+=(_.dummy?y:x)/2,N+=(k.dummy?y:x)/2,N+=k.width/2,Object.hasOwn(k,"labelpos"))switch(k.labelpos.toLowerCase()){case"l":E=k.width/2;break;case"r":E=-k.width/2;break}return E&&(N+=v?E:-E),E=0,N}}function b(x,y){return x.node(y).width}return ws}var bs,Di;function Ch(){if(Di)return bs;Di=1;let e=me(),t=Sh().positionX;bs=n;function n(r){r=e.asNonCompoundGraph(r),s(r),Object.entries(t(r)).forEach(([i,o])=>r.node(i).x=o)}function s(r){let i=e.buildLayerMatrix(r),o=r.graph().ranksep,a=0;i.forEach(c=>{const u=c.reduce((d,f)=>{const h=r.node(f).height;return d>h?d:h},0);c.forEach(d=>r.node(d).y=a+u/2),a+=u+o})}return bs}var vs,zi;function kh(){if(zi)return vs;zi=1;let e=uh(),t=dh(),n=hh(),s=me().normalizeRanks,r=mh(),i=me().removeEmptyRanks,o=ph(),a=gh(),c=xh(),u=Ih(),d=Ch(),f=me(),h=$e().Graph;vs=m;function m(M,z){let V=z&&z.debugTiming?f.time:f.notime;V("layout",()=>{let H=V("  buildLayoutGraph",()=>N(M));V("  runLayout",()=>p(H,V,z)),V("  updateInputGraph",()=>b(M,H))})}function p(M,z,V){z("    makeSpaceForEdgeLabels",()=>E(M)),z("    removeSelfEdges",()=>R(M)),z("    acyclic",()=>e.run(M)),z("    nestingGraph.run",()=>o.run(M)),z("    rank",()=>n(f.asNonCompoundGraph(M))),z("    injectEdgeLabelProxies",()=>A(M)),z("    removeEmptyRanks",()=>i(M)),z("    nestingGraph.cleanup",()=>o.cleanup(M)),z("    normalizeRanks",()=>s(M)),z("    assignRankMinMax",()=>I(M)),z("    removeEdgeLabelProxies",()=>C(M)),z("    normalize.run",()=>t.run(M)),z("    parentDummyChains",()=>r(M)),z("    addBorderSegments",()=>a(M)),z("    order",()=>u(M,V)),z("    insertSelfEdges",()=>D(M)),z("    adjustCoordinateSystem",()=>c.adjust(M)),z("    position",()=>d(M)),z("    positionSelfEdges",()=>F(M)),z("    removeBorderNodes",()=>B(M)),z("    normalize.undo",()=>t.undo(M)),z("    fixupEdgeLabelCoords",()=>P(M)),z("    undoCoordinateSystem",()=>c.undo(M)),z("    translateGraph",()=>O(M)),z("    assignNodeIntersects",()=>j(M)),z("    reversePoints",()=>T(M)),z("    acyclic.undo",()=>e.undo(M))}function b(M,z){M.nodes().forEach(V=>{let H=M.node(V),W=z.node(V);H&&(H.x=W.x,H.y=W.y,H.rank=W.rank,z.children(V).length&&(H.width=W.width,H.height=W.height))}),M.edges().forEach(V=>{let H=M.edge(V),W=z.edge(V);H.points=W.points,Object.hasOwn(W,"x")&&(H.x=W.x,H.y=W.y)}),M.graph().width=z.graph().width,M.graph().height=z.graph().height}let x=["nodesep","edgesep","ranksep","marginx","marginy"],y={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},v=["acyclicer","ranker","rankdir","align"],g=["width","height","rank"],w={width:0,height:0},S=["minlen","weight","width","height","labeloffset"],_={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},k=["labelpos"];function N(M){let z=new h({multigraph:!0,compound:!0}),V=G(M.graph());return z.setGraph(Object.assign({},y,Y(V,x),f.pick(V,v))),M.nodes().forEach(H=>{let W=G(M.node(H));const q=Y(W,g);Object.keys(w).forEach(X=>{q[X]===void 0&&(q[X]=w[X])}),z.setNode(H,q),z.setParent(H,M.parent(H))}),M.edges().forEach(H=>{let W=G(M.edge(H));z.setEdge(H,Object.assign({},_,Y(W,S),f.pick(W,k)))}),z}function E(M){let z=M.graph();z.ranksep/=2,M.edges().forEach(V=>{let H=M.edge(V);H.minlen*=2,H.labelpos.toLowerCase()!=="c"&&(z.rankdir==="TB"||z.rankdir==="BT"?H.width+=H.labeloffset:H.height+=H.labeloffset)})}function A(M){M.edges().forEach(z=>{let V=M.edge(z);if(V.width&&V.height){let H=M.node(z.v),q={rank:(M.node(z.w).rank-H.rank)/2+H.rank,e:z};f.addDummyNode(M,"edge-proxy",q,"_ep")}})}function I(M){let z=0;M.nodes().forEach(V=>{let H=M.node(V);H.borderTop&&(H.minRank=M.node(H.borderTop).rank,H.maxRank=M.node(H.borderBottom).rank,z=Math.max(z,H.maxRank))}),M.graph().maxRank=z}function C(M){M.nodes().forEach(z=>{let V=M.node(z);V.dummy==="edge-proxy"&&(M.edge(V.e).labelRank=V.rank,M.removeNode(z))})}function O(M){let z=Number.POSITIVE_INFINITY,V=0,H=Number.POSITIVE_INFINITY,W=0,q=M.graph(),X=q.marginx||0,ee=q.marginy||0;function te(Q){let Z=Q.x,ne=Q.y,oe=Q.width,re=Q.height;z=Math.min(z,Z-oe/2),V=Math.max(V,Z+oe/2),H=Math.min(H,ne-re/2),W=Math.max(W,ne+re/2)}M.nodes().forEach(Q=>te(M.node(Q))),M.edges().forEach(Q=>{let Z=M.edge(Q);Object.hasOwn(Z,"x")&&te(Z)}),z-=X,H-=ee,M.nodes().forEach(Q=>{let Z=M.node(Q);Z.x-=z,Z.y-=H}),M.edges().forEach(Q=>{let Z=M.edge(Q);Z.points.forEach(ne=>{ne.x-=z,ne.y-=H}),Object.hasOwn(Z,"x")&&(Z.x-=z),Object.hasOwn(Z,"y")&&(Z.y-=H)}),q.width=V-z+X,q.height=W-H+ee}function j(M){M.edges().forEach(z=>{let V=M.edge(z),H=M.node(z.v),W=M.node(z.w),q,X;V.points?(q=V.points[0],X=V.points[V.points.length-1]):(V.points=[],q=W,X=H),V.points.unshift(f.intersectRect(H,q)),V.points.push(f.intersectRect(W,X))})}function P(M){M.edges().forEach(z=>{let V=M.edge(z);if(Object.hasOwn(V,"x"))switch((V.labelpos==="l"||V.labelpos==="r")&&(V.width-=V.labeloffset),V.labelpos){case"l":V.x-=V.width/2+V.labeloffset;break;case"r":V.x+=V.width/2+V.labeloffset;break}})}function T(M){M.edges().forEach(z=>{let V=M.edge(z);V.reversed&&V.points.reverse()})}function B(M){M.nodes().forEach(z=>{if(M.children(z).length){let V=M.node(z),H=M.node(V.borderTop),W=M.node(V.borderBottom),q=M.node(V.borderLeft[V.borderLeft.length-1]),X=M.node(V.borderRight[V.borderRight.length-1]);V.width=Math.abs(X.x-q.x),V.height=Math.abs(W.y-H.y),V.x=q.x+V.width/2,V.y=H.y+V.height/2}}),M.nodes().forEach(z=>{M.node(z).dummy==="border"&&M.removeNode(z)})}function R(M){M.edges().forEach(z=>{if(z.v===z.w){var V=M.node(z.v);V.selfEdges||(V.selfEdges=[]),V.selfEdges.push({e:z,label:M.edge(z)}),M.removeEdge(z)}})}function D(M){var z=f.buildLayerMatrix(M);z.forEach(V=>{var H=0;V.forEach((W,q)=>{var X=M.node(W);X.order=q+H,(X.selfEdges||[]).forEach(ee=>{f.addDummyNode(M,"selfedge",{width:ee.label.width,height:ee.label.height,rank:X.rank,order:q+ ++H,e:ee.e,label:ee.label},"_se")}),delete X.selfEdges})})}function F(M){M.nodes().forEach(z=>{var V=M.node(z);if(V.dummy==="selfedge"){var H=M.node(V.e.v),W=H.x+H.width/2,q=H.y,X=V.x-W,ee=H.height/2;M.setEdge(V.e,V.label),M.removeNode(z),V.label.points=[{x:W+2*X/3,y:q-ee},{x:W+5*X/6,y:q-ee},{x:W+X,y:q},{x:W+5*X/6,y:q+ee},{x:W+2*X/3,y:q+ee}],V.label.x=V.x,V.label.y=V.y}})}function Y(M,z){return f.mapValues(f.pick(M,z),Number)}function G(M){var z={};return M&&Object.entries(M).forEach(([V,H])=>{typeof V=="string"&&(V=V.toLowerCase()),z[V]=H}),z}return vs}var Ns,Ri;function Ah(){if(Ri)return Ns;Ri=1;let e=me(),t=$e().Graph;Ns={debugOrdering:n};function n(s){let r=e.buildLayerMatrix(s),i=new t({compound:!0,multigraph:!0}).setGraph({});return s.nodes().forEach(o=>{i.setNode(o,{label:o}),i.setParent(o,"layer"+s.node(o).rank)}),s.edges().forEach(o=>i.setEdge(o.v,o.w,{},o.name)),r.forEach((o,a)=>{let c="layer"+a;i.setNode(c,{rank:"same"}),o.reduce((u,d)=>(i.setEdge(u,d,{style:"invis"}),d))}),i}return Ns}var js,Li;function Mh(){return Li||(Li=1,js="1.1.8"),js}var Es,$i;function Th(){return $i||($i=1,Es={graphlib:$e(),layout:kh(),debug:Ah(),util:{time:me().time,notime:me().notime},version:Mh()}),Es}var Ph=Th();const Oi=zd(Ph),jt=44,Hn=.5,qn=1,Rs=512,Dh=400;function zh(e,t){const n=new Oi.graphlib.Graph,s=Uf();return n.setDefaultEdgeLabel(()=>({})),n.setGraph({rankdir:s,ranksep:100,nodesep:50}),e.forEach(r=>{n.setNode(r.id,{width:r.width,height:r.height})}),t.forEach(r=>{n.setEdge(r.source,r.target)}),Oi.layout(n,{disableOptimalOrderHeuristic:!0}),e.map(r=>{const i=n.node(r.id);return{...r,position:{x:i.x-r.width/2,y:i.y-r.height/2}}})}function pe(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,s;n<e.length;n++)(s=pe(e[n]))!==""&&(t+=(t&&" ")+s);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var Rh={value:()=>{}};function lr(){for(var e=0,t=arguments.length,n={},s;e<t;++e){if(!(s=arguments[e]+"")||s in n||/[\s.]/.test(s))throw new Error("illegal type: "+s);n[s]=[]}return new Pn(n)}function Pn(e){this._=e}function Lh(e,t){return e.trim().split(/^|\s+/).map(function(n){var s="",r=n.indexOf(".");if(r>=0&&(s=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:s}})}Pn.prototype=lr.prototype={constructor:Pn,on:function(e,t){var n=this._,s=Lh(e+"",n),r,i=-1,o=s.length;if(arguments.length<2){for(;++i<o;)if((r=(e=s[i]).type)&&(r=$h(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<o;)if(r=(e=s[i]).type)n[r]=Bi(n[r],e.name,t);else if(t==null)for(r in n)n[r]=Bi(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Pn(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),s=0,r,i;s<r;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],s=0,r=i.length;s<r;++s)i[s].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)}};function $h(e,t){for(var n=0,s=e.length,r;n<s;++n)if((r=e[n]).name===t)return r.value}function Bi(e,t,n){for(var s=0,r=e.length;s<r;++s)if(e[s].name===t){e[s]=Rh,e=e.slice(0,s).concat(e.slice(s+1));break}return n!=null&&e.push({name:t,value:n}),e}var Ls="http://www.w3.org/1999/xhtml";const Vi={svg:"http://www.w3.org/2000/svg",xhtml:Ls,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function cr(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Vi.hasOwnProperty(t)?{space:Vi[t],local:e}:e}function Oh(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Ls&&t.documentElement.namespaceURI===Ls?t.createElement(e):t.createElementNS(n,e)}}function Bh(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function El(e){var t=cr(e);return(t.local?Bh:Oh)(t)}function Vh(){}function uo(e){return e==null?Vh:function(){return this.querySelector(e)}}function Fh(e){typeof e!="function"&&(e=uo(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],o=i.length,a=s[r]=new Array(o),c,u,d=0;d<o;++d)(c=i[d])&&(u=e.call(c,c.__data__,d,i))&&("__data__"in c&&(u.__data__=c.__data__),a[d]=u);return new Ce(s,this._parents)}function Hh(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function qh(){return[]}function _l(e){return e==null?qh:function(){return this.querySelectorAll(e)}}function Gh(e){return function(){return Hh(e.apply(this,arguments))}}function Yh(e){typeof e=="function"?e=Gh(e):e=_l(e);for(var t=this._groups,n=t.length,s=[],r=[],i=0;i<n;++i)for(var o=t[i],a=o.length,c,u=0;u<a;++u)(c=o[u])&&(s.push(e.call(c,c.__data__,u,o)),r.push(c));return new Ce(s,r)}function Il(e){return function(){return this.matches(e)}}function Sl(e){return function(t){return t.matches(e)}}var Wh=Array.prototype.find;function Xh(e){return function(){return Wh.call(this.children,e)}}function Uh(){return this.firstElementChild}function Zh(e){return this.select(e==null?Uh:Xh(typeof e=="function"?e:Sl(e)))}var Kh=Array.prototype.filter;function Qh(){return Array.from(this.children)}function Jh(e){return function(){return Kh.call(this.children,e)}}function em(e){return this.selectAll(e==null?Qh:Jh(typeof e=="function"?e:Sl(e)))}function tm(e){typeof e!="function"&&(e=Il(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],o=i.length,a=s[r]=[],c,u=0;u<o;++u)(c=i[u])&&e.call(c,c.__data__,u,i)&&a.push(c);return new Ce(s,this._parents)}function Cl(e){return new Array(e.length)}function nm(){return new Ce(this._enter||this._groups.map(Cl),this._parents)}function Gn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Gn.prototype={constructor:Gn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function rm(e){return function(){return e}}function sm(e,t,n,s,r,i){for(var o=0,a,c=t.length,u=i.length;o<u;++o)(a=t[o])?(a.__data__=i[o],s[o]=a):n[o]=new Gn(e,i[o]);for(;o<c;++o)(a=t[o])&&(r[o]=a)}function om(e,t,n,s,r,i,o){var a,c,u=new Map,d=t.length,f=i.length,h=new Array(d),m;for(a=0;a<d;++a)(c=t[a])&&(h[a]=m=o.call(c,c.__data__,a,t)+"",u.has(m)?r[a]=c:u.set(m,c));for(a=0;a<f;++a)m=o.call(e,i[a],a,i)+"",(c=u.get(m))?(s[a]=c,c.__data__=i[a],u.delete(m)):n[a]=new Gn(e,i[a]);for(a=0;a<d;++a)(c=t[a])&&u.get(h[a])===c&&(r[a]=c)}function im(e){return e.__data__}function am(e,t){if(!arguments.length)return Array.from(this,im);var n=t?om:sm,s=this._parents,r=this._groups;typeof e!="function"&&(e=rm(e));for(var i=r.length,o=new Array(i),a=new Array(i),c=new Array(i),u=0;u<i;++u){var d=s[u],f=r[u],h=f.length,m=lm(e.call(d,d&&d.__data__,u,s)),p=m.length,b=a[u]=new Array(p),x=o[u]=new Array(p),y=c[u]=new Array(h);n(d,f,b,x,y,m,t);for(var v=0,g=0,w,S;v<p;++v)if(w=b[v]){for(v>=g&&(g=v+1);!(S=x[g])&&++g<p;);w._next=S||null}}return o=new Ce(o,s),o._enter=a,o._exit=c,o}function lm(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function cm(){return new Ce(this._exit||this._groups.map(Cl),this._parents)}function um(e,t,n){var s=this.enter(),r=this,i=this.exit();return typeof e=="function"?(s=e(s),s&&(s=s.selection())):s=s.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?i.remove():n(i),s&&r?s.merge(r).order():r}function dm(e){for(var t=e.selection?e.selection():e,n=this._groups,s=t._groups,r=n.length,i=s.length,o=Math.min(r,i),a=new Array(r),c=0;c<o;++c)for(var u=n[c],d=s[c],f=u.length,h=a[c]=new Array(f),m,p=0;p<f;++p)(m=u[p]||d[p])&&(h[p]=m);for(;c<r;++c)a[c]=n[c];return new Ce(a,this._parents)}function fm(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var s=e[t],r=s.length-1,i=s[r],o;--r>=0;)(o=s[r])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function hm(e){e||(e=mm);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var n=this._groups,s=n.length,r=new Array(s),i=0;i<s;++i){for(var o=n[i],a=o.length,c=r[i]=new Array(a),u,d=0;d<a;++d)(u=o[d])&&(c[d]=u);c.sort(t)}return new Ce(r,this._parents).order()}function mm(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function pm(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function gm(){return Array.from(this)}function xm(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,i=s.length;r<i;++r){var o=s[r];if(o)return o}return null}function ym(){let e=0;for(const t of this)++e;return e}function wm(){return!this.node()}function bm(e){for(var t=this._groups,n=0,s=t.length;n<s;++n)for(var r=t[n],i=0,o=r.length,a;i<o;++i)(a=r[i])&&e.call(a,a.__data__,i,r);return this}function vm(e){return function(){this.removeAttribute(e)}}function Nm(e){return function(){this.removeAttributeNS(e.space,e.local)}}function jm(e,t){return function(){this.setAttribute(e,t)}}function Em(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function _m(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Im(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Sm(e,t){var n=cr(e);if(arguments.length<2){var s=this.node();return n.local?s.getAttributeNS(n.space,n.local):s.getAttribute(n)}return this.each((t==null?n.local?Nm:vm:typeof t=="function"?n.local?Im:_m:n.local?Em:jm)(n,t))}function kl(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Cm(e){return function(){this.style.removeProperty(e)}}function km(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Am(e,t,n){return function(){var s=t.apply(this,arguments);s==null?this.style.removeProperty(e):this.style.setProperty(e,s,n)}}function Mm(e,t,n){return arguments.length>1?this.each((t==null?Cm:typeof t=="function"?Am:km)(e,t,n??"")):kt(this.node(),e)}function kt(e,t){return e.style.getPropertyValue(t)||kl(e).getComputedStyle(e,null).getPropertyValue(t)}function Tm(e){return function(){delete this[e]}}function Pm(e,t){return function(){this[e]=t}}function Dm(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function zm(e,t){return arguments.length>1?this.each((t==null?Tm:typeof t=="function"?Dm:Pm)(e,t)):this.node()[e]}function Al(e){return e.trim().split(/^|\s+/)}function fo(e){return e.classList||new Ml(e)}function Ml(e){this._node=e,this._names=Al(e.getAttribute("class")||"")}Ml.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Tl(e,t){for(var n=fo(e),s=-1,r=t.length;++s<r;)n.add(t[s])}function Pl(e,t){for(var n=fo(e),s=-1,r=t.length;++s<r;)n.remove(t[s])}function Rm(e){return function(){Tl(this,e)}}function Lm(e){return function(){Pl(this,e)}}function $m(e,t){return function(){(t.apply(this,arguments)?Tl:Pl)(this,e)}}function Om(e,t){var n=Al(e+"");if(arguments.length<2){for(var s=fo(this.node()),r=-1,i=n.length;++r<i;)if(!s.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?$m:t?Rm:Lm)(n,t))}function Bm(){this.textContent=""}function Vm(e){return function(){this.textContent=e}}function Fm(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Hm(e){return arguments.length?this.each(e==null?Bm:(typeof e=="function"?Fm:Vm)(e)):this.node().textContent}function qm(){this.innerHTML=""}function Gm(e){return function(){this.innerHTML=e}}function Ym(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Wm(e){return arguments.length?this.each(e==null?qm:(typeof e=="function"?Ym:Gm)(e)):this.node().innerHTML}function Xm(){this.nextSibling&&this.parentNode.appendChild(this)}function Um(){return this.each(Xm)}function Zm(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Km(){return this.each(Zm)}function Qm(e){var t=typeof e=="function"?e:El(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Jm(){return null}function ep(e,t){var n=typeof e=="function"?e:El(e),s=t==null?Jm:typeof t=="function"?t:uo(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),s.apply(this,arguments)||null)})}function tp(){var e=this.parentNode;e&&e.removeChild(this)}function np(){return this.each(tp)}function rp(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function sp(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function op(e){return this.select(e?sp:rp)}function ip(e){return arguments.length?this.property("__data__",e):this.node().__data__}function ap(e){return function(t){e.call(this,t,this.__data__)}}function lp(e){return e.trim().split(/^|\s+/).map(function(t){var n="",s=t.indexOf(".");return s>=0&&(n=t.slice(s+1),t=t.slice(0,s)),{type:t,name:n}})}function cp(e){return function(){var t=this.__on;if(t){for(var n=0,s=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++s]=i;++s?t.length=s:delete this.__on}}}function up(e,t,n){return function(){var s=this.__on,r,i=ap(t);if(s){for(var o=0,a=s.length;o<a;++o)if((r=s[o]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},s?s.push(r):this.__on=[r]}}function dp(e,t,n){var s=lp(e+""),r,i=s.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,u=a.length,d;c<u;++c)for(r=0,d=a[c];r<i;++r)if((o=s[r]).type===d.type&&o.name===d.name)return d.value}return}for(a=t?up:cp,r=0;r<i;++r)this.each(a(s[r],t,n));return this}function Dl(e,t,n){var s=kl(e),r=s.CustomEvent;typeof r=="function"?r=new r(t,n):(r=s.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function fp(e,t){return function(){return Dl(this,e,t)}}function hp(e,t){return function(){return Dl(this,e,t.apply(this,arguments))}}function mp(e,t){return this.each((typeof t=="function"?hp:fp)(e,t))}function*pp(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,i=s.length,o;r<i;++r)(o=s[r])&&(yield o)}var zl=[null];function Ce(e,t){this._groups=e,this._parents=t}function cn(){return new Ce([[document.documentElement]],zl)}function gp(){return this}Ce.prototype=cn.prototype={constructor:Ce,select:Fh,selectAll:Yh,selectChild:Zh,selectChildren:em,filter:tm,data:am,enter:nm,exit:cm,join:um,merge:dm,selection:gp,order:fm,sort:hm,call:pm,nodes:gm,node:xm,size:ym,empty:wm,each:bm,attr:Sm,style:Mm,property:zm,classed:Om,text:Hm,html:Wm,raise:Um,lower:Km,append:Qm,insert:ep,remove:np,clone:op,datum:ip,on:dp,dispatch:mp,[Symbol.iterator]:pp};function Se(e){return typeof e=="string"?new Ce([[document.querySelector(e)]],[document.documentElement]):new Ce([[e]],zl)}function xp(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Pe(e,t){if(e=xp(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var s=n.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,s=s.matrixTransform(t.getScreenCTM().inverse()),[s.x,s.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}const yp={passive:!1},Zt={capture:!0,passive:!1};function _s(e){e.stopImmediatePropagation()}function St(e){e.preventDefault(),e.stopImmediatePropagation()}function Rl(e){var t=e.document.documentElement,n=Se(e).on("dragstart.drag",St,Zt);"onselectstart"in t?n.on("selectstart.drag",St,Zt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Ll(e,t){var n=e.document.documentElement,s=Se(e).on("dragstart.drag",null);t&&(s.on("click.drag",St,Zt),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in n?s.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const bn=e=>()=>e;function $s(e,{sourceEvent:t,subject:n,target:s,identifier:r,active:i,x:o,y:a,dx:c,dy:u,dispatch:d}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:d}})}$s.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function wp(e){return!e.ctrlKey&&!e.button}function bp(){return this.parentNode}function vp(e,t){return t??{x:e.x,y:e.y}}function Np(){return navigator.maxTouchPoints||"ontouchstart"in this}function $l(){var e=wp,t=bp,n=vp,s=Np,r={},i=lr("start","drag","end"),o=0,a,c,u,d,f=0;function h(w){w.on("mousedown.drag",m).filter(s).on("touchstart.drag",x).on("touchmove.drag",y,yp).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(w,S){if(!(d||!e.call(this,w,S))){var _=g(this,t.call(this,w,S),w,S,"mouse");_&&(Se(w.view).on("mousemove.drag",p,Zt).on("mouseup.drag",b,Zt),Rl(w.view),_s(w),u=!1,a=w.clientX,c=w.clientY,_("start",w))}}function p(w){if(St(w),!u){var S=w.clientX-a,_=w.clientY-c;u=S*S+_*_>f}r.mouse("drag",w)}function b(w){Se(w.view).on("mousemove.drag mouseup.drag",null),Ll(w.view,u),St(w),r.mouse("end",w)}function x(w,S){if(e.call(this,w,S)){var _=w.changedTouches,k=t.call(this,w,S),N=_.length,E,A;for(E=0;E<N;++E)(A=g(this,k,w,S,_[E].identifier,_[E]))&&(_s(w),A("start",w,_[E]))}}function y(w){var S=w.changedTouches,_=S.length,k,N;for(k=0;k<_;++k)(N=r[S[k].identifier])&&(St(w),N("drag",w,S[k]))}function v(w){var S=w.changedTouches,_=S.length,k,N;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),k=0;k<_;++k)(N=r[S[k].identifier])&&(_s(w),N("end",w,S[k]))}function g(w,S,_,k,N,E){var A=i.copy(),I=Pe(E||_,S),C,O,j;if((j=n.call(w,new $s("beforestart",{sourceEvent:_,target:h,identifier:N,active:o,x:I[0],y:I[1],dx:0,dy:0,dispatch:A}),k))!=null)return C=j.x-I[0]||0,O=j.y-I[1]||0,function P(T,B,R){var D=I,F;switch(T){case"start":r[N]=P,F=o++;break;case"end":delete r[N],--o;case"drag":I=Pe(R||B,S),F=o;break}A.call(T,w,new $s(T,{sourceEvent:B,subject:j,target:h,identifier:N,active:F,x:I[0]+C,y:I[1]+O,dx:I[0]-D[0],dy:I[1]-D[1],dispatch:A}),k)}}return h.filter=function(w){return arguments.length?(e=typeof w=="function"?w:bn(!!w),h):e},h.container=function(w){return arguments.length?(t=typeof w=="function"?w:bn(w),h):t},h.subject=function(w){return arguments.length?(n=typeof w=="function"?w:bn(w),h):n},h.touchable=function(w){return arguments.length?(s=typeof w=="function"?w:bn(!!w),h):s},h.on=function(){var w=i.on.apply(i,arguments);return w===i?h:w},h.clickDistance=function(w){return arguments.length?(f=(w=+w)*w,h):Math.sqrt(f)},h}function ho(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ol(e,t){var n=Object.create(e.prototype);for(var s in t)n[s]=t[s];return n}function un(){}var Kt=.7,Yn=1/Kt,Ct="\\s*([+-]?\\d+)\\s*",Qt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",qe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",jp=/^#([0-9a-f]{3,8})$/,Ep=new RegExp(`^rgb\\(${Ct},${Ct},${Ct}\\)$`),_p=new RegExp(`^rgb\\(${qe},${qe},${qe}\\)$`),Ip=new RegExp(`^rgba\\(${Ct},${Ct},${Ct},${Qt}\\)$`),Sp=new RegExp(`^rgba\\(${qe},${qe},${qe},${Qt}\\)$`),Cp=new RegExp(`^hsl\\(${Qt},${qe},${qe}\\)$`),kp=new RegExp(`^hsla\\(${Qt},${qe},${qe},${Qt}\\)$`),Fi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ho(un,xt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Hi,formatHex:Hi,formatHex8:Ap,formatHsl:Mp,formatRgb:qi,toString:qi});function Hi(){return this.rgb().formatHex()}function Ap(){return this.rgb().formatHex8()}function Mp(){return Bl(this).formatHsl()}function qi(){return this.rgb().formatRgb()}function xt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=jp.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Gi(t):n===3?new _e(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?vn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?vn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ep.exec(e))?new _e(t[1],t[2],t[3],1):(t=_p.exec(e))?new _e(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Ip.exec(e))?vn(t[1],t[2],t[3],t[4]):(t=Sp.exec(e))?vn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Cp.exec(e))?Xi(t[1],t[2]/100,t[3]/100,1):(t=kp.exec(e))?Xi(t[1],t[2]/100,t[3]/100,t[4]):Fi.hasOwnProperty(e)?Gi(Fi[e]):e==="transparent"?new _e(NaN,NaN,NaN,0):null}function Gi(e){return new _e(e>>16&255,e>>8&255,e&255,1)}function vn(e,t,n,s){return s<=0&&(e=t=n=NaN),new _e(e,t,n,s)}function Tp(e){return e instanceof un||(e=xt(e)),e?(e=e.rgb(),new _e(e.r,e.g,e.b,e.opacity)):new _e}function Os(e,t,n,s){return arguments.length===1?Tp(e):new _e(e,t,n,s??1)}function _e(e,t,n,s){this.r=+e,this.g=+t,this.b=+n,this.opacity=+s}ho(_e,Os,Ol(un,{brighter(e){return e=e==null?Yn:Math.pow(Yn,e),new _e(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Kt:Math.pow(Kt,e),new _e(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new _e(pt(this.r),pt(this.g),pt(this.b),Wn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yi,formatHex:Yi,formatHex8:Pp,formatRgb:Wi,toString:Wi}));function Yi(){return`#${ht(this.r)}${ht(this.g)}${ht(this.b)}`}function Pp(){return`#${ht(this.r)}${ht(this.g)}${ht(this.b)}${ht((isNaN(this.opacity)?1:this.opacity)*255)}`}function Wi(){const e=Wn(this.opacity);return`${e===1?"rgb(":"rgba("}${pt(this.r)}, ${pt(this.g)}, ${pt(this.b)}${e===1?")":`, ${e})`}`}function Wn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function pt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ht(e){return e=pt(e),(e<16?"0":"")+e.toString(16)}function Xi(e,t,n,s){return s<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new De(e,t,n,s)}function Bl(e){if(e instanceof De)return new De(e.h,e.s,e.l,e.opacity);if(e instanceof un||(e=xt(e)),!e)return new De;if(e instanceof De)return e;e=e.rgb();var t=e.r/255,n=e.g/255,s=e.b/255,r=Math.min(t,n,s),i=Math.max(t,n,s),o=NaN,a=i-r,c=(i+r)/2;return a?(t===i?o=(n-s)/a+(n<s)*6:n===i?o=(s-t)/a+2:o=(t-n)/a+4,a/=c<.5?i+r:2-i-r,o*=60):a=c>0&&c<1?0:o,new De(o,a,c,e.opacity)}function Dp(e,t,n,s){return arguments.length===1?Bl(e):new De(e,t,n,s??1)}function De(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}ho(De,Dp,Ol(un,{brighter(e){return e=e==null?Yn:Math.pow(Yn,e),new De(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Kt:Math.pow(Kt,e),new De(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,s=n+(n<.5?n:1-n)*t,r=2*n-s;return new _e(Is(e>=240?e-240:e+120,r,s),Is(e,r,s),Is(e<120?e+240:e-120,r,s),this.opacity)},clamp(){return new De(Ui(this.h),Nn(this.s),Nn(this.l),Wn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Wn(this.opacity);return`${e===1?"hsl(":"hsla("}${Ui(this.h)}, ${Nn(this.s)*100}%, ${Nn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Ui(e){return e=(e||0)%360,e<0?e+360:e}function Nn(e){return Math.max(0,Math.min(1,e||0))}function Is(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const mo=e=>()=>e;function zp(e,t){return function(n){return e+n*t}}function Rp(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(s){return Math.pow(e+s*t,n)}}function Lp(e){return(e=+e)==1?Vl:function(t,n){return n-t?Rp(t,n,e):mo(isNaN(t)?n:t)}}function Vl(e,t){var n=t-e;return n?zp(e,n):mo(isNaN(e)?t:e)}const Xn=(function e(t){var n=Lp(t);function s(r,i){var o=n((r=Os(r)).r,(i=Os(i)).r),a=n(r.g,i.g),c=n(r.b,i.b),u=Vl(r.opacity,i.opacity);return function(d){return r.r=o(d),r.g=a(d),r.b=c(d),r.opacity=u(d),r+""}}return s.gamma=e,s})(1);function $p(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,s=t.slice(),r;return function(i){for(r=0;r<n;++r)s[r]=e[r]*(1-i)+t[r]*i;return s}}function Op(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Bp(e,t){var n=t?t.length:0,s=e?Math.min(n,e.length):0,r=new Array(s),i=new Array(n),o;for(o=0;o<s;++o)r[o]=Yt(e[o],t[o]);for(;o<n;++o)i[o]=t[o];return function(a){for(o=0;o<s;++o)i[o]=r[o](a);return i}}function Vp(e,t){var n=new Date;return e=+e,t=+t,function(s){return n.setTime(e*(1-s)+t*s),n}}function He(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Fp(e,t){var n={},s={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Yt(e[r],t[r]):s[r]=t[r];return function(i){for(r in n)s[r]=n[r](i);return s}}var Bs=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ss=new RegExp(Bs.source,"g");function Hp(e){return function(){return e}}function qp(e){return function(t){return e(t)+""}}function Fl(e,t){var n=Bs.lastIndex=Ss.lastIndex=0,s,r,i,o=-1,a=[],c=[];for(e=e+"",t=t+"";(s=Bs.exec(e))&&(r=Ss.exec(t));)(i=r.index)>n&&(i=t.slice(n,i),a[o]?a[o]+=i:a[++o]=i),(s=s[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,c.push({i:o,x:He(s,r)})),n=Ss.lastIndex;return n<t.length&&(i=t.slice(n),a[o]?a[o]+=i:a[++o]=i),a.length<2?c[0]?qp(c[0].x):Hp(t):(t=c.length,function(u){for(var d=0,f;d<t;++d)a[(f=c[d]).i]=f.x(u);return a.join("")})}function Yt(e,t){var n=typeof t,s;return t==null||n==="boolean"?mo(t):(n==="number"?He:n==="string"?(s=xt(t))?(t=s,Xn):Fl:t instanceof xt?Xn:t instanceof Date?Vp:Op(t)?$p:Array.isArray(t)?Bp:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Fp:He)(e,t)}var Zi=180/Math.PI,Vs={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Hl(e,t,n,s,r,i){var o,a,c;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(c=e*n+t*s)&&(n-=e*c,s-=t*c),(a=Math.sqrt(n*n+s*s))&&(n/=a,s/=a,c/=a),e*s<t*n&&(e=-e,t=-t,c=-c,o=-o),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*Zi,skewX:Math.atan(c)*Zi,scaleX:o,scaleY:a}}var jn;function Gp(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Vs:Hl(t.a,t.b,t.c,t.d,t.e,t.f)}function Yp(e){return e==null||(jn||(jn=document.createElementNS("http://www.w3.org/2000/svg","g")),jn.setAttribute("transform",e),!(e=jn.transform.baseVal.consolidate()))?Vs:(e=e.matrix,Hl(e.a,e.b,e.c,e.d,e.e,e.f))}function ql(e,t,n,s){function r(u){return u.length?u.pop()+" ":""}function i(u,d,f,h,m,p){if(u!==f||d!==h){var b=m.push("translate(",null,t,null,n);p.push({i:b-4,x:He(u,f)},{i:b-2,x:He(d,h)})}else(f||h)&&m.push("translate("+f+t+h+n)}function o(u,d,f,h){u!==d?(u-d>180?d+=360:d-u>180&&(u+=360),h.push({i:f.push(r(f)+"rotate(",null,s)-2,x:He(u,d)})):d&&f.push(r(f)+"rotate("+d+s)}function a(u,d,f,h){u!==d?h.push({i:f.push(r(f)+"skewX(",null,s)-2,x:He(u,d)}):d&&f.push(r(f)+"skewX("+d+s)}function c(u,d,f,h,m,p){if(u!==f||d!==h){var b=m.push(r(m)+"scale(",null,",",null,")");p.push({i:b-4,x:He(u,f)},{i:b-2,x:He(d,h)})}else(f!==1||h!==1)&&m.push(r(m)+"scale("+f+","+h+")")}return function(u,d){var f=[],h=[];return u=e(u),d=e(d),i(u.translateX,u.translateY,d.translateX,d.translateY,f,h),o(u.rotate,d.rotate,f,h),a(u.skewX,d.skewX,f,h),c(u.scaleX,u.scaleY,d.scaleX,d.scaleY,f,h),u=d=null,function(m){for(var p=-1,b=h.length,x;++p<b;)f[(x=h[p]).i]=x.x(m);return f.join("")}}}var Wp=ql(Gp,"px, ","px)","deg)"),Xp=ql(Yp,", ",")",")"),Up=1e-12;function Ki(e){return((e=Math.exp(e))+1/e)/2}function Zp(e){return((e=Math.exp(e))-1/e)/2}function Kp(e){return((e=Math.exp(2*e))-1)/(e+1)}const Dn=(function e(t,n,s){function r(i,o){var a=i[0],c=i[1],u=i[2],d=o[0],f=o[1],h=o[2],m=d-a,p=f-c,b=m*m+p*p,x,y;if(b<Up)y=Math.log(h/u)/t,x=function(k){return[a+k*m,c+k*p,u*Math.exp(t*k*y)]};else{var v=Math.sqrt(b),g=(h*h-u*u+s*b)/(2*u*n*v),w=(h*h-u*u-s*b)/(2*h*n*v),S=Math.log(Math.sqrt(g*g+1)-g),_=Math.log(Math.sqrt(w*w+1)-w);y=(_-S)/t,x=function(k){var N=k*y,E=Ki(S),A=u/(n*v)*(E*Kp(t*N+S)-Zp(S));return[a+A*m,c+A*p,u*E/Ki(t*N+S)]}}return x.duration=y*1e3*t/Math.SQRT2,x}return r.rho=function(i){var o=Math.max(.001,+i),a=o*o,c=a*a;return e(o,a,c)},r})(Math.SQRT2,2,4);var At=0,qt=0,Ft=0,Gl=1e3,Un,Gt,Zn=0,yt=0,ur=0,Jt=typeof performance=="object"&&performance.now?performance:Date,Yl=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function po(){return yt||(Yl(Qp),yt=Jt.now()+ur)}function Qp(){yt=0}function Kn(){this._call=this._time=this._next=null}Kn.prototype=Wl.prototype={constructor:Kn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?po():+n)+(t==null?0:+t),!this._next&&Gt!==this&&(Gt?Gt._next=this:Un=this,Gt=this),this._call=e,this._time=n,Fs()},stop:function(){this._call&&(this._call=null,this._time=1/0,Fs())}};function Wl(e,t,n){var s=new Kn;return s.restart(e,t,n),s}function Jp(){po(),++At;for(var e=Un,t;e;)(t=yt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--At}function Qi(){yt=(Zn=Jt.now())+ur,At=qt=0;try{Jp()}finally{At=0,tg(),yt=0}}function eg(){var e=Jt.now(),t=e-Zn;t>Gl&&(ur-=t,Zn=e)}function tg(){for(var e,t=Un,n,s=1/0;t;)t._call?(s>t._time&&(s=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Un=n);Gt=e,Fs(s)}function Fs(e){if(!At){qt&&(qt=clearTimeout(qt));var t=e-yt;t>24?(e<1/0&&(qt=setTimeout(Qi,e-Jt.now()-ur)),Ft&&(Ft=clearInterval(Ft))):(Ft||(Zn=Jt.now(),Ft=setInterval(eg,Gl)),At=1,Yl(Qi))}}function Ji(e,t,n){var s=new Kn;return t=t==null?0:+t,s.restart(r=>{s.stop(),e(r+t)},t,n),s}var ng=lr("start","end","cancel","interrupt"),rg=[],Xl=0,ea=1,Hs=2,zn=3,ta=4,qs=5,Rn=6;function dr(e,t,n,s,r,i){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;sg(e,n,{name:t,index:s,group:r,on:ng,tween:rg,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Xl})}function go(e,t){var n=Ve(e,t);if(n.state>Xl)throw new Error("too late; already scheduled");return n}function Xe(e,t){var n=Ve(e,t);if(n.state>zn)throw new Error("too late; already running");return n}function Ve(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function sg(e,t,n){var s=e.__transition,r;s[t]=n,n.timer=Wl(i,0,n.time);function i(u){n.state=ea,n.timer.restart(o,n.delay,n.time),n.delay<=u&&o(u-n.delay)}function o(u){var d,f,h,m;if(n.state!==ea)return c();for(d in s)if(m=s[d],m.name===n.name){if(m.state===zn)return Ji(o);m.state===ta?(m.state=Rn,m.timer.stop(),m.on.call("interrupt",e,e.__data__,m.index,m.group),delete s[d]):+d<t&&(m.state=Rn,m.timer.stop(),m.on.call("cancel",e,e.__data__,m.index,m.group),delete s[d])}if(Ji(function(){n.state===zn&&(n.state=ta,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=Hs,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Hs){for(n.state=zn,r=new Array(h=n.tween.length),d=0,f=-1;d<h;++d)(m=n.tween[d].value.call(e,e.__data__,n.index,n.group))&&(r[++f]=m);r.length=f+1}}function a(u){for(var d=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(c),n.state=qs,1),f=-1,h=r.length;++f<h;)r[f].call(e,d);n.state===qs&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=Rn,n.timer.stop(),delete s[t];for(var u in s)return;delete e.__transition}}function Ln(e,t){var n=e.__transition,s,r,i=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((s=n[o]).name!==t){i=!1;continue}r=s.state>Hs&&s.state<qs,s.state=Rn,s.timer.stop(),s.on.call(r?"interrupt":"cancel",e,e.__data__,s.index,s.group),delete n[o]}i&&delete e.__transition}}function og(e){return this.each(function(){Ln(this,e)})}function ig(e,t){var n,s;return function(){var r=Xe(this,e),i=r.tween;if(i!==n){s=n=i;for(var o=0,a=s.length;o<a;++o)if(s[o].name===t){s=s.slice(),s.splice(o,1);break}}r.tween=s}}function ag(e,t,n){var s,r;if(typeof n!="function")throw new Error;return function(){var i=Xe(this,e),o=i.tween;if(o!==s){r=(s=o).slice();for(var a={name:t,value:n},c=0,u=r.length;c<u;++c)if(r[c].name===t){r[c]=a;break}c===u&&r.push(a)}i.tween=r}}function lg(e,t){var n=this._id;if(e+="",arguments.length<2){for(var s=Ve(this.node(),n).tween,r=0,i=s.length,o;r<i;++r)if((o=s[r]).name===e)return o.value;return null}return this.each((t==null?ig:ag)(n,e,t))}function xo(e,t,n){var s=e._id;return e.each(function(){var r=Xe(this,s);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Ve(r,s).value[t]}}function Ul(e,t){var n;return(typeof t=="number"?He:t instanceof xt?Xn:(n=xt(t))?(t=n,Xn):Fl)(e,t)}function cg(e){return function(){this.removeAttribute(e)}}function ug(e){return function(){this.removeAttributeNS(e.space,e.local)}}function dg(e,t,n){var s,r=n+"",i;return function(){var o=this.getAttribute(e);return o===r?null:o===s?i:i=t(s=o,n)}}function fg(e,t,n){var s,r=n+"",i;return function(){var o=this.getAttributeNS(e.space,e.local);return o===r?null:o===s?i:i=t(s=o,n)}}function hg(e,t,n){var s,r,i;return function(){var o,a=n(this),c;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),c=a+"",o===c?null:o===s&&c===r?i:(r=c,i=t(s=o,a)))}}function mg(e,t,n){var s,r,i;return function(){var o,a=n(this),c;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),c=a+"",o===c?null:o===s&&c===r?i:(r=c,i=t(s=o,a)))}}function pg(e,t){var n=cr(e),s=n==="transform"?Xp:Ul;return this.attrTween(e,typeof t=="function"?(n.local?mg:hg)(n,s,xo(this,"attr."+e,t)):t==null?(n.local?ug:cg)(n):(n.local?fg:dg)(n,s,t))}function gg(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function xg(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function yg(e,t){var n,s;function r(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&xg(e,i)),n}return r._value=t,r}function wg(e,t){var n,s;function r(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&gg(e,i)),n}return r._value=t,r}function bg(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var s=cr(e);return this.tween(n,(s.local?yg:wg)(s,t))}function vg(e,t){return function(){go(this,e).delay=+t.apply(this,arguments)}}function Ng(e,t){return t=+t,function(){go(this,e).delay=t}}function jg(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?vg:Ng)(t,e)):Ve(this.node(),t).delay}function Eg(e,t){return function(){Xe(this,e).duration=+t.apply(this,arguments)}}function _g(e,t){return t=+t,function(){Xe(this,e).duration=t}}function Ig(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Eg:_g)(t,e)):Ve(this.node(),t).duration}function Sg(e,t){if(typeof t!="function")throw new Error;return function(){Xe(this,e).ease=t}}function Cg(e){var t=this._id;return arguments.length?this.each(Sg(t,e)):Ve(this.node(),t).ease}function kg(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Xe(this,e).ease=n}}function Ag(e){if(typeof e!="function")throw new Error;return this.each(kg(this._id,e))}function Mg(e){typeof e!="function"&&(e=Il(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],o=i.length,a=s[r]=[],c,u=0;u<o;++u)(c=i[u])&&e.call(c,c.__data__,u,i)&&a.push(c);return new Je(s,this._parents,this._name,this._id)}function Tg(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,s=t.length,r=n.length,i=Math.min(s,r),o=new Array(s),a=0;a<i;++a)for(var c=t[a],u=n[a],d=c.length,f=o[a]=new Array(d),h,m=0;m<d;++m)(h=c[m]||u[m])&&(f[m]=h);for(;a<s;++a)o[a]=t[a];return new Je(o,this._parents,this._name,this._id)}function Pg(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Dg(e,t,n){var s,r,i=Pg(t)?go:Xe;return function(){var o=i(this,e),a=o.on;a!==s&&(r=(s=a).copy()).on(t,n),o.on=r}}function zg(e,t){var n=this._id;return arguments.length<2?Ve(this.node(),n).on.on(e):this.each(Dg(n,e,t))}function Rg(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Lg(){return this.on("end.remove",Rg(this._id))}function $g(e){var t=this._name,n=this._id;typeof e!="function"&&(e=uo(e));for(var s=this._groups,r=s.length,i=new Array(r),o=0;o<r;++o)for(var a=s[o],c=a.length,u=i[o]=new Array(c),d,f,h=0;h<c;++h)(d=a[h])&&(f=e.call(d,d.__data__,h,a))&&("__data__"in d&&(f.__data__=d.__data__),u[h]=f,dr(u[h],t,n,h,u,Ve(d,n)));return new Je(i,this._parents,t,n)}function Og(e){var t=this._name,n=this._id;typeof e!="function"&&(e=_l(e));for(var s=this._groups,r=s.length,i=[],o=[],a=0;a<r;++a)for(var c=s[a],u=c.length,d,f=0;f<u;++f)if(d=c[f]){for(var h=e.call(d,d.__data__,f,c),m,p=Ve(d,n),b=0,x=h.length;b<x;++b)(m=h[b])&&dr(m,t,n,b,h,p);i.push(h),o.push(d)}return new Je(i,o,t,n)}var Bg=cn.prototype.constructor;function Vg(){return new Bg(this._groups,this._parents)}function Fg(e,t){var n,s,r;return function(){var i=kt(this,e),o=(this.style.removeProperty(e),kt(this,e));return i===o?null:i===n&&o===s?r:r=t(n=i,s=o)}}function Zl(e){return function(){this.style.removeProperty(e)}}function Hg(e,t,n){var s,r=n+"",i;return function(){var o=kt(this,e);return o===r?null:o===s?i:i=t(s=o,n)}}function qg(e,t,n){var s,r,i;return function(){var o=kt(this,e),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(e),kt(this,e))),o===c?null:o===s&&c===r?i:(r=c,i=t(s=o,a))}}function Gg(e,t){var n,s,r,i="style."+t,o="end."+i,a;return function(){var c=Xe(this,e),u=c.on,d=c.value[i]==null?a||(a=Zl(t)):void 0;(u!==n||r!==d)&&(s=(n=u).copy()).on(o,r=d),c.on=s}}function Yg(e,t,n){var s=(e+="")=="transform"?Wp:Ul;return t==null?this.styleTween(e,Fg(e,s)).on("end.style."+e,Zl(e)):typeof t=="function"?this.styleTween(e,qg(e,s,xo(this,"style."+e,t))).each(Gg(this._id,e)):this.styleTween(e,Hg(e,s,t),n).on("end.style."+e,null)}function Wg(e,t,n){return function(s){this.style.setProperty(e,t.call(this,s),n)}}function Xg(e,t,n){var s,r;function i(){var o=t.apply(this,arguments);return o!==r&&(s=(r=o)&&Wg(e,o,n)),s}return i._value=t,i}function Ug(e,t,n){var s="style."+(e+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;return this.tween(s,Xg(e,t,n??""))}function Zg(e){return function(){this.textContent=e}}function Kg(e){return function(){var t=e(this);this.textContent=t??""}}function Qg(e){return this.tween("text",typeof e=="function"?Kg(xo(this,"text",e)):Zg(e==null?"":e+""))}function Jg(e){return function(t){this.textContent=e.call(this,t)}}function ex(e){var t,n;function s(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Jg(r)),t}return s._value=e,s}function tx(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,ex(e))}function nx(){for(var e=this._name,t=this._id,n=Kl(),s=this._groups,r=s.length,i=0;i<r;++i)for(var o=s[i],a=o.length,c,u=0;u<a;++u)if(c=o[u]){var d=Ve(c,t);dr(c,e,n,u,o,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Je(s,this._parents,e,n)}function rx(){var e,t,n=this,s=n._id,r=n.size();return new Promise(function(i,o){var a={value:o},c={value:function(){--r===0&&i()}};n.each(function(){var u=Xe(this,s),d=u.on;d!==e&&(t=(e=d).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),u.on=t}),r===0&&i()})}var sx=0;function Je(e,t,n,s){this._groups=e,this._parents=t,this._name=n,this._id=s}function Kl(){return++sx}var Ze=cn.prototype;Je.prototype={constructor:Je,select:$g,selectAll:Og,selectChild:Ze.selectChild,selectChildren:Ze.selectChildren,filter:Mg,merge:Tg,selection:Vg,transition:nx,call:Ze.call,nodes:Ze.nodes,node:Ze.node,size:Ze.size,empty:Ze.empty,each:Ze.each,on:zg,attr:pg,attrTween:bg,style:Yg,styleTween:Ug,text:Qg,textTween:tx,remove:Lg,tween:lg,delay:jg,duration:Ig,ease:Cg,easeVarying:Ag,end:rx,[Symbol.iterator]:Ze[Symbol.iterator]};function ox(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var ix={time:null,delay:0,duration:250,ease:ox};function ax(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function lx(e){var t,n;e instanceof Je?(t=e._id,e=e._name):(t=Kl(),(n=ix).time=po(),e=e==null?null:e+"");for(var s=this._groups,r=s.length,i=0;i<r;++i)for(var o=s[i],a=o.length,c,u=0;u<a;++u)(c=o[u])&&dr(c,e,t,u,o,n||ax(c,t));return new Je(s,this._parents,e,t)}cn.prototype.interrupt=og;cn.prototype.transition=lx;const En=e=>()=>e;function cx(e,{sourceEvent:t,target:n,transform:s,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:r}})}function Qe(e,t,n){this.k=e,this.x=t,this.y=n}Qe.prototype={constructor:Qe,scale:function(e){return e===1?this:new Qe(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Qe(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var fr=new Qe(1,0,0);Ql.prototype=Qe.prototype;function Ql(e){for(;!e.__zoom;)if(!(e=e.parentNode))return fr;return e.__zoom}function Cs(e){e.stopImmediatePropagation()}function Ht(e){e.preventDefault(),e.stopImmediatePropagation()}function ux(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function dx(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function na(){return this.__zoom||fr}function fx(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function hx(){return navigator.maxTouchPoints||"ontouchstart"in this}function mx(e,t,n){var s=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(r>s?(s+r)/2:Math.min(0,s)||Math.max(0,r),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function Jl(){var e=ux,t=dx,n=mx,s=fx,r=hx,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,c=Dn,u=lr("start","zoom","end"),d,f,h,m=500,p=150,b=0,x=10;function y(j){j.property("__zoom",na).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",E).on("dblclick.zoom",A).filter(r).on("touchstart.zoom",I).on("touchmove.zoom",C).on("touchend.zoom touchcancel.zoom",O).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(j,P,T,B){var R=j.selection?j.selection():j;R.property("__zoom",na),j!==R?S(j,P,T,B):R.interrupt().each(function(){_(this,arguments).event(B).start().zoom(null,typeof P=="function"?P.apply(this,arguments):P).end()})},y.scaleBy=function(j,P,T,B){y.scaleTo(j,function(){var R=this.__zoom.k,D=typeof P=="function"?P.apply(this,arguments):P;return R*D},T,B)},y.scaleTo=function(j,P,T,B){y.transform(j,function(){var R=t.apply(this,arguments),D=this.__zoom,F=T==null?w(R):typeof T=="function"?T.apply(this,arguments):T,Y=D.invert(F),G=typeof P=="function"?P.apply(this,arguments):P;return n(g(v(D,G),F,Y),R,o)},T,B)},y.translateBy=function(j,P,T,B){y.transform(j,function(){return n(this.__zoom.translate(typeof P=="function"?P.apply(this,arguments):P,typeof T=="function"?T.apply(this,arguments):T),t.apply(this,arguments),o)},null,B)},y.translateTo=function(j,P,T,B,R){y.transform(j,function(){var D=t.apply(this,arguments),F=this.__zoom,Y=B==null?w(D):typeof B=="function"?B.apply(this,arguments):B;return n(fr.translate(Y[0],Y[1]).scale(F.k).translate(typeof P=="function"?-P.apply(this,arguments):-P,typeof T=="function"?-T.apply(this,arguments):-T),D,o)},B,R)};function v(j,P){return P=Math.max(i[0],Math.min(i[1],P)),P===j.k?j:new Qe(P,j.x,j.y)}function g(j,P,T){var B=P[0]-T[0]*j.k,R=P[1]-T[1]*j.k;return B===j.x&&R===j.y?j:new Qe(j.k,B,R)}function w(j){return[(+j[0][0]+ +j[1][0])/2,(+j[0][1]+ +j[1][1])/2]}function S(j,P,T,B){j.on("start.zoom",function(){_(this,arguments).event(B).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).event(B).end()}).tween("zoom",function(){var R=this,D=arguments,F=_(R,D).event(B),Y=t.apply(R,D),G=T==null?w(Y):typeof T=="function"?T.apply(R,D):T,M=Math.max(Y[1][0]-Y[0][0],Y[1][1]-Y[0][1]),z=R.__zoom,V=typeof P=="function"?P.apply(R,D):P,H=c(z.invert(G).concat(M/z.k),V.invert(G).concat(M/V.k));return function(W){if(W===1)W=V;else{var q=H(W),X=M/q[2];W=new Qe(X,G[0]-q[0]*X,G[1]-q[1]*X)}F.zoom(null,W)}})}function _(j,P,T){return!T&&j.__zooming||new k(j,P)}function k(j,P){this.that=j,this.args=P,this.active=0,this.sourceEvent=null,this.extent=t.apply(j,P),this.taps=0}k.prototype={event:function(j){return j&&(this.sourceEvent=j),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(j,P){return this.mouse&&j!=="mouse"&&(this.mouse[1]=P.invert(this.mouse[0])),this.touch0&&j!=="touch"&&(this.touch0[1]=P.invert(this.touch0[0])),this.touch1&&j!=="touch"&&(this.touch1[1]=P.invert(this.touch1[0])),this.that.__zoom=P,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(j){var P=Se(this.that).datum();u.call(j,this.that,new cx(j,{sourceEvent:this.sourceEvent,target:y,transform:this.that.__zoom,dispatch:u}),P)}};function N(j,...P){if(!e.apply(this,arguments))return;var T=_(this,P).event(j),B=this.__zoom,R=Math.max(i[0],Math.min(i[1],B.k*Math.pow(2,s.apply(this,arguments)))),D=Pe(j);if(T.wheel)(T.mouse[0][0]!==D[0]||T.mouse[0][1]!==D[1])&&(T.mouse[1]=B.invert(T.mouse[0]=D)),clearTimeout(T.wheel);else{if(B.k===R)return;T.mouse=[D,B.invert(D)],Ln(this),T.start()}Ht(j),T.wheel=setTimeout(F,p),T.zoom("mouse",n(g(v(B,R),T.mouse[0],T.mouse[1]),T.extent,o));function F(){T.wheel=null,T.end()}}function E(j,...P){if(h||!e.apply(this,arguments))return;var T=j.currentTarget,B=_(this,P,!0).event(j),R=Se(j.view).on("mousemove.zoom",G,!0).on("mouseup.zoom",M,!0),D=Pe(j,T),F=j.clientX,Y=j.clientY;Rl(j.view),Cs(j),B.mouse=[D,this.__zoom.invert(D)],Ln(this),B.start();function G(z){if(Ht(z),!B.moved){var V=z.clientX-F,H=z.clientY-Y;B.moved=V*V+H*H>b}B.event(z).zoom("mouse",n(g(B.that.__zoom,B.mouse[0]=Pe(z,T),B.mouse[1]),B.extent,o))}function M(z){R.on("mousemove.zoom mouseup.zoom",null),Ll(z.view,B.moved),Ht(z),B.event(z).end()}}function A(j,...P){if(e.apply(this,arguments)){var T=this.__zoom,B=Pe(j.changedTouches?j.changedTouches[0]:j,this),R=T.invert(B),D=T.k*(j.shiftKey?.5:2),F=n(g(v(T,D),B,R),t.apply(this,P),o);Ht(j),a>0?Se(this).transition().duration(a).call(S,F,B,j):Se(this).call(y.transform,F,B,j)}}function I(j,...P){if(e.apply(this,arguments)){var T=j.touches,B=T.length,R=_(this,P,j.changedTouches.length===B).event(j),D,F,Y,G;for(Cs(j),F=0;F<B;++F)Y=T[F],G=Pe(Y,this),G=[G,this.__zoom.invert(G),Y.identifier],R.touch0?!R.touch1&&R.touch0[2]!==G[2]&&(R.touch1=G,R.taps=0):(R.touch0=G,D=!0,R.taps=1+!!d);d&&(d=clearTimeout(d)),D&&(R.taps<2&&(f=G[0],d=setTimeout(function(){d=null},m)),Ln(this),R.start())}}function C(j,...P){if(this.__zooming){var T=_(this,P).event(j),B=j.changedTouches,R=B.length,D,F,Y,G;for(Ht(j),D=0;D<R;++D)F=B[D],Y=Pe(F,this),T.touch0&&T.touch0[2]===F.identifier?T.touch0[0]=Y:T.touch1&&T.touch1[2]===F.identifier&&(T.touch1[0]=Y);if(F=T.that.__zoom,T.touch1){var M=T.touch0[0],z=T.touch0[1],V=T.touch1[0],H=T.touch1[1],W=(W=V[0]-M[0])*W+(W=V[1]-M[1])*W,q=(q=H[0]-z[0])*q+(q=H[1]-z[1])*q;F=v(F,Math.sqrt(W/q)),Y=[(M[0]+V[0])/2,(M[1]+V[1])/2],G=[(z[0]+H[0])/2,(z[1]+H[1])/2]}else if(T.touch0)Y=T.touch0[0],G=T.touch0[1];else return;T.zoom("touch",n(g(F,Y,G),T.extent,o))}}function O(j,...P){if(this.__zooming){var T=_(this,P).event(j),B=j.changedTouches,R=B.length,D,F;for(Cs(j),h&&clearTimeout(h),h=setTimeout(function(){h=null},m),D=0;D<R;++D)F=B[D],T.touch0&&T.touch0[2]===F.identifier?delete T.touch0:T.touch1&&T.touch1[2]===F.identifier&&delete T.touch1;if(T.touch1&&!T.touch0&&(T.touch0=T.touch1,delete T.touch1),T.touch0)T.touch0[1]=this.__zoom.invert(T.touch0[0]);else if(T.end(),T.taps===2&&(F=Pe(F,this),Math.hypot(f[0]-F[0],f[1]-F[1])<x)){var Y=Se(this).on("dblclick.zoom");Y&&Y.apply(this,arguments)}}}return y.wheelDelta=function(j){return arguments.length?(s=typeof j=="function"?j:En(+j),y):s},y.filter=function(j){return arguments.length?(e=typeof j=="function"?j:En(!!j),y):e},y.touchable=function(j){return arguments.length?(r=typeof j=="function"?j:En(!!j),y):r},y.extent=function(j){return arguments.length?(t=typeof j=="function"?j:En([[+j[0][0],+j[0][1]],[+j[1][0],+j[1][1]]]),y):t},y.scaleExtent=function(j){return arguments.length?(i[0]=+j[0],i[1]=+j[1],y):[i[0],i[1]]},y.translateExtent=function(j){return arguments.length?(o[0][0]=+j[0][0],o[1][0]=+j[1][0],o[0][1]=+j[0][1],o[1][1]=+j[1][1],y):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},y.constrain=function(j){return arguments.length?(n=j,y):n},y.duration=function(j){return arguments.length?(a=+j,y):a},y.interpolate=function(j){return arguments.length?(c=j,y):c},y.on=function(){var j=u.on.apply(u,arguments);return j===u?y:j},y.clickDistance=function(j){return arguments.length?(b=(j=+j)*j,y):Math.sqrt(b)},y.tapDistance=function(j){return arguments.length?(x=+j,y):x},y}const Ye={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:s})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:s}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},en=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],ec=["Enter"," ","Escape"],tc={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Mt;(function(e){e.Strict="strict",e.Loose="loose"})(Mt||(Mt={}));var gt;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(gt||(gt={}));var tn;(function(e){e.Partial="partial",e.Full="full"})(tn||(tn={}));const nc={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Ke;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Ke||(Ke={}));var Qn;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Qn||(Qn={}));var U;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(U||(U={}));const ra={[U.Left]:U.Right,[U.Right]:U.Left,[U.Top]:U.Bottom,[U.Bottom]:U.Top};function rc(e){return e===null?null:e?"valid":"invalid"}const sc=e=>"id"in e&&"source"in e&&"target"in e,px=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),yo=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),dn=(e,t=[0,0])=>{const{width:n,height:s}=tt(e),r=e.origin??t,i=n*r[0],o=s*r[1];return{x:e.position.x-i,y:e.position.y-o}},oc=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((s,r)=>{const i=typeof r=="string";let o=!t.nodeLookup&&!i?r:void 0;t.nodeLookup&&(o=i?t.nodeLookup.get(r):yo(r)?r:t.nodeLookup.get(r.id));const a=o?Jn(o,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return hr(s,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return mr(n)},fn=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},s=!1;return e.forEach(r=>{(t.filter===void 0||t.filter(r))&&(n=hr(n,Jn(r)),s=!0)}),s?mr(n):{x:0,y:0,width:0,height:0}},wo=(e,t,[n,s,r]=[0,0,1],i=!1,o=!1)=>{const a={...mn(t,[n,s,r]),width:t.width/r,height:t.height/r},c=[];for(const u of e.values()){const{measured:d,selectable:f=!0,hidden:h=!1}=u;if(o&&!f||h)continue;const m=d.width??u.width??u.initialWidth??null,p=d.height??u.height??u.initialHeight??null,b=nn(a,Pt(u)),x=(m??0)*(p??0),y=i&&b>0;(!u.internals.handleBounds||y||b>=x||u.dragging)&&c.push(u)}return c},gx=(e,t)=>{const n=new Set;return e.forEach(s=>{n.add(s.id)}),t.filter(s=>n.has(s.source)||n.has(s.target))};function xx(e,t){const n=new Map,s=t!=null&&t.nodes?new Set(t.nodes.map(r=>r.id)):null;return e.forEach(r=>{r.measured.width&&r.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!r.hidden)&&(!s||s.has(r.id))&&n.set(r.id,r)}),n}async function yx({nodes:e,width:t,height:n,panZoom:s,minZoom:r,maxZoom:i},o){if(e.size===0)return Promise.resolve(!0);const a=xx(e,o),c=fn(a),u=pr(c,t,n,(o==null?void 0:o.minZoom)??r,(o==null?void 0:o.maxZoom)??i,(o==null?void 0:o.padding)??.1);return await s.setViewport(u,{duration:o==null?void 0:o.duration,ease:o==null?void 0:o.ease,interpolate:o==null?void 0:o.interpolate}),Promise.resolve(!0)}function ic({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:s=[0,0],nodeExtent:r,onError:i}){const o=n.get(e),a=o.parentId?n.get(o.parentId):void 0,{x:c,y:u}=a?a.internals.positionAbsolute:{x:0,y:0},d=o.origin??s;let f=o.extent||r;if(o.extent==="parent"&&!o.expandParent)if(!a)i==null||i("005",Ye.error005());else{const m=a.measured.width,p=a.measured.height;m&&p&&(f=[[c,u],[c+m,u+p]])}else a&&Dt(o.extent)&&(f=[[o.extent[0][0]+c,o.extent[0][1]+u],[o.extent[1][0]+c,o.extent[1][1]+u]]);const h=Dt(f)?wt(t,f,o.measured):t;return(o.measured.width===void 0||o.measured.height===void 0)&&(i==null||i("015",Ye.error015())),{position:{x:h.x-c+(o.measured.width??0)*d[0],y:h.y-u+(o.measured.height??0)*d[1]},positionAbsolute:h}}async function wx({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:s,onBeforeDelete:r}){const i=new Set(e.map(h=>h.id)),o=[];for(const h of n){if(h.deletable===!1)continue;const m=i.has(h.id),p=!m&&h.parentId&&o.find(b=>b.id===h.parentId);(m||p)&&o.push(h)}const a=new Set(t.map(h=>h.id)),c=s.filter(h=>h.deletable!==!1),d=gx(o,c);for(const h of c)a.has(h.id)&&!d.find(p=>p.id===h.id)&&d.push(h);if(!r)return{edges:d,nodes:o};const f=await r({nodes:o,edges:d});return typeof f=="boolean"?f?{edges:d,nodes:o}:{edges:[],nodes:[]}:f}const Tt=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),wt=(e={x:0,y:0},t,n)=>({x:Tt(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:Tt(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function ac(e,t,n){const{width:s,height:r}=tt(n),{x:i,y:o}=n.internals.positionAbsolute;return wt(e,[[i,o],[i+s,o+r]],t)}const sa=(e,t,n)=>e<t?Tt(Math.abs(e-t),1,t)/t:e>n?-Tt(Math.abs(e-n),1,t)/t:0,lc=(e,t,n=15,s=40)=>{const r=sa(e.x,s,t.width-s)*n,i=sa(e.y,s,t.height-s)*n;return[r,i]},hr=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Gs=({x:e,y:t,width:n,height:s})=>({x:e,y:t,x2:e+n,y2:t+s}),mr=({x:e,y:t,x2:n,y2:s})=>({x:e,y:t,width:n-e,height:s-t}),Pt=(e,t=[0,0])=>{var r,i;const{x:n,y:s}=yo(e)?e.internals.positionAbsolute:dn(e,t);return{x:n,y:s,width:((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0,height:((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0}},Jn=(e,t=[0,0])=>{var r,i;const{x:n,y:s}=yo(e)?e.internals.positionAbsolute:dn(e,t);return{x:n,y:s,x2:n+(((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0),y2:s+(((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0)}},cc=(e,t)=>mr(hr(Gs(e),Gs(t))),nn=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),s=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*s)},oa=e=>ze(e.width)&&ze(e.height)&&ze(e.x)&&ze(e.y),ze=e=>!isNaN(e)&&isFinite(e),bx=(e,t)=>{},hn=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),mn=({x:e,y:t},[n,s,r],i=!1,o=[1,1])=>{const a={x:(e-n)/r,y:(t-s)/r};return i?hn(a,o):a},er=({x:e,y:t},[n,s,r])=>({x:e*r+n,y:t*r+s});function Nt(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function vx(e,t,n){if(typeof e=="string"||typeof e=="number"){const s=Nt(e,n),r=Nt(e,t);return{top:s,right:r,bottom:s,left:r,x:r*2,y:s*2}}if(typeof e=="object"){const s=Nt(e.top??e.y??0,n),r=Nt(e.bottom??e.y??0,n),i=Nt(e.left??e.x??0,t),o=Nt(e.right??e.x??0,t);return{top:s,right:o,bottom:r,left:i,x:i+o,y:s+r}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Nx(e,t,n,s,r,i){const{x:o,y:a}=er(e,[t,n,s]),{x:c,y:u}=er({x:e.x+e.width,y:e.y+e.height},[t,n,s]),d=r-c,f=i-u;return{left:Math.floor(o),top:Math.floor(a),right:Math.floor(d),bottom:Math.floor(f)}}const pr=(e,t,n,s,r,i)=>{const o=vx(i,t,n),a=(t-o.x)/e.width,c=(n-o.y)/e.height,u=Math.min(a,c),d=Tt(u,s,r),f=e.x+e.width/2,h=e.y+e.height/2,m=t/2-f*d,p=n/2-h*d,b=Nx(e,m,p,d,t,n),x={left:Math.min(b.left-o.left,0),top:Math.min(b.top-o.top,0),right:Math.min(b.right-o.right,0),bottom:Math.min(b.bottom-o.bottom,0)};return{x:m-x.left+x.right,y:p-x.top+x.bottom,zoom:d}},rn=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function Dt(e){return e!=null&&e!=="parent"}function tt(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function uc(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function dc(e,t={width:0,height:0},n,s,r){const i={...e},o=s.get(n);if(o){const a=o.origin||r;i.x+=o.internals.positionAbsolute.x-(t.width??0)*a[0],i.y+=o.internals.positionAbsolute.y-(t.height??0)*a[1]}return i}function ia(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function jx(){let e,t;return{promise:new Promise((s,r)=>{e=s,t=r}),resolve:e,reject:t}}function Ex(e){return{...tc,...e||{}}}function Wt(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:s,containerBounds:r}){const{x:i,y:o}=Re(e),a=mn({x:i-((r==null?void 0:r.left)??0),y:o-((r==null?void 0:r.top)??0)},s),{x:c,y:u}=n?hn(a,t):a;return{xSnapped:c,ySnapped:u,...a}}const bo=e=>({width:e.offsetWidth,height:e.offsetHeight}),fc=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},_x=["INPUT","SELECT","TEXTAREA"];function hc(e){var s,r;const t=((r=(s=e.composedPath)==null?void 0:s.call(e))==null?void 0:r[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:_x.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const mc=e=>"clientX"in e,Re=(e,t)=>{var i,o;const n=mc(e),s=n?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,r=n?e.clientY:(o=e.touches)==null?void 0:o[0].clientY;return{x:s-((t==null?void 0:t.left)??0),y:r-((t==null?void 0:t.top)??0)}},aa=(e,t,n,s,r)=>{const i=t.querySelectorAll(`.${e}`);return!i||!i.length?null:Array.from(i).map(o=>{const a=o.getBoundingClientRect();return{id:o.getAttribute("data-handleid"),type:e,nodeId:r,position:o.getAttribute("data-handlepos"),x:(a.left-n.left)/s,y:(a.top-n.top)/s,...bo(o)}})};function pc({sourceX:e,sourceY:t,targetX:n,targetY:s,sourceControlX:r,sourceControlY:i,targetControlX:o,targetControlY:a}){const c=e*.125+r*.375+o*.375+n*.125,u=t*.125+i*.375+a*.375+s*.125,d=Math.abs(c-e),f=Math.abs(u-t);return[c,u,d,f]}function _n(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function la({pos:e,x1:t,y1:n,x2:s,y2:r,c:i}){switch(e){case U.Left:return[t-_n(t-s,i),n];case U.Right:return[t+_n(s-t,i),n];case U.Top:return[t,n-_n(n-r,i)];case U.Bottom:return[t,n+_n(r-n,i)]}}function gc({sourceX:e,sourceY:t,sourcePosition:n=U.Bottom,targetX:s,targetY:r,targetPosition:i=U.Top,curvature:o=.25}){const[a,c]=la({pos:n,x1:e,y1:t,x2:s,y2:r,c:o}),[u,d]=la({pos:i,x1:s,y1:r,x2:e,y2:t,c:o}),[f,h,m,p]=pc({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:a,sourceControlY:c,targetControlX:u,targetControlY:d});return[`M${e},${t} C${a},${c} ${u},${d} ${s},${r}`,f,h,m,p]}function xc({sourceX:e,sourceY:t,targetX:n,targetY:s}){const r=Math.abs(n-e)/2,i=n<e?n+r:n-r,o=Math.abs(s-t)/2,a=s<t?s+o:s-o;return[i,a,r,o]}function Ix({sourceNode:e,targetNode:t,selected:n=!1,zIndex:s=0,elevateOnSelect:r=!1,zIndexMode:i="basic"}){if(i==="manual")return s;const o=r&&n?s+1e3:s,a=Math.max(e.parentId||r&&e.selected?e.internals.z:0,t.parentId||r&&t.selected?t.internals.z:0);return o+a}function Sx({sourceNode:e,targetNode:t,width:n,height:s,transform:r}){const i=hr(Jn(e),Jn(t));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const o={x:-r[0]/r[2],y:-r[1]/r[2],width:n/r[2],height:s/r[2]};return nn(o,mr(i))>0}const Cx=({source:e,sourceHandle:t,target:n,targetHandle:s})=>`xy-edge__${e}${t||""}-${n}${s||""}`,kx=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),Ax=(e,t,n={})=>{if(!e.source||!e.target)return t;const s=n.getEdgeId||Cx;let r;return sc(e)?r={...e}:r={...e,id:s(e)},kx(r,t)?t:(r.sourceHandle===null&&delete r.sourceHandle,r.targetHandle===null&&delete r.targetHandle,t.concat(r))};function yc({sourceX:e,sourceY:t,targetX:n,targetY:s}){const[r,i,o,a]=xc({sourceX:e,sourceY:t,targetX:n,targetY:s});return[`M ${e},${t}L ${n},${s}`,r,i,o,a]}const ca={[U.Left]:{x:-1,y:0},[U.Right]:{x:1,y:0},[U.Top]:{x:0,y:-1},[U.Bottom]:{x:0,y:1}},Mx=({source:e,sourcePosition:t=U.Bottom,target:n})=>t===U.Left||t===U.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},ua=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Tx({source:e,sourcePosition:t=U.Bottom,target:n,targetPosition:s=U.Top,center:r,offset:i,stepPosition:o}){const a=ca[t],c=ca[s],u={x:e.x+a.x*i,y:e.y+a.y*i},d={x:n.x+c.x*i,y:n.y+c.y*i},f=Mx({source:u,sourcePosition:t,target:d}),h=f.x!==0?"x":"y",m=f[h];let p=[],b,x;const y={x:0,y:0},v={x:0,y:0},[,,g,w]=xc({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[h]*c[h]===-1){h==="x"?(b=r.x??u.x+(d.x-u.x)*o,x=r.y??(u.y+d.y)/2):(b=r.x??(u.x+d.x)/2,x=r.y??u.y+(d.y-u.y)*o);const _=[{x:b,y:u.y},{x:b,y:d.y}],k=[{x:u.x,y:x},{x:d.x,y:x}];a[h]===m?p=h==="x"?_:k:p=h==="x"?k:_}else{const _=[{x:u.x,y:d.y}],k=[{x:d.x,y:u.y}];if(h==="x"?p=a.x===m?k:_:p=a.y===m?_:k,t===s){const C=Math.abs(e[h]-n[h]);if(C<=i){const O=Math.min(i-1,i-C);a[h]===m?y[h]=(u[h]>e[h]?-1:1)*O:v[h]=(d[h]>n[h]?-1:1)*O}}if(t!==s){const C=h==="x"?"y":"x",O=a[h]===c[C],j=u[C]>d[C],P=u[C]<d[C];(a[h]===1&&(!O&&j||O&&P)||a[h]!==1&&(!O&&P||O&&j))&&(p=h==="x"?_:k)}const N={x:u.x+y.x,y:u.y+y.y},E={x:d.x+v.x,y:d.y+v.y},A=Math.max(Math.abs(N.x-p[0].x),Math.abs(E.x-p[0].x)),I=Math.max(Math.abs(N.y-p[0].y),Math.abs(E.y-p[0].y));A>=I?(b=(N.x+E.x)/2,x=p[0].y):(b=p[0].x,x=(N.y+E.y)/2)}return[[e,{x:u.x+y.x,y:u.y+y.y},...p,{x:d.x+v.x,y:d.y+v.y},n],b,x,g,w]}function Px(e,t,n,s){const r=Math.min(ua(e,t)/2,ua(t,n)/2,s),{x:i,y:o}=t;if(e.x===i&&i===n.x||e.y===o&&o===n.y)return`L${i} ${o}`;if(e.y===o){const u=e.x<n.x?-1:1,d=e.y<n.y?1:-1;return`L ${i+r*u},${o}Q ${i},${o} ${i},${o+r*d}`}const a=e.x<n.x?1:-1,c=e.y<n.y?-1:1;return`L ${i},${o+r*c}Q ${i},${o} ${i+r*a},${o}`}function Ys({sourceX:e,sourceY:t,sourcePosition:n=U.Bottom,targetX:s,targetY:r,targetPosition:i=U.Top,borderRadius:o=5,centerX:a,centerY:c,offset:u=20,stepPosition:d=.5}){const[f,h,m,p,b]=Tx({source:{x:e,y:t},sourcePosition:n,target:{x:s,y:r},targetPosition:i,center:{x:a,y:c},offset:u,stepPosition:d});return[f.reduce((y,v,g)=>{let w="";return g>0&&g<f.length-1?w=Px(f[g-1],v,f[g+1],o):w=`${g===0?"M":"L"}${v.x} ${v.y}`,y+=w,y},""),h,m,p,b]}function da(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function Dx(e){var f;const{sourceNode:t,targetNode:n}=e;if(!da(t)||!da(n))return null;const s=t.internals.handleBounds||fa(t.handles),r=n.internals.handleBounds||fa(n.handles),i=ha((s==null?void 0:s.source)??[],e.sourceHandle),o=ha(e.connectionMode===Mt.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),e.targetHandle);if(!i||!o)return(f=e.onError)==null||f.call(e,"008",Ye.error008(i?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=(i==null?void 0:i.position)||U.Bottom,c=(o==null?void 0:o.position)||U.Top,u=bt(t,i,a),d=bt(n,o,c);return{sourceX:u.x,sourceY:u.y,targetX:d.x,targetY:d.y,sourcePosition:a,targetPosition:c}}function fa(e){if(!e)return null;const t=[],n=[];for(const s of e)s.width=s.width??1,s.height=s.height??1,s.type==="source"?t.push(s):s.type==="target"&&n.push(s);return{source:t,target:n}}function bt(e,t,n=U.Left,s=!1){const r=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,i=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:o,height:a}=t??tt(e);if(s)return{x:r+o/2,y:i+a/2};switch((t==null?void 0:t.position)??n){case U.Top:return{x:r+o/2,y:i};case U.Right:return{x:r+o,y:i+a/2};case U.Bottom:return{x:r+o/2,y:i+a};case U.Left:return{x:r,y:i+a/2}}}function ha(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function Ws(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(s=>`${s}=${e[s]}`).join("&")}`:""}function zx(e,{id:t,defaultColor:n,defaultMarkerStart:s,defaultMarkerEnd:r}){const i=new Set;return e.reduce((o,a)=>([a.markerStart||s,a.markerEnd||r].forEach(c=>{if(c&&typeof c=="object"){const u=Ws(c,t);i.has(u)||(o.push({id:u,color:c.color||n,...c}),i.add(u))}}),o),[]).sort((o,a)=>o.id.localeCompare(a.id))}const wc=1e3,Rx=10,vo={nodeOrigin:[0,0],nodeExtent:en,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},Lx={...vo,checkEquality:!0};function No(e,t){const n={...e};for(const s in t)t[s]!==void 0&&(n[s]=t[s]);return n}function $x(e,t,n){const s=No(vo,n);for(const r of e.values())if(r.parentId)Eo(r,e,t,s);else{const i=dn(r,s.nodeOrigin),o=Dt(r.extent)?r.extent:s.nodeExtent,a=wt(i,o,tt(r));r.internals.positionAbsolute=a}}function Ox(e,t){if(!e.handles)return e.measured?t==null?void 0:t.internals.handleBounds:void 0;const n=[],s=[];for(const r of e.handles){const i={id:r.id,width:r.width??1,height:r.height??1,nodeId:e.id,x:r.x,y:r.y,position:r.position,type:r.type};r.type==="source"?n.push(i):r.type==="target"&&s.push(i)}return{source:n,target:s}}function jo(e){return e==="manual"}function Xs(e,t,n,s={}){var u,d;const r=No(Lx,s),i={i:0},o=new Map(t),a=r!=null&&r.elevateNodesOnSelect&&!jo(r.zIndexMode)?wc:0;let c=e.length>0;t.clear(),n.clear();for(const f of e){let h=o.get(f.id);if(r.checkEquality&&f===(h==null?void 0:h.internals.userNode))t.set(f.id,h);else{const m=dn(f,r.nodeOrigin),p=Dt(f.extent)?f.extent:r.nodeExtent,b=wt(m,p,tt(f));h={...r.defaults,...f,measured:{width:(u=f.measured)==null?void 0:u.width,height:(d=f.measured)==null?void 0:d.height},internals:{positionAbsolute:b,handleBounds:Ox(f,h),z:bc(f,a,r.zIndexMode),userNode:f}},t.set(f.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(c=!1),f.parentId&&Eo(h,t,n,s,i)}return c}function Bx(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Eo(e,t,n,s,r){const{elevateNodesOnSelect:i,nodeOrigin:o,nodeExtent:a,zIndexMode:c}=No(vo,s),u=e.parentId,d=t.get(u);if(!d){console.warn(`Parent node ${u} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Bx(e,n),r&&!d.parentId&&d.internals.rootParentIndex===void 0&&c==="auto"&&(d.internals.rootParentIndex=++r.i,d.internals.z=d.internals.z+r.i*Rx),r&&d.internals.rootParentIndex!==void 0&&(r.i=d.internals.rootParentIndex);const f=i&&!jo(c)?wc:0,{x:h,y:m,z:p}=Vx(e,d,o,a,f,c),{positionAbsolute:b}=e.internals,x=h!==b.x||m!==b.y;(x||p!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:x?{x:h,y:m}:b,z:p}})}function bc(e,t,n){const s=ze(e.zIndex)?e.zIndex:0;return jo(n)?s:s+(e.selected?t:0)}function Vx(e,t,n,s,r,i){const{x:o,y:a}=t.internals.positionAbsolute,c=tt(e),u=dn(e,n),d=Dt(e.extent)?wt(u,e.extent,c):u;let f=wt({x:o+d.x,y:a+d.y},s,c);e.extent==="parent"&&(f=ac(f,c,t));const h=bc(e,r,i),m=t.internals.z??0;return{x:f.x,y:f.y,z:m>=h?m+1:h}}function _o(e,t,n,s=[0,0]){var o;const r=[],i=new Map;for(const a of e){const c=t.get(a.parentId);if(!c)continue;const u=((o=i.get(a.parentId))==null?void 0:o.expandedRect)??Pt(c),d=cc(u,a.rect);i.set(a.parentId,{expandedRect:d,parent:c})}return i.size>0&&i.forEach(({expandedRect:a,parent:c},u)=>{var g;const d=c.internals.positionAbsolute,f=tt(c),h=c.origin??s,m=a.x<d.x?Math.round(Math.abs(d.x-a.x)):0,p=a.y<d.y?Math.round(Math.abs(d.y-a.y)):0,b=Math.max(f.width,Math.round(a.width)),x=Math.max(f.height,Math.round(a.height)),y=(b-f.width)*h[0],v=(x-f.height)*h[1];(m>0||p>0||y||v)&&(r.push({id:u,type:"position",position:{x:c.position.x-m+y,y:c.position.y-p+v}}),(g=n.get(u))==null||g.forEach(w=>{e.some(S=>S.id===w.id)||r.push({id:w.id,type:"position",position:{x:w.position.x+m,y:w.position.y+p}})})),(f.width<a.width||f.height<a.height||m||p)&&r.push({id:u,type:"dimensions",setAttributes:!0,dimensions:{width:b+(m?h[0]*m-y:0),height:x+(p?h[1]*p-v:0)}})}),r}function Fx(e,t,n,s,r,i,o){const a=s==null?void 0:s.querySelector(".xyflow__viewport");let c=!1;if(!a)return{changes:[],updatedInternals:c};const u=[],d=window.getComputedStyle(a),{m22:f}=new window.DOMMatrixReadOnly(d.transform),h=[];for(const m of e.values()){const p=t.get(m.id);if(!p)continue;if(p.hidden){t.set(p.id,{...p,internals:{...p.internals,handleBounds:void 0}}),c=!0;continue}const b=bo(m.nodeElement),x=p.measured.width!==b.width||p.measured.height!==b.height;if(!!(b.width&&b.height&&(x||!p.internals.handleBounds||m.force))){const v=m.nodeElement.getBoundingClientRect(),g=Dt(p.extent)?p.extent:i;let{positionAbsolute:w}=p.internals;p.parentId&&p.extent==="parent"?w=ac(w,b,t.get(p.parentId)):g&&(w=wt(w,g,b));const S={...p,measured:b,internals:{...p.internals,positionAbsolute:w,handleBounds:{source:aa("source",m.nodeElement,v,f,p.id),target:aa("target",m.nodeElement,v,f,p.id)}}};t.set(p.id,S),p.parentId&&Eo(S,t,n,{nodeOrigin:r,zIndexMode:o}),c=!0,x&&(u.push({id:p.id,type:"dimensions",dimensions:b}),p.expandParent&&p.parentId&&h.push({id:p.id,parentId:p.parentId,rect:Pt(S,r)}))}}if(h.length>0){const m=_o(h,t,n,r);u.push(...m)}return{changes:u,updatedInternals:c}}async function Hx({delta:e,panZoom:t,transform:n,translateExtent:s,width:r,height:i}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const o=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[r,i]],s),a=!!o&&(o.x!==n[0]||o.y!==n[1]||o.k!==n[2]);return Promise.resolve(a)}function ma(e,t,n,s,r,i){let o=r;const a=s.get(o)||new Map;s.set(o,a.set(n,t)),o=`${r}-${e}`;const c=s.get(o)||new Map;if(s.set(o,c.set(n,t)),i){o=`${r}-${e}-${i}`;const u=s.get(o)||new Map;s.set(o,u.set(n,t))}}function vc(e,t,n){e.clear(),t.clear();for(const s of n){const{source:r,target:i,sourceHandle:o=null,targetHandle:a=null}=s,c={edgeId:s.id,source:r,target:i,sourceHandle:o,targetHandle:a},u=`${r}-${o}--${i}-${a}`,d=`${i}-${a}--${r}-${o}`;ma("source",c,d,e,r,o),ma("target",c,u,e,i,a),t.set(s.id,s)}}function Nc(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:Nc(n,t):!1}function pa(e,t,n){var r;let s=e;do{if((r=s==null?void 0:s.matches)!=null&&r.call(s,t))return!0;if(s===n)return!1;s=s==null?void 0:s.parentElement}while(s);return!1}function qx(e,t,n,s){const r=new Map;for(const[i,o]of e)if((o.selected||o.id===s)&&(!o.parentId||!Nc(o,e))&&(o.draggable||t&&typeof o.draggable>"u")){const a=e.get(i);a&&r.set(i,{id:i,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return r}function ks({nodeId:e,dragItems:t,nodeLookup:n,dragging:s=!0}){var o,a,c;const r=[];for(const[u,d]of t){const f=(o=n.get(u))==null?void 0:o.internals.userNode;f&&r.push({...f,position:d.position,dragging:s})}if(!e)return[r[0],r];const i=(a=n.get(e))==null?void 0:a.internals.userNode;return[i?{...i,position:((c=t.get(e))==null?void 0:c.position)||i.position,dragging:s}:r[0],r]}function Gx({dragItems:e,snapGrid:t,x:n,y:s}){const r=e.values().next().value;if(!r)return null;const i={x:n-r.distance.x,y:s-r.distance.y},o=hn(i,t);return{x:o.x-i.x,y:o.y-i.y}}function Yx({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:s,onDragStop:r}){let i={x:null,y:null},o=0,a=new Map,c=!1,u={x:0,y:0},d=null,f=!1,h=null,m=!1,p=!1,b=null;function x({noDragClassName:v,handleSelector:g,domNode:w,isSelectable:S,nodeId:_,nodeClickDistance:k=0}){h=Se(w);function N({x:C,y:O}){const{nodeLookup:j,nodeExtent:P,snapGrid:T,snapToGrid:B,nodeOrigin:R,onNodeDrag:D,onSelectionDrag:F,onError:Y,updateNodePositions:G}=t();i={x:C,y:O};let M=!1;const z=a.size>1,V=z&&P?Gs(fn(a)):null,H=z&&B?Gx({dragItems:a,snapGrid:T,x:C,y:O}):null;for(const[W,q]of a){if(!j.has(W))continue;let X={x:C-q.distance.x,y:O-q.distance.y};B&&(X=H?{x:Math.round(X.x+H.x),y:Math.round(X.y+H.y)}:hn(X,T));let ee=null;if(z&&P&&!q.extent&&V){const{positionAbsolute:Z}=q.internals,ne=Z.x-V.x+P[0][0],oe=Z.x+q.measured.width-V.x2+P[1][0],re=Z.y-V.y+P[0][1],we=Z.y+q.measured.height-V.y2+P[1][1];ee=[[ne,re],[oe,we]]}const{position:te,positionAbsolute:Q}=ic({nodeId:W,nextPosition:X,nodeLookup:j,nodeExtent:ee||P,nodeOrigin:R,onError:Y});M=M||q.position.x!==te.x||q.position.y!==te.y,q.position=te,q.internals.positionAbsolute=Q}if(p=p||M,!!M&&(G(a,!0),b&&(s||D||!_&&F))){const[W,q]=ks({nodeId:_,dragItems:a,nodeLookup:j});s==null||s(b,a,W,q),D==null||D(b,W,q),_||F==null||F(b,q)}}async function E(){if(!d)return;const{transform:C,panBy:O,autoPanSpeed:j,autoPanOnNodeDrag:P}=t();if(!P){c=!1,cancelAnimationFrame(o);return}const[T,B]=lc(u,d,j);(T!==0||B!==0)&&(i.x=(i.x??0)-T/C[2],i.y=(i.y??0)-B/C[2],await O({x:T,y:B})&&N(i)),o=requestAnimationFrame(E)}function A(C){var z;const{nodeLookup:O,multiSelectionActive:j,nodesDraggable:P,transform:T,snapGrid:B,snapToGrid:R,selectNodesOnDrag:D,onNodeDragStart:F,onSelectionDragStart:Y,unselectNodesAndEdges:G}=t();f=!0,(!D||!S)&&!j&&_&&((z=O.get(_))!=null&&z.selected||G()),S&&D&&_&&(e==null||e(_));const M=Wt(C.sourceEvent,{transform:T,snapGrid:B,snapToGrid:R,containerBounds:d});if(i=M,a=qx(O,P,M,_),a.size>0&&(n||F||!_&&Y)){const[V,H]=ks({nodeId:_,dragItems:a,nodeLookup:O});n==null||n(C.sourceEvent,a,V,H),F==null||F(C.sourceEvent,V,H),_||Y==null||Y(C.sourceEvent,H)}}const I=$l().clickDistance(k).on("start",C=>{const{domNode:O,nodeDragThreshold:j,transform:P,snapGrid:T,snapToGrid:B}=t();d=(O==null?void 0:O.getBoundingClientRect())||null,m=!1,p=!1,b=C.sourceEvent,j===0&&A(C),i=Wt(C.sourceEvent,{transform:P,snapGrid:T,snapToGrid:B,containerBounds:d}),u=Re(C.sourceEvent,d)}).on("drag",C=>{const{autoPanOnNodeDrag:O,transform:j,snapGrid:P,snapToGrid:T,nodeDragThreshold:B,nodeLookup:R}=t(),D=Wt(C.sourceEvent,{transform:j,snapGrid:P,snapToGrid:T,containerBounds:d});if(b=C.sourceEvent,(C.sourceEvent.type==="touchmove"&&C.sourceEvent.touches.length>1||_&&!R.has(_))&&(m=!0),!m){if(!c&&O&&f&&(c=!0,E()),!f){const F=Re(C.sourceEvent,d),Y=F.x-u.x,G=F.y-u.y;Math.sqrt(Y*Y+G*G)>B&&A(C)}(i.x!==D.xSnapped||i.y!==D.ySnapped)&&a&&f&&(u=Re(C.sourceEvent,d),N(D))}}).on("end",C=>{if(!(!f||m)&&(c=!1,f=!1,cancelAnimationFrame(o),a.size>0)){const{nodeLookup:O,updateNodePositions:j,onNodeDragStop:P,onSelectionDragStop:T}=t();if(p&&(j(a,!1),p=!1),r||P||!_&&T){const[B,R]=ks({nodeId:_,dragItems:a,nodeLookup:O,dragging:!1});r==null||r(C.sourceEvent,a,B,R),P==null||P(C.sourceEvent,B,R),_||T==null||T(C.sourceEvent,R)}}}).filter(C=>{const O=C.target;return!C.button&&(!v||!pa(O,`.${v}`,w))&&(!g||pa(O,g,w))});h.call(I)}function y(){h==null||h.on(".drag",null)}return{update:x,destroy:y}}function Wx(e,t,n){const s=[],r={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const i of t.values())nn(r,Pt(i))>0&&s.push(i);return s}const Xx=250;function Ux(e,t,n,s){var a,c;let r=[],i=1/0;const o=Wx(e,n,t+Xx);for(const u of o){const d=[...((a=u.internals.handleBounds)==null?void 0:a.source)??[],...((c=u.internals.handleBounds)==null?void 0:c.target)??[]];for(const f of d){if(s.nodeId===f.nodeId&&s.type===f.type&&s.id===f.id)continue;const{x:h,y:m}=bt(u,f,f.position,!0),p=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(m-e.y,2));p>t||(p<i?(r=[{...f,x:h,y:m}],i=p):p===i&&r.push({...f,x:h,y:m}))}}if(!r.length)return null;if(r.length>1){const u=s.type==="source"?"target":"source";return r.find(d=>d.type===u)??r[0]}return r[0]}function jc(e,t,n,s,r,i=!1){var u,d,f;const o=s.get(e);if(!o)return null;const a=r==="strict"?(u=o.internals.handleBounds)==null?void 0:u[t]:[...((d=o.internals.handleBounds)==null?void 0:d.source)??[],...((f=o.internals.handleBounds)==null?void 0:f.target)??[]],c=(n?a==null?void 0:a.find(h=>h.id===n):a==null?void 0:a[0])??null;return c&&i?{...c,...bt(o,c,c.position,!0)}:c}function Ec(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function Zx(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const _c=()=>!0;function Kx(e,{connectionMode:t,connectionRadius:n,handleId:s,nodeId:r,edgeUpdaterType:i,isTarget:o,domNode:a,nodeLookup:c,lib:u,autoPanOnConnect:d,flowId:f,panBy:h,cancelConnection:m,onConnectStart:p,onConnect:b,onConnectEnd:x,isValidConnection:y=_c,onReconnectEnd:v,updateConnection:g,getTransform:w,getFromHandle:S,autoPanSpeed:_,dragThreshold:k=1,handleDomNode:N}){const E=fc(e.target);let A=0,I;const{x:C,y:O}=Re(e),j=Ec(i,N),P=a==null?void 0:a.getBoundingClientRect();let T=!1;if(!P||!j)return;const B=jc(r,j,s,c,t);if(!B)return;let R=Re(e,P),D=!1,F=null,Y=!1,G=null;function M(){if(!d||!P)return;const[te,Q]=lc(R,P,_);h({x:te,y:Q}),A=requestAnimationFrame(M)}const z={...B,nodeId:r,type:j,position:B.position},V=c.get(r);let W={inProgress:!0,isValid:null,from:bt(V,z,U.Left,!0),fromHandle:z,fromPosition:z.position,fromNode:V,to:R,toHandle:null,toPosition:ra[z.position],toNode:null,pointer:R};function q(){T=!0,g(W),p==null||p(e,{nodeId:r,handleId:s,handleType:j})}k===0&&q();function X(te){if(!T){const{x:we,y:nt}=Re(te),Ue=we-C,dt=nt-O;if(!(Ue*Ue+dt*dt>k*k))return;q()}if(!S()||!z){ee(te);return}const Q=w();R=Re(te,P),I=Ux(mn(R,Q,!1,[1,1]),n,c,z),D||(M(),D=!0);const Z=Ic(te,{handle:I,connectionMode:t,fromNodeId:r,fromHandleId:s,fromType:o?"target":"source",isValidConnection:y,doc:E,lib:u,flowId:f,nodeLookup:c});G=Z.handleDomNode,F=Z.connection,Y=Zx(!!I,Z.isValid);const ne=c.get(r),oe=ne?bt(ne,z,U.Left,!0):W.from,re={...W,from:oe,isValid:Y,to:Z.toHandle&&Y?er({x:Z.toHandle.x,y:Z.toHandle.y},Q):R,toHandle:Z.toHandle,toPosition:Y&&Z.toHandle?Z.toHandle.position:ra[z.position],toNode:Z.toHandle?c.get(Z.toHandle.nodeId):null,pointer:R};g(re),W=re}function ee(te){if(!("touches"in te&&te.touches.length>0)){if(T){(I||G)&&F&&Y&&(b==null||b(F));const{inProgress:Q,...Z}=W,ne={...Z,toPosition:W.toHandle?W.toPosition:null};x==null||x(te,ne),i&&(v==null||v(te,ne))}m(),cancelAnimationFrame(A),D=!1,Y=!1,F=null,G=null,E.removeEventListener("mousemove",X),E.removeEventListener("mouseup",ee),E.removeEventListener("touchmove",X),E.removeEventListener("touchend",ee)}}E.addEventListener("mousemove",X),E.addEventListener("mouseup",ee),E.addEventListener("touchmove",X),E.addEventListener("touchend",ee)}function Ic(e,{handle:t,connectionMode:n,fromNodeId:s,fromHandleId:r,fromType:i,doc:o,lib:a,flowId:c,isValidConnection:u=_c,nodeLookup:d}){const f=i==="target",h=t?o.querySelector(`.${a}-flow__handle[data-id="${c}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:m,y:p}=Re(e),b=o.elementFromPoint(m,p),x=b!=null&&b.classList.contains(`${a}-flow__handle`)?b:h,y={handleDomNode:x,isValid:!1,connection:null,toHandle:null};if(x){const v=Ec(void 0,x),g=x.getAttribute("data-nodeid"),w=x.getAttribute("data-handleid"),S=x.classList.contains("connectable"),_=x.classList.contains("connectableend");if(!g||!v)return y;const k={source:f?g:s,sourceHandle:f?w:r,target:f?s:g,targetHandle:f?r:w};y.connection=k;const E=S&&_&&(n===Mt.Strict?f&&v==="source"||!f&&v==="target":g!==s||w!==r);y.isValid=E&&u(k),y.toHandle=jc(g,v,w,d,n,!0)}return y}const Us={onPointerDown:Kx,isValid:Ic};function Qx({domNode:e,panZoom:t,getTransform:n,getViewScale:s}){const r=Se(e);function i({translateExtent:a,width:c,height:u,zoomStep:d=1,pannable:f=!0,zoomable:h=!0,inversePan:m=!1}){const p=g=>{if(g.sourceEvent.type!=="wheel"||!t)return;const w=n(),S=g.sourceEvent.ctrlKey&&rn()?10:1,_=-g.sourceEvent.deltaY*(g.sourceEvent.deltaMode===1?.05:g.sourceEvent.deltaMode?1:.002)*d,k=w[2]*Math.pow(2,_*S);t.scaleTo(k)};let b=[0,0];const x=g=>{(g.sourceEvent.type==="mousedown"||g.sourceEvent.type==="touchstart")&&(b=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY])},y=g=>{const w=n();if(g.sourceEvent.type!=="mousemove"&&g.sourceEvent.type!=="touchmove"||!t)return;const S=[g.sourceEvent.clientX??g.sourceEvent.touches[0].clientX,g.sourceEvent.clientY??g.sourceEvent.touches[0].clientY],_=[S[0]-b[0],S[1]-b[1]];b=S;const k=s()*Math.max(w[2],Math.log(w[2]))*(m?-1:1),N={x:w[0]-_[0]*k,y:w[1]-_[1]*k},E=[[0,0],[c,u]];t.setViewportConstrained({x:N.x,y:N.y,zoom:w[2]},E,a)},v=Jl().on("start",x).on("zoom",f?y:null).on("zoom.wheel",h?p:null);r.call(v,{})}function o(){r.on("zoom",null)}return{update:i,destroy:o,pointer:Pe}}const gr=e=>({x:e.x,y:e.y,zoom:e.k}),As=({x:e,y:t,zoom:n})=>fr.translate(e,t).scale(n),Et=(e,t)=>e.target.closest(`.${t}`),Sc=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Jx=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Ms=(e,t=0,n=Jx,s=()=>{})=>{const r=typeof t=="number"&&t>0;return r||s(),r?e.transition().duration(t).ease(n).on("end",s):e},Cc=e=>{const t=e.ctrlKey&&rn()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function e0({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:s,panOnScrollMode:r,panOnScrollSpeed:i,zoomOnPinch:o,onPanZoomStart:a,onPanZoom:c,onPanZoomEnd:u}){return d=>{if(Et(d,t))return d.ctrlKey&&d.preventDefault(),!1;d.preventDefault(),d.stopImmediatePropagation();const f=n.property("__zoom").k||1;if(d.ctrlKey&&o){const x=Pe(d),y=Cc(d),v=f*Math.pow(2,y);s.scaleTo(n,v,x,d);return}const h=d.deltaMode===1?20:1;let m=r===gt.Vertical?0:d.deltaX*h,p=r===gt.Horizontal?0:d.deltaY*h;!rn()&&d.shiftKey&&r!==gt.Vertical&&(m=d.deltaY*h,p=0),s.translateBy(n,-(m/f)*i,-(p/f)*i,{internal:!0});const b=gr(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(c==null||c(d,b),e.panScrollTimeout=setTimeout(()=>{u==null||u(d,b),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,a==null||a(d,b))}}function t0({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(s,r){const i=s.type==="wheel",o=!t&&i&&!s.ctrlKey,a=Et(s,e);if(s.ctrlKey&&i&&a&&s.preventDefault(),o||a)return null;s.preventDefault(),n.call(this,s,r)}}function n0({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return s=>{var i,o,a;if((i=s.sourceEvent)!=null&&i.internal)return;const r=gr(s.transform);e.mouseButton=((o=s.sourceEvent)==null?void 0:o.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=r,((a=s.sourceEvent)==null?void 0:a.type)==="mousedown"&&t(!0),n&&(n==null||n(s.sourceEvent,r))}}function r0({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:s,onPanZoom:r}){return i=>{var o,a;e.usedRightMouseButton=!!(n&&Sc(t,e.mouseButton??0)),(o=i.sourceEvent)!=null&&o.sync||s([i.transform.x,i.transform.y,i.transform.k]),r&&!((a=i.sourceEvent)!=null&&a.internal)&&(r==null||r(i.sourceEvent,gr(i.transform)))}}function s0({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:s,onPanZoomEnd:r,onPaneContextMenu:i}){return o=>{var a;if(!((a=o.sourceEvent)!=null&&a.internal)&&(e.isZoomingOrPanning=!1,i&&Sc(t,e.mouseButton??0)&&!e.usedRightMouseButton&&o.sourceEvent&&i(o.sourceEvent),e.usedRightMouseButton=!1,s(!1),r)){const c=gr(o.transform);e.prevViewport=c,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{r==null||r(o.sourceEvent,c)},n?150:0)}}}function o0({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:s,panOnScroll:r,zoomOnDoubleClick:i,userSelectionActive:o,noWheelClassName:a,noPanClassName:c,lib:u,connectionInProgress:d}){return f=>{var x;const h=e||t,m=n&&f.ctrlKey,p=f.type==="wheel";if(f.button===1&&f.type==="mousedown"&&(Et(f,`${u}-flow__node`)||Et(f,`${u}-flow__edge`)))return!0;if(!s&&!h&&!r&&!i&&!n||o||d&&!p||Et(f,a)&&p||Et(f,c)&&(!p||r&&p&&!e)||!n&&f.ctrlKey&&p)return!1;if(!n&&f.type==="touchstart"&&((x=f.touches)==null?void 0:x.length)>1)return f.preventDefault(),!1;if(!h&&!r&&!m&&p||!s&&(f.type==="mousedown"||f.type==="touchstart")||Array.isArray(s)&&!s.includes(f.button)&&f.type==="mousedown")return!1;const b=Array.isArray(s)&&s.includes(f.button)||!f.button||f.button<=1;return(!f.ctrlKey||p)&&b}}function i0({domNode:e,minZoom:t,maxZoom:n,translateExtent:s,viewport:r,onPanZoom:i,onPanZoomStart:o,onPanZoomEnd:a,onDraggingChange:c}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=e.getBoundingClientRect(),f=Jl().scaleExtent([t,n]).translateExtent(s),h=Se(e).call(f);v({x:r.x,y:r.y,zoom:Tt(r.zoom,t,n)},[[0,0],[d.width,d.height]],s);const m=h.on("wheel.zoom"),p=h.on("dblclick.zoom");f.wheelDelta(Cc);function b(I,C){return h?new Promise(O=>{f==null||f.interpolate((C==null?void 0:C.interpolate)==="linear"?Yt:Dn).transform(Ms(h,C==null?void 0:C.duration,C==null?void 0:C.ease,()=>O(!0)),I)}):Promise.resolve(!1)}function x({noWheelClassName:I,noPanClassName:C,onPaneContextMenu:O,userSelectionActive:j,panOnScroll:P,panOnDrag:T,panOnScrollMode:B,panOnScrollSpeed:R,preventScrolling:D,zoomOnPinch:F,zoomOnScroll:Y,zoomOnDoubleClick:G,zoomActivationKeyPressed:M,lib:z,onTransformChange:V,connectionInProgress:H,paneClickDistance:W,selectionOnDrag:q}){j&&!u.isZoomingOrPanning&&y();const X=P&&!M&&!j;f.clickDistance(q?1/0:!ze(W)||W<0?0:W);const ee=X?e0({zoomPanValues:u,noWheelClassName:I,d3Selection:h,d3Zoom:f,panOnScrollMode:B,panOnScrollSpeed:R,zoomOnPinch:F,onPanZoomStart:o,onPanZoom:i,onPanZoomEnd:a}):t0({noWheelClassName:I,preventScrolling:D,d3ZoomHandler:m});if(h.on("wheel.zoom",ee,{passive:!1}),!j){const Q=n0({zoomPanValues:u,onDraggingChange:c,onPanZoomStart:o});f.on("start",Q);const Z=r0({zoomPanValues:u,panOnDrag:T,onPaneContextMenu:!!O,onPanZoom:i,onTransformChange:V});f.on("zoom",Z);const ne=s0({zoomPanValues:u,panOnDrag:T,panOnScroll:P,onPaneContextMenu:O,onPanZoomEnd:a,onDraggingChange:c});f.on("end",ne)}const te=o0({zoomActivationKeyPressed:M,panOnDrag:T,zoomOnScroll:Y,panOnScroll:P,zoomOnDoubleClick:G,zoomOnPinch:F,userSelectionActive:j,noPanClassName:C,noWheelClassName:I,lib:z,connectionInProgress:H});f.filter(te),G?h.on("dblclick.zoom",p):h.on("dblclick.zoom",null)}function y(){f.on("zoom",null)}async function v(I,C,O){const j=As(I),P=f==null?void 0:f.constrain()(j,C,O);return P&&await b(P),new Promise(T=>T(P))}async function g(I,C){const O=As(I);return await b(O,C),new Promise(j=>j(O))}function w(I){if(h){const C=As(I),O=h.property("__zoom");(O.k!==I.zoom||O.x!==I.x||O.y!==I.y)&&(f==null||f.transform(h,C,null,{sync:!0}))}}function S(){const I=h?Ql(h.node()):{x:0,y:0,k:1};return{x:I.x,y:I.y,zoom:I.k}}function _(I,C){return h?new Promise(O=>{f==null||f.interpolate((C==null?void 0:C.interpolate)==="linear"?Yt:Dn).scaleTo(Ms(h,C==null?void 0:C.duration,C==null?void 0:C.ease,()=>O(!0)),I)}):Promise.resolve(!1)}function k(I,C){return h?new Promise(O=>{f==null||f.interpolate((C==null?void 0:C.interpolate)==="linear"?Yt:Dn).scaleBy(Ms(h,C==null?void 0:C.duration,C==null?void 0:C.ease,()=>O(!0)),I)}):Promise.resolve(!1)}function N(I){f==null||f.scaleExtent(I)}function E(I){f==null||f.translateExtent(I)}function A(I){const C=!ze(I)||I<0?0:I;f==null||f.clickDistance(C)}return{update:x,destroy:y,setViewport:g,setViewportConstrained:v,getViewport:S,scaleTo:_,scaleBy:k,setScaleExtent:N,setTranslateExtent:E,syncViewport:w,setClickDistance:A}}var zt;(function(e){e.Line="line",e.Handle="handle"})(zt||(zt={}));function a0({width:e,prevWidth:t,height:n,prevHeight:s,affectsX:r,affectsY:i}){const o=e-t,a=n-s,c=[o>0?1:o<0?-1:0,a>0?1:a<0?-1:0];return o&&r&&(c[0]=c[0]*-1),a&&i&&(c[1]=c[1]*-1),c}function ga(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),s=e.includes("left"),r=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:s,affectsY:r}}function rt(e,t){return Math.max(0,t-e)}function st(e,t){return Math.max(0,e-t)}function In(e,t,n){return Math.max(0,t-e,e-n)}function xa(e,t){return e?!t:t}function l0(e,t,n,s,r,i,o,a){let{affectsX:c,affectsY:u}=t;const{isHorizontal:d,isVertical:f}=t,h=d&&f,{xSnapped:m,ySnapped:p}=n,{minWidth:b,maxWidth:x,minHeight:y,maxHeight:v}=s,{x:g,y:w,width:S,height:_,aspectRatio:k}=e;let N=Math.floor(d?m-e.pointerX:0),E=Math.floor(f?p-e.pointerY:0);const A=S+(c?-N:N),I=_+(u?-E:E),C=-i[0]*S,O=-i[1]*_;let j=In(A,b,x),P=In(I,y,v);if(o){let R=0,D=0;c&&N<0?R=rt(g+N+C,o[0][0]):!c&&N>0&&(R=st(g+A+C,o[1][0])),u&&E<0?D=rt(w+E+O,o[0][1]):!u&&E>0&&(D=st(w+I+O,o[1][1])),j=Math.max(j,R),P=Math.max(P,D)}if(a){let R=0,D=0;c&&N>0?R=st(g+N,a[0][0]):!c&&N<0&&(R=rt(g+A,a[1][0])),u&&E>0?D=st(w+E,a[0][1]):!u&&E<0&&(D=rt(w+I,a[1][1])),j=Math.max(j,R),P=Math.max(P,D)}if(r){if(d){const R=In(A/k,y,v)*k;if(j=Math.max(j,R),o){let D=0;!c&&!u||c&&!u&&h?D=st(w+O+A/k,o[1][1])*k:D=rt(w+O+(c?N:-N)/k,o[0][1])*k,j=Math.max(j,D)}if(a){let D=0;!c&&!u||c&&!u&&h?D=rt(w+A/k,a[1][1])*k:D=st(w+(c?N:-N)/k,a[0][1])*k,j=Math.max(j,D)}}if(f){const R=In(I*k,b,x)/k;if(P=Math.max(P,R),o){let D=0;!c&&!u||u&&!c&&h?D=st(g+I*k+C,o[1][0])/k:D=rt(g+(u?E:-E)*k+C,o[0][0])/k,P=Math.max(P,D)}if(a){let D=0;!c&&!u||u&&!c&&h?D=rt(g+I*k,a[1][0])/k:D=st(g+(u?E:-E)*k,a[0][0])/k,P=Math.max(P,D)}}}E=E+(E<0?P:-P),N=N+(N<0?j:-j),r&&(h?A>I*k?E=(xa(c,u)?-N:N)/k:N=(xa(c,u)?-E:E)*k:d?(E=N/k,u=c):(N=E*k,c=u));const T=c?g+N:g,B=u?w+E:w;return{width:S+(c?-N:N),height:_+(u?-E:E),x:i[0]*N*(c?-1:1)+T,y:i[1]*E*(u?-1:1)+B}}const kc={width:0,height:0,x:0,y:0},c0={...kc,pointerX:0,pointerY:0,aspectRatio:1};function u0(e){return[[0,0],[e.measured.width,e.measured.height]]}function d0(e,t,n){const s=t.position.x+e.position.x,r=t.position.y+e.position.y,i=e.measured.width??0,o=e.measured.height??0,a=n[0]*i,c=n[1]*o;return[[s-a,r-c],[s+i-a,r+o-c]]}function f0({domNode:e,nodeId:t,getStoreItems:n,onChange:s,onEnd:r}){const i=Se(e);let o={controlDirection:ga("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function a({controlPosition:u,boundaries:d,keepAspectRatio:f,resizeDirection:h,onResizeStart:m,onResize:p,onResizeEnd:b,shouldResize:x}){let y={...kc},v={...c0};o={boundaries:d,resizeDirection:h,keepAspectRatio:f,controlDirection:ga(u)};let g,w=null,S=[],_,k,N,E=!1;const A=$l().on("start",I=>{const{nodeLookup:C,transform:O,snapGrid:j,snapToGrid:P,nodeOrigin:T,paneDomNode:B}=n();if(g=C.get(t),!g)return;w=(B==null?void 0:B.getBoundingClientRect())??null;const{xSnapped:R,ySnapped:D}=Wt(I.sourceEvent,{transform:O,snapGrid:j,snapToGrid:P,containerBounds:w});y={width:g.measured.width??0,height:g.measured.height??0,x:g.position.x??0,y:g.position.y??0},v={...y,pointerX:R,pointerY:D,aspectRatio:y.width/y.height},_=void 0,g.parentId&&(g.extent==="parent"||g.expandParent)&&(_=C.get(g.parentId),k=_&&g.extent==="parent"?u0(_):void 0),S=[],N=void 0;for(const[F,Y]of C)if(Y.parentId===t&&(S.push({id:F,position:{...Y.position},extent:Y.extent}),Y.extent==="parent"||Y.expandParent)){const G=d0(Y,g,Y.origin??T);N?N=[[Math.min(G[0][0],N[0][0]),Math.min(G[0][1],N[0][1])],[Math.max(G[1][0],N[1][0]),Math.max(G[1][1],N[1][1])]]:N=G}m==null||m(I,{...y})}).on("drag",I=>{const{transform:C,snapGrid:O,snapToGrid:j,nodeOrigin:P}=n(),T=Wt(I.sourceEvent,{transform:C,snapGrid:O,snapToGrid:j,containerBounds:w}),B=[];if(!g)return;const{x:R,y:D,width:F,height:Y}=y,G={},M=g.origin??P,{width:z,height:V,x:H,y:W}=l0(v,o.controlDirection,T,o.boundaries,o.keepAspectRatio,M,k,N),q=z!==F,X=V!==Y,ee=H!==R&&q,te=W!==D&&X;if(!ee&&!te&&!q&&!X)return;if((ee||te||M[0]===1||M[1]===1)&&(G.x=ee?H:y.x,G.y=te?W:y.y,y.x=G.x,y.y=G.y,S.length>0)){const oe=H-R,re=W-D;for(const we of S)we.position={x:we.position.x-oe+M[0]*(z-F),y:we.position.y-re+M[1]*(V-Y)},B.push(we)}if((q||X)&&(G.width=q&&(!o.resizeDirection||o.resizeDirection==="horizontal")?z:y.width,G.height=X&&(!o.resizeDirection||o.resizeDirection==="vertical")?V:y.height,y.width=G.width,y.height=G.height),_&&g.expandParent){const oe=M[0]*(G.width??0);G.x&&G.x<oe&&(y.x=oe,v.x=v.x-(G.x-oe));const re=M[1]*(G.height??0);G.y&&G.y<re&&(y.y=re,v.y=v.y-(G.y-re))}const Q=a0({width:y.width,prevWidth:F,height:y.height,prevHeight:Y,affectsX:o.controlDirection.affectsX,affectsY:o.controlDirection.affectsY}),Z={...y,direction:Q};(x==null?void 0:x(I,Z))!==!1&&(E=!0,p==null||p(I,Z),s(G,B))}).on("end",I=>{E&&(b==null||b(I,{...y}),r==null||r({...y}),E=!1)});i.call(A)}function c(){i.on(".drag",null)}return{update:a,destroy:c}}const h0={},ya=e=>{let t;const n=new Set,s=(d,f)=>{const h=typeof d=="function"?d(t):d;if(!Object.is(h,t)){const m=t;t=f??(typeof h!="object"||h===null)?h:Object.assign({},t,h),n.forEach(p=>p(t,m))}},r=()=>t,c={setState:s,getState:r,getInitialState:()=>u,subscribe:d=>(n.add(d),()=>n.delete(d)),destroy:()=>{(h0?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},u=t=e(s,r,c);return c},m0=e=>e?ya(e):ya,{useDebugValue:p0}=Rd,{useSyncExternalStoreWithSelector:g0}=Df,x0=e=>e;function Ac(e,t=x0,n){const s=g0(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return p0(s),s}const wa=(e,t)=>{const n=m0(e),s=(r,i=t)=>Ac(n,r,i);return Object.assign(s,n),s},y0=(e,t)=>e?wa(e,t):wa;function de(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[s,r]of e)if(!Object.is(r,t.get(s)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(t,s)||!Object.is(e[s],t[s]))return!1;return!0}const xr=L.createContext(null),w0=xr.Provider,Mc=Ye.error001();function se(e,t){const n=L.useContext(xr);if(n===null)throw new Error(Mc);return Ac(n,e,t)}function ue(){const e=L.useContext(xr);if(e===null)throw new Error(Mc);return L.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const ba={display:"none"},b0={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Tc="react-flow__node-desc",Pc="react-flow__edge-desc",v0="react-flow__aria-live",N0=e=>e.ariaLiveMessage,j0=e=>e.ariaLabelConfig;function E0({rfId:e}){const t=se(N0);return l.jsx("div",{id:`${v0}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:b0,children:t})}function _0({rfId:e,disableKeyboardA11y:t}){const n=se(j0);return l.jsxs(l.Fragment,{children:[l.jsx("div",{id:`${Tc}-${e}`,style:ba,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),l.jsx("div",{id:`${Pc}-${e}`,style:ba,children:n["edge.a11yDescription.default"]}),!t&&l.jsx(E0,{rfId:e})]})}const yr=L.forwardRef(({position:e="top-left",children:t,className:n,style:s,...r},i)=>{const o=`${e}`.split("-");return l.jsx("div",{className:pe(["react-flow__panel",n,...o]),style:s,ref:i,...r,children:t})});yr.displayName="Panel";function I0({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:l.jsx(yr,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:l.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const S0=e=>{const t=[],n=[];for(const[,s]of e.nodeLookup)s.selected&&t.push(s.internals.userNode);for(const[,s]of e.edgeLookup)s.selected&&n.push(s);return{selectedNodes:t,selectedEdges:n}},Sn=e=>e.id;function C0(e,t){return de(e.selectedNodes.map(Sn),t.selectedNodes.map(Sn))&&de(e.selectedEdges.map(Sn),t.selectedEdges.map(Sn))}function k0({onSelectionChange:e}){const t=ue(),{selectedNodes:n,selectedEdges:s}=se(S0,C0);return L.useEffect(()=>{const r={nodes:n,edges:s};e==null||e(r),t.getState().onSelectionChangeHandlers.forEach(i=>i(r))},[n,s,e]),null}const A0=e=>!!e.onSelectionChangeHandlers;function M0({onSelectionChange:e}){const t=se(A0);return e||t?l.jsx(k0,{onSelectionChange:e}):null}const Dc=[0,0],T0={x:0,y:0,zoom:1},P0=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],va=[...P0,"rfId"],D0=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),Na={translateExtent:en,nodeOrigin:Dc,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function z0(e){const{setNodes:t,setEdges:n,setMinZoom:s,setMaxZoom:r,setTranslateExtent:i,setNodeExtent:o,reset:a,setDefaultNodesAndEdges:c}=se(D0,de),u=ue();L.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{d.current=Na,a()}),[]);const d=L.useRef(Na);return L.useEffect(()=>{for(const f of va){const h=e[f],m=d.current[f];h!==m&&(typeof e[f]>"u"||(f==="nodes"?t(h):f==="edges"?n(h):f==="minZoom"?s(h):f==="maxZoom"?r(h):f==="translateExtent"?i(h):f==="nodeExtent"?o(h):f==="ariaLabelConfig"?u.setState({ariaLabelConfig:Ex(h)}):f==="fitView"?u.setState({fitViewQueued:h}):f==="fitViewOptions"?u.setState({fitViewOptions:h}):u.setState({[f]:h})))}d.current=e},va.map(f=>e[f])),null}function ja(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function R0(e){var s;const[t,n]=L.useState(e==="system"?null:e);return L.useEffect(()=>{if(e!=="system"){n(e);return}const r=ja(),i=()=>n(r!=null&&r.matches?"dark":"light");return i(),r==null||r.addEventListener("change",i),()=>{r==null||r.removeEventListener("change",i)}},[e]),t!==null?t:(s=ja())!=null&&s.matches?"dark":"light"}const Ea=typeof document<"u"?document:null;function sn(e=null,t={target:Ea,actInsideInputWithModifier:!0}){const[n,s]=L.useState(!1),r=L.useRef(!1),i=L.useRef(new Set([])),[o,a]=L.useMemo(()=>{if(e!==null){const u=(Array.isArray(e)?e:[e]).filter(f=>typeof f=="string").map(f=>f.replace("+",`
`).replace(`

`,`
+`).split(`
`)),d=u.reduce((f,h)=>f.concat(...h),[]);return[u,d]}return[[],[]]},[e]);return L.useEffect(()=>{const c=(t==null?void 0:t.target)??Ea,u=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const d=m=>{var x,y;if(r.current=m.ctrlKey||m.metaKey||m.shiftKey||m.altKey,(!r.current||r.current&&!u)&&hc(m))return!1;const b=Ia(m.code,a);if(i.current.add(m[b]),_a(o,i.current,!1)){const v=((y=(x=m.composedPath)==null?void 0:x.call(m))==null?void 0:y[0])||m.target,g=(v==null?void 0:v.nodeName)==="BUTTON"||(v==null?void 0:v.nodeName)==="A";t.preventDefault!==!1&&(r.current||!g)&&m.preventDefault(),s(!0)}},f=m=>{const p=Ia(m.code,a);_a(o,i.current,!0)?(s(!1),i.current.clear()):i.current.delete(m[p]),m.key==="Meta"&&i.current.clear(),r.current=!1},h=()=>{i.current.clear(),s(!1)};return c==null||c.addEventListener("keydown",d),c==null||c.addEventListener("keyup",f),window.addEventListener("blur",h),window.addEventListener("contextmenu",h),()=>{c==null||c.removeEventListener("keydown",d),c==null||c.removeEventListener("keyup",f),window.removeEventListener("blur",h),window.removeEventListener("contextmenu",h)}}},[e,s]),n}function _a(e,t,n){return e.filter(s=>n||s.length===t.size).some(s=>s.every(r=>t.has(r)))}function Ia(e,t){return t.includes(e)?"code":"key"}const L0=()=>{const e=ue();return L.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:s}=e.getState();return s?s.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[s,r,i],panZoom:o}=e.getState();return o?(await o.setViewport({x:t.x??s,y:t.y??r,zoom:t.zoom??i},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,s]=e.getState().transform;return{x:t,y:n,zoom:s}},setCenter:async(t,n,s)=>e.getState().setCenter(t,n,s),fitBounds:async(t,n)=>{const{width:s,height:r,minZoom:i,maxZoom:o,panZoom:a}=e.getState(),c=pr(t,s,r,i,o,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(c,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:s,snapGrid:r,snapToGrid:i,domNode:o}=e.getState();if(!o)return t;const{x:a,y:c}=o.getBoundingClientRect(),u={x:t.x-a,y:t.y-c},d=n.snapGrid??r,f=n.snapToGrid??i;return mn(u,s,f,d)},flowToScreenPosition:t=>{const{transform:n,domNode:s}=e.getState();if(!s)return t;const{x:r,y:i}=s.getBoundingClientRect(),o=er(t,n);return{x:o.x+r,y:o.y+i}}}),[])};function zc(e,t){const n=[],s=new Map,r=[];for(const i of e)if(i.type==="add"){r.push(i);continue}else if(i.type==="remove"||i.type==="replace")s.set(i.id,[i]);else{const o=s.get(i.id);o?o.push(i):s.set(i.id,[i])}for(const i of t){const o=s.get(i.id);if(!o){n.push(i);continue}if(o[0].type==="remove")continue;if(o[0].type==="replace"){n.push({...o[0].item});continue}const a={...i};for(const c of o)$0(c,a);n.push(a)}return r.length&&r.forEach(i=>{i.index!==void 0?n.splice(i.index,0,{...i.item}):n.push({...i.item})}),n}function $0(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured={...e.dimensions},e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function O0(e,t){return zc(e,t)}function B0(e,t){return zc(e,t)}function ft(e,t){return{id:e,type:"select",selected:t}}function _t(e,t=new Set,n=!1){const s=[];for(const[r,i]of e){const o=t.has(r);!(i.selected===void 0&&!o)&&i.selected!==o&&(n&&(i.selected=o),s.push(ft(i.id,o)))}return s}function Sa({items:e=[],lookup:t}){var r;const n=[],s=new Map(e.map(i=>[i.id,i]));for(const[i,o]of e.entries()){const a=t.get(o.id),c=((r=a==null?void 0:a.internals)==null?void 0:r.userNode)??a;c!==void 0&&c!==o&&n.push({id:o.id,item:o,type:"replace"}),c===void 0&&n.push({item:o,type:"add",index:i})}for(const[i]of t)s.get(i)===void 0&&n.push({id:i,type:"remove"});return n}function Ca(e){return{id:e.id,type:"remove"}}const ka=e=>px(e),V0=e=>sc(e);function Rc(e){return L.forwardRef(e)}const F0=typeof window<"u"?L.useLayoutEffect:L.useEffect;function Aa(e){const[t,n]=L.useState(BigInt(0)),[s]=L.useState(()=>H0(()=>n(r=>r+BigInt(1))));return F0(()=>{const r=s.get();r.length&&(e(r),s.reset())},[t]),s}function H0(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Lc=L.createContext(null);function q0({children:e}){const t=ue(),n=L.useCallback(a=>{const{nodes:c=[],setNodes:u,hasDefaultNodes:d,onNodesChange:f,nodeLookup:h,fitViewQueued:m,onNodesChangeMiddlewareMap:p}=t.getState();let b=c;for(const y of a)b=typeof y=="function"?y(b):y;let x=Sa({items:b,lookup:h});for(const y of p.values())x=y(x);d&&u(b),x.length>0?f==null||f(x):m&&window.requestAnimationFrame(()=>{const{fitViewQueued:y,nodes:v,setNodes:g}=t.getState();y&&g(v)})},[]),s=Aa(n),r=L.useCallback(a=>{const{edges:c=[],setEdges:u,hasDefaultEdges:d,onEdgesChange:f,edgeLookup:h}=t.getState();let m=c;for(const p of a)m=typeof p=="function"?p(m):p;d?u(m):f&&f(Sa({items:m,lookup:h}))},[]),i=Aa(r),o=L.useMemo(()=>({nodeQueue:s,edgeQueue:i}),[]);return l.jsx(Lc.Provider,{value:o,children:e})}function G0(){const e=L.useContext(Lc);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const Y0=e=>!!e.panZoom;function wr(){const e=L0(),t=ue(),n=G0(),s=se(Y0),r=L.useMemo(()=>{const i=f=>t.getState().nodeLookup.get(f),o=f=>{n.nodeQueue.push(f)},a=f=>{n.edgeQueue.push(f)},c=f=>{var y,v;const{nodeLookup:h,nodeOrigin:m}=t.getState(),p=ka(f)?f:h.get(f.id),b=p.parentId?dc(p.position,p.measured,p.parentId,h,m):p.position,x={...p,position:b,width:((y=p.measured)==null?void 0:y.width)??p.width,height:((v=p.measured)==null?void 0:v.height)??p.height};return Pt(x)},u=(f,h,m={replace:!1})=>{o(p=>p.map(b=>{if(b.id===f){const x=typeof h=="function"?h(b):h;return m.replace&&ka(x)?x:{...b,...x}}return b}))},d=(f,h,m={replace:!1})=>{a(p=>p.map(b=>{if(b.id===f){const x=typeof h=="function"?h(b):h;return m.replace&&V0(x)?x:{...b,...x}}return b}))};return{getNodes:()=>t.getState().nodes.map(f=>({...f})),getNode:f=>{var h;return(h=i(f))==null?void 0:h.internals.userNode},getInternalNode:i,getEdges:()=>{const{edges:f=[]}=t.getState();return f.map(h=>({...h}))},getEdge:f=>t.getState().edgeLookup.get(f),setNodes:o,setEdges:a,addNodes:f=>{const h=Array.isArray(f)?f:[f];n.nodeQueue.push(m=>[...m,...h])},addEdges:f=>{const h=Array.isArray(f)?f:[f];n.edgeQueue.push(m=>[...m,...h])},toObject:()=>{const{nodes:f=[],edges:h=[],transform:m}=t.getState(),[p,b,x]=m;return{nodes:f.map(y=>({...y})),edges:h.map(y=>({...y})),viewport:{x:p,y:b,zoom:x}}},deleteElements:async({nodes:f=[],edges:h=[]})=>{const{nodes:m,edges:p,onNodesDelete:b,onEdgesDelete:x,triggerNodeChanges:y,triggerEdgeChanges:v,onDelete:g,onBeforeDelete:w}=t.getState(),{nodes:S,edges:_}=await wx({nodesToRemove:f,edgesToRemove:h,nodes:m,edges:p,onBeforeDelete:w}),k=_.length>0,N=S.length>0;if(k){const E=_.map(Ca);x==null||x(_),v(E)}if(N){const E=S.map(Ca);b==null||b(S),y(E)}return(N||k)&&(g==null||g({nodes:S,edges:_})),{deletedNodes:S,deletedEdges:_}},getIntersectingNodes:(f,h=!0,m)=>{const p=oa(f),b=p?f:c(f),x=m!==void 0;return b?(m||t.getState().nodes).filter(y=>{const v=t.getState().nodeLookup.get(y.id);if(v&&!p&&(y.id===f.id||!v.internals.positionAbsolute))return!1;const g=Pt(x?y:v),w=nn(g,b);return h&&w>0||w>=g.width*g.height||w>=b.width*b.height}):[]},isNodeIntersecting:(f,h,m=!0)=>{const b=oa(f)?f:c(f);if(!b)return!1;const x=nn(b,h);return m&&x>0||x>=h.width*h.height||x>=b.width*b.height},updateNode:u,updateNodeData:(f,h,m={replace:!1})=>{u(f,p=>{const b=typeof h=="function"?h(p):h;return m.replace?{...p,data:b}:{...p,data:{...p.data,...b}}},m)},updateEdge:d,updateEdgeData:(f,h,m={replace:!1})=>{d(f,p=>{const b=typeof h=="function"?h(p):h;return m.replace?{...p,data:b}:{...p,data:{...p.data,...b}}},m)},getNodesBounds:f=>{const{nodeLookup:h,nodeOrigin:m}=t.getState();return oc(f,{nodeLookup:h,nodeOrigin:m})},getHandleConnections:({type:f,id:h,nodeId:m})=>{var p;return Array.from(((p=t.getState().connectionLookup.get(`${m}-${f}${h?`-${h}`:""}`))==null?void 0:p.values())??[])},getNodeConnections:({type:f,handleId:h,nodeId:m})=>{var p;return Array.from(((p=t.getState().connectionLookup.get(`${m}${f?h?`-${f}-${h}`:`-${f}`:""}`))==null?void 0:p.values())??[])},fitView:async f=>{const h=t.getState().fitViewResolver??jx();return t.setState({fitViewQueued:!0,fitViewOptions:f,fitViewResolver:h}),n.nodeQueue.push(m=>[...m]),h.promise}}},[]);return L.useMemo(()=>({...r,...e,viewportInitialized:s}),[s])}const Ma=e=>e.selected,W0=typeof window<"u"?window:void 0;function X0({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=ue(),{deleteElements:s}=wr(),r=sn(e,{actInsideInputWithModifier:!1}),i=sn(t,{target:W0});L.useEffect(()=>{if(r){const{edges:o,nodes:a}=n.getState();s({nodes:a.filter(Ma),edges:o.filter(Ma)}),n.setState({nodesSelectionActive:!1})}},[r]),L.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])}function U0(e){const t=ue();L.useEffect(()=>{const n=()=>{var r,i,o,a;if(!e.current||!(((i=(r=e.current).checkVisibility)==null?void 0:i.call(r))??!0))return!1;const s=bo(e.current);(s.height===0||s.width===0)&&((a=(o=t.getState()).onError)==null||a.call(o,"004",Ye.error004())),t.setState({width:s.width||500,height:s.height||500})};if(e.current){n(),window.addEventListener("resize",n);const s=new ResizeObserver(()=>n());return s.observe(e.current),()=>{window.removeEventListener("resize",n),s&&e.current&&s.unobserve(e.current)}}},[])}const br={position:"absolute",width:"100%",height:"100%",top:0,left:0},Z0=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function K0({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:s=!1,panOnScrollSpeed:r=.5,panOnScrollMode:i=gt.Free,zoomOnDoubleClick:o=!0,panOnDrag:a=!0,defaultViewport:c,translateExtent:u,minZoom:d,maxZoom:f,zoomActivationKeyCode:h,preventScrolling:m=!0,children:p,noWheelClassName:b,noPanClassName:x,onViewportChange:y,isControlledViewport:v,paneClickDistance:g,selectionOnDrag:w}){const S=ue(),_=L.useRef(null),{userSelectionActive:k,lib:N,connectionInProgress:E}=se(Z0,de),A=sn(h),I=L.useRef();U0(_);const C=L.useCallback(O=>{y==null||y({x:O[0],y:O[1],zoom:O[2]}),v||S.setState({transform:O})},[y,v]);return L.useEffect(()=>{if(_.current){I.current=i0({domNode:_.current,minZoom:d,maxZoom:f,translateExtent:u,viewport:c,onDraggingChange:T=>S.setState({paneDragging:T}),onPanZoomStart:(T,B)=>{const{onViewportChangeStart:R,onMoveStart:D}=S.getState();D==null||D(T,B),R==null||R(B)},onPanZoom:(T,B)=>{const{onViewportChange:R,onMove:D}=S.getState();D==null||D(T,B),R==null||R(B)},onPanZoomEnd:(T,B)=>{const{onViewportChangeEnd:R,onMoveEnd:D}=S.getState();D==null||D(T,B),R==null||R(B)}});const{x:O,y:j,zoom:P}=I.current.getViewport();return S.setState({panZoom:I.current,transform:[O,j,P],domNode:_.current.closest(".react-flow")}),()=>{var T;(T=I.current)==null||T.destroy()}}},[]),L.useEffect(()=>{var O;(O=I.current)==null||O.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:s,panOnScrollSpeed:r,panOnScrollMode:i,zoomOnDoubleClick:o,panOnDrag:a,zoomActivationKeyPressed:A,preventScrolling:m,noPanClassName:x,userSelectionActive:k,noWheelClassName:b,lib:N,onTransformChange:C,connectionInProgress:E,selectionOnDrag:w,paneClickDistance:g})},[e,t,n,s,r,i,o,a,A,m,x,k,b,N,C,E,w,g]),l.jsx("div",{className:"react-flow__renderer",ref:_,style:br,children:p})}const Q0=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function J0(){const{userSelectionActive:e,userSelectionRect:t}=se(Q0,de);return e&&t?l.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const Ts=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},ey=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function ty({isSelecting:e,selectionKeyPressed:t,selectionMode:n=tn.Full,panOnDrag:s,paneClickDistance:r,selectionOnDrag:i,onSelectionStart:o,onSelectionEnd:a,onPaneClick:c,onPaneContextMenu:u,onPaneScroll:d,onPaneMouseEnter:f,onPaneMouseMove:h,onPaneMouseLeave:m,children:p}){const b=ue(),{userSelectionActive:x,elementsSelectable:y,dragging:v,connectionInProgress:g}=se(ey,de),w=y&&(e||x),S=L.useRef(null),_=L.useRef(),k=L.useRef(new Set),N=L.useRef(new Set),E=L.useRef(!1),A=R=>{if(E.current||g){E.current=!1;return}c==null||c(R),b.getState().resetSelectedElements(),b.setState({nodesSelectionActive:!1})},I=R=>{if(Array.isArray(s)&&(s!=null&&s.includes(2))){R.preventDefault();return}u==null||u(R)},C=d?R=>d(R):void 0,O=R=>{E.current&&(R.stopPropagation(),E.current=!1)},j=R=>{var V,H;const{domNode:D}=b.getState();if(_.current=D==null?void 0:D.getBoundingClientRect(),!_.current)return;const F=R.target===S.current;if(!F&&!!R.target.closest(".nokey")||!e||!(i&&F||t)||R.button!==0||!R.isPrimary)return;(H=(V=R.target)==null?void 0:V.setPointerCapture)==null||H.call(V,R.pointerId),E.current=!1;const{x:M,y:z}=Re(R.nativeEvent,_.current);b.setState({userSelectionRect:{width:0,height:0,startX:M,startY:z,x:M,y:z}}),F||(R.stopPropagation(),R.preventDefault())},P=R=>{const{userSelectionRect:D,transform:F,nodeLookup:Y,edgeLookup:G,connectionLookup:M,triggerNodeChanges:z,triggerEdgeChanges:V,defaultEdgeOptions:H,resetSelectedElements:W}=b.getState();if(!_.current||!D)return;const{x:q,y:X}=Re(R.nativeEvent,_.current),{startX:ee,startY:te}=D;if(!E.current){const re=t?0:r;if(Math.hypot(q-ee,X-te)<=re)return;W(),o==null||o(R)}E.current=!0;const Q={startX:ee,startY:te,x:q<ee?q:ee,y:X<te?X:te,width:Math.abs(q-ee),height:Math.abs(X-te)},Z=k.current,ne=N.current;k.current=new Set(wo(Y,Q,F,n===tn.Partial,!0).map(re=>re.id)),N.current=new Set;const oe=(H==null?void 0:H.selectable)??!0;for(const re of k.current){const we=M.get(re);if(we)for(const{edgeId:nt}of we.values()){const Ue=G.get(nt);Ue&&(Ue.selectable??oe)&&N.current.add(nt)}}if(!ia(Z,k.current)){const re=_t(Y,k.current,!0);z(re)}if(!ia(ne,N.current)){const re=_t(G,N.current);V(re)}b.setState({userSelectionRect:Q,userSelectionActive:!0,nodesSelectionActive:!1})},T=R=>{var D,F;R.button===0&&((F=(D=R.target)==null?void 0:D.releasePointerCapture)==null||F.call(D,R.pointerId),!x&&R.target===S.current&&b.getState().userSelectionRect&&(A==null||A(R)),b.setState({userSelectionActive:!1,userSelectionRect:null}),E.current&&(a==null||a(R),b.setState({nodesSelectionActive:k.current.size>0})))},B=s===!0||Array.isArray(s)&&s.includes(0);return l.jsxs("div",{className:pe(["react-flow__pane",{draggable:B,dragging:v,selection:e}]),onClick:w?void 0:Ts(A,S),onContextMenu:Ts(I,S),onWheel:Ts(C,S),onPointerEnter:w?void 0:f,onPointerMove:w?P:h,onPointerUp:w?T:void 0,onPointerDownCapture:w?j:void 0,onClickCapture:w?O:void 0,onPointerLeave:m,ref:S,style:br,children:[p,l.jsx(J0,{})]})}function Zs({id:e,store:t,unselect:n=!1,nodeRef:s}){const{addSelectedNodes:r,unselectNodesAndEdges:i,multiSelectionActive:o,nodeLookup:a,onError:c}=t.getState(),u=a.get(e);if(!u){c==null||c("012",Ye.error012(e));return}t.setState({nodesSelectionActive:!1}),u.selected?(n||u.selected&&o)&&(i({nodes:[u],edges:[]}),requestAnimationFrame(()=>{var d;return(d=s==null?void 0:s.current)==null?void 0:d.blur()})):r([e])}function $c({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:s,nodeId:r,isSelectable:i,nodeClickDistance:o}){const a=ue(),[c,u]=L.useState(!1),d=L.useRef();return L.useEffect(()=>{d.current=Yx({getStoreItems:()=>a.getState(),onNodeMouseDown:f=>{Zs({id:f,store:a,nodeRef:e})},onDragStart:()=>{u(!0)},onDragStop:()=>{u(!1)}})},[]),L.useEffect(()=>{var f,h;if(t)(f=d.current)==null||f.destroy();else if(e.current)return(h=d.current)==null||h.update({noDragClassName:n,handleSelector:s,domNode:e.current,isSelectable:i,nodeId:r,nodeClickDistance:o}),()=>{var m;(m=d.current)==null||m.destroy()}},[n,s,t,i,e,r]),c}const ny=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Oc(){const e=ue();return L.useCallback(n=>{const{nodeExtent:s,snapToGrid:r,snapGrid:i,nodesDraggable:o,onError:a,updateNodePositions:c,nodeLookup:u,nodeOrigin:d}=e.getState(),f=new Map,h=ny(o),m=r?i[0]:5,p=r?i[1]:5,b=n.direction.x*m*n.factor,x=n.direction.y*p*n.factor;for(const[,y]of u){if(!h(y))continue;let v={x:y.internals.positionAbsolute.x+b,y:y.internals.positionAbsolute.y+x};r&&(v=hn(v,i));const{position:g,positionAbsolute:w}=ic({nodeId:y.id,nextPosition:v,nodeLookup:u,nodeExtent:s,nodeOrigin:d,onError:a});y.position=g,y.internals.positionAbsolute=w,f.set(y.id,y)}c(f)},[])}const Io=L.createContext(null),ry=Io.Provider;Io.Consumer;const Bc=()=>L.useContext(Io),sy=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),oy=(e,t,n)=>s=>{const{connectionClickStartHandle:r,connectionMode:i,connection:o}=s,{fromHandle:a,toHandle:c,isValid:u}=o,d=(c==null?void 0:c.nodeId)===e&&(c==null?void 0:c.id)===t&&(c==null?void 0:c.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,connectingTo:d,clickConnecting:(r==null?void 0:r.nodeId)===e&&(r==null?void 0:r.id)===t&&(r==null?void 0:r.type)===n,isPossibleEndHandle:i===Mt.Strict?(a==null?void 0:a.type)!==n:e!==(a==null?void 0:a.nodeId)||t!==(a==null?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!r,valid:d&&u}};function iy({type:e="source",position:t=U.Top,isValidConnection:n,isConnectable:s=!0,isConnectableStart:r=!0,isConnectableEnd:i=!0,id:o,onConnect:a,children:c,className:u,onMouseDown:d,onTouchStart:f,...h},m){var P,T;const p=o||null,b=e==="target",x=ue(),y=Bc(),{connectOnClick:v,noPanClassName:g,rfId:w}=se(sy,de),{connectingFrom:S,connectingTo:_,clickConnecting:k,isPossibleEndHandle:N,connectionInProcess:E,clickConnectionInProcess:A,valid:I}=se(oy(y,p,e),de);y||(T=(P=x.getState()).onError)==null||T.call(P,"010",Ye.error010());const C=B=>{const{defaultEdgeOptions:R,onConnect:D,hasDefaultEdges:F}=x.getState(),Y={...R,...B};if(F){const{edges:G,setEdges:M}=x.getState();M(Ax(Y,G))}D==null||D(Y),a==null||a(Y)},O=B=>{if(!y)return;const R=mc(B.nativeEvent);if(r&&(R&&B.button===0||!R)){const D=x.getState();Us.onPointerDown(B.nativeEvent,{handleDomNode:B.currentTarget,autoPanOnConnect:D.autoPanOnConnect,connectionMode:D.connectionMode,connectionRadius:D.connectionRadius,domNode:D.domNode,nodeLookup:D.nodeLookup,lib:D.lib,isTarget:b,handleId:p,nodeId:y,flowId:D.rfId,panBy:D.panBy,cancelConnection:D.cancelConnection,onConnectStart:D.onConnectStart,onConnectEnd:D.onConnectEnd,updateConnection:D.updateConnection,onConnect:C,isValidConnection:n||D.isValidConnection,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,autoPanSpeed:D.autoPanSpeed,dragThreshold:D.connectionDragThreshold})}R?d==null||d(B):f==null||f(B)},j=B=>{const{onClickConnectStart:R,onClickConnectEnd:D,connectionClickStartHandle:F,connectionMode:Y,isValidConnection:G,lib:M,rfId:z,nodeLookup:V,connection:H}=x.getState();if(!y||!F&&!r)return;if(!F){R==null||R(B.nativeEvent,{nodeId:y,handleId:p,handleType:e}),x.setState({connectionClickStartHandle:{nodeId:y,type:e,id:p}});return}const W=fc(B.target),q=n||G,{connection:X,isValid:ee}=Us.isValid(B.nativeEvent,{handle:{nodeId:y,id:p,type:e},connectionMode:Y,fromNodeId:F.nodeId,fromHandleId:F.id||null,fromType:F.type,isValidConnection:q,flowId:z,doc:W,lib:M,nodeLookup:V});ee&&X&&C(X);const te=structuredClone(H);delete te.inProgress,te.toPosition=te.toHandle?te.toHandle.position:null,D==null||D(B,te),x.setState({connectionClickStartHandle:null})};return l.jsx("div",{"data-handleid":p,"data-nodeid":y,"data-handlepos":t,"data-id":`${w}-${y}-${p}-${e}`,className:pe(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",g,u,{source:!b,target:b,connectable:s,connectablestart:r,connectableend:i,clickconnecting:k,connectingfrom:S,connectingto:_,valid:I,connectionindicator:s&&(!E||N)&&(E||A?i:r)}]),onMouseDown:O,onTouchStart:O,onClick:v?j:void 0,ref:m,...h,children:c})}const on=L.memo(Rc(iy));function ay({data:e,isConnectable:t,sourcePosition:n=U.Bottom}){return l.jsxs(l.Fragment,{children:[e==null?void 0:e.label,l.jsx(on,{type:"source",position:n,isConnectable:t})]})}function ly({data:e,isConnectable:t,targetPosition:n=U.Top,sourcePosition:s=U.Bottom}){return l.jsxs(l.Fragment,{children:[l.jsx(on,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,l.jsx(on,{type:"source",position:s,isConnectable:t})]})}function cy(){return null}function uy({data:e,isConnectable:t,targetPosition:n=U.Top}){return l.jsxs(l.Fragment,{children:[l.jsx(on,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const tr={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Ta={input:ay,default:ly,output:uy,group:cy};function dy(e){var t,n,s,r;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((s=e.style)==null?void 0:s.width),height:e.height??((r=e.style)==null?void 0:r.height)}}const fy=e=>{const{width:t,height:n,x:s,y:r}=fn(e.nodeLookup,{filter:i=>!!i.selected});return{width:ze(t)?t:null,height:ze(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${s}px,${r}px)`}};function hy({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const s=ue(),{width:r,height:i,transformString:o,userSelectionActive:a}=se(fy,de),c=Oc(),u=L.useRef(null);if(L.useEffect(()=>{var h;n||(h=u.current)==null||h.focus({preventScroll:!0})},[n]),$c({nodeRef:u}),a||!r||!i)return null;const d=e?h=>{const m=s.getState().nodes.filter(p=>p.selected);e(h,m)}:void 0,f=h=>{Object.prototype.hasOwnProperty.call(tr,h.key)&&(h.preventDefault(),c({direction:tr[h.key],factor:h.shiftKey?4:1}))};return l.jsx("div",{className:pe(["react-flow__nodesselection","react-flow__container",t]),style:{transform:o},children:l.jsx("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:d,tabIndex:n?void 0:-1,onKeyDown:n?void 0:f,style:{width:r,height:i}})})}const Pa=typeof window<"u"?window:void 0,my=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Vc({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:o,paneClickDistance:a,deleteKeyCode:c,selectionKeyCode:u,selectionOnDrag:d,selectionMode:f,onSelectionStart:h,onSelectionEnd:m,multiSelectionKeyCode:p,panActivationKeyCode:b,zoomActivationKeyCode:x,elementsSelectable:y,zoomOnScroll:v,zoomOnPinch:g,panOnScroll:w,panOnScrollSpeed:S,panOnScrollMode:_,zoomOnDoubleClick:k,panOnDrag:N,defaultViewport:E,translateExtent:A,minZoom:I,maxZoom:C,preventScrolling:O,onSelectionContextMenu:j,noWheelClassName:P,noPanClassName:T,disableKeyboardA11y:B,onViewportChange:R,isControlledViewport:D}){const{nodesSelectionActive:F,userSelectionActive:Y}=se(my,de),G=sn(u,{target:Pa}),M=sn(b,{target:Pa}),z=M||N,V=M||w,H=d&&z!==!0,W=G||Y||H;return X0({deleteKeyCode:c,multiSelectionKeyCode:p}),l.jsx(K0,{onPaneContextMenu:i,elementsSelectable:y,zoomOnScroll:v,zoomOnPinch:g,panOnScroll:V,panOnScrollSpeed:S,panOnScrollMode:_,zoomOnDoubleClick:k,panOnDrag:!G&&z,defaultViewport:E,translateExtent:A,minZoom:I,maxZoom:C,zoomActivationKeyCode:x,preventScrolling:O,noWheelClassName:P,noPanClassName:T,onViewportChange:R,isControlledViewport:D,paneClickDistance:a,selectionOnDrag:H,children:l.jsxs(ty,{onSelectionStart:h,onSelectionEnd:m,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:o,panOnDrag:z,isSelecting:!!W,selectionMode:f,selectionKeyPressed:G,paneClickDistance:a,selectionOnDrag:H,children:[e,F&&l.jsx(hy,{onSelectionContextMenu:j,noPanClassName:T,disableKeyboardA11y:B})]})})}Vc.displayName="FlowRenderer";const py=L.memo(Vc),gy=e=>t=>e?wo(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function xy(e){return se(L.useCallback(gy(e),[e]),de)}const yy=e=>e.updateNodeInternals;function wy(){const e=se(yy),[t]=L.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const s=new Map;n.forEach(r=>{const i=r.target.getAttribute("data-id");s.set(i,{id:i,nodeElement:r.target,force:!0})}),e(s)}));return L.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function by({node:e,nodeType:t,hasDimensions:n,resizeObserver:s}){const r=ue(),i=L.useRef(null),o=L.useRef(null),a=L.useRef(e.sourcePosition),c=L.useRef(e.targetPosition),u=L.useRef(t),d=n&&!!e.internals.handleBounds;return L.useEffect(()=>{i.current&&!e.hidden&&(!d||o.current!==i.current)&&(o.current&&(s==null||s.unobserve(o.current)),s==null||s.observe(i.current),o.current=i.current)},[d,e.hidden]),L.useEffect(()=>()=>{o.current&&(s==null||s.unobserve(o.current),o.current=null)},[]),L.useEffect(()=>{if(i.current){const f=u.current!==t,h=a.current!==e.sourcePosition,m=c.current!==e.targetPosition;(f||h||m)&&(u.current=t,a.current=e.sourcePosition,c.current=e.targetPosition,r.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:i.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),i}function vy({id:e,onClick:t,onMouseEnter:n,onMouseMove:s,onMouseLeave:r,onContextMenu:i,onDoubleClick:o,nodesDraggable:a,elementsSelectable:c,nodesConnectable:u,nodesFocusable:d,resizeObserver:f,noDragClassName:h,noPanClassName:m,disableKeyboardA11y:p,rfId:b,nodeTypes:x,nodeClickDistance:y,onError:v}){const{node:g,internals:w,isParent:S}=se(q=>{const X=q.nodeLookup.get(e),ee=q.parentLookup.has(e);return{node:X,internals:X.internals,isParent:ee}},de);let _=g.type||"default",k=(x==null?void 0:x[_])||Ta[_];k===void 0&&(v==null||v("003",Ye.error003(_)),_="default",k=(x==null?void 0:x.default)||Ta.default);const N=!!(g.draggable||a&&typeof g.draggable>"u"),E=!!(g.selectable||c&&typeof g.selectable>"u"),A=!!(g.connectable||u&&typeof g.connectable>"u"),I=!!(g.focusable||d&&typeof g.focusable>"u"),C=ue(),O=uc(g),j=by({node:g,nodeType:_,hasDimensions:O,resizeObserver:f}),P=$c({nodeRef:j,disabled:g.hidden||!N,noDragClassName:h,handleSelector:g.dragHandle,nodeId:e,isSelectable:E,nodeClickDistance:y}),T=Oc();if(g.hidden)return null;const B=tt(g),R=dy(g),D=E||N||t||n||s||r,F=n?q=>n(q,{...w.userNode}):void 0,Y=s?q=>s(q,{...w.userNode}):void 0,G=r?q=>r(q,{...w.userNode}):void 0,M=i?q=>i(q,{...w.userNode}):void 0,z=o?q=>o(q,{...w.userNode}):void 0,V=q=>{const{selectNodesOnDrag:X,nodeDragThreshold:ee}=C.getState();E&&(!X||!N||ee>0)&&Zs({id:e,store:C,nodeRef:j}),t&&t(q,{...w.userNode})},H=q=>{if(!(hc(q.nativeEvent)||p)){if(ec.includes(q.key)&&E){const X=q.key==="Escape";Zs({id:e,store:C,unselect:X,nodeRef:j})}else if(N&&g.selected&&Object.prototype.hasOwnProperty.call(tr,q.key)){q.preventDefault();const{ariaLabelConfig:X}=C.getState();C.setState({ariaLiveMessage:X["node.a11yDescription.ariaLiveMessage"]({direction:q.key.replace("Arrow","").toLowerCase(),x:~~w.positionAbsolute.x,y:~~w.positionAbsolute.y})}),T({direction:tr[q.key],factor:q.shiftKey?4:1})}}},W=()=>{var ne;if(p||!((ne=j.current)!=null&&ne.matches(":focus-visible")))return;const{transform:q,width:X,height:ee,autoPanOnNodeFocus:te,setCenter:Q}=C.getState();if(!te)return;wo(new Map([[e,g]]),{x:0,y:0,width:X,height:ee},q,!0).length>0||Q(g.position.x+B.width/2,g.position.y+B.height/2,{zoom:q[2]})};return l.jsx("div",{className:pe(["react-flow__node",`react-flow__node-${_}`,{[m]:N},g.className,{selected:g.selected,selectable:E,parent:S,draggable:N,dragging:P}]),ref:j,style:{zIndex:w.z,transform:`translate(${w.positionAbsolute.x}px,${w.positionAbsolute.y}px)`,pointerEvents:D?"all":"none",visibility:O?"visible":"hidden",...g.style,...R},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:F,onMouseMove:Y,onMouseLeave:G,onContextMenu:M,onClick:V,onDoubleClick:z,onKeyDown:I?H:void 0,tabIndex:I?0:void 0,onFocus:I?W:void 0,role:g.ariaRole??(I?"group":void 0),"aria-roledescription":"node","aria-describedby":p?void 0:`${Tc}-${b}`,"aria-label":g.ariaLabel,...g.domAttributes,children:l.jsx(ry,{value:e,children:l.jsx(k,{id:e,data:g.data,type:_,positionAbsoluteX:w.positionAbsolute.x,positionAbsoluteY:w.positionAbsolute.y,selected:g.selected??!1,selectable:E,draggable:N,deletable:g.deletable??!0,isConnectable:A,sourcePosition:g.sourcePosition,targetPosition:g.targetPosition,dragging:P,dragHandle:g.dragHandle,zIndex:w.z,parentId:g.parentId,...B})})})}var Ny=L.memo(vy);const jy=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Fc(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:r,onError:i}=se(jy,de),o=xy(e.onlyRenderVisibleElements),a=wy();return l.jsx("div",{className:"react-flow__nodes",style:br,children:o.map(c=>l.jsx(Ny,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:r,nodeClickDistance:e.nodeClickDistance,onError:i},c))})}Fc.displayName="NodeRenderer";const Ey=L.memo(Fc);function _y(e){return se(L.useCallback(n=>{if(!e)return n.edges.map(r=>r.id);const s=[];if(n.width&&n.height)for(const r of n.edges){const i=n.nodeLookup.get(r.source),o=n.nodeLookup.get(r.target);i&&o&&Sx({sourceNode:i,targetNode:o,width:n.width,height:n.height,transform:n.transform})&&s.push(r.id)}return s},[e]),de)}const Iy=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return l.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},Sy=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return l.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},Da={[Qn.Arrow]:Iy,[Qn.ArrowClosed]:Sy};function Cy(e){const t=ue();return L.useMemo(()=>{var r,i;return Object.prototype.hasOwnProperty.call(Da,e)?Da[e]:((i=(r=t.getState()).onError)==null||i.call(r,"009",Ye.error009(e)),null)},[e])}const ky=({id:e,type:t,color:n,width:s=12.5,height:r=12.5,markerUnits:i="strokeWidth",strokeWidth:o,orient:a="auto-start-reverse"})=>{const c=Cy(t);return c?l.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${s}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:a,refX:"0",refY:"0",children:l.jsx(c,{color:n,strokeWidth:o})}):null},Hc=({defaultColor:e,rfId:t})=>{const n=se(i=>i.edges),s=se(i=>i.defaultEdgeOptions),r=L.useMemo(()=>zx(n,{id:t,defaultColor:e,defaultMarkerStart:s==null?void 0:s.markerStart,defaultMarkerEnd:s==null?void 0:s.markerEnd}),[n,s,t,e]);return r.length?l.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:l.jsx("defs",{children:r.map(i=>l.jsx(ky,{id:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient},i.id))})}):null};Hc.displayName="MarkerDefinitions";var Ay=L.memo(Hc);function qc({x:e,y:t,label:n,labelStyle:s,labelShowBg:r=!0,labelBgStyle:i,labelBgPadding:o=[2,4],labelBgBorderRadius:a=2,children:c,className:u,...d}){const[f,h]=L.useState({x:1,y:0,width:0,height:0}),m=pe(["react-flow__edge-textwrapper",u]),p=L.useRef(null);return L.useEffect(()=>{if(p.current){const b=p.current.getBBox();h({x:b.x,y:b.y,width:b.width,height:b.height})}},[n]),n?l.jsxs("g",{transform:`translate(${e-f.width/2} ${t-f.height/2})`,className:m,visibility:f.width?"visible":"hidden",...d,children:[r&&l.jsx("rect",{width:f.width+2*o[0],x:-o[0],y:-o[1],height:f.height+2*o[1],className:"react-flow__edge-textbg",style:i,rx:a,ry:a}),l.jsx("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:p,style:s,children:n}),c]}):null}qc.displayName="EdgeText";const My=L.memo(qc);function vr({path:e,labelX:t,labelY:n,label:s,labelStyle:r,labelShowBg:i,labelBgStyle:o,labelBgPadding:a,labelBgBorderRadius:c,interactionWidth:u=20,...d}){return l.jsxs(l.Fragment,{children:[l.jsx("path",{...d,d:e,fill:"none",className:pe(["react-flow__edge-path",d.className])}),u?l.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:u,className:"react-flow__edge-interaction"}):null,s&&ze(t)&&ze(n)?l.jsx(My,{x:t,y:n,label:s,labelStyle:r,labelShowBg:i,labelBgStyle:o,labelBgPadding:a,labelBgBorderRadius:c}):null]})}function za({pos:e,x1:t,y1:n,x2:s,y2:r}){return e===U.Left||e===U.Right?[.5*(t+s),n]:[t,.5*(n+r)]}function Gc({sourceX:e,sourceY:t,sourcePosition:n=U.Bottom,targetX:s,targetY:r,targetPosition:i=U.Top}){const[o,a]=za({pos:n,x1:e,y1:t,x2:s,y2:r}),[c,u]=za({pos:i,x1:s,y1:r,x2:e,y2:t}),[d,f,h,m]=pc({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:o,sourceControlY:a,targetControlX:c,targetControlY:u});return[`M${e},${t} C${o},${a} ${c},${u} ${s},${r}`,d,f,h,m]}function Yc(e){return L.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:o,targetPosition:a,label:c,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:h,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:x,interactionWidth:y})=>{const[v,g,w]=Gc({sourceX:n,sourceY:s,sourcePosition:o,targetX:r,targetY:i,targetPosition:a}),S=e.isInternal?void 0:t;return l.jsx(vr,{id:S,path:v,labelX:g,labelY:w,label:c,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:h,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:x,interactionWidth:y})})}const Ty=Yc({isInternal:!1}),Wc=Yc({isInternal:!0});Ty.displayName="SimpleBezierEdge";Wc.displayName="SimpleBezierEdgeInternal";function Xc(e){return L.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:f,style:h,sourcePosition:m=U.Bottom,targetPosition:p=U.Top,markerEnd:b,markerStart:x,pathOptions:y,interactionWidth:v})=>{const[g,w,S]=Ys({sourceX:n,sourceY:s,sourcePosition:m,targetX:r,targetY:i,targetPosition:p,borderRadius:y==null?void 0:y.borderRadius,offset:y==null?void 0:y.offset,stepPosition:y==null?void 0:y.stepPosition}),_=e.isInternal?void 0:t;return l.jsx(vr,{id:_,path:g,labelX:w,labelY:S,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:f,style:h,markerEnd:b,markerStart:x,interactionWidth:v})})}const Uc=Xc({isInternal:!1}),Zc=Xc({isInternal:!0});Uc.displayName="SmoothStepEdge";Zc.displayName="SmoothStepEdgeInternal";function Kc(e){return L.memo(({id:t,...n})=>{var r;const s=e.isInternal?void 0:t;return l.jsx(Uc,{...n,id:s,pathOptions:L.useMemo(()=>{var i;return{borderRadius:0,offset:(i=n.pathOptions)==null?void 0:i.offset}},[(r=n.pathOptions)==null?void 0:r.offset])})})}const Py=Kc({isInternal:!1}),Qc=Kc({isInternal:!0});Py.displayName="StepEdge";Qc.displayName="StepEdgeInternal";function Jc(e){return L.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:f,style:h,markerEnd:m,markerStart:p,interactionWidth:b})=>{const[x,y,v]=yc({sourceX:n,sourceY:s,targetX:r,targetY:i}),g=e.isInternal?void 0:t;return l.jsx(vr,{id:g,path:x,labelX:y,labelY:v,label:o,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:d,labelBgBorderRadius:f,style:h,markerEnd:m,markerStart:p,interactionWidth:b})})}const Dy=Jc({isInternal:!1}),eu=Jc({isInternal:!0});Dy.displayName="StraightEdge";eu.displayName="StraightEdgeInternal";function tu(e){return L.memo(({id:t,sourceX:n,sourceY:s,targetX:r,targetY:i,sourcePosition:o=U.Bottom,targetPosition:a=U.Top,label:c,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:h,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:x,pathOptions:y,interactionWidth:v})=>{const[g,w,S]=gc({sourceX:n,sourceY:s,sourcePosition:o,targetX:r,targetY:i,targetPosition:a,curvature:y==null?void 0:y.curvature}),_=e.isInternal?void 0:t;return l.jsx(vr,{id:_,path:g,labelX:w,labelY:S,label:c,labelStyle:u,labelShowBg:d,labelBgStyle:f,labelBgPadding:h,labelBgBorderRadius:m,style:p,markerEnd:b,markerStart:x,interactionWidth:v})})}const zy=tu({isInternal:!1}),nu=tu({isInternal:!0});zy.displayName="BezierEdge";nu.displayName="BezierEdgeInternal";const Ra={default:nu,straight:eu,step:Qc,smoothstep:Zc,simplebezier:Wc},La={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},Ry=(e,t,n)=>n===U.Left?e-t:n===U.Right?e+t:e,Ly=(e,t,n)=>n===U.Top?e-t:n===U.Bottom?e+t:e,$a="react-flow__edgeupdater";function Oa({position:e,centerX:t,centerY:n,radius:s=10,onMouseDown:r,onMouseEnter:i,onMouseOut:o,type:a}){return l.jsx("circle",{onMouseDown:r,onMouseEnter:i,onMouseOut:o,className:pe([$a,`${$a}-${a}`]),cx:Ry(t,s,e),cy:Ly(n,s,e),r:s,stroke:"transparent",fill:"transparent"})}function $y({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:s,sourceY:r,targetX:i,targetY:o,sourcePosition:a,targetPosition:c,onReconnect:u,onReconnectStart:d,onReconnectEnd:f,setReconnecting:h,setUpdateHover:m}){const p=ue(),b=(w,S)=>{if(w.button!==0)return;const{autoPanOnConnect:_,domNode:k,isValidConnection:N,connectionMode:E,connectionRadius:A,lib:I,onConnectStart:C,onConnectEnd:O,cancelConnection:j,nodeLookup:P,rfId:T,panBy:B,updateConnection:R}=p.getState(),D=S.type==="target",F=(M,z)=>{h(!1),f==null||f(M,n,S.type,z)},Y=M=>u==null?void 0:u(n,M),G=(M,z)=>{h(!0),d==null||d(w,n,S.type),C==null||C(M,z)};Us.onPointerDown(w.nativeEvent,{autoPanOnConnect:_,connectionMode:E,connectionRadius:A,domNode:k,handleId:S.id,nodeId:S.nodeId,nodeLookup:P,isTarget:D,edgeUpdaterType:S.type,lib:I,flowId:T,cancelConnection:j,panBy:B,isValidConnection:N,onConnect:Y,onConnectStart:G,onConnectEnd:O,onReconnectEnd:F,updateConnection:R,getTransform:()=>p.getState().transform,getFromHandle:()=>p.getState().connection.fromHandle,dragThreshold:p.getState().connectionDragThreshold,handleDomNode:w.currentTarget})},x=w=>b(w,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),y=w=>b(w,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),v=()=>m(!0),g=()=>m(!1);return l.jsxs(l.Fragment,{children:[(e===!0||e==="source")&&l.jsx(Oa,{position:a,centerX:s,centerY:r,radius:t,onMouseDown:x,onMouseEnter:v,onMouseOut:g,type:"source"}),(e===!0||e==="target")&&l.jsx(Oa,{position:c,centerX:i,centerY:o,radius:t,onMouseDown:y,onMouseEnter:v,onMouseOut:g,type:"target"})]})}function Oy({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:s,onClick:r,onDoubleClick:i,onContextMenu:o,onMouseEnter:a,onMouseMove:c,onMouseLeave:u,reconnectRadius:d,onReconnect:f,onReconnectStart:h,onReconnectEnd:m,rfId:p,edgeTypes:b,noPanClassName:x,onError:y,disableKeyboardA11y:v}){let g=se(Q=>Q.edgeLookup.get(e));const w=se(Q=>Q.defaultEdgeOptions);g=w?{...w,...g}:g;let S=g.type||"default",_=(b==null?void 0:b[S])||Ra[S];_===void 0&&(y==null||y("011",Ye.error011(S)),S="default",_=(b==null?void 0:b.default)||Ra.default);const k=!!(g.focusable||t&&typeof g.focusable>"u"),N=typeof f<"u"&&(g.reconnectable||n&&typeof g.reconnectable>"u"),E=!!(g.selectable||s&&typeof g.selectable>"u"),A=L.useRef(null),[I,C]=L.useState(!1),[O,j]=L.useState(!1),P=ue(),{zIndex:T,sourceX:B,sourceY:R,targetX:D,targetY:F,sourcePosition:Y,targetPosition:G}=se(L.useCallback(Q=>{const Z=Q.nodeLookup.get(g.source),ne=Q.nodeLookup.get(g.target);if(!Z||!ne)return{zIndex:g.zIndex,...La};const oe=Dx({id:e,sourceNode:Z,targetNode:ne,sourceHandle:g.sourceHandle||null,targetHandle:g.targetHandle||null,connectionMode:Q.connectionMode,onError:y});return{zIndex:Ix({selected:g.selected,zIndex:g.zIndex,sourceNode:Z,targetNode:ne,elevateOnSelect:Q.elevateEdgesOnSelect,zIndexMode:Q.zIndexMode}),...oe||La}},[g.source,g.target,g.sourceHandle,g.targetHandle,g.selected,g.zIndex]),de),M=L.useMemo(()=>g.markerStart?`url('#${Ws(g.markerStart,p)}')`:void 0,[g.markerStart,p]),z=L.useMemo(()=>g.markerEnd?`url('#${Ws(g.markerEnd,p)}')`:void 0,[g.markerEnd,p]);if(g.hidden||B===null||R===null||D===null||F===null)return null;const V=Q=>{var re;const{addSelectedEdges:Z,unselectNodesAndEdges:ne,multiSelectionActive:oe}=P.getState();E&&(P.setState({nodesSelectionActive:!1}),g.selected&&oe?(ne({nodes:[],edges:[g]}),(re=A.current)==null||re.blur()):Z([e])),r&&r(Q,g)},H=i?Q=>{i(Q,{...g})}:void 0,W=o?Q=>{o(Q,{...g})}:void 0,q=a?Q=>{a(Q,{...g})}:void 0,X=c?Q=>{c(Q,{...g})}:void 0,ee=u?Q=>{u(Q,{...g})}:void 0,te=Q=>{var Z;if(!v&&ec.includes(Q.key)&&E){const{unselectNodesAndEdges:ne,addSelectedEdges:oe}=P.getState();Q.key==="Escape"?((Z=A.current)==null||Z.blur(),ne({edges:[g]})):oe([e])}};return l.jsx("svg",{style:{zIndex:T},children:l.jsxs("g",{className:pe(["react-flow__edge",`react-flow__edge-${S}`,g.className,x,{selected:g.selected,animated:g.animated,inactive:!E&&!r,updating:I,selectable:E}]),onClick:V,onDoubleClick:H,onContextMenu:W,onMouseEnter:q,onMouseMove:X,onMouseLeave:ee,onKeyDown:k?te:void 0,tabIndex:k?0:void 0,role:g.ariaRole??(k?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":g.ariaLabel===null?void 0:g.ariaLabel||`Edge from ${g.source} to ${g.target}`,"aria-describedby":k?`${Pc}-${p}`:void 0,ref:A,...g.domAttributes,children:[!O&&l.jsx(_,{id:e,source:g.source,target:g.target,type:g.type,selected:g.selected,animated:g.animated,selectable:E,deletable:g.deletable??!0,label:g.label,labelStyle:g.labelStyle,labelShowBg:g.labelShowBg,labelBgStyle:g.labelBgStyle,labelBgPadding:g.labelBgPadding,labelBgBorderRadius:g.labelBgBorderRadius,sourceX:B,sourceY:R,targetX:D,targetY:F,sourcePosition:Y,targetPosition:G,data:g.data,style:g.style,sourceHandleId:g.sourceHandle,targetHandleId:g.targetHandle,markerStart:M,markerEnd:z,pathOptions:"pathOptions"in g?g.pathOptions:void 0,interactionWidth:g.interactionWidth}),N&&l.jsx($y,{edge:g,isReconnectable:N,reconnectRadius:d,onReconnect:f,onReconnectStart:h,onReconnectEnd:m,sourceX:B,sourceY:R,targetX:D,targetY:F,sourcePosition:Y,targetPosition:G,setUpdateHover:C,setReconnecting:j})]})})}var By=L.memo(Oy);const Vy=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function ru({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:s,noPanClassName:r,onReconnect:i,onEdgeContextMenu:o,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:u,onEdgeClick:d,reconnectRadius:f,onEdgeDoubleClick:h,onReconnectStart:m,onReconnectEnd:p,disableKeyboardA11y:b}){const{edgesFocusable:x,edgesReconnectable:y,elementsSelectable:v,onError:g}=se(Vy,de),w=_y(t);return l.jsxs("div",{className:"react-flow__edges",children:[l.jsx(Ay,{defaultColor:e,rfId:n}),w.map(S=>l.jsx(By,{id:S,edgesFocusable:x,edgesReconnectable:y,elementsSelectable:v,noPanClassName:r,onReconnect:i,onContextMenu:o,onMouseEnter:a,onMouseMove:c,onMouseLeave:u,onClick:d,reconnectRadius:f,onDoubleClick:h,onReconnectStart:m,onReconnectEnd:p,rfId:n,onError:g,edgeTypes:s,disableKeyboardA11y:b},S))]})}ru.displayName="EdgeRenderer";const Fy=L.memo(ru),Hy=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function qy({children:e}){const t=se(Hy);return l.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function Gy(e){const t=wr(),n=L.useRef(!1);L.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const Yy=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function Wy(e){const t=se(Yy),n=ue();return L.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function Xy(e){return e.connection.inProgress?{...e.connection,to:mn(e.connection.to,e.transform)}:{...e.connection}}function Uy(e){return Xy}function Zy(e){const t=Uy();return se(t,de)}const Ky=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Qy({containerStyle:e,style:t,type:n,component:s}){const{nodesConnectable:r,width:i,height:o,isValid:a,inProgress:c}=se(Ky,de);return!(i&&r&&c)?null:l.jsx("svg",{style:e,width:i,height:o,className:"react-flow__connectionline react-flow__container",children:l.jsx("g",{className:pe(["react-flow__connection",rc(a)]),children:l.jsx(su,{style:t,type:n,CustomComponent:s,isValid:a})})})}const su=({style:e,type:t=Ke.Bezier,CustomComponent:n,isValid:s})=>{const{inProgress:r,from:i,fromNode:o,fromHandle:a,fromPosition:c,to:u,toNode:d,toHandle:f,toPosition:h,pointer:m}=Zy();if(!r)return;if(n)return l.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:o,fromHandle:a,fromX:i.x,fromY:i.y,toX:u.x,toY:u.y,fromPosition:c,toPosition:h,connectionStatus:rc(s),toNode:d,toHandle:f,pointer:m});let p="";const b={sourceX:i.x,sourceY:i.y,sourcePosition:c,targetX:u.x,targetY:u.y,targetPosition:h};switch(t){case Ke.Bezier:[p]=gc(b);break;case Ke.SimpleBezier:[p]=Gc(b);break;case Ke.Step:[p]=Ys({...b,borderRadius:0});break;case Ke.SmoothStep:[p]=Ys(b);break;default:[p]=yc(b)}return l.jsx("path",{d:p,fill:"none",className:"react-flow__connection-path",style:e})};su.displayName="ConnectionLine";const Jy={};function Ba(e=Jy){L.useRef(e),ue(),L.useEffect(()=>{},[e])}function ew(){ue(),L.useRef(!1),L.useEffect(()=>{},[])}function ou({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:s,onEdgeClick:r,onNodeDoubleClick:i,onEdgeDoubleClick:o,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:u,onNodeContextMenu:d,onSelectionContextMenu:f,onSelectionStart:h,onSelectionEnd:m,connectionLineType:p,connectionLineStyle:b,connectionLineComponent:x,connectionLineContainerStyle:y,selectionKeyCode:v,selectionOnDrag:g,selectionMode:w,multiSelectionKeyCode:S,panActivationKeyCode:_,zoomActivationKeyCode:k,deleteKeyCode:N,onlyRenderVisibleElements:E,elementsSelectable:A,defaultViewport:I,translateExtent:C,minZoom:O,maxZoom:j,preventScrolling:P,defaultMarkerColor:T,zoomOnScroll:B,zoomOnPinch:R,panOnScroll:D,panOnScrollSpeed:F,panOnScrollMode:Y,zoomOnDoubleClick:G,panOnDrag:M,onPaneClick:z,onPaneMouseEnter:V,onPaneMouseMove:H,onPaneMouseLeave:W,onPaneScroll:q,onPaneContextMenu:X,paneClickDistance:ee,nodeClickDistance:te,onEdgeContextMenu:Q,onEdgeMouseEnter:Z,onEdgeMouseMove:ne,onEdgeMouseLeave:oe,reconnectRadius:re,onReconnect:we,onReconnectStart:nt,onReconnectEnd:Ue,noDragClassName:dt,noWheelClassName:$t,noPanClassName:Ot,disableKeyboardA11y:Bt,nodeExtent:Sr,rfId:gn,viewport:vt,onViewportChange:Vt}){return Ba(e),Ba(t),ew(),Gy(n),Wy(vt),l.jsx(py,{onPaneClick:z,onPaneMouseEnter:V,onPaneMouseMove:H,onPaneMouseLeave:W,onPaneContextMenu:X,onPaneScroll:q,paneClickDistance:ee,deleteKeyCode:N,selectionKeyCode:v,selectionOnDrag:g,selectionMode:w,onSelectionStart:h,onSelectionEnd:m,multiSelectionKeyCode:S,panActivationKeyCode:_,zoomActivationKeyCode:k,elementsSelectable:A,zoomOnScroll:B,zoomOnPinch:R,zoomOnDoubleClick:G,panOnScroll:D,panOnScrollSpeed:F,panOnScrollMode:Y,panOnDrag:M,defaultViewport:I,translateExtent:C,minZoom:O,maxZoom:j,onSelectionContextMenu:f,preventScrolling:P,noDragClassName:dt,noWheelClassName:$t,noPanClassName:Ot,disableKeyboardA11y:Bt,onViewportChange:Vt,isControlledViewport:!!vt,children:l.jsxs(qy,{children:[l.jsx(Fy,{edgeTypes:t,onEdgeClick:r,onEdgeDoubleClick:o,onReconnect:we,onReconnectStart:nt,onReconnectEnd:Ue,onlyRenderVisibleElements:E,onEdgeContextMenu:Q,onEdgeMouseEnter:Z,onEdgeMouseMove:ne,onEdgeMouseLeave:oe,reconnectRadius:re,defaultMarkerColor:T,noPanClassName:Ot,disableKeyboardA11y:Bt,rfId:gn}),l.jsx(Qy,{style:b,type:p,component:x,containerStyle:y}),l.jsx("div",{className:"react-flow__edgelabel-renderer"}),l.jsx(Ey,{nodeTypes:e,onNodeClick:s,onNodeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:u,onNodeContextMenu:d,nodeClickDistance:te,onlyRenderVisibleElements:E,noPanClassName:Ot,noDragClassName:dt,disableKeyboardA11y:Bt,nodeExtent:Sr,rfId:gn}),l.jsx("div",{className:"react-flow__viewport-portal"})]})})}ou.displayName="GraphView";const tw=L.memo(ou),Va=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:o,fitViewOptions:a,minZoom:c=.5,maxZoom:u=2,nodeOrigin:d,nodeExtent:f,zIndexMode:h="basic"}={})=>{const m=new Map,p=new Map,b=new Map,x=new Map,y=s??t??[],v=n??e??[],g=d??[0,0],w=f??en;vc(b,x,y);const S=Xs(v,m,p,{nodeOrigin:g,nodeExtent:w,zIndexMode:h});let _=[0,0,1];if(o&&r&&i){const k=fn(m,{filter:I=>!!((I.width||I.initialWidth)&&(I.height||I.initialHeight))}),{x:N,y:E,zoom:A}=pr(k,r,i,c,u,(a==null?void 0:a.padding)??.1);_=[N,E,A]}return{rfId:"1",width:r??0,height:i??0,transform:_,nodes:v,nodesInitialized:S,nodeLookup:m,parentLookup:p,edges:y,edgeLookup:x,connectionLookup:b,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:s!==void 0,panZoom:null,minZoom:c,maxZoom:u,translateExtent:en,nodeExtent:w,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Mt.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:g,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:o??!1,fitViewOptions:a,fitViewResolver:null,connection:{...nc},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:bx,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:tc,zIndexMode:h,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},nw=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:o,fitViewOptions:a,minZoom:c,maxZoom:u,nodeOrigin:d,nodeExtent:f,zIndexMode:h})=>y0((m,p)=>{async function b(){const{nodeLookup:x,panZoom:y,fitViewOptions:v,fitViewResolver:g,width:w,height:S,minZoom:_,maxZoom:k}=p();y&&(await yx({nodes:x,width:w,height:S,panZoom:y,minZoom:_,maxZoom:k},v),g==null||g.resolve(!0),m({fitViewResolver:null}))}return{...Va({nodes:e,edges:t,width:r,height:i,fitView:o,fitViewOptions:a,minZoom:c,maxZoom:u,nodeOrigin:d,nodeExtent:f,defaultNodes:n,defaultEdges:s,zIndexMode:h}),setNodes:x=>{const{nodeLookup:y,parentLookup:v,nodeOrigin:g,elevateNodesOnSelect:w,fitViewQueued:S,zIndexMode:_}=p(),k=Xs(x,y,v,{nodeOrigin:g,nodeExtent:f,elevateNodesOnSelect:w,checkEquality:!0,zIndexMode:_});S&&k?(b(),m({nodes:x,nodesInitialized:k,fitViewQueued:!1,fitViewOptions:void 0})):m({nodes:x,nodesInitialized:k})},setEdges:x=>{const{connectionLookup:y,edgeLookup:v}=p();vc(y,v,x),m({edges:x})},setDefaultNodesAndEdges:(x,y)=>{if(x){const{setNodes:v}=p();v(x),m({hasDefaultNodes:!0})}if(y){const{setEdges:v}=p();v(y),m({hasDefaultEdges:!0})}},updateNodeInternals:x=>{const{triggerNodeChanges:y,nodeLookup:v,parentLookup:g,domNode:w,nodeOrigin:S,nodeExtent:_,debug:k,fitViewQueued:N,zIndexMode:E}=p(),{changes:A,updatedInternals:I}=Fx(x,v,g,w,S,_,E);I&&($x(v,g,{nodeOrigin:S,nodeExtent:_,zIndexMode:E}),N?(b(),m({fitViewQueued:!1,fitViewOptions:void 0})):m({}),(A==null?void 0:A.length)>0&&(k&&console.log("React Flow: trigger node changes",A),y==null||y(A)))},updateNodePositions:(x,y=!1)=>{const v=[];let g=[];const{nodeLookup:w,triggerNodeChanges:S,connection:_,updateConnection:k,onNodesChangeMiddlewareMap:N}=p();for(const[E,A]of x){const I=w.get(E),C=!!(I!=null&&I.expandParent&&(I!=null&&I.parentId)&&(A!=null&&A.position)),O={id:E,type:"position",position:C?{x:Math.max(0,A.position.x),y:Math.max(0,A.position.y)}:A.position,dragging:y};if(I&&_.inProgress&&_.fromNode.id===I.id){const j=bt(I,_.fromHandle,U.Left,!0);k({..._,from:j})}C&&I.parentId&&v.push({id:E,parentId:I.parentId,rect:{...A.internals.positionAbsolute,width:A.measured.width??0,height:A.measured.height??0}}),g.push(O)}if(v.length>0){const{parentLookup:E,nodeOrigin:A}=p(),I=_o(v,w,E,A);g.push(...I)}for(const E of N.values())g=E(g);S(g)},triggerNodeChanges:x=>{const{onNodesChange:y,setNodes:v,nodes:g,hasDefaultNodes:w,debug:S}=p();if(x!=null&&x.length){if(w){const _=O0(x,g);v(_)}S&&console.log("React Flow: trigger node changes",x),y==null||y(x)}},triggerEdgeChanges:x=>{const{onEdgesChange:y,setEdges:v,edges:g,hasDefaultEdges:w,debug:S}=p();if(x!=null&&x.length){if(w){const _=B0(x,g);v(_)}S&&console.log("React Flow: trigger edge changes",x),y==null||y(x)}},addSelectedNodes:x=>{const{multiSelectionActive:y,edgeLookup:v,nodeLookup:g,triggerNodeChanges:w,triggerEdgeChanges:S}=p();if(y){const _=x.map(k=>ft(k,!0));w(_);return}w(_t(g,new Set([...x]),!0)),S(_t(v))},addSelectedEdges:x=>{const{multiSelectionActive:y,edgeLookup:v,nodeLookup:g,triggerNodeChanges:w,triggerEdgeChanges:S}=p();if(y){const _=x.map(k=>ft(k,!0));S(_);return}S(_t(v,new Set([...x]))),w(_t(g,new Set,!0))},unselectNodesAndEdges:({nodes:x,edges:y}={})=>{const{edges:v,nodes:g,nodeLookup:w,triggerNodeChanges:S,triggerEdgeChanges:_}=p(),k=x||g,N=y||v,E=k.map(I=>{const C=w.get(I.id);return C&&(C.selected=!1),ft(I.id,!1)}),A=N.map(I=>ft(I.id,!1));S(E),_(A)},setMinZoom:x=>{const{panZoom:y,maxZoom:v}=p();y==null||y.setScaleExtent([x,v]),m({minZoom:x})},setMaxZoom:x=>{const{panZoom:y,minZoom:v}=p();y==null||y.setScaleExtent([v,x]),m({maxZoom:x})},setTranslateExtent:x=>{var y;(y=p().panZoom)==null||y.setTranslateExtent(x),m({translateExtent:x})},resetSelectedElements:()=>{const{edges:x,nodes:y,triggerNodeChanges:v,triggerEdgeChanges:g,elementsSelectable:w}=p();if(!w)return;const S=y.reduce((k,N)=>N.selected?[...k,ft(N.id,!1)]:k,[]),_=x.reduce((k,N)=>N.selected?[...k,ft(N.id,!1)]:k,[]);v(S),g(_)},setNodeExtent:x=>{const{nodes:y,nodeLookup:v,parentLookup:g,nodeOrigin:w,elevateNodesOnSelect:S,nodeExtent:_,zIndexMode:k}=p();x[0][0]===_[0][0]&&x[0][1]===_[0][1]&&x[1][0]===_[1][0]&&x[1][1]===_[1][1]||(Xs(y,v,g,{nodeOrigin:w,nodeExtent:x,elevateNodesOnSelect:S,checkEquality:!1,zIndexMode:k}),m({nodeExtent:x}))},panBy:x=>{const{transform:y,width:v,height:g,panZoom:w,translateExtent:S}=p();return Hx({delta:x,panZoom:w,transform:y,translateExtent:S,width:v,height:g})},setCenter:async(x,y,v)=>{const{width:g,height:w,maxZoom:S,panZoom:_}=p();if(!_)return Promise.resolve(!1);const k=typeof(v==null?void 0:v.zoom)<"u"?v.zoom:S;return await _.setViewport({x:g/2-x*k,y:w/2-y*k,zoom:k},{duration:v==null?void 0:v.duration,ease:v==null?void 0:v.ease,interpolate:v==null?void 0:v.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{m({connection:{...nc}})},updateConnection:x=>{m({connection:x})},reset:()=>m({...Va()})}},Object.is);function iu({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:s,initialWidth:r,initialHeight:i,initialMinZoom:o,initialMaxZoom:a,initialFitViewOptions:c,fitView:u,nodeOrigin:d,nodeExtent:f,zIndexMode:h,children:m}){const[p]=L.useState(()=>nw({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,width:r,height:i,fitView:u,minZoom:o,maxZoom:a,fitViewOptions:c,nodeOrigin:d,nodeExtent:f,zIndexMode:h}));return l.jsx(w0,{value:p,children:l.jsx(q0,{children:m})})}function rw({children:e,nodes:t,edges:n,defaultNodes:s,defaultEdges:r,width:i,height:o,fitView:a,fitViewOptions:c,minZoom:u,maxZoom:d,nodeOrigin:f,nodeExtent:h,zIndexMode:m}){return L.useContext(xr)?l.jsx(l.Fragment,{children:e}):l.jsx(iu,{initialNodes:t,initialEdges:n,defaultNodes:s,defaultEdges:r,initialWidth:i,initialHeight:o,fitView:a,initialFitViewOptions:c,initialMinZoom:u,initialMaxZoom:d,nodeOrigin:f,nodeExtent:h,zIndexMode:m,children:e})}const sw={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function ow({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,className:r,nodeTypes:i,edgeTypes:o,onNodeClick:a,onEdgeClick:c,onInit:u,onMove:d,onMoveStart:f,onMoveEnd:h,onConnect:m,onConnectStart:p,onConnectEnd:b,onClickConnectStart:x,onClickConnectEnd:y,onNodeMouseEnter:v,onNodeMouseMove:g,onNodeMouseLeave:w,onNodeContextMenu:S,onNodeDoubleClick:_,onNodeDragStart:k,onNodeDrag:N,onNodeDragStop:E,onNodesDelete:A,onEdgesDelete:I,onDelete:C,onSelectionChange:O,onSelectionDragStart:j,onSelectionDrag:P,onSelectionDragStop:T,onSelectionContextMenu:B,onSelectionStart:R,onSelectionEnd:D,onBeforeDelete:F,connectionMode:Y,connectionLineType:G=Ke.Bezier,connectionLineStyle:M,connectionLineComponent:z,connectionLineContainerStyle:V,deleteKeyCode:H="Backspace",selectionKeyCode:W="Shift",selectionOnDrag:q=!1,selectionMode:X=tn.Full,panActivationKeyCode:ee="Space",multiSelectionKeyCode:te=rn()?"Meta":"Control",zoomActivationKeyCode:Q=rn()?"Meta":"Control",snapToGrid:Z,snapGrid:ne,onlyRenderVisibleElements:oe=!1,selectNodesOnDrag:re,nodesDraggable:we,autoPanOnNodeFocus:nt,nodesConnectable:Ue,nodesFocusable:dt,nodeOrigin:$t=Dc,edgesFocusable:Ot,edgesReconnectable:Bt,elementsSelectable:Sr=!0,defaultViewport:gn=T0,minZoom:vt=.5,maxZoom:Vt=2,translateExtent:To=en,preventScrolling:Cu=!0,nodeExtent:Cr,defaultMarkerColor:ku="#b1b1b7",zoomOnScroll:Au=!0,zoomOnPinch:Mu=!0,panOnScroll:Tu=!1,panOnScrollSpeed:Pu=.5,panOnScrollMode:Du=gt.Free,zoomOnDoubleClick:zu=!0,panOnDrag:Ru=!0,onPaneClick:Lu,onPaneMouseEnter:$u,onPaneMouseMove:Ou,onPaneMouseLeave:Bu,onPaneScroll:Vu,onPaneContextMenu:Fu,paneClickDistance:Hu=1,nodeClickDistance:qu=0,children:Gu,onReconnect:Yu,onReconnectStart:Wu,onReconnectEnd:Xu,onEdgeContextMenu:Uu,onEdgeDoubleClick:Zu,onEdgeMouseEnter:Ku,onEdgeMouseMove:Qu,onEdgeMouseLeave:Ju,reconnectRadius:ed=10,onNodesChange:td,onEdgesChange:nd,noDragClassName:rd="nodrag",noWheelClassName:sd="nowheel",noPanClassName:Po="nopan",fitView:Do,fitViewOptions:zo,connectOnClick:od,attributionPosition:id,proOptions:ad,defaultEdgeOptions:ld,elevateNodesOnSelect:cd=!0,elevateEdgesOnSelect:ud=!1,disableKeyboardA11y:Ro=!1,autoPanOnConnect:dd,autoPanOnNodeDrag:fd,autoPanSpeed:hd,connectionRadius:md,isValidConnection:pd,onError:gd,style:xd,id:Lo,nodeDragThreshold:yd,connectionDragThreshold:wd,viewport:bd,onViewportChange:vd,width:Nd,height:jd,colorMode:Ed="light",debug:_d,onScroll:xn,ariaLabelConfig:Id,zIndexMode:$o="basic",...Sd},Cd){const kr=Lo||"1",kd=R0(Ed),Ad=L.useCallback(Oo=>{Oo.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),xn==null||xn(Oo)},[xn]);return l.jsx("div",{"data-testid":"rf__wrapper",...Sd,onScroll:Ad,style:{...xd,...sw},ref:Cd,className:pe(["react-flow",r,kd]),id:Lo,role:"application",children:l.jsxs(rw,{nodes:e,edges:t,width:Nd,height:jd,fitView:Do,fitViewOptions:zo,minZoom:vt,maxZoom:Vt,nodeOrigin:$t,nodeExtent:Cr,zIndexMode:$o,children:[l.jsx(tw,{onInit:u,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:v,onNodeMouseMove:g,onNodeMouseLeave:w,onNodeContextMenu:S,onNodeDoubleClick:_,nodeTypes:i,edgeTypes:o,connectionLineType:G,connectionLineStyle:M,connectionLineComponent:z,connectionLineContainerStyle:V,selectionKeyCode:W,selectionOnDrag:q,selectionMode:X,deleteKeyCode:H,multiSelectionKeyCode:te,panActivationKeyCode:ee,zoomActivationKeyCode:Q,onlyRenderVisibleElements:oe,defaultViewport:gn,translateExtent:To,minZoom:vt,maxZoom:Vt,preventScrolling:Cu,zoomOnScroll:Au,zoomOnPinch:Mu,zoomOnDoubleClick:zu,panOnScroll:Tu,panOnScrollSpeed:Pu,panOnScrollMode:Du,panOnDrag:Ru,onPaneClick:Lu,onPaneMouseEnter:$u,onPaneMouseMove:Ou,onPaneMouseLeave:Bu,onPaneScroll:Vu,onPaneContextMenu:Fu,paneClickDistance:Hu,nodeClickDistance:qu,onSelectionContextMenu:B,onSelectionStart:R,onSelectionEnd:D,onReconnect:Yu,onReconnectStart:Wu,onReconnectEnd:Xu,onEdgeContextMenu:Uu,onEdgeDoubleClick:Zu,onEdgeMouseEnter:Ku,onEdgeMouseMove:Qu,onEdgeMouseLeave:Ju,reconnectRadius:ed,defaultMarkerColor:ku,noDragClassName:rd,noWheelClassName:sd,noPanClassName:Po,rfId:kr,disableKeyboardA11y:Ro,nodeExtent:Cr,viewport:bd,onViewportChange:vd}),l.jsx(z0,{nodes:e,edges:t,defaultNodes:n,defaultEdges:s,onConnect:m,onConnectStart:p,onConnectEnd:b,onClickConnectStart:x,onClickConnectEnd:y,nodesDraggable:we,autoPanOnNodeFocus:nt,nodesConnectable:Ue,nodesFocusable:dt,edgesFocusable:Ot,edgesReconnectable:Bt,elementsSelectable:Sr,elevateNodesOnSelect:cd,elevateEdgesOnSelect:ud,minZoom:vt,maxZoom:Vt,nodeExtent:Cr,onNodesChange:td,onEdgesChange:nd,snapToGrid:Z,snapGrid:ne,connectionMode:Y,translateExtent:To,connectOnClick:od,defaultEdgeOptions:ld,fitView:Do,fitViewOptions:zo,onNodesDelete:A,onEdgesDelete:I,onDelete:C,onNodeDragStart:k,onNodeDrag:N,onNodeDragStop:E,onSelectionDrag:P,onSelectionDragStart:j,onSelectionDragStop:T,onMove:d,onMoveStart:f,onMoveEnd:h,noPanClassName:Po,nodeOrigin:$t,rfId:kr,autoPanOnConnect:dd,autoPanOnNodeDrag:fd,autoPanSpeed:hd,onError:gd,connectionRadius:md,isValidConnection:pd,selectNodesOnDrag:re,nodeDragThreshold:yd,connectionDragThreshold:wd,onBeforeDelete:F,debug:_d,ariaLabelConfig:Id,zIndexMode:$o}),l.jsx(M0,{onSelectionChange:O}),Gu,l.jsx(I0,{proOptions:ad,position:id}),l.jsx(_0,{rfId:kr,disableKeyboardA11y:Ro})]})})}var iw=Rc(ow);function aw({dimensions:e,lineWidth:t,variant:n,className:s}){return l.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:pe(["react-flow__background-pattern",n,s])})}function lw({radius:e,className:t}){return l.jsx("circle",{cx:e,cy:e,r:e,className:pe(["react-flow__background-pattern","dots",t])})}var at;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(at||(at={}));const cw={[at.Dots]:1,[at.Lines]:1,[at.Cross]:6},uw=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function au({id:e,variant:t=at.Dots,gap:n=20,size:s,lineWidth:r=1,offset:i=0,color:o,bgColor:a,style:c,className:u,patternClassName:d}){const f=L.useRef(null),{transform:h,patternId:m}=se(uw,de),p=s||cw[t],b=t===at.Dots,x=t===at.Cross,y=Array.isArray(n)?n:[n,n],v=[y[0]*h[2]||1,y[1]*h[2]||1],g=p*h[2],w=Array.isArray(i)?i:[i,i],S=x?[g,g]:v,_=[w[0]*h[2]||1+S[0]/2,w[1]*h[2]||1+S[1]/2],k=`${m}${e||""}`;return l.jsxs("svg",{className:pe(["react-flow__background",u]),style:{...c,...br,"--xy-background-color-props":a,"--xy-background-pattern-color-props":o},ref:f,"data-testid":"rf__background",children:[l.jsx("pattern",{id:k,x:h[0]%v[0],y:h[1]%v[1],width:v[0],height:v[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${_[0]},-${_[1]})`,children:b?l.jsx(lw,{radius:g/2,className:d}):l.jsx(aw,{dimensions:S,lineWidth:r,variant:t,className:d})}),l.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${k})`})]})}au.displayName="Background";const dw=L.memo(au);function fw(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:l.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function hw(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:l.jsx("path",{d:"M0 0h32v4.2H0z"})})}function mw(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:l.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function pw(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:l.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function gw(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:l.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Cn({children:e,className:t,...n}){return l.jsx("button",{type:"button",className:pe(["react-flow__controls-button",t]),...n,children:e})}const xw=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function lu({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:s=!0,fitViewOptions:r,onZoomIn:i,onZoomOut:o,onFitView:a,onInteractiveChange:c,className:u,children:d,position:f="bottom-left",orientation:h="vertical","aria-label":m}){const p=ue(),{isInteractive:b,minZoomReached:x,maxZoomReached:y,ariaLabelConfig:v}=se(xw,de),{zoomIn:g,zoomOut:w,fitView:S}=wr(),_=()=>{g(),i==null||i()},k=()=>{w(),o==null||o()},N=()=>{S(r),a==null||a()},E=()=>{p.setState({nodesDraggable:!b,nodesConnectable:!b,elementsSelectable:!b}),c==null||c(!b)},A=h==="horizontal"?"horizontal":"vertical";return l.jsxs(yr,{className:pe(["react-flow__controls",A,u]),position:f,style:e,"data-testid":"rf__controls","aria-label":m??v["controls.ariaLabel"],children:[t&&l.jsxs(l.Fragment,{children:[l.jsx(Cn,{onClick:_,className:"react-flow__controls-zoomin",title:v["controls.zoomIn.ariaLabel"],"aria-label":v["controls.zoomIn.ariaLabel"],disabled:y,children:l.jsx(fw,{})}),l.jsx(Cn,{onClick:k,className:"react-flow__controls-zoomout",title:v["controls.zoomOut.ariaLabel"],"aria-label":v["controls.zoomOut.ariaLabel"],disabled:x,children:l.jsx(hw,{})})]}),n&&l.jsx(Cn,{className:"react-flow__controls-fitview",onClick:N,title:v["controls.fitView.ariaLabel"],"aria-label":v["controls.fitView.ariaLabel"],children:l.jsx(mw,{})}),s&&l.jsx(Cn,{className:"react-flow__controls-interactive",onClick:E,title:v["controls.interactive.ariaLabel"],"aria-label":v["controls.interactive.ariaLabel"],children:b?l.jsx(gw,{}):l.jsx(pw,{})}),d]})}lu.displayName="Controls";L.memo(lu);function yw({id:e,x:t,y:n,width:s,height:r,style:i,color:o,strokeColor:a,strokeWidth:c,className:u,borderRadius:d,shapeRendering:f,selected:h,onClick:m}){const{background:p,backgroundColor:b}=i||{},x=o||p||b;return l.jsx("rect",{className:pe(["react-flow__minimap-node",{selected:h},u]),x:t,y:n,rx:d,ry:d,width:s,height:r,style:{fill:x,stroke:a,strokeWidth:c},shapeRendering:f,onClick:m?y=>m(y,e):void 0})}const ww=L.memo(yw),bw=e=>e.nodes.map(t=>t.id),Ps=e=>e instanceof Function?e:()=>e;function vw({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:s=5,nodeStrokeWidth:r,nodeComponent:i=ww,onClick:o}){const a=se(bw,de),c=Ps(t),u=Ps(e),d=Ps(n),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return l.jsx(l.Fragment,{children:a.map(h=>l.jsx(jw,{id:h,nodeColorFunc:c,nodeStrokeColorFunc:u,nodeClassNameFunc:d,nodeBorderRadius:s,nodeStrokeWidth:r,NodeComponent:i,onClick:o,shapeRendering:f},h))})}function Nw({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:s,nodeBorderRadius:r,nodeStrokeWidth:i,shapeRendering:o,NodeComponent:a,onClick:c}){const{node:u,x:d,y:f,width:h,height:m}=se(p=>{const{internals:b}=p.nodeLookup.get(e),x=b.userNode,{x:y,y:v}=b.positionAbsolute,{width:g,height:w}=tt(x);return{node:x,x:y,y:v,width:g,height:w}},de);return!u||u.hidden||!uc(u)?null:l.jsx(a,{x:d,y:f,width:h,height:m,style:u.style,selected:!!u.selected,className:s(u),color:t(u),borderRadius:r,strokeColor:n(u),strokeWidth:i,shapeRendering:o,onClick:c,id:u.id})}const jw=L.memo(Nw);var Ew=L.memo(vw);const _w=200,Iw=150,Sw=e=>!e.hidden,Cw=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?cc(fn(e.nodeLookup,{filter:Sw}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},kw="react-flow__minimap-desc";function cu({style:e,className:t,nodeStrokeColor:n,nodeColor:s,nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:o,nodeComponent:a,bgColor:c,maskColor:u,maskStrokeColor:d,maskStrokeWidth:f,position:h="bottom-right",onClick:m,onNodeClick:p,pannable:b=!1,zoomable:x=!1,ariaLabel:y,inversePan:v,zoomStep:g=1,offsetScale:w=5}){const S=ue(),_=L.useRef(null),{boundingRect:k,viewBB:N,rfId:E,panZoom:A,translateExtent:I,flowWidth:C,flowHeight:O,ariaLabelConfig:j}=se(Cw,de),P=(e==null?void 0:e.width)??_w,T=(e==null?void 0:e.height)??Iw,B=k.width/P,R=k.height/T,D=Math.max(B,R),F=D*P,Y=D*T,G=w*D,M=k.x-(F-k.width)/2-G,z=k.y-(Y-k.height)/2-G,V=F+G*2,H=Y+G*2,W=`${kw}-${E}`,q=L.useRef(0),X=L.useRef();q.current=D,L.useEffect(()=>{if(_.current&&A)return X.current=Qx({domNode:_.current,panZoom:A,getTransform:()=>S.getState().transform,getViewScale:()=>q.current}),()=>{var Z;(Z=X.current)==null||Z.destroy()}},[A]),L.useEffect(()=>{var Z;(Z=X.current)==null||Z.update({translateExtent:I,width:C,height:O,inversePan:v,pannable:b,zoomStep:g,zoomable:x})},[b,x,v,g,I,C,O]);const ee=m?Z=>{var re;const[ne,oe]=((re=X.current)==null?void 0:re.pointer(Z))||[0,0];m(Z,{x:ne,y:oe})}:void 0,te=p?L.useCallback((Z,ne)=>{const oe=S.getState().nodeLookup.get(ne).internals.userNode;p(Z,oe)},[]):void 0,Q=y??j["minimap.ariaLabel"];return l.jsx(yr,{position:h,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-color-props":typeof d=="string"?d:void 0,"--xy-minimap-mask-stroke-width-props":typeof f=="number"?f*D:void 0,"--xy-minimap-node-background-color-props":typeof s=="string"?s:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof o=="number"?o:void 0},className:pe(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:l.jsxs("svg",{width:P,height:T,viewBox:`${M} ${z} ${V} ${H}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":W,ref:_,onClick:ee,children:[Q&&l.jsx("title",{id:W,children:Q}),l.jsx(Ew,{onClick:te,nodeColor:s,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:r,nodeStrokeWidth:o,nodeComponent:a}),l.jsx("path",{className:"react-flow__minimap-mask",d:`M${M-G},${z-G}h${V+G*2}v${H+G*2}h${-V-G*2}z
        M${N.x},${N.y}h${N.width}v${N.height}h${-N.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}cu.displayName="MiniMap";const Aw=L.memo(cu),Mw=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,Tw={[zt.Line]:"right",[zt.Handle]:"bottom-right"};function Pw({nodeId:e,position:t,variant:n=zt.Handle,className:s,style:r=void 0,children:i,color:o,minWidth:a=10,minHeight:c=10,maxWidth:u=Number.MAX_VALUE,maxHeight:d=Number.MAX_VALUE,keepAspectRatio:f=!1,resizeDirection:h,autoScale:m=!0,shouldResize:p,onResizeStart:b,onResize:x,onResizeEnd:y}){const v=Bc(),g=typeof e=="string"?e:v,w=ue(),S=L.useRef(null),_=n===zt.Handle,k=se(L.useCallback(Mw(_&&m),[_,m]),de),N=L.useRef(null),E=t??Tw[n];L.useEffect(()=>{if(!(!S.current||!g))return N.current||(N.current=f0({domNode:S.current,nodeId:g,getStoreItems:()=>{const{nodeLookup:I,transform:C,snapGrid:O,snapToGrid:j,nodeOrigin:P,domNode:T}=w.getState();return{nodeLookup:I,transform:C,snapGrid:O,snapToGrid:j,nodeOrigin:P,paneDomNode:T}},onChange:(I,C)=>{const{triggerNodeChanges:O,nodeLookup:j,parentLookup:P,nodeOrigin:T}=w.getState(),B=[],R={x:I.x,y:I.y},D=j.get(g);if(D&&D.expandParent&&D.parentId){const F=D.origin??T,Y=I.width??D.measured.width??0,G=I.height??D.measured.height??0,M={id:D.id,parentId:D.parentId,rect:{width:Y,height:G,...dc({x:I.x??D.position.x,y:I.y??D.position.y},{width:Y,height:G},D.parentId,j,F)}},z=_o([M],j,P,T);B.push(...z),R.x=I.x?Math.max(F[0]*Y,I.x):void 0,R.y=I.y?Math.max(F[1]*G,I.y):void 0}if(R.x!==void 0&&R.y!==void 0){const F={id:g,type:"position",position:{...R}};B.push(F)}if(I.width!==void 0&&I.height!==void 0){const Y={id:g,type:"dimensions",resizing:!0,setAttributes:h?h==="horizontal"?"width":"height":!0,dimensions:{width:I.width,height:I.height}};B.push(Y)}for(const F of C){const Y={...F,type:"position"};B.push(Y)}O(B)},onEnd:({width:I,height:C})=>{const O={id:g,type:"dimensions",resizing:!1,dimensions:{width:I,height:C}};w.getState().triggerNodeChanges([O])}})),N.current.update({controlPosition:E,boundaries:{minWidth:a,minHeight:c,maxWidth:u,maxHeight:d},keepAspectRatio:f,resizeDirection:h,onResizeStart:b,onResize:x,onResizeEnd:y,shouldResize:p}),()=>{var I;(I=N.current)==null||I.destroy()}},[E,a,c,u,d,f,b,x,y,p]);const A=E.split("-");return l.jsx("div",{className:pe(["react-flow__resize-control","nodrag",...A,n,s]),ref:S,style:{...r,scale:k,...o&&{[_?"backgroundColor":"borderColor"]:o}},children:i})}L.memo(Pw);const Dw="start";function Fa(e){let t=[Lw()];const n=[];return e.forEach(s=>{if(s.parentId||(s.parentId=t[0].id),!e.find(o=>o.parentId===s.id)){const o=Rw(s.id);t.push(o),n.push(Ha(o))}const i=uu(s);t.push(i),i.data.parentId&&n.push(Ha(i))}),t=zh(t,n),{nodes:t,edges:n}}function zw(e){return e.map(t=>{const{parentId:n,flowId:s,...r}=t.data??{};return{...t,data:r}})}function uu({id:e,type:t,parentId:n,data:s}){const r=s?{...s}:{};return r.parentId=n,r.flowId=e,{id:e,data:r,...du(t)}}function Ha(e){return{id:`${e.data.parentId}-${e.id}`,source:e.data.parentId,target:e.id,selectable:!1,type:Ke.SmoothStep,hidden:e.type===K.placeholder}}function Rw(e){return uu({id:nr(),parentId:e,data:{},type:K.placeholder})}function Lw(){return{...du(K.start),id:Dw,data:{name:"Start",parentId:null,flowId:"start"}}}function du(e){return{type:e,draggable:!1,position:{x:0,y:0},width:ce[e].size.width,height:ce[e].size.height}}function $w({targetNodes:e,allNodes:t,canvasSize:n,zoom:s,nodeIsSelected:r,previewIsVisible:i}){const o=new Map(t.map(u=>[u.id,u])),a=oc(e,{nodeLookup:o});let c=jt;return r&&(c+=Rs+jt-24,i&&(c-=Dh+16)),pr(a,n.width,n.height,s,s,{top:`${jt}px`,left:`${jt}px`,bottom:`${jt}px`,right:`${c}px`})}let Ks;const Ow=e=>{Ks=e},Bw=({nodes:e=[]},t)=>{const n=Fa(e);return Ld((s,r)=>({flowIntent:t,setFlowIntent:i=>{i!==r().flowIntent&&s({flowIntent:i,isDirty:!0})},isDirty:!1,setIsDirty:i=>{s({isDirty:i})},previewVisible:!1,setPreviewVisible:i=>{s({previewVisible:i})},getState:()=>r(),nodes:n.nodes,edges:n.edges,storedNodes:e,zoom:1,setZoom:i=>{const o=Bo(i,Hn,qn);return s({zoom:Bo(i,Hn,qn)}),o},incrementZoom:()=>{const i=r().zoom+.2;return r().setZoom(i),i},decrementZoom:()=>{const i=r().zoom-.2;return r().setZoom(i),i},canvasSize:null,setCanvasSize:i=>{const o=r().canvasSize;((o==null?void 0:o.width)!==i.width||(o==null?void 0:o.height)!==i.height)&&(s({canvasSize:i}),o||r().panToNode(r().nodes[0],{initial:!0}))},selectedNodeId:null,selectedChildId:null,setSelectedNodeId:(i,o)=>{if(s({selectedNodeId:i,selectedChildId:o??null}),i){const a=r().nodes.find(c=>c.id===i);a&&r().panToNode(a)}},hoveredNodeId:null,setHoveredNodeId:i=>{s({hoveredNodeId:i})},setStoredNodes:(i,o)=>{const{nodes:a,edges:c}=Fa(i);let u=o!=null&&o.selectPannedNode?o.panToNode:r().selectedNodeId;if(u&&!a.find(d=>d.id===u)&&(u=null),s({storedNodes:i,nodes:a,edges:c,selectedNodeId:u,isDirty:!0}),o!=null&&o.panToNode){const d=a.find(f=>f.id===o.panToNode);d&&r().panToNode(d)}},removeNode:i=>{const o=Wf(r().storedNodes,i);o&&r().setStoredNodes(o.allNodes,{panToNode:o.parentId})},removeNodeAndChildren:i=>{const o=Xf(r().storedNodes,i);o&&r().setStoredNodes(o.allNodes,{panToNode:o.parentId})},getPayloadForSaving:()=>({intent:r().flowIntent,config:{nodes:zw(r().storedNodes)}}),panToNode:(i,o={initial:!1})=>{const{canvasSize:a}=r();if(!Ks||!a)return;(i.type===K.buttonsItem||i.type===K.branchesItem)&&(i=r().nodes.find(u=>u.id===i.data.parentId));const c=$w({targetNodes:[i],allNodes:r().nodes,canvasSize:a,zoom:r().zoom,nodeIsSelected:!!r().selectedNodeId,previewIsVisible:r().previewVisible});o.initial&&(c.y=jt),Ks.setViewport(c,{duration:o.initial?0:500})}}))},fu=L.createContext(null);function Vw({initialValue:e,children:t,intent:n}){const[s]=L.useState(()=>Bw(structuredClone(e),n));return l.jsx(fu.Provider,{value:s,children:t})}function J(e,t){const n=L.useContext(fu);return ff(n,e,t)}function $n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,s,r;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(s=n;s--!==0;)if(!$n(e[s],t[s]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;for(s of e.entries())if(!$n(s[1],t.get(s[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(r=Object.keys(e),n=r.length,n!==Object.keys(t).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,r[s]))return!1;for(s=n;s--!==0;){var i=r[s];if(!(i==="_owner"&&e.$$typeof)&&!$n(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}const So="node-editor-form";function be({children:e,node:t,form:n,onSubmit:s}){const r=J(a=>a.getState),i=J(a=>a.setStoredNodes),o=J(a=>a.setSelectedNodeId);return l.jsx(rr,{className:"flex h-full flex-col",id:So,form:n,onSubmit:a=>{if(!$n(n.formState.defaultValues,a))if(s)s(a);else{const c=lo(r().storedNodes,t.id,a);i(c)}o(null)},children:e})}function Ee({className:e}){const{trans:t}=je();return l.jsx(an,{name:"name",label:l.jsx($,{message:"Step name"}),descriptionPosition:"top",className:e,placeholder:t({message:"Optional"})})}function Fw({node:e}){const t=xe({defaultValues:{name:e.data.name??"",conversationTags:e.data.conversationTags??[],userTags:e.data.userTags??[]}});return l.jsx(be,{node:e,form:t,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(qa,{name:"conversationTags",label:l.jsx($,{message:"Add tags to conversation"}),className:"mb-24"}),l.jsx(qa,{name:"userTags",label:l.jsx($,{message:"Add tags to user"})})]})})}function qa({name:e,label:t,className:n}){const{trans:s}=je(),[r,i]=L.useState(""),{data:o,isFetching:a}=mf({query:r,perPage:10});return l.jsx(pf,{name:e,label:t,isAsync:!0,isLoading:a,inputValue:r,onInputValueChange:i,valueKey:"name",placeholder:s(ae("Enter tag name...")),className:n,allowCustomValue:!1,suggestions:o==null?void 0:o.pagination.data,children:o==null?void 0:o.pagination.data.map(c=>l.jsx(le,{value:c.name,textLabel:c.name,capitalizeFirst:!0,children:c.name},c.id))})}function Hw(){return l.jsxs("div",{className:"mb-24 mt-12 grid grid-cols-4 gap-10 empty:hidden",children:[l.jsx(qw,{}),l.jsx(Gw,{})]})}function qw(){var o;const{flowId:e}=Me(["flowId"]),t=Oe(),s=((o=Ae(ke.flows.indexAttachments(e)).data)==null?void 0:o.attachments)??[],r=Ne({name:"attachmentIds"})??[],i=a=>{const c=t.getValues("attachmentIds");t.setValue("attachmentIds",c.filter(u=>u!==a))};return l.jsx(L.Fragment,{children:r.map(a=>{const c=s.find(u=>u.id===a);return l.jsx(hu,{thumbnail:c?l.jsx(xf,{file:c,className:"rounded-panel"}):l.jsx(of,{}),name:(c==null?void 0:c.name)??"Unknown",onRemove:()=>c?i(c.id):void 0},a)})})}function Gw(){const e=It(r=>r.abortUpload),t=It(r=>r.removeUpload),n=J(r=>r.selectedNodeId),s=It(il(r=>[...r.fileUploads.values()].filter(i=>{var o;return((o=i.options.metadata)==null?void 0:o.nodeId)===n}).map(i=>i.file)));return l.jsx(L.Fragment,{children:s.map(r=>l.jsx(hu,{thumbnail:l.jsx(Yw,{file:r}),name:r.name,onRemove:()=>{e(r.id),t(r.id)}},r.id))})}function Yw({file:e}){const t=It(o=>o.fileUploads.get(e.id)),n=(t==null?void 0:t.percentage)||0,s=t==null?void 0:t.status,r=t==null?void 0:t.errorMessage;let i;if(s==="failed"){const o=r||ae("This file could not be uploaded");i=l.jsx(mt,{variant:"danger",label:l.jsx(Od,{value:o}),children:l.jsx($d,{className:"text-danger",size:"md"})})}else s==="aborted"?i=l.jsx(Za,{className:"text-warning",size:"md"}):s==="completed"?i=l.jsx(Bd,{size:"md",className:"text-positive"}):i=l.jsx(ln,{"aria-label":"Upload progress",size:"sm",value:n,isIndeterminate:n<1||n>99});return l.jsx("div",{className:"flex flex-auto items-center justify-center",children:i})}function hu({thumbnail:e,name:t,onRemove:n}){return l.jsxs("div",{className:"relative flex aspect-square min-h-0 flex-col rounded-panel border px-6 pb-4 pt-6",children:[l.jsx("div",{className:"m-4 flex min-h-0 flex-auto items-center justify-center overflow-hidden",children:e}),l.jsx("div",{className:"mt-6 flex-shrink-0 overflow-hidden overflow-ellipsis whitespace-nowrap text-center text-xs",children:t}),l.jsx(Ie,{className:"absolute -right-8 -top-8",variant:"flat",radius:"rounded-full",color:"chip",size:"2xs",onClick:()=>n(),children:l.jsx(Qs,{})})]})}const ct="rgb(255, 255, 255, 0.87)",Co="rgb(0, 0, 0, 0.87)",Ww={bg:"#62748e",fg:ct},Xw={bg:"#62748e",fg:Co},ot={bg:"#7ccf00",fg:ct},it={bg:"#7ccf00",fg:Co},kn={bg:"#615fff",fg:ct},An={bg:"#615fff",fg:ct},Ga={bg:"#2b7fff",fg:ct},Ya={bg:"#2b7fff",fg:ct},Mn={bg:"#ff6900",fg:ct},Tn={bg:"#ff6900",fg:Co},mu={bg:"transparent",fg:ct},pu={start:Ww,message:ot,buttons:ot,dynamicButtons:ot,buttonsItem:ot,articles:ot,cards:ot,dynamicCards:ot,collectDetails:ot,tool:kn,toolResult:kn,setAttribute:kn,addTags:kn,branches:Ga,branchesItem:Ga,transfer:Mn,closeConversation:Mn,goToStep:Mn,goToFlow:Mn,placeholder:mu},gu={start:Xw,message:it,buttons:it,buttonsItem:it,dynamicButtons:it,articles:it,cards:it,dynamicCards:it,collectDetails:it,tool:An,toolResult:An,setAttribute:An,addTags:An,branches:Ya,branchesItem:Ya,transfer:Tn,closeConversation:Tn,goToStep:Tn,goToFlow:Tn,placeholder:mu};function ko(){const t=Ka()?gu:pu,n={};for(const s in t)n[`--node-color-${s}-bg`]=t[s].bg,n[`--node-color-${s}-fg`]=t[s].fg;return n}function pn(e){return L.useMemo(()=>({backgroundColor:`var(--node-color-${e}-bg)`,color:`var(--node-color-${e}-fg)`}),[e])}const Uw=[ce.placeholder.type,ce.goToStep.type];function Zw({node:e}){const t=xe({defaultValues:e.data});return l.jsx(be,{node:e,form:t,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(xu,{currentNode:e,name:"targetNodeId"})]})})}function xu({currentNode:e,name:t,size:n}){const{trans:s}=je(),r=J(i=>i.nodes);return l.jsx(Ge,{name:t,size:n,label:l.jsx($,{message:"Target step"}),placeholder:s({message:"Choose target step"}),showSearchField:!0,searchPlaceholder:s({message:"Find a step"}),required:!0,children:r.map(i=>i.id===e.id||i.id===e.data.parentId||Uw.includes(i.type)?null:l.jsx(le,{value:i.id,startIcon:l.jsx(Kw,{config:ce[i.type]}),children:i.data.name?i.data.name:l.jsx($,{...ce[i.type].displayName})},i.id))})}function Kw({config:e}){const t=e.icon,n=ko();return l.jsx("div",{style:{backgroundColor:n[`--node-color-${e.type}-bg`],color:n[`--node-color-${e.type}-fg`]},className:"mr-4 flex h-24 w-24 items-center justify-center rounded-button text-on-primary",children:l.jsx(t,{size:"xs"})})}function Lt({children:e}){const[t,n]=L.Children.toArray(e);return l.jsxs("div",{children:[t?l.jsx("div",{className:"text-sm",children:t}):null,n?l.jsx("div",{className:"mb-14 text-xs text-muted",children:n}):null]})}const Ao=[{name:"",value:"",type:Bn.AiAgentSession}];function Qw({node:e}){const t=xe({defaultValues:{name:e.data.name??"",attributes:e.data.attributes??Ao}});return l.jsx(be,{node:e,form:t,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsxs(Lt,{children:[l.jsx($,{message:"Attributes"}),l.jsx($,{message:"Set a value for one or more attributes."})]}),l.jsx(yu,{name:"attributes"})]})})}function yu({name:e,allowVariablesInValue:t}){const n=Oe();e=e;const{fields:s,append:r,remove:i,update:o}=et({name:e});return l.jsxs("div",{children:[s.map((a,c)=>l.jsx(Jw,{name:e,index:c,attributes:s,onUpdate:u=>o(c,{...n.getValues(`${e}.${c}`),...u}),onRemove:()=>i(c),allowVariablesInValue:t},a.id)),l.jsx(ie,{color:"primary",size:"xs",className:"-ml-10",startIcon:l.jsx(Be,{}),onClick:()=>{r({...Ao[0]})},disabled:s.length>=10,children:l.jsx($,{message:"Add another attribute"})})]})}function Jw({index:e,attributes:t,onUpdate:n,onRemove:s,name:r,allowVariablesInValue:i}){return l.jsx("div",{className:ge("group relative mb-16",t.length-1!==e&&"border-b border-b-divider-lighter pb-16"),children:l.jsxs("div",{children:[l.jsx(eb,{name:r,index:e,onSelected:o=>n(o)}),l.jsx(tb,{index:e,name:r,allowVariables:i}),t.length>1&&l.jsx("div",{className:"text-right",children:l.jsx(ie,{size:"2xs",variant:"outline",className:"mt-12",onClick:()=>s(),children:l.jsx($,{message:"Remove"})})})]})})}function eb({onSelected:e,index:t,name:n}){const{getItem:s}=lt(),r=`${n}.${t}`,i=Ne({name:r}),o=i?s(i):null,{input:a}=Vd({inputDisplay:"flex items-center justify-between"}),c=(o==null?void 0:o.displayName)||(i==null?void 0:i.name);return l.jsxs("div",{className:"mb-12 flex items-center",children:[l.jsx("div",{className:"mr-16 min-w-24 text-sm font-semibold",children:l.jsx($,{message:"Set"})}),l.jsx(al,{value:i,onChange:u=>e(u),onAddNewAttribute:u=>e(u),className:"w-full",children:l.jsxs("button",{type:"button",className:a,children:[c?l.jsx(Js,{size:"sm",adornment:l.jsx(nl,{}),fontWeight:"font-medium",children:c}):l.jsx("span",{className:"font-normal text-main/40",children:l.jsx($,{message:"Choose attribute"})}),l.jsx(tl,{size:"sm"})]})})]})}function tb({index:e,name:t,allowVariables:n}){var c,u;const{getItem:s}=lt(),r=Ne({name:`${t}.${e}`}),{setValue:i}=Oe(),o=s(r);if(n)return l.jsx(Le,{required:!0,multiline:!1,name:`${t}.${e}.value`,labelDisplay:"block min-w-24 font-semibold",labelPosition:"side",label:l.jsx($,{message:"To"}),hideEmojiPicker:!0});const a=o==null?void 0:o.name;return o&&cl.includes(a)?l.jsx(ul,{labelDisplay:"block min-w-24 font-semibold",label:l.jsx($,{message:"To"}),labelPosition:"side",type:a,value:r.value,onChange:d=>i(`${t}.${e}.value`,d)}):o!=null&&o.attribute?l.jsx(ll,{labelDisplay:"block min-w-24 font-semibold",label:l.jsx($,{message:"To"}),labelPosition:"side",inputName:`${t}.${e}.value`,attribute:o.attribute,preferSelects:!0}):l.jsx(an,{name:`${t}.${e}.value`,labelDisplay:"block min-w-24 font-semibold",label:l.jsx($,{message:"To"}),labelPosition:"side",required:!0,type:((c=o==null?void 0:o.inputConfig)==null?void 0:c.type)??"text",description:(u=o==null?void 0:o.inputConfig)==null?void 0:u.description})}function Nr({pathPrefix:e,size:t,nameLabel:n}){const s=`${e}`,{setValue:r,getValues:i}=Oe();return l.jsxs(l.Fragment,{children:[l.jsx(Le,{size:t,name:`${e}.name`,label:n??l.jsx($,{message:"Name"}),className:t==="sm"?"mb-20":"mb-24",hideEmojiPicker:!0,required:!0}),l.jsxs(Ge,{selectionMode:"single",size:t,name:`${e}.actionType`,label:l.jsx($,{message:"Action type"}),className:t==="sm"?"mb-20":"mb-24",required:!0,onSelectionChange:o=>{const a=o,c={...i(s),attributes:a==="setAttributes"?Ao:[]};r(s,c,{shouldDirty:!0})},children:[l.jsx(le,{value:"openUrl",children:l.jsx($,{message:"Open URL"})}),l.jsx(le,{value:"copyToClipboard",children:l.jsx($,{message:"Copy to clipboard"})}),l.jsx(le,{value:"sendMessage",children:l.jsx($,{message:"Send message"})}),l.jsx(le,{value:"setAttributes",children:l.jsx($,{message:"Set attributes"})}),l.jsx(le,{value:"openEmbed",children:l.jsx($,{message:"Open embed"})}),l.jsx(le,{value:"goToNode",children:l.jsx($,{message:"Go to node"})})]}),l.jsx(nb,{pathPrefix:e,size:t})]})}function nb({pathPrefix:e,size:t}){const n=J(il(r=>r.nodes.find(i=>i.id===r.selectedNodeId))),s=Ne({name:`${e}.actionType`});return s?s==="goToNode"?n?l.jsx(xu,{size:t,currentNode:n,name:`${e}.actionValue`}):null:s==="setAttributes"?l.jsxs("div",{children:[l.jsx(Le,{size:t,name:`${e}.actionValue`,label:l.jsx($,{message:"Message"}),hideEmojiPicker:!0,className:"pb-16"}),l.jsx("div",{className:"my-6 text-sm",children:l.jsx($,{message:"Attributes"})}),l.jsx(yu,{name:`${e}.attributes`,allowVariablesInValue:!0})]}):l.jsx(Le,{size:t,name:`${e}.actionValue`,label:l.jsx(rb,{actionType:s}),required:!0,hideEmojiPicker:!0,className:"pb-16"}):null}function rb({actionType:e}){switch(e){case"openUrl":case"openEmbed":return l.jsx($,{message:"URL"});case"copyToClipboard":return l.jsx($,{message:"Text to copy"});case"sendMessage":return l.jsx($,{message:"Message"})}}function ut({className:e,placeholder:t,required:n=!0,showButtonsEditor:s}){return l.jsxs("div",{className:e,children:[l.jsxs(Le,{size:"lg",name:"message",label:l.jsx($,{message:"AI agent message"}),required:n,placeholder:t,multiline:!0,children:[l.jsx(sb,{size:"2xs"}),l.jsx(ob,{size:"2xs"})]}),s&&l.jsx(ib,{}),l.jsx(Hw,{})]})}function sb({size:e}){const t=wu(eo.conversationImages);return l.jsx(mt,{label:l.jsx($,{message:"Add image"}),children:l.jsx(Ie,{size:e,iconSize:"sm",onClick:()=>t(),children:l.jsx(wf,{})})})}function ob({size:e}){const t=wu(eo.conversationAttachments);return l.jsx(mt,{label:l.jsx($,{message:"Add file"}),children:l.jsx(Ie,{size:e,iconSize:"sm",onClick:()=>t(),children:l.jsx(bf,{})})})}function wu(e){const{flowId:t}=Me(["flowId"]),n=It(o=>o.uploadMultiple),s=It(o=>o.removeUpload),{setValue:r,getValues:i}=Oe();return async()=>{const o=hf({uploadType:e}),a=await vf({types:o==null?void 0:o.allowedFileTypes,multiple:!0});n(a,{uploadType:e,showToastOnRestrictionFail:!0,restrictions:o,onSuccess:async(c,u)=>{s(u.id),Qa.setQueriesData(ke.flows.indexAttachments(t),d=>({attachments:[...(d==null?void 0:d.attachments)??[],c]})),r("attachmentIds",[...i("attachmentIds"),c.id])}})}}function ib(){const{fields:e,append:t,update:n,remove:s}=et({name:"buttons"});return l.jsxs("div",{className:"mt-10 flex flex-wrap items-center gap-6",children:[e.map((r,i)=>l.jsxs(Ut,{type:"popover",placement:"left",onClose:o=>{o&&n(i,o)},children:[l.jsx(ie,{size:"xs",variant:"outline",children:r.name}),l.jsx(Wa,{button:r,onRemove:()=>s(i)})]},r.id)),l.jsxs(Ut,{type:"popover",placement:"left",onClose:r=>{r&&t(r)},children:[l.jsx(ie,{size:"xs",color:"primary",startIcon:l.jsx(Be,{}),children:l.jsx($,{message:"Add button"})}),l.jsx(Wa,{})]})]})}function Wa({button:e,onRemove:t}){const{close:n,formId:s}=sr(),r=xe({defaultValues:{actionType:"openUrl",...e}});return l.jsxs(to,{children:[l.jsx(no,{children:e?l.jsx($,{message:"Update button"}):l.jsx($,{message:"Add button"})}),l.jsx(ro,{children:l.jsx(rr,{id:s,form:r,onSubmit:i=>n(i),children:l.jsx(Nr,{pathPrefix:"",size:"md"})})}),l.jsxs(so,{startAction:t?l.jsx(ie,{color:"danger",onClick:()=>t(),children:l.jsx($,{message:"Remove"})}):null,children:[l.jsx(ie,{onClick:()=>n(),children:l.jsx($,{message:"Cancel"})}),l.jsx(ie,{form:s,type:"submit",variant:"flat",color:"primary",children:e?l.jsx($,{message:"Update"}):l.jsx($,{message:"Add"})})]})]})}function ab({node:e}){const{trans:t}=je(),n=xe({defaultValues:{...e.data,attachmentIds:e.data.attachmentIds??[]}}),s=r=>{const i=n.getValues("articleIds")??[];i.includes(r)||n.setValue("articleIds",[...i,r])};return l.jsx(be,{node:e,form:n,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(ut,{className:"mb-24",placeholder:t(ae("Optional")),required:!1}),l.jsxs(Lt,{children:[l.jsx($,{message:"Articles"}),l.jsx($,{message:"Show up to 6 articles to customers"})]}),l.jsx(lb,{onSelected:r=>s(r)}),l.jsx(cb,{})]})})}function lb({onSelected:e}){const{trans:t}=je(),[n,s]=L.useState(""),{data:r,isFetching:i}=Ae(gf.articles.index({})),o=(r==null?void 0:r.pagination.data)??[];return l.jsx(Nf,{isAsync:!0,isLoading:i,inputValue:n,onInputValueChange:s,placeholder:t(ae("Search by title...")),allowCustomValue:!1,items:o,onSelectionChange:a=>e(a),selectionMode:"single",clearInputOnItemSelection:!0,clearSelectionOnInputClear:!0,blurReferenceOnItemSelection:!0,children:o.map(a=>l.jsx(le,{value:a.id,textLabel:a.title,children:a.title},a.id))})}function cb(){var s;const e=Ne({name:"articleIds"})??[],n=((s=tf("normalized-models/article",{modelIds:e.join(",")},{enabled:!!e.length}).data)==null?void 0:s.results)??[];return l.jsx("div",{className:"mt-12 space-y-10",children:e.map(r=>{const i=n.find(o=>o.id===r);return i?l.jsx(ub,{articleId:r,articleIds:e,name:i.name},r):null})})}function ub({articleId:e,articleIds:t,name:n}){const{setValue:s}=Oe(),r=L.useRef(null),{sortableProps:i,dragHandleRef:o}=ar({item:e,items:t,type:"articlesFlowSortable",ref:r,onSortEnd:(a,c)=>{s("articleIds",jf(t,a,c))},strategy:"liveSort"});return l.jsxs("div",{...i,ref:r,className:"flex items-center gap-8 rounded-panel border px-12 py-8 text-sm",children:[l.jsx(Ie,{ref:o,size:"xs",iconSize:"sm",children:l.jsx(ao,{})}),n,l.jsx(Ie,{size:"xs",iconSize:"sm",className:"ml-auto",children:l.jsx(Qs,{onClick:()=>s("articleIds",t.filter(a=>a!==e))})})]})}function db({node:e,onEditBranch:t}){const{fields:n,remove:s,move:r,insert:i}=et({name:"branches"}),o=()=>{const a=n.findIndex(u=>u.isElseBranch),c=ce.branchesItem.createNewStoredNode(e.id,{name:`Branch #${n.length}`})[0].data;i(a,{...c,flowId:nr()}),t(n.length-1)};return L.createElement(On.div,{...oo,key:"branches-list",className:"flex min-h-0 flex-auto flex-col"},l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsxs(Lt,{children:[l.jsx($,{message:"Branches"}),l.jsx($,{message:"Manage branches and the conditions that determine which branch to take."})]}),l.jsx(ie,{color:"primary",className:"-ml-14 mb-6",startIcon:l.jsx(Be,{}),onClick:()=>o(),disabled:n.length===6,children:l.jsx($,{message:"Add branch"})}),l.jsx("div",{className:"space-y-10",children:n.map((a,c)=>l.jsx(fb,{branch:a,branches:n,onEdit:()=>t(c),onDelete:()=>s(c),onSortEnd:(u,d)=>r(u,d)},a.id))})]}))}function fb({branch:e,branches:t,onEdit:n,onDelete:s,onSortEnd:r}){const i=e.isElseBranch,o=L.useRef(null),{sortableProps:a,dragHandleRef:c}=ar({item:e,items:t,type:"branchesSortable",ref:o,onSortEnd:r,strategy:"liveSort",disabled:i});return l.jsxs("div",{ref:o,className:ge("flex h-46 min-w-full items-center rounded-button border p-4",!i&&"cursor-pointer hover:bg-hover"),...a,onClick:()=>{i||n()},children:[!i&&l.jsx(Ie,{ref:c,size:"sm",onClick:u=>u.stopPropagation(),children:l.jsx(Ef,{className:"text-muted hover:cursor-move"})}),l.jsx("div",{className:ge("min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap px-6 text-sm font-medium",i&&"pl-42"),children:e.name}),!i&&l.jsxs(or,{children:[l.jsx(Ie,{className:"ml-auto",size:"sm",onClick:u=>u.stopPropagation(),children:l.jsx(_f,{})}),l.jsxs(ir,{children:[l.jsx(le,{value:"edit",onSelected:()=>n(),children:l.jsx($,{message:"Edit"})}),l.jsx(le,{value:"delete",onSelected:async()=>{await Fd(hb)&&s()},children:l.jsx($,{message:"Delete"})})]})]})]})}function hb(){const{close:e}=sr();return l.jsx(If,{isDanger:!0,title:l.jsx($,{message:"Delete branch"}),body:l.jsx($,{message:"Are you sure you want to delete this branch?"}),confirm:l.jsx($,{message:"Delete"}),onConfirm:()=>e(!0)})}function bu({condition:e}){const{close:t,formId:n}=sr(),{getItem:s}=lt(),r=u=>{u.attribute&&t(u)},i=xe({defaultValues:{attribute:e==null?void 0:e.attribute,operator:(e==null?void 0:e.operator)??Ds.eq,value:(e==null?void 0:e.value)??""}}),o=i.watch("attribute"),a=i.watch("value"),c=u=>{var f;i.setValue("attribute",u);const d=s(u);i.setValue("value",(d==null?void 0:d.defaultValue)??""),i.setValue("operator",((f=d==null?void 0:d.operators)==null?void 0:f[0])??Ds.eq)};return l.jsxs(to,{size:"sm",children:[l.jsx(no,{className:"capitalize",children:e?l.jsx($,{message:"Update condition"}):l.jsx($,{message:"New condition"})}),l.jsx(ro,{children:l.jsxs(rr,{form:i,className:"space-y-20",id:n,onSubmit:u=>{r(u),t()},children:[l.jsx(al,{required:!0,label:l.jsx($,{message:"Attribute"}),size:"sm",showReadonly:!0,showPageVisitAttributes:!0,value:o,onChange:u=>{c(u)}}),l.jsx(mb,{}),l.jsx(pb,{})]})}),l.jsx(so,{children:l.jsx(ie,{type:"submit",variant:"flat",color:"primary",className:"min-w-full",size:"xs",form:n,disabled:!o||!a,children:e?l.jsx($,{message:"Update"}):l.jsx($,{message:"Add"})})})]})}function mb(){const{getItem:e}=lt(),t=Ne({name:"attribute"}),n=e(t),s=(n==null?void 0:n.operators)??Hd;return s.length?l.jsx(Ge,{name:"operator",size:"sm",label:l.jsx($,{message:"Operator"}),children:s.map(r=>l.jsx(le,{value:r,capitalizeFirst:!0,children:l.jsx($,{...dl[r]})},r))}):null}function pb(){var a,c;const{getItem:e}=lt(),t=Ne({name:"attribute"}),n=Ne({name:"operator"}),s=Ne({name:"value"}),{setValue:r}=Oe(),i=e(t);if(n===Ds.notNull||i!=null&&i.operators&&!i.operators.length)return null;const o=i==null?void 0:i.name;return i&&cl.includes(o)?l.jsx(ul,{type:o,label:l.jsx($,{message:"Value"}),size:"sm",className:"w-full",value:s,onChange:u=>r("value",u)}):i!=null&&i.attribute?l.jsx(ll,{inputTypeAlwaysText:!0,label:l.jsx($,{message:"Value"}),attribute:i.attribute,inputName:"value",size:"sm",preferSelects:!0}):l.jsx(an,{name:"value",label:l.jsx($,{message:"Value"}),size:"sm",required:!0,type:((a=i==null?void 0:i.inputConfig)==null?void 0:a.type)??"text",description:(c=i==null?void 0:i.inputConfig)==null?void 0:c.description})}const gb=L.memo(({code:e})=>{const{localeCode:t}=qd(),n=new Intl.DisplayNames([t],{type:"language"});let s;try{s=n.of(e)}catch{}return l.jsx(L.Fragment,{children:s})});function xb({node:e,index:t,onBack:n}){return L.createElement(On.div,{...oo,key:"selected-branch",className:"flex min-h-0 flex-auto flex-col"},l.jsx(Iu,{node:e,title:l.jsx(ie,{startIcon:l.jsx(kf,{}),color:"primary",onClick:()=>n(),className:"-ml-12",children:l.jsx($,{message:"Back"})}),children:l.jsx(yb,{branchIndex:t})}))}function yb({branchIndex:e}){const{fields:t,append:n,remove:s}=et({name:`branches.${e}.conditionGroups`});return l.jsxs(l.Fragment,{children:[l.jsx(an,{name:`branches.${e}.name`,label:l.jsx($,{message:"Name"}),descriptionPosition:"top",className:"mb-24",description:l.jsx($,{message:"This wont be visible to customers, but will help you tell the branches apart."})}),l.jsxs(Lt,{children:[l.jsx($,{message:"Conditions"}),l.jsx($,{message:"Conditions determine which branch is selected."})]}),t.map((r,i)=>l.jsx(wb,{branchIndex:e,groupIndex:i,isLast:i===t.length-1,onRemove:()=>s(i)},r.id)),l.jsx(vu,{className:"mt-12",gap:"gap-6",children:l.jsx(ie,{startIcon:l.jsx(Be,{}),size:"xs",color:"primary",onClick:()=>{n({conditions:[],matchType:"or"})},children:l.jsx($,{message:"Add condition group"})})})]})}function wb({branchIndex:e,groupIndex:t,isLast:n,onRemove:s}){const r=`branches.${e}.conditionGroups.${t}.conditions`,{fields:i,remove:o,append:a,update:c}=et({name:r});return l.jsxs("div",{children:[l.jsxs("div",{className:"rounded-panel border p-16",children:[i.map((u,d)=>{const f=d===i.length-1;return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-center gap-12",children:[l.jsxs(Ut,{type:"popover",placement:"left",onClose:h=>{h&&c(d,h)},children:[l.jsxs("button",{type:"button",className:"inline-flex min-w-0 flex-auto select-none appearance-none items-center justify-start gap-4 whitespace-nowrap rounded-button border bg-transparent px-12 py-[7px] align-middle text-sm font-semibold leading-none no-underline outline-none transition-button duration-200 hover:bg-hover focus-visible:ring",children:[l.jsxs("span",{className:"flex flex-auto flex-wrap items-center gap-4",children:[l.jsx(bb,{attribute:u.attribute}),l.jsx("span",{className:"font-normal",children:l.jsx($,{...dl[u.operator]})}),l.jsx("div",{className:"min-w-0 overflow-hidden text-ellipsis whitespace-nowrap",children:l.jsx(vb,{condition:u})})]}),l.jsx(fl,{className:"ml-auto text-muted",size:"sm"})]}),l.jsx(bu,{condition:u})]}),l.jsx(Ie,{variant:"outline",size:"sm",onClick:()=>o(d),children:l.jsx(Vn,{})})]}),f?null:l.jsx(Xa,{name:`branches.${e}.conditionGroups.${t}.matchType`,className:"my-8 -ml-10"})]},d)}),l.jsxs("div",{className:"flex items-center gap-8",children:[l.jsx(Nb,{isCompact:i.length>=1,onAdd:u=>{a(u)}}),!i.length&&l.jsx(Ie,{variant:"outline",size:"sm",onClick:()=>s(),children:l.jsx(Vn,{})})]})]}),!n&&l.jsx(vu,{className:"my-16",children:l.jsx(Xa,{name:`branches.${e}.branchMatchType`})})]})}function bb({attribute:e}){const{getItem:t}=lt(),n=t(e);return(n==null?void 0:n.displayName)??e.name}function vb({condition:e}){var s;const{getItem:t}=lt(),n=t(e.attribute);if((n==null?void 0:n.type)===Bn.User){if(n.name==="country")return l.jsx(Cf,{code:e.value});if(n.name==="language")return l.jsx(gb,{code:e.value})}return((s=n==null?void 0:n.attribute)==null?void 0:s.format)==="date"?l.jsx(Sf,{attribute:{...n.attribute,value:e.value}}):e.value}function Xa({name:e,className:t}){const{setValue:n}=Oe(),s=Ne({name:e});return l.jsxs(or,{selectionMode:"single",selectedValue:s,onSelectionChange:r=>{n(e,r)},children:[l.jsx(ie,{size:"xs",color:"primary",endIcon:l.jsx(Gd,{}),className:ge("uppercase",t),children:s==="and"?l.jsx($,{message:"And"}):l.jsx($,{message:"Or"})}),l.jsxs(ir,{children:[l.jsx(le,{value:"and",className:"uppercase",children:l.jsx($,{message:"And"})}),l.jsx(le,{value:"or",className:"uppercase",children:l.jsx($,{message:"Or"})})]})]})}function Nb({isCompact:e,onAdd:t}){return l.jsxs(Ut,{type:"popover",placement:"left",onClose:n=>{n&&t(n)},children:[l.jsx(ie,{display:"flex",startIcon:l.jsx(Be,{}),size:e?"xs":"sm",variant:e?void 0:"outline",color:"primary",className:ge(e?"-ml-10 mt-12":"flex-auto"),children:l.jsx($,{message:"Add condition"})}),l.jsx(bu,{})]})}function vu({children:e,className:t,gap:n="gap-12"}){return l.jsxs("div",{className:ge("flex items-center",n,t),children:[l.jsx("div",{className:"h-1 flex-auto bg-divider"}),e,l.jsx("div",{className:"h-1 flex-auto bg-divider"})]})}function jb({node:e}){const t=J(u=>u.getState),n=J(u=>u.setStoredNodes),[s,r]=L.useState(()=>{const u=t().selectedChildId;return u?t().nodes.filter(f=>f.data.parentId===e.id).findIndex(f=>f.id===u):null}),o=J(u=>u.nodes).filter(u=>u.data.parentId===e.id),a=xe({defaultValues:{name:e.data.name??"",branches:o.map(u=>u.data)}}),c=u=>{let d=t().storedNodes;lo(d,e.id,{name:u.name}),d=d.filter(m=>m.parentId!==e.id);const f=d.findIndex(m=>m.id===e.id),h=u.branches.map(m=>ye({id:m.flowId,parentId:e.id,type:K.branchesItem,data:m}));d.splice(f+1,0,...h),n(d)};return l.jsx(be,{node:e,form:a,onSubmit:c,children:s!==null?l.jsx(xb,{node:e,index:s,onBack:()=>r(null)}):l.jsx(db,{node:e,onEditBranch:r})})}function Eb({node:e}){const t=J(o=>o.getState),s=J(o=>o.nodes).filter(o=>o.data.parentId===e.id),r=xe({defaultValues:{name:e.data.name??"",message:e.data.message??"",attachmentIds:e.data.attachmentIds??[],buttons:s.map(o=>o.data),preventTyping:e.data.preventTyping??!1}}),i=o=>{let a=t().storedNodes;lo(a,e.id,{name:o.name,message:o.message,attachmentIds:o.attachmentIds,preventTyping:o.preventTyping}),a=a.filter(d=>d.parentId!==e.id);const c=a.findIndex(d=>d.id===e.id),u=o.buttons.map(d=>ye({id:d.flowId,parentId:e.id,type:K.buttonsItem,data:d}));a.splice(c+1,0,...u),t().setStoredNodes(a)};return l.jsx(be,{form:r,node:e,onSubmit:o=>{i(o)},children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(io,{name:"preventTyping",className:"mb-24",children:l.jsx($,{message:"Prevent customer from typing"})}),l.jsx(ut,{}),l.jsx(_b,{node:e})]})})}function _b({node:e}){const{fields:t,append:n,remove:s,move:r}=et({name:"buttons"}),i=()=>{const o=ce.buttonsItem.createNewStoredNode(e.id,{name:`Button #${t.length+1}`})[0].data;n({...o,flowId:nr()})};return l.jsxs("div",{className:"mt-24",children:[l.jsxs(Lt,{children:[l.jsx($,{message:"Buttons"}),l.jsx($,{message:"Show up to 10 buttons to customers"})]}),l.jsx("div",{className:"-ml-6 space-y-6",children:t.map((o,a)=>l.jsx(Ib,{button:o,buttons:t,index:a,onRemove:()=>s(a),onSortEnd:(c,u)=>{r(c,u)}},o.id))}),l.jsx(ie,{color:"primary",className:"-ml-10 mt-10",startIcon:l.jsx(Be,{}),onClick:()=>i(),disabled:t.length===10,children:l.jsx($,{message:"Add another button"})})]})}function Ib({index:e,button:t,buttons:n,onRemove:s,onSortEnd:r}){const i=L.useRef(null),{sortableProps:o,dragHandleRef:a}=ar({item:t,items:n,type:"buttonsFlowSortable",ref:i,onSortEnd:(u,d)=>{r(u,d)},strategy:"liveSort"}),c=J(u=>u.storedNodes);return l.jsxs("div",{ref:i,className:"flex items-center",...o,children:[l.jsx(Ie,{className:"mr-8 text-muted",ref:a,children:l.jsx(ao,{})}),l.jsx(Le,{name:`buttons.${e}.name`,className:"flex-auto",required:!0}),l.jsx(Ie,{className:"ml-8 text-muted",disabled:n.length===1,onClick:()=>{c.some(u=>u.parentId===t.flowId)?Ja.danger(ae("Can't delete a button that has child steps")):s()},children:l.jsx(Vn,{})})]})}function Sb({card:e}){const{flowId:t}=Me(["flowId"]),[n,s]=L.useState([]),{formId:r,close:i}=sr(),o=xe({defaultValues:e}),{fields:a,append:c,remove:u}=et({name:"buttons",control:o.control}),d=()=>{c({name:"Button label",actionType:"openUrl",actionValue:""})};return l.jsxs(to,{children:[l.jsx(no,{children:l.jsx($,{message:"Edit card"})}),l.jsx(ro,{children:l.jsxs(rr,{id:r,form:o,onSubmit:f=>i(f),children:[l.jsx(sl,{children:l.jsx(Af,{name:"image",label:l.jsx($,{message:"Image"}),className:"mb-24",variant:"input",uploadType:eo.conversationImages,showRemoveButton:!0})}),l.jsx(Le,{name:"title",label:l.jsx($,{message:"Title"}),className:"mb-24",maxLength:80,size:"md"}),l.jsx(Le,{name:"description",label:l.jsx($,{message:"Description"}),className:"mb-24",maxLength:120,size:"md",multiline:!0}),l.jsxs("div",{children:[l.jsx("div",{className:"mb-4",children:l.jsx($,{message:"Buttons"})}),l.jsx(hl,{variant:"outline",expandedValues:n,onExpandedChange:s,children:a.map((f,h)=>l.jsxs(ml,{label:f.name,children:[l.jsx(Nr,{size:"sm",pathPrefix:`buttons.${h}`}),l.jsx("div",{className:"text-right",children:l.jsx(ie,{size:"xs",color:"danger",variant:"outline",onClick:()=>{u(h),s([])},className:"mt-20",children:l.jsx($,{message:"Remove"})})})]},h))}),l.jsx(ie,{size:"sm",color:"primary",className:"-ml-18 mt-6",startIcon:l.jsx(Be,{}),onClick:()=>d(),children:l.jsx($,{message:"Add button"})})]})]})}),l.jsxs(so,{children:[l.jsx(ie,{size:"sm",variant:"outline",onClick:()=>i(),children:l.jsx($,{message:"Cancel"})}),l.jsx(ie,{size:"sm",variant:"flat",color:"primary",type:"submit",form:r,children:l.jsx($,{message:"Save"})})]})]})}function Cb({node:e}){const{trans:t}=je(),n=L.useRef(null),s=xe({defaultValues:{...e.data,attachmentIds:e.data.attachmentIds??[]}}),{fields:r,append:i,remove:o,move:a}=et({control:s.control,name:"cards"}),c=r.map(u=>u.id);return l.jsx(be,{node:e,form:s,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(ut,{className:"mb-24",placeholder:t(ae("Optional")),required:!1}),l.jsxs("div",{className:"relative",children:[l.jsx("div",{ref:n,className:"compact-scrollbar mb-12 flex snap-x snap-mandatory items-start gap-24 overflow-x-auto",children:r.map((u,d)=>l.jsx(kb,{node:e,index:d,id:u.id,ids:c,onRemove:()=>o(d),onSortEnd:a},u.id))}),r.length?l.jsx(Ab,{scrollRef:n}):null]}),l.jsx(ie,{className:"-ml-14",size:"sm",color:"primary",startIcon:l.jsx(Be,{}),disabled:r.length>=6,onClick:()=>{const[u]=ce.cards.createNewStoredNode(e.id);i(u.data.cards[0]);const d=n.current;d&&setTimeout(()=>{d.scrollTo({left:d.scrollWidth,behavior:"smooth"})})},children:l.jsx($,{message:"Add card"})})]})})}function kb({node:e,index:t,id:n,ids:s,onRemove:r,onSortEnd:i}){const o=L.useRef(null),{sortableProps:a,dragHandleRef:c}=ar({ref:o,item:n,items:s,type:"channelContentItem",strategy:"liveSort",onSortEnd:i}),u=Oe(),d=`cards.${t}`,f=Ne({name:d});return l.jsxs("div",{ref:o,...a,className:"group relative w-240 flex-shrink-0 snap-center pt-16",children:[l.jsxs("div",{className:"rounded-panel border shadow-sm",children:[f.image&&l.jsx("img",{src:f.image,alt:"",className:"h-172 w-full rounded-t-panel"}),l.jsxs("div",{className:"px-20 pb-20 pt-16 text-sm",children:[l.jsx("div",{className:"line-clamp-2 whitespace-pre-wrap break-words font-semibold",children:f.title}),l.jsx("div",{className:"mt-8 line-clamp-4 whitespace-pre-wrap break-words",children:f.description})]}),f.buttons.map((h,m)=>l.jsx("div",{children:l.jsx("div",{className:"flex h-44 w-full items-center justify-center overflow-hidden overflow-ellipsis whitespace-nowrap border-t px-20 text-sm font-semibold text-primary",children:l.jsx($,{message:h.name})})},m))]}),l.jsxs("div",{className:"pointer-events-none absolute left-0 right-0 top-0 mx-auto flex w-max items-center gap-6 opacity-0 transition-opacity group-hover:pointer-events-auto group-hover:opacity-100",children:[l.jsx(Xt,{ref:c,children:l.jsx(ao,{size:"sm"})}),l.jsxs(Ut,{type:"popover",triggerRef:o,placement:"left",offset:10,onClose:h=>{h&&u.setValue(`cards.${t}`,h)},children:[l.jsx(Xt,{children:l.jsx(fl,{size:"sm"})}),l.jsx(Sb,{card:f})]}),s.length>1&&l.jsx(Xt,{onClick:()=>r(),children:l.jsx(Vn,{size:"sm"})})]})]})}function Ab({scrollRef:e}){const[t,n]=L.useState(!0),[s,r]=L.useState(!1);return L.useEffect(()=>{const i=e.current;if(i){const o=()=>{n(i.scrollLeft===0),r(i.scrollLeft+i.clientWidth===i.scrollWidth)};return i.addEventListener("scroll",o),()=>{i.removeEventListener("scroll",o)}}},[]),l.jsxs("div",{className:"pointer-events-none absolute top-0 flex h-full w-full items-center",children:[l.jsx(Xt,{hidden:t,className:"mr-auto",shadow:"shadow-[0_0_15px_0_rgba(0,0,0,.34)]",onClick:()=>{e.current&&e.current.scrollBy({left:-240,behavior:"smooth"})},children:l.jsx(Yd,{})}),l.jsx(Xt,{hidden:s,className:"ml-auto",shadow:"shadow-[0_0_15px_0_rgba(0,0,0,.34)]",onClick:()=>{e.current&&e.current.scrollBy({left:240,behavior:"smooth"})},children:l.jsx(Wd,{})})]})}function Xt({children:e,hidden:t,className:n,shadow:s,...r}){return l.jsx("button",{...r,type:"button",className:ge("flex size-34 items-center justify-center rounded-full border bg outline-none transition-[opacity,color,background-color] hover:bg-primary hover:text-on-primary focus-visible:ring",t?"pointer-events-none opacity-0":"pointer-events-auto",n,s||"shadow-md"),children:e})}function Mb({node:e}){const t=xe({defaultValues:{...e.data,attachmentIds:e.data.attachmentIds??[]}});return l.jsx(be,{node:e,form:t,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(ut,{})]})})}const Tb=zs.attributes.normalizedList({for:"agent"});function Pb({node:e}){const t=xe({defaultValues:{name:e.data.name??"",attributeIds:e.data.attributeIds??[]}});return l.jsx(be,{node:e,form:t,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(Db,{})]})})}function Db(){const{setValue:e}=Oe(),t=Ne({name:"attributeIds"});return l.jsxs("div",{children:[l.jsxs(Lt,{children:[l.jsx($,{message:"Details"}),l.jsx($,{message:"Collect details from customers for use later in the flow."})]}),l.jsx(Mf,{queryOptions:Tb,selectedAttributeIds:t,onChange:n=>{e("attributeIds",n,{shouldDirty:!0})}})]})}function Nu(e,t,n){const s=[];let r=e;for(;r;){const i=n.find(a=>a.id===r);if(!i||(r=i.data.parentId,!r||r==="start"))break;const o=n.find(a=>a.id===r);if(!o)break;o.type===t&&s.push(r)}return s}function ju({node:e,onToolChange:t}){const{aiAgentId:n}=Me(["aiAgentId"]),{trans:s}=je(),r=J(u=>u.nodes),o=L.useMemo(()=>Nu(e.id,K.tool,r).map(d=>r.find(f=>f.id===d)).filter(Boolean),[e.id,r]).map(u=>u.data.toolId),{data:a}=Ae(ke.tools.list(n)),c=(a==null?void 0:a.tools.filter(u=>o.includes(u.id)))??[];return l.jsx(Ge,{name:"toolId",className:"mb-24",label:l.jsx($,{message:"Tool response"}),placeholder:s({message:"Select a tool response"}),showSearchField:!0,required:!0,onSelectionChange:t,children:c.map(u=>l.jsx(le,{value:u.id,children:u.name},u.id))})}function Eu({toolId:e,listPath:t,children:n}){const{data:s}=ol(ke.tools.get(e)),r=L.useMemo(()=>t?s.tool.response_schema.properties.filter(i=>i.path.startsWith(t)).map(i=>({name:i.id,displayName:i.path.replace(`${t}.[*].`,"").replace("[root]","items"),type:Bn.AiAgentTool,key:`${Bn.AiAgentTool}.${i.id}`,isReadonly:!0})):[],[s.tool.response_schema.properties,t]);return l.jsx(yf.Provider,{value:r,children:n})}const Ua={name:"",actionType:"sendMessage",actionValue:""};function zb({node:e}){const{trans:t}=je(),n=xe({defaultValues:{message:e.data.message??"",preventTyping:e.data.preventTyping??!1,name:e.data.name??"",listPath:e.data.listPath??"",propertyPath:e.data.propertyPath??"",toolId:e.data.toolId??"",button:e.data.button??Ua}}),s=n.watch("toolId"),r=()=>{n.setValue("button",Ua)};return l.jsx(be,{node:e,form:n,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(io,{name:"preventTyping",className:"mb-24",children:l.jsx($,{message:"Prevent customer from typing"})}),l.jsx(ut,{className:"mb-24",required:!1,placeholder:t({message:"Optional"})}),l.jsx(ju,{node:e,onToolChange:()=>r()}),s?l.jsx(Rb,{toolId:s,onListPathChange:()=>r()}):null]})})}function Rb({toolId:e,onListPathChange:t}){const{trans:n}=je(),{data:s}=Ae(ke.tools.get(e)),r=Ne({name:"listPath"});return s?l.jsxs("div",{children:[l.jsx(Ge,{className:"mb-24",name:"listPath",label:l.jsx($,{message:"Generate buttons from"}),placeholder:n({message:"Select a list"}),showSearchField:!0,required:!0,description:l.jsx($,{message:"Select a list from tool response to use for showing dynamic buttons"}),onSelectionChange:()=>t(),children:s.tool.response_schema.arrays.map(i=>l.jsx(le,{value:i.path,children:i.name},i.path))}),l.jsx(Eu,{toolId:e,listPath:r,children:l.jsx(Nr,{pathPrefix:"button",nameLabel:l.jsx($,{message:"Button label"})})})]}):l.jsx("div",{className:"mt-24 flex h-full w-full items-center justify-center",children:l.jsx(ln,{isIndeterminate:!0})})}const Lb=new RegExp('(<be-variable name="[a-zA-Z0-9_-]+" type="[a-zA-Z0-9_-]+" fallback="(?:[a-zA-Z0-9_-]+)?"></be-variable>)',"gm"),$b=new RegExp('<be-variable name="([a-zA-Z0-9_-]+)" type="([a-zA-Z0-9_-]+)" fallback="(([a-zA-Z0-9_-]+)?)"></be-variable>');function _u({children:e}){const t=L.useMemo(()=>e.split(Lb).filter(Boolean).map((s,r)=>{if(s.startsWith("<be-variable")){const i=s.match($b);if(i)return l.jsx(Ob,{name:i[1],type:i[2],fallback:i[3]},r)}return s}),[e]);return l.jsx("div",{children:t})}function Ob({name:e,type:t,fallback:n}){const{getItem:s}=lt(),r=s({name:e,type:t});return l.jsx("div",{className:"trim-both mx-2 inline-flex min-w-34 items-center justify-center rounded-full border bg-chip px-4 align-middle font-medium leading-[20px]",children:(r==null?void 0:r.displayName)||e})}function Bb({node:e}){const{trans:t}=je(),n=xe({defaultValues:{name:e.data.name??"",listPath:e.data.listPath??"",card:e.data.card??{},toolId:e.data.toolId??""}}),s=n.watch("toolId"),r=()=>{n.setValue("card",ce.dynamicCards.createNewStoredNode(e.data.parentId)[0].data.card)};return l.jsx(be,{node:e,form:n,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(io,{name:"preventTyping",className:"mb-24",children:l.jsx($,{message:"Prevent customer from typing"})}),l.jsx(ut,{className:"mb-24",required:!1,placeholder:t({message:"Optional"})}),l.jsx(ju,{node:e,onToolChange:()=>r()}),s?l.jsx(Vb,{toolId:s,node:e,onListPathChange:()=>r()}):null]})})}function Vb({toolId:e,node:t,onListPathChange:n}){const{trans:s}=je(),{data:r}=Ae(ke.tools.get(e)),{setValue:i}=Oe(),o=Ne({name:"listPath"});return r?l.jsxs("div",{children:[l.jsx(Ge,{className:"mb-24",name:"listPath",label:l.jsx($,{message:"Generate cards from"}),placeholder:s({message:"Select a list"}),showSearchField:!0,required:!0,description:l.jsx($,{message:"Select a list from tool response to use for showing dynamic cards"}),onSelectionChange:()=>n(),children:r.tool.response_schema.arrays.map(a=>l.jsx(le,{value:a.path,children:a.name},a.path))}),l.jsx(Eu,{toolId:e,listPath:o,children:l.jsx(Fb,{})})]}):l.jsx("div",{className:"mt-24 flex h-full w-full items-center justify-center",children:l.jsx(ln,{isIndeterminate:!0})})}function Fb(){return l.jsxs("div",{className:"rounded-panel border px-20 py-16",children:[l.jsx(Le,{name:"card.image",label:l.jsx($,{message:"Image"}),hideEmojiPicker:!0,className:"mb-20"}),l.jsx(Le,{name:"card.title",label:l.jsx($,{message:"Title"}),className:"mb-20"}),l.jsx(Le,{name:"card.description",label:l.jsx($,{message:"Description"}),className:"mb-20",multiline:!0}),l.jsx(Hb,{})]})}function Hb(){const[e,t]=L.useState([]),{fields:n,append:s,remove:r}=et({name:"card.buttons"}),i=()=>{s({name:"Button label",actionType:"openUrl",actionValue:""})};return l.jsxs("div",{className:"mt-20",children:[l.jsx("div",{className:"mb-4 text-sm",children:l.jsx($,{message:"Buttons"})}),l.jsx(hl,{variant:"outline",expandedValues:e,onExpandedChange:t,children:n.map((o,a)=>l.jsxs(ml,{label:l.jsx(qb,{index:a}),children:[l.jsx(Nr,{size:"sm",pathPrefix:`card.buttons.${a}`}),l.jsx("div",{className:"mt-12 text-right",children:l.jsx(ie,{size:"xs",color:"danger",variant:"outline",onClick:()=>{r(a),t([])},children:l.jsx($,{message:"Remove"})})})]},a))}),l.jsx(ie,{size:"sm",color:"primary",className:"-ml-18 mt-12",startIcon:l.jsx(Be,{}),onClick:()=>i(),children:l.jsx($,{message:"Add button"})})]})}function qb({index:e}){const t=`card.buttons.${e}.name`,n=Ne({name:t});return l.jsx(_u,{children:n})}function Gb({node:e}){const{aiAgentId:t}=Me(["aiAgentId"]),{trans:n}=je(),s=xe({defaultValues:e.data}),{data:r}=Ae(ke.flows.list(t)),{flowId:i}=Me(["flowId"]),o=s.watch("targetFlowId");return l.jsx(be,{node:e,form:s,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(Ge,{name:"targetFlowId",label:l.jsx($,{message:"Target flow"}),placeholder:n({message:"Choose target flow"}),showSearchField:!0,searchPlaceholder:n({message:"Find a flow"}),required:!0,children:r==null?void 0:r.flows.map(a=>`${a.id}`==`${i}`?null:l.jsx(le,{value:a.id,children:a.name},a.id))}),l.jsx(ie,{className:"-ml-12 mt-12",color:"primary",startIcon:l.jsx(pl,{}),elementType:el,to:`/dashboard/ai-agents/${t}/flows/${o}/edit`,target:"_blank",children:l.jsx($,{message:"Edit flow"})})]})})}function Yb({node:e}){const t=xe({defaultValues:{...e.data,attachmentIds:e.data.attachmentIds??[]}});return l.jsx(be,{node:e,form:t,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(ut,{showButtonsEditor:!0})]})})}function Wb({node:e}){const{trans:t}=je(),n=J(o=>o.flowIntent),s=J(o=>o.setFlowIntent),r=xe({defaultValues:{intent:n??""}}),i=o=>{s(o.intent)};return l.jsx(be,{node:e,form:r,onSubmit:i,children:l.jsx(ve,{node:e,children:l.jsx(an,{name:"intent",label:l.jsx($,{message:"Customer intent"}),placeholder:t({message:"Optional"}),inputElementType:"textarea",rows:3,description:l.jsx($,{message:"Here you can describe the customer intent. If AI Agent determines that user message matches this intent, this flow will be triggered. If left empty, this flow will only be triggerable manually (for example, by clicking on a button in greeting message)."})})})})}function Xb({node:e}){const{aiAgentId:t}=Me(["aiAgentId"]),{trans:n}=je(),s=xe({defaultValues:{name:e.data.name??"",toolId:e.data.toolId??""}}),{data:r}=Ae(ke.tools.list(t)),i=s.watch("toolId");return l.jsx(be,{node:e,form:s,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(Ge,{name:"toolId",label:l.jsx($,{message:"Tool"}),placeholder:n({message:"Select a tool"}),description:l.jsx($,{message:"Only tools that are set to live will be selectable here."}),showSearchField:!0,required:!0,children:r==null?void 0:r.tools.map(o=>l.jsx(le,{value:o.id,children:o.name},o.id))}),l.jsx(ie,{className:"-ml-12 mb-24 mt-8",color:"primary",startIcon:l.jsx(pl,{}),elementType:el,to:`/dashboard/ai-agents/${t}/tools/${i}/edit`,target:"_blank",children:l.jsx($,{message:"Edit tool"})}),!!i&&l.jsx(Ub,{toolId:i})]})})}function Ub({toolId:e}){var r;const{data:t}=Ae(ke.tools.get(e));if(!t)return l.jsx("div",{className:"mt-24 flex items-center justify-center",children:l.jsx(ln,{isIndeterminate:!0})});const n=t.tool.response_schema.properties.filter(i=>i.attribute).map(i=>i.attribute),s=((r=t.tool.config.apiRequest)==null?void 0:r.attributesUsed)??[];return l.jsxs("div",{children:[s!=null&&s.length?l.jsx(Zb,{requiredAttributes:s}):null,n!=null&&n.length?l.jsx(Kb,{updatedAttributes:n}):null]})}function Zb({requiredAttributes:e}){return l.jsxs("div",{className:"mb-16 rounded-panel border p-12 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-6",children:[l.jsx(Za,{size:"xs"}),l.jsx($,{message:"Data required for API request:"})]}),l.jsx(gl,{className:"mt-12",size:"sm",radius:"rounded-input",children:e.map(t=>l.jsx(Js,{children:t.name},t.name))})]})}function Kb({updatedAttributes:e}){return l.jsxs("div",{className:"rounded-panel border p-12 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-6",children:[l.jsx(Tf,{size:"xs"}),l.jsx($,{message:"Once completed, these attributes will be updated:"})]}),l.jsx(gl,{className:"mt-12",size:"sm",radius:"rounded-input",children:e.map(t=>l.jsx(Js,{children:t.name},t.name))})]})}function Qb({node:e}){const t=xe({defaultValues:{...e.data,attachmentIds:e.data.attachmentIds??[]}});return l.jsx(be,{node:e,form:t,children:l.jsxs(ve,{node:e,children:[l.jsx(Ee,{className:"mb-24"}),l.jsx(ut,{className:"mb-24"}),l.jsx(Jb,{node:e})]})})}function Jb({node:e}){var a,c;const n=(a=Ae(zs.agents.compact).data)==null?void 0:a.agents,s=Ae(zs.groups.normalizedList),r=(c=s.data)==null?void 0:c.groups;if(!n||!r)return l.jsx("div",{className:"flex h-[148px] items-center justify-center",children:l.jsx(ln,{isIndeterminate:!0,size:"sm"})});const i=e.data.groupId??s.data.defaultGroupId,o=n.filter(u=>u.groups.some(d=>d.id==i));return l.jsxs("div",{children:[l.jsx(Ge,{name:"groupId",className:"mb-24",label:l.jsx($,{message:"Group"}),selectionMode:"single",placeholder:"Optional",children:r.map(u=>l.jsx(le,{value:`${u.id}`,startIcon:l.jsx(Fo,{user:u,size:"sm"}),children:u.name},u.id))}),l.jsxs(Ge,{name:"agentId",label:l.jsx($,{message:"Agent"}),selectionMode:"single",placeholder:"Optional",children:[l.jsx(le,{value:"",children:l.jsx($,{message:"First available"})}),o.map(u=>l.jsx(le,{value:`${u.id}`,startIcon:l.jsx(Fo,{user:u,size:"sm"}),children:u.name},u.id))]})]})}function ev(){const e=J(r=>r.selectedNodeId),t=J(r=>r.nodes),n=e?t.find(r=>r.id===e):null,s=()=>{const r=document.getElementById(So);r&&r.requestSubmit()};return l.jsx(Xd,{initial:!1,mode:"wait",children:n?l.jsxs(L.Fragment,{children:[l.jsx(On.div,{initial:{x:Rs},animate:{x:0},exit:{x:Rs},transition:{type:"tween",duration:.15},className:"fixed right-8 top-8 z-20 h-full max-h-[calc(100%-16px)] w-512 rounded-panel border bg shadow-lg",children:l.jsx(nv,{node:n})},e?"open":"closed"),l.jsx(On.div,{...oo,className:"fixed inset-0 z-10 bg-[rgba(34,48,74,.4)]",onClick:()=>s()},"flow-underlay")]}):null})}function ve({node:e,children:t}){return l.jsx(Iu,{node:e,title:l.jsx(tv,{node:e}),actions:e.type===K.start?null:l.jsx(rv,{selectedNode:e}),children:t})}function Iu({node:e,title:t,actions:n,children:s}){const r=J(i=>i.setSelectedNodeId);return l.jsxs(L.Fragment,{children:[l.jsxs("div",{className:"flex h-64 flex-shrink-0 items-center border-b px-24",children:[l.jsx("div",{className:"mr-12 text-sm font-semibold text-muted",children:t}),l.jsx(ie,{variant:"outline",type:"button",size:"xs",className:"ml-auto",onClick:()=>r(null),children:l.jsx($,{message:"Cancel"})}),l.jsx(ie,{variant:"flat",color:"primary",type:"submit",size:"xs",form:So,className:"ml-10 min-w-70",children:l.jsx($,{message:"Save"})})]}),l.jsxs("div",{className:"compact-scrollbar flex-auto overflow-y-auto p-24",children:[n,l.jsx("div",{children:s},e.id)]})]})}function tv({node:e}){const t=ce[e.type],n=t.icon,s=t.displayName,r=pn(e.type);return l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{style:r,className:"mr-6 flex size-32 items-center justify-center rounded-button",children:l.jsx(n,{size:"xs"})}),l.jsx($,{...s})]})}function nv({node:e}){switch(e.type){case K.start:return l.jsx(Wb,{node:e});case K.message:return l.jsx(Yb,{node:e});case K.buttons:return l.jsx(Eb,{node:e});case K.dynamicButtons:return l.jsx(zb,{node:e});case K.articles:return l.jsx(ab,{node:e});case K.cards:return l.jsx(Cb,{node:e});case K.dynamicCards:return l.jsx(Bb,{node:e});case K.transfer:return l.jsx(Qb,{node:e});case K.closeConversation:return l.jsx(Mb,{node:e});case K.goToStep:return l.jsx(Zw,{node:e});case K.goToFlow:return l.jsx(Gb,{node:e});case K.collectDetails:return l.jsx(Pb,{node:e});case K.tool:return l.jsx(Xb,{node:e});case K.setAttribute:return l.jsx(Qw,{node:e});case K.addTags:return l.jsx(Fw,{node:e});case K.branches:return l.jsx(jb,{node:e})}return null}function rv({selectedNode:e}){const t=J(r=>r.removeNode),n=J(r=>r.removeNodeAndChildren),s=ce[e.type];return l.jsxs(or,{children:[l.jsx(ie,{variant:"outline",endIcon:l.jsx(tl,{}),className:"mb-24",size:"xs",children:l.jsx($,{message:"Step actions"})}),l.jsxs(ir,{children:[!s.forceDeleteAllChildren&&l.jsx(le,{value:"delete",onSelected:()=>{t(e.id)},children:l.jsx($,{message:"Delete this step"})}),l.jsx(le,{value:"deleteWithChildren",onSelected:()=>{n(e.id)},children:l.jsx($,{message:"Delete this and following steps"})})]})]})}const sv=["start","buttonsItem","branchesItem","toolResult","placeholder"];function jr({nodeId:e}){const{flowDirection:t}=Rt(),n=J(m=>m.getState),s=J(m=>m.setStoredNodes),r=J(m=>m.hoveredNodeId===e),i=J(m=>m.nodes),o=i.find(m=>m.id===e),a=i.find(m=>m.data.parentId===e),c=o?ce[o.type]:null,u=!(c!=null&&c.disallowChildren),d=c==null?void 0:c.isTerminal,f=!a||a.type===K.placeholder;if(!u||d)return null;const h=m=>{const{allNodes:p,newNodes:b}=Yf(n().storedNodes,{type:m,parentId:e});s(p,{panToNode:b[0].id,selectPannedNode:!0})};return l.jsx("div",{className:ge("absolute flex justify-center bg-transparent",t==="TB"&&"-bottom-34 left-0 h-34 w-full",t==="LR"&&"-right-34 bottom-0 top-0 my-auto h-24 w-34"),children:l.jsxs(or,{onItemSelected:m=>h(m),children:[l.jsx(mt,{label:l.jsx($,{message:"Add new step"}),children:l.jsx("button",{className:ge(t==="TB"&&"mt-8",t==="LR"&&"ml-8","flex h-28 w-28 items-center justify-center rounded-full border border-primary bg text-primary transition-button hover:bg-primary hover:text-on-primary",!r&&!f&&"opacity-0"),children:l.jsx(Be,{size:"sm"})})}),l.jsx(ir,{children:Object.entries(ce).map(([m,p])=>{if(sv.includes(m))return null;let b=!1;return!f&&(p.isTerminal||p.disallowChildren)&&(b=!0),p.requiredAnsector&&(o==null?void 0:o.type)!==p.requiredAnsector&&!Nu(e,p.requiredAnsector,i).length&&(b=!0),l.jsx(le,{value:m,startIcon:l.jsx(ov,{config:p}),isDisabled:b,children:l.jsx($,{...p.displayName})},m)})})]})})}function ov({config:e}){const t=e.icon,n=ko();return l.jsx("div",{style:{backgroundColor:n[`--node-color-${e.type}-bg`],color:n[`--node-color-${e.type}-fg`]},className:"mr-4 flex h-24 w-24 items-center justify-center rounded-button text-on-primary",children:l.jsx(t,{size:"xs"})})}function Er({radius:e="rounded-full"}){return l.jsx("div",{className:ge("pointer-events-none absolute inset-0 -left-5 -top-5 z-10 h-[calc(100%+10px)] w-[calc(100%+10px)] border-2 border-dashed border-primary",e)})}function We({type:e,position:t,size:n="w-8 h-8"}){return l.jsx(on,{className:ge(n,"pointer-events-none opacity-0"),type:e,position:t})}function _r({children:e,className:t,...n}){return l.jsx("div",{...n,className:ge("before:absolute before:-left-40 before:-top-40 before:-z-10 before:block before:h-[calc(100%+80px)] before:w-[calc(100%+80px)]",t),children:e})}function Fe({children:e,label:t,className:n,id:s,type:r,disableSelection:i}){const{flowDirection:o}=Rt(),a=J(f=>f.selectedNodeId===s),c=J(f=>f.setSelectedNodeId),u=ce[r].icon,d=pn(r);return l.jsxs(L.Fragment,{children:[l.jsx(We,{type:"target",position:o==="TB"?U.Top:U.Left}),l.jsx(jr,{nodeId:s}),a&&l.jsx(Er,{radius:"rounded-panel"}),l.jsxs(_r,{onClick:()=>{!i&&c(s)},className:ge("flex h-full w-full items-center justify-center gap-12 overflow-hidden rounded-panel border bg p-12",n),children:[l.jsx("div",{className:"flex aspect-square h-full flex-shrink-0 items-center justify-center rounded-panel",style:d,children:l.jsx(u,{size:"md"})}),l.jsxs("div",{className:ge("min-w-0 flex-auto text-[13px] leading-none",!!t&&"-mt-4"),children:[l.jsx("div",{className:ge("overflow-hidden overflow-ellipsis whitespace-nowrap text-sm font-medium",!!t&&"mb-2"),children:e}),!!t&&l.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-muted",children:t})]})]}),l.jsx(We,{type:"source",position:o==="TB"?U.Bottom:U.Right})]})}function iv(e){const t=[...e.data.conversationTags??[],...e.data.userTags??[]];return l.jsx(Fe,{id:e.id,type:e.type,label:t.length?t.join(", "):e.data.name,children:l.jsx($,{message:"Add tags"})})}function av({data:e,id:t,type:n}){var s;return l.jsx(Fe,{id:t,type:n,label:e.name,children:l.jsx($,{message:"Show articles (:count)",values:{count:((s=e.articleIds)==null?void 0:s.length)||0}})})}function Mo({id:e,type:t,children:n,onClick:s,isSelected:r,useNodeColor:i}){const{flowDirection:o}=Rt(),a=pn(t);return l.jsxs(L.Fragment,{children:[l.jsx(We,{type:"target",position:o==="TB"?U.Top:U.Left}),r&&l.jsx(Er,{}),l.jsx(_r,{onClick:()=>s==null?void 0:s(),style:i?a:void 0,className:ge("relative flex h-full w-full items-center justify-center rounded-full px-10",i?"font-bold shadow-sm":"border bg"),children:l.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-sm",children:n})}),l.jsx(We,{type:"source",position:o==="TB"?U.Bottom:U.Right}),l.jsx(jr,{nodeId:e})]})}function lv({data:e,type:t,id:n}){const s=J(a=>a.setSelectedNodeId),r=J(a=>a.selectedNodeId),i=e.parentId===r,o=e.name??"";return l.jsx(Mo,{id:n,type:t,isSelected:i,useNodeColor:!0,onClick:()=>{e.parentId&&s(e.parentId,n)},children:o?l.jsx("span",{children:o}):l.jsx($,{message:"Branch name"})})}function cv({children:e}){return l.jsx("div",{className:"absolute -top-34 left-1/2 w-max -translate-x-1/2 whitespace-nowrap bg-alt/70 p-8 text-sm font-semibold text-muted",children:e})}function uv({label:e,className:t,id:n,type:s}){const{flowDirection:r}=Rt(),i=J(u=>u.selectedNodeId===n),o=J(u=>u.setSelectedNodeId),a=ce[s].icon,c=pn(s);return l.jsxs(L.Fragment,{children:[l.jsx(We,{type:"target",position:r==="TB"?U.Top:U.Left}),l.jsx(jr,{nodeId:n}),i&&l.jsx(Er,{}),e&&l.jsx(cv,{children:e}),l.jsxs(_r,{onClick:()=>{o(n)},className:ge("relative isolate flex h-full w-full items-center justify-center shadow-sm",t),style:{color:c.color},children:[l.jsx("div",{className:"absolute size-[calc(100%-12px)] rotate-45 rounded-panel",style:{backgroundColor:c.backgroundColor}}),l.jsx(a,{size:"md",className:"z-10"})]}),l.jsx(We,{type:"source",position:r==="TB"?U.Bottom:U.Right})]})}function dv(e){return l.jsx(uv,{id:e.id,type:e.type,label:e.data.name})}function fv({data:e,id:t,type:n}){var s;return l.jsx(Fe,{id:t,type:n,label:e.name,children:l.jsx($,{message:"Show cards (:count)",values:{count:((s=e.cards)==null?void 0:s.length)||0}})})}function Ir({children:e,label:t,className:n,id:s,type:r,showChildCount:i}){const{flowDirection:o}=Rt(),a=J(m=>m.selectedNodeId===s),c=J(m=>m.setSelectedNodeId),u=ce[r].icon,f=J(m=>m.nodes).filter(m=>m.data.parentId===s).length,h=pn(r);return l.jsxs(L.Fragment,{children:[l.jsx(We,{type:"target",position:o==="TB"?U.Top:U.Left}),l.jsx(jr,{nodeId:s}),a&&l.jsx(Er,{radius:"rounded-panel"}),l.jsxs(_r,{onClick:()=>{c(s)},className:ge("flex h-full w-full flex-col overflow-hidden rounded-panel border bg",n),children:[l.jsx("div",{className:"min-h-0 flex-auto px-10 py-12 text-sm",children:l.jsx("div",{className:"line-clamp-2 break-words",children:e})}),l.jsxs("div",{className:ge("flex h-32 flex-shrink-0 items-center gap-8 border-t"),children:[l.jsx("div",{style:h,className:"flex h-full w-32 items-center justify-center text-on-primary",children:l.jsx(u,{size:"xs"})}),l.jsx("div",{className:"text-xs text-muted",children:t||l.jsx($,{...ce[r].displayName})}),!!f&&i&&l.jsx("div",{className:"ml-auto mr-8",children:l.jsx("div",{style:h,className:"flex h-18 w-18 items-center justify-center rounded-full bg-primary text-xs font-bold text-on-primary",children:f})})]})]}),l.jsx(We,{type:"source",position:o==="TB"?U.Bottom:U.Right})]})}function hv({data:e,id:t,type:n}){return l.jsx(Ir,{id:t,type:n,children:e.message?l.jsx("div",{children:e.message}):l.jsx("div",{className:"text-muted",children:l.jsx($,{message:"AI agent message"})})})}function mv(e){return l.jsx(Fe,{id:e.id,type:e.type,label:e.data.name,children:l.jsx($,{message:"Dynamic buttons"})})}function pv(e){return l.jsx(Fe,{id:e.id,type:e.type,label:e.data.name,children:l.jsx($,{message:"Dynamic cards"})})}function gv({data:e,id:t,type:n}){var o;const{aiAgentId:s}=Me(["aiAgentId"]),r=Ae(ke.flows.list(s)),i=e.targetFlowId?(o=r.data)==null?void 0:o.flows.find(a=>a.id===e.targetFlowId):null;return l.jsx(Fe,{id:t,type:n,label:e.name??(i==null?void 0:i.name),children:l.jsx($,{message:"Go to flow"})})}function xv({data:e,id:t,type:n}){const{trans:s}=je(),r=J(a=>a.nodes);let i=null;const o=e.targetNodeId?r.find(a=>a.id===e.targetNodeId):null;return o&&(i=o.data.name?o.data.name:s(ce[o.type].displayName)),l.jsx(Fe,{id:t,type:n,label:e.name??i,children:l.jsx($,{message:"Go to step"})})}function yv(e){const{flowDirection:t}=Rt();return l.jsxs(l.Fragment,{children:[l.jsx(We,{type:"target",position:t==="TB"?U.Top:U.Left}),l.jsx(We,{type:"source",position:t==="TB"?U.Bottom:U.Right})]})}function wv(e){return l.jsx(Fe,{id:e.id,type:e.type,label:e.data.name,children:l.jsx($,{message:"Set attribute"})})}function bv(e){var r;const{aiAgentId:t}=Me(["aiAgentId"]),n=Ae(ke.tools.list(t)),s=e.data.toolId?(r=n.data)==null?void 0:r.tools.find(i=>i.id===e.data.toolId):null;return l.jsx(Fe,{id:e.id,type:e.type,label:s==null?void 0:s.name,children:l.jsx($,{message:"Use tool"})})}function vv({data:e,id:t,type:n}){const s=J(o=>o.setSelectedNodeId),r=J(o=>o.selectedNodeId),i=e.parentId===r;return l.jsx(Mo,{id:t,type:n,isSelected:i,onClick:()=>{e.parentId&&s(e.parentId,t)},children:e.type==="success"?l.jsxs("div",{className:"flex items-center gap-8",children:[l.jsx(Ud,{size:"sm",className:"text-positive"}),l.jsx($,{message:"Success"})]}):l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx(Qs,{size:"sm",className:"block text-danger"}),l.jsx($,{message:"Failure"})]})})}function Nv({data:e,id:t,type:n}){const s=J(o=>o.setSelectedNodeId),r=J(o=>o.selectedNodeId),i=e.parentId===r;return l.jsx(Mo,{id:t,type:n,isSelected:i,onClick:()=>{e.parentId&&s(e.parentId,t)},children:e.name?l.jsx("span",{children:e.name}):l.jsx("span",{className:"text-muted",children:l.jsx($,{message:"Button label"})})})}function jv({data:e,id:t,type:n}){return l.jsx(Ir,{id:t,type:n,label:l.jsx($,{message:"Buttons"}),showChildCount:!0,children:e.message?l.jsx("div",{children:e.message}):l.jsx("div",{className:"text-muted",children:l.jsx($,{message:"AI agent message"})})})}function Ev(e){return l.jsx(Fe,{id:e.id,type:e.type,label:e.data.name,children:l.jsx($,{message:"Ask for details"})})}function _v({data:e,id:t,type:n}){return l.jsx(Ir,{id:t,type:n,label:l.jsx($,{message:"Message"}),children:e.message?l.jsx(_u,{children:e.message}):l.jsx("div",{className:"text-muted",children:l.jsx($,{message:"AI agent message"})})})}function Iv({id:e,type:t}){return l.jsx(Fe,{id:e,type:t,label:l.jsx($,{message:"Edit intent"}),children:l.jsx($,{message:"Start point"})})}function Sv({data:e,id:t,type:n}){return l.jsx(Ir,{id:t,type:n,children:e.message?l.jsx("div",{children:e.message}):l.jsx("div",{className:"text-muted",children:l.jsx($,{message:"AI agent message"})})})}const Cv={start:Iv,message:_v,buttons:jv,dynamicButtons:mv,buttonsItem:Nv,articles:av,cards:fv,dynamicCards:pv,collectDetails:Ev,tool:bv,toolResult:vv,setAttribute:wv,addTags:iv,branches:dv,branchesItem:lv,goToStep:xv,goToFlow:gv,transfer:Sv,closeConversation:hv,placeholder:yv};function kv(){return l.jsx(L.Fragment,{children:l.jsx(iu,{children:l.jsx(Av,{})})})}function Av(){const e=Ka(),t=ko(),n=J(d=>d.setHoveredNodeId),s=J(d=>d.removeNodeAndChildren),r=J(d=>d.getState),i=J(d=>d.nodes),o=J(d=>d.edges),a=J(d=>d.setCanvasSize),c=L.useRef(null),u=ue();return L.useEffect(()=>{Ow(u.getState().panZoom)},[]),L.useEffect(()=>Zd(c,d=>{a(d)}),[a]),l.jsx(sl,{children:l.jsxs(iw,{nodes:i,edges:o,nodeTypes:Cv,panOnScroll:!0,maxZoom:qn,minZoom:Hn,ref:c,zoomOnScroll:!1,zoomOnPinch:!1,zoomOnDoubleClick:!1,onNodeMouseEnter:(d,f)=>{n(f.id)},onNodeMouseLeave:()=>{n(null)},onKeyDown:d=>{(d.key==="Delete"||d.key==="Backspace")&&r().selectedNodeId&&!Pf()&&(d.preventDefault(),s(r().selectedNodeId))},proOptions:{hideAttribution:!0},className:"rounded-panel border",style:{"--xy-edge-stroke-width":3,"--xy-edge-stroke":e?"rgb(128, 129, 130)":"rgb(216, 220, 222)","--xy-edge-stroke-selected":"var(--xy-edge-stroke)",...t},children:[l.jsx(dw,{bgColor:e?void 0:"rgb(var(--be-bg-alt))"}),l.jsx(Mv,{}),l.jsx(Aw,{className:"rounded-panel border",pannable:!0,nodeColor:d=>{const f=d.type;return e?gu[f].bg:pu[f].bg}}),l.jsx(ev,{})]})})}function Mv(){const e=J(c=>c.zoom),t=J(c=>c.incrementZoom),n=J(c=>c.decrementZoom),s=J(c=>c.panToNode),r=J(c=>c.getState),{zoomTo:i}=wr(),o=()=>{i(t())},a=()=>{i(n())};return Ar("window","ctrl+-",()=>a()),Ar("window","ctrl+plus",()=>o()),Ar("window","Home",()=>{s(r().nodes[0])}),l.jsxs("div",{className:"absolute bottom-0 left-0 z-[5] flex flex-col p-10",children:[l.jsx(mt,{label:l.jsx($,{message:"Start point"}),children:l.jsx(Ie,{size:"sm",onClick:()=>{s(r().nodes[0])},children:l.jsx(rl,{})})}),l.jsx(mt,{label:l.jsx($,{message:"Zoom in"}),children:l.jsx(Ie,{size:"sm",onClick:()=>{o()},disabled:e>=qn,children:l.jsx(Be,{})})}),l.jsx(mt,{label:l.jsx($,{message:"Zoom out"}),children:l.jsx(Ie,{size:"sm",onClick:()=>{a()},disabled:e<=Hn,children:l.jsx(af,{})})})]})}function Aj(){const{flowId:e}=Me(["flowId"]),{data:t}=ol(ke.flows.get(e));return l.jsxs(Vw,{initialValue:t.flow.config,intent:t.flow.intent,children:[l.jsx(Tv,{}),l.jsxs("div",{className:"dashboard-grid-content dashboard-rounded-panel z-[1] flex h-full flex-col",children:[l.jsx(Dv,{flow:t.flow}),l.jsx("div",{className:"flex-auto p-24",children:l.jsx(kv,{})})]}),l.jsx(Pv,{})]})}function Tv(){const e=J(t=>t.isDirty);return l.jsx(Hf,{shouldBlock:e})}function Pv(){const{flowId:e}=Me(["flowId"]),{saveChanges:t,isSaving:n}=Su(),s=J(o=>o.isDirty),r=J(o=>o.previewVisible),i=J(o=>o.setPreviewVisible);return r?l.jsx(zf,{flowId:e,onClose:()=>i(!1),resetConversationMessage:s?o=>l.jsx(Bf,{className:"shadow-md",leadingIcon:l.jsx(Kd,{size:"sm"}),title:l.jsx($,{message:"Flow has unsaved changes."}),actions:l.jsx(ie,{size:"xs",color:"white",variant:"flat",className:"min-w-144",disabled:n,onClick:()=>{t.mutate(void 0,{onSuccess:()=>o()})},children:l.jsx($,{message:"Save and reset now"})}),description:l.jsx($,{message:"Save them and reset conversation to test the current version."})}):void 0}):null}function Dv({flow:e}){const{saveChanges:t,isSaving:n}=Su(),s=J(a=>a.isDirty),r=J(a=>a.previewVisible),i=J(a=>a.setPreviewVisible),o=l.jsxs(l.Fragment,{children:[l.jsx($f,{size:"xs",variant:"button",link:Lf.pages.flows,children:l.jsx($,{message:"Learn"})}),l.jsx(Rf,{onTogglePreview:()=>i(!r),previewIsVisible:r}),l.jsx(ie,{variant:"flat",color:"primary",className:"ml-auto",size:"xs",disabled:n||!s,onClick:()=>t.mutate(),children:l.jsx($,{message:"Save changes"})})]});return l.jsx(Of,{showSidebarToggleButton:!0,rightContent:o,children:l.jsxs(Ff,{size:"xl",children:[l.jsx(Go,{to:"../flows",children:l.jsx($,{message:"Flows"})}),l.jsx(Go,{children:e.name})]})})}function Su(){const{flowId:e}=Me(["flowId"]),t=J(o=>o.getPayloadForSaving),n=J(o=>o.setIsDirty),s=["save-flow-changes"],r=Vf({mutationKey:s})>0,i=Qd({mutationKey:s,mutationFn:()=>ef.put(`lc/ai-agent/flows/${e}`,t()),onSuccess:()=>{Qa.invalidateQueries({queryKey:ke.flows.invalidateKey}),n(!1),Ja(ae("Flow updated"))},onError:o=>Jd(o)});return{isSaving:r,saveChanges:i}}export{Aj as Component};
