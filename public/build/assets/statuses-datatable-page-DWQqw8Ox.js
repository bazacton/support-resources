import{j as e,F as f,T as s,z as D,az as m,ci as S,e as B,al as j,d as v,i as h,k as b,t as d,m as c,q as y,l as g,am as C,an as F,ap as P,aP as k,aq as I,B as u,s as T,aQ as N,b7 as H,r as p,av as x,aw as M,aj as Q,ax as L,aZ as U,bF as _}from"./client-OfhJa1Pp.js";import{A as K}from"./admin-config-tfY5n3F7.js";import{F as V}from"./select-Dsco87dL.js";import{o as w}from"./custom-menu-BbwshV9x.js";import{C as z}from"./confirmation-dialog-BIOq1A-h.js";import{M as G}from"./MoreVert-Ci70_mZh.js";import{s as R}from"./search-D3bB1V5N.js";import{D as W}from"./settings-links-D22SAe6v.js";import{G as $}from"./global-loading-progress-CKXIm6JS.js";import{D as Z}from"./data-table-add-item-button-2jwTYQ5G.js";import{D as J}from"./data-table-header-CeAVoFvI.js";import{D as X}from"./data-table-pagination-footer-CEEx1VtI.js";import{u as Y}from"./use-datatable-search-params-CQGreY35.js";import{D as ee}from"./data-table-emty-state-message-DLsG3g03.js";import{a as ae,D as se,b as te,c as re}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{u as ie}from"./use-datatable-query-BQ-GXlzU.js";import{h as oe}from"./main-CqFMqK8-.js";import{T as ne}from"./table-BifRiqkr.js";import"./dashboard-icons-CHop3mns.js";import"./library-icon-CHCHM-UW.js";import"./messages-square-icon-CTmom_u4.js";import"./Delete-BhyMZiPM.js";import"./Home--R_oEr6a.js";import"./SupervisorAccount-k9OnPB-d.js";import"./Translate-Cs-ut2nW.js";import"./TextFields-8TfbEP0O.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./external-link-DbBk1ItZ.js";import"./book-open-Cbdc52Ur.js";import"./Add-CN0r1QLK.js";import"./FilterAlt-CXibH0wr.js";import"./select-filter-panel-C_zo36WK.js";import"./form-chip-field-sH5S7-lx.js";import"./chip-list-CkGaRoaT.js";import"./filter-operator-names-BZog1mvA.js";import"./normalized-model-field-COxh0lBC.js";import"./Edit-JNj6SFDx.js";import"./skeleton-Cp2m1Uyc.js";import"./accordion-DWEV-mKU.js";import"./accordtion-animation-BGCK95Hj.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import"./ArrowDownward-mN9PlQJw.js";import"./useEffectEvent-DQn3o5L0.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./useGlobalListeners-CeWFSHKo.js";function A({status:a}){return e.jsxs(e.Fragment,{children:[e.jsx(f,{name:"label",label:e.jsx(s,{message:"Agent label"}),className:"mb-24",required:!0,autoFocus:!0}),e.jsx(f,{name:"user_label",label:"Customer label",className:"mb-24",description:e.jsx(s,{message:"Label that will be shown to customers. If left empty, agent label will be shown instead."})}),e.jsx(V,{name:"category",label:"Category",className:"mb-24",disabled:a==null?void 0:a.internal,required:!0,children:Object.values(D).map(t=>e.jsx(m,{value:t,children:e.jsx(S,{category:t})},t))}),e.jsx(B,{name:"active",disabled:a==null?void 0:a.internal,description:e.jsx(s,{message:"Disabled statuses will be hidden from both agents and customers. Default statuses can't be deactivated."}),children:e.jsx(s,{message:"Active"})})]})}function le(){const{close:a,formId:t}=j(),r=v({defaultValues:{category:D.open}}),o=h({mutationFn:i=>b.post("helpdesk/statuses",i),onSuccess:()=>{d(c("Status created")),y.invalidateQueries({queryKey:g.statuses.invalidateKey}),a()},onError:i=>w(i,r)});return e.jsxs(C,{children:[e.jsx(F,{children:e.jsx(s,{message:"Create status"})}),e.jsx(P,{children:e.jsx(k,{id:t,form:r,onSubmit:i=>{o.mutate(i)},children:e.jsx(A,{})})}),e.jsxs(I,{children:[e.jsx(u,{onClick:()=>a(),children:e.jsx(s,{message:"Cancel"})}),e.jsx(u,{variant:"flat",color:"primary",type:"submit",form:t,disabled:o.isPending,children:e.jsx(s,{message:"Create"})})]})]})}function O(a,t){return h({mutationFn:r=>b.put(`helpdesk/statuses/${a.id}`,r),onSuccess:()=>{d(c("Status updated")),y.invalidateQueries({queryKey:g.statuses.invalidateKey})},onError:r=>t?w(r,t):T(r)})}function q({status:a}){const{close:t,formId:r}=j(),o=v({defaultValues:{label:a.label,user_label:a.user_label,category:a.category,active:a.active}}),i=O(a,o);return e.jsxs(C,{children:[e.jsx(F,{children:e.jsx(s,{message:"Update status"})}),e.jsx(P,{children:e.jsx(k,{id:r,form:o,onSubmit:n=>{i.mutate(n,{onSuccess:()=>t()})},children:e.jsx(A,{})})}),e.jsxs(I,{children:[e.jsx(u,{onClick:()=>t(),children:e.jsx(s,{message:"Cancel"})}),e.jsx(u,{variant:"flat",color:"primary",type:"submit",form:r,disabled:i.isPending,children:e.jsx(s,{message:"Update"})})]})]})}function me({status:a}){const t=h({mutationFn:()=>b.delete(`helpdesk/statuses/${a.id}`),onSuccess:()=>y.invalidateQueries({queryKey:g.statuses.invalidateKey}),onError:o=>T(o)}),{close:r}=j();return e.jsx(z,{isDanger:!0,isLoading:t.isPending,title:e.jsx(s,{message:"Delete status"}),body:e.jsx(s,{message:"Are you sure you want to delete this status?"}),confirm:e.jsx(s,{message:"Delete"}),onConfirm:()=>{t.mutate(void 0,{onSuccess:()=>r()})}})}const de=[{key:"label",header:()=>e.jsx(s,{message:"Label"}),visibleInMode:"all",body:a=>a.label},{key:"user_label",header:()=>e.jsx(s,{message:"User label"}),body:a=>a.user_label||"-"},{key:"category",allowsSorting:!0,header:()=>e.jsx(s,{message:"Category"}),body:a=>e.jsx(S,{category:a.category})},{key:"active",allowsSorting:!0,header:()=>e.jsx(s,{message:"Active"}),body:a=>a.active?e.jsx(N,{className:"text-muted"}):null},{key:"updated_at",allowsSorting:!0,header:()=>e.jsx(s,{message:"Last updated"}),body:a=>e.jsx(H,{date:a.updated_at})},{key:"actions",hideHeader:!0,align:"end",visibleInMode:"all",header:()=>e.jsx(s,{message:"Actions"}),body:a=>e.jsx(ce,{status:a}),width:"w-44 flex-shrink-0"}];function ce({status:a}){const[t,r]=p.useState(!1),[o,i]=p.useState(!1),n=O(a),l=()=>n.mutate({active:!0},{onSuccess:()=>d(c("Activated status"))}),E=()=>n.mutate({active:!1},{onSuccess:()=>d(c("Deactivated status"))});return e.jsxs(p.Fragment,{children:[t&&e.jsx(x,{type:"modal",isOpen:t,onOpenChange:r,children:e.jsx(me,{status:a})}),o&&e.jsx(x,{type:"modal",isOpen:o,onOpenChange:i,children:e.jsx(q,{status:a})}),e.jsxs(M,{children:[e.jsx(Q,{className:"text-muted",disabled:n.isPending,children:e.jsx(G,{})}),e.jsxs(L,{children:[e.jsx(m,{value:"edit",onSelected:()=>i(!0),children:e.jsx(s,{message:"Edit"})}),!a.active&&e.jsx(m,{value:"activate",onSelected:()=>l(),children:e.jsx(s,{message:"Activate"})}),a.active&&e.jsx(m,{value:"deactivate",onSelected:()=>E(),isDisabled:a.internal,children:e.jsx(s,{message:"Deactivate"})}),e.jsx(m,{value:"delete",className:"text-danger",onSelected:()=>r(!0),isDisabled:a.internal,children:e.jsx(s,{message:"Delete"})})]})]})]})}function oa(){const{searchParams:a,sortDescriptor:t,mergeIntoSearchParams:r,setSearchQuery:o,isFiltering:i}=Y(U),n=ie(g.statuses.index(a));return e.jsxs(ae,{children:[e.jsx(oe,{children:e.jsx(s,{message:"Statuses"})}),e.jsx($,{query:n}),e.jsx(se,{title:e.jsx(s,{message:"Statuses"}),showSidebarToggleButton:!0,rightContent:e.jsx(W,{variant:"button",link:K.pages.statuses,size:"xs"})}),e.jsxs(te,{children:[e.jsx(J,{searchValue:a.query,onSearchChange:o,actions:e.jsxs(x,{type:"modal",children:[e.jsx(Z,{children:e.jsx(s,{message:"Add status"})}),e.jsx(le,{})]})}),e.jsxs(re,{children:[e.jsx(ne,{columns:de,data:n.items,sortDescriptor:t,onSortChange:r,enableSelection:!1,cellHeight:"h-64",onAction:l=>_(q,{status:l})}),n.isEmpty&&e.jsx(ee,{isFiltering:i,image:R,title:e.jsx(s,{message:"No conversation statuses have been created yet"}),filteringTitle:e.jsx(s,{message:"No matching conversation statuses"})}),e.jsx(X,{hideIfOnlyOnePage:!0,query:n,onPageChange:l=>r({page:l}),onPerPageChange:l=>r({perPage:l})})]})]})]})}export{oa as Component};
