const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ace-editor-DaDisMMx.js","./client-OfhJa1Pp.js"])))=>i.map(i=>d[i]);
import{m as Y,j as d,aw as xe,aj as L,p as V,ax as we,az as S,T as w,r as k,av as Ce,aM as st,B as q,ag as lt,a_ as le,ck as rt,d as it,al as De,am as Be,an as We,ap as $e,aP as at,F as Pe,aq as _e,_ as ct,P as dt,bd as ut,f as Oe,ae as ft}from"./client-OfhJa1Pp.js";import{F as ht,a as pt,b as mt,c as gt,d as bt,e as xt,f as wt,H as Ct,S as yt,N as St,U as At,R as jt}from"./Undo-D06cFnP3.js";import{u as I}from"./tiptap-editor-context-BAgvnYfz.js";import{F as vt,L as Tt,a as Mt,C as kt,b as Rt}from"./list-buttons-BgDZUgyW.js";import{C as Nt}from"./color-picker-dialog-C1vQg-H6.js";import{F as Ht}from"./FormatColorFill-8XiV_8LV.js";import{I as Lt}from"./image-button-ExYLUK-F.js";import{M as It}from"./MoreVert-Ci70_mZh.js";import{P as Et}from"./PriorityHigh-C-SfNUlB.js";import{D as Ve}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{C as zt}from"./FormatListNumbered-rvs8UAfH.js";import"./ArrowBack-DcV9hHRo.js";import"./image-up-DCwS84Wx.js";import{F as Ft}from"./file-upload-provider-DTPBUrkd.js";import"./Link-DfTxpaxj.js";import{c as re,N as U,m as P,T as D,W as Dt,q as Ke,P as qe,j as ye,k as Bt,h as F,X as Wt,F as H,S as $,D as de,g as ue,f as $t,Y as Pt,n as _t,o as Ot,Z as Vt}from"./index-W-EjzbYI.js";import{i as Kt,a as qt,T as Ut,C as Xt,b as Jt,l as Gt}from"./index-DTFmR8Ac.js";import{P as Yt,T as Zt,a as Qt}from"./index-RecbqAl0.js";import{E as en}from"./Edit-JNj6SFDx.js";import{D as Ue}from"./main-CqFMqK8-.js";import{D as tn}from"./dashboard-sidenav-B5THGxpt.js";import{T as nn}from"./toggle-right-sidebar-icon-DXM314Tt.js";const Z={left:{icon:gt,label:Y("Align left")},center:{icon:mt,label:Y("Align center")},right:{icon:pt,label:Y("Align right")},justify:{icon:ht,label:Y("Justify")}};function on({size:t}){const e=I(),n=Object.keys(Z).find(s=>e==null?void 0:e.isActive({textAlign:s})),o=n?Z[n].icon:Z.left.icon;return d.jsxs(xe,{floatingWidth:"auto",selectionMode:"single",selectedValue:n,onSelectionChange:s=>{e==null||e.commands.focus(),e==null||e.commands.setTextAlign(s)},children:[d.jsx(L,{size:t,disabled:!e,color:n?"primary":null,className:V("flex-shrink-0"),children:d.jsx(o,{})}),d.jsx(we,{children:Object.entries(Z).map(([s,l])=>{const r=l.icon;return d.jsx(S,{value:s,startIcon:d.jsx(r,{size:"md"}),capitalizeFirst:!0,children:d.jsx(w,{message:l.label.message})},s)})})]})}function sn({size:t}){const e=I(),[n,o]=k.useState(!1),s=e==null?void 0:e.getAttributes("textStyle").color,l=e==null?void 0:e.getAttributes("textStyle").backgroundColor;return d.jsxs(k.Fragment,{children:[d.jsxs("span",{className:V("flex-shrink-0 whitespace-nowrap"),children:[d.jsx(L,{disabled:!e,size:t,color:s?"primary":null,onClick:()=>{o("text")},children:d.jsx(bt,{})}),d.jsx(L,{disabled:!e,size:t,color:l?"primary":null,onClick:()=>{o("bg")},children:d.jsx(Ht,{})})]}),d.jsx(Ce,{defaultValue:n==="text"?"#000000":"#FFFFFF",type:"modal",isOpen:!!n,onClose:r=>{r&&(n==="text"?e==null||e.commands.setColor(r):e==null||e.commands.setBackgroundColor(r)),o(!1)},children:d.jsx(Nt,{})})]})}function K(){return d.jsx("div",{className:"self-stretch mx-4 w-1 bg-divider flex-shrink-0"})}function N({children:t,modifier:e,separator:n="+"}){const o=st()?d.jsx("span",{className:"text-base align-middle",children:"âŒ˜"}):"Ctrl";return d.jsxs("kbd",{className:"text-xs text-muted",children:[e&&d.jsxs(d.Fragment,{children:[o,n]}),t]})}function ln({size:t}){const e=I();return d.jsxs(xe,{floatingMinWidth:"w-256",onItemSelected:n=>{e==null||e.commands.focus(),typeof n=="string"&&n.startsWith("h")?e==null||e.commands.toggleHeading({level:parseInt(n.replace("h",""))}):n==="code"?e==null||e.commands.toggleCode():n==="strike"?e==null||e.commands.toggleStrike():n==="super"?e==null||e.commands.toggleSuperscript():n==="sub"?e==null||e.commands.toggleSubscript():n==="blockquote"?e==null||e.commands.toggleBlockquote():n==="paragraph"&&(e==null||e.commands.setParagraph())},children:[d.jsx(q,{className:V("flex-shrink-0"),variant:"text",size:t,endIcon:d.jsx(lt,{}),disabled:!e,children:d.jsx(w,{message:"Format"})}),d.jsxs(we,{children:[d.jsx(S,{value:"h1",endSection:d.jsx(N,{modifier:!0,children:"Alt+1"}),children:d.jsx(w,{message:"Heading :number",values:{number:1}})}),d.jsx(S,{value:"h2",endSection:d.jsx(N,{modifier:!0,children:"Alt+2"}),children:d.jsx(w,{message:"Heading :number",values:{number:2}})}),d.jsx(S,{value:"h3",endSection:d.jsx(N,{modifier:!0,children:"Alt+3"}),children:d.jsx(w,{message:"Heading :number",values:{number:3}})}),d.jsx(S,{value:"h4",endSection:d.jsx(N,{modifier:!0,children:"Alt+4"}),children:d.jsx(w,{message:"Heading :number",values:{number:4}})}),d.jsx(S,{value:"code",endSection:d.jsx(N,{modifier:!0,children:"E"}),children:d.jsx(w,{message:"Code"})}),d.jsx(S,{value:"strike",endSection:d.jsx(N,{modifier:!0,children:"Shift+X"}),children:d.jsx(w,{message:"Strikethrough"})}),d.jsx(S,{value:"super",endSection:d.jsx(N,{modifier:!0,separator:" ",children:"."}),children:d.jsx(w,{message:"Superscript"})}),d.jsx(S,{value:"sub",endSection:d.jsx(N,{modifier:!0,separator:" ",children:","}),children:d.jsx(w,{message:"Subscript"})}),d.jsx(S,{value:"blockquote",endSection:d.jsx(N,{modifier:!0,children:"Shift+B"}),children:d.jsx(w,{message:"Blockquote"})}),d.jsx(S,{value:"paragraph",endSection:d.jsx(N,{modifier:!0,children:"Alt+0"}),children:d.jsx(w,{message:"Paragraph"})})]})]})}function rn({size:t}){const e=I();return d.jsxs("span",{className:V("flex-shrink-0","whitespace-nowrap"),children:[d.jsx(le,{label:d.jsx(w,{message:"Decrease indent"}),children:d.jsx(L,{size:t,disabled:!e,onClick:()=>{e==null||e.commands.focus(),e==null||e.commands.outdent()},children:d.jsx(xt,{})})}),d.jsx(le,{label:d.jsx(w,{message:"Increase indent"}),children:d.jsx(L,{size:t,disabled:!e,onClick:()=>{e==null||e.commands.focus(),e==null||e.commands.indent()},children:d.jsx(wt,{})})})]})}function an({size:t}){const e=I(),[n,o]=k.useState(!1);return d.jsxs(d.Fragment,{children:[d.jsxs(xe,{onItemSelected:s=>{s==="hr"?(e==null||e.commands.focus(),e==null||e.commands.setHorizontalRule()):s==="embed"?o("embed"):(e==null||e.commands.focus(),e==null||e.commands.addInfo({type:s}))},children:[d.jsx(L,{variant:"text",size:t,className:V("flex-shrink-0"),disabled:!e,children:d.jsx(It,{})}),d.jsxs(we,{children:[d.jsx(S,{value:"hr",startIcon:d.jsx(Ct,{}),children:d.jsx(w,{message:"Horizontal rule"})}),d.jsx(S,{value:"embed",startIcon:d.jsx(yt,{}),children:d.jsx(w,{message:"Embed"})}),d.jsx(S,{value:"important",startIcon:d.jsx(Et,{}),children:d.jsx(w,{message:"Important"})}),d.jsx(S,{value:"warning",startIcon:d.jsx(rt,{}),children:d.jsx(w,{message:"Warning"})}),d.jsx(S,{value:"success",startIcon:d.jsx(St,{}),children:d.jsx(w,{message:"Note"})})]})]}),d.jsx(Ce,{type:"modal",isOpen:!!n,onClose:()=>{o(!1)},children:d.jsx(cn,{})})]})}function cn(){const t=I(),e=t==null?void 0:t.getAttributes("embed").src,n=it({defaultValues:{src:e}}),{formId:o,close:s}=De();return d.jsxs(Be,{children:[d.jsx(We,{children:d.jsx(w,{message:"Insert link"})}),d.jsx($e,{children:d.jsx(at,{form:n,id:o,onSubmit:l=>{t==null||t.commands.setEmbed(l),s()},children:d.jsx(Pe,{name:"src",label:d.jsx(w,{message:"Embed URL"}),autoFocus:!0,type:"url",required:!0})})}),d.jsxs(_e,{children:[d.jsx(q,{onClick:s,variant:"text",children:d.jsx(w,{message:"Cancel"})}),d.jsx(q,{type:"submit",form:o,disabled:!n.formState.isValid,variant:"flat",color:"primary",children:d.jsx(w,{message:"Add"})})]})]})}function dn({size:t="sm",justify:e="justify-center-safe",hideInsertButton:n=!1,imageUploadType:o}){return d.jsxs("div",{className:V("hidden-scrollbar flex flex-shrink-0 items-center overflow-x-auto border-b px-4 py-2 text-muted",e),children:[d.jsx(ln,{size:t}),d.jsx(K,{}),d.jsx(vt,{size:t}),d.jsx(K,{}),d.jsx(on,{size:t}),d.jsx(rn,{size:t}),d.jsx(K,{}),d.jsx(Tt,{size:t}),d.jsx(K,{}),d.jsx(Mt,{size:t}),d.jsx(Lt,{size:t,uploadType:o}),!n&&d.jsx(an,{size:t}),d.jsx(K,{}),d.jsx(sn,{size:t}),d.jsx(K,{}),d.jsx(kt,{size:t}),d.jsx(Rt,{size:t})]})}function un(){const t=I();return d.jsxs("span",{className:"flex items-center max-md:hidden",children:[d.jsx(L,{size:"md",disabled:!t||!t.can().undo(),onClick:()=>{t==null||t.commands.focus(),t==null||t.commands.undo()},children:d.jsx(At,{})}),d.jsx(L,{size:"md",disabled:!t||!t.can().redo(),onClick:()=>{t==null||t.commands.focus(),t==null||t.commands.redo()},children:d.jsx(jt,{})})]})}const fn=ct.lazy(()=>ut(()=>import("./ace-editor-DaDisMMx.js"),__vite__mapDeps([0,1]),import.meta.url));function hn({defaultValue:t,mode:e="html",title:n,onSave:o,isSaving:s,footerStartAction:l,beautify:r,editorRef:a}){const[i,c]=k.useState(t),[u,f]=k.useState(!0);return d.jsxs(Be,{size:"fullscreen",className:"h-full w-full",children:[d.jsx(We,{children:n}),d.jsx($e,{className:"relative flex-auto",padding:"p-0",children:d.jsx(k.Suspense,{fallback:d.jsx("div",{className:"flex h-400 w-full items-center justify-center",children:d.jsx(dt,{"aria-label":"Loading editor...",isIndeterminate:!0,size:"md"})}),children:d.jsx(fn,{beautify:r,mode:e,onChange:h=>c(h),defaultValue:i||"",onIsValidChange:f,editorRef:a})})}),d.jsx(pn,{disabled:!u||s,value:i,onSave:o,startAction:l})]})}function pn({disabled:t,value:e,onSave:n,startAction:o}){const{close:s}=De();return d.jsxs(_e,{dividerTop:!0,startAction:o,children:[d.jsx(q,{onClick:()=>s(),children:d.jsx(w,{message:"Cancel"})}),d.jsx(q,{disabled:t,variant:"flat",color:"primary",onClick:()=>{n?n(e):s(e)},children:d.jsx(w,{message:"Save"})})]})}function mn(){const t=I();return d.jsxs(Ce,{type:"modal",onClose:e=>{e!=null&&(t==null||t.commands.setContent(e))},children:[d.jsx(le,{label:d.jsx(w,{message:"Source code"}),children:d.jsx(L,{className:"text-muted max-md:hidden",variant:"text",disabled:!t,children:d.jsx(zt,{})})}),d.jsx(hn,{title:d.jsx(w,{message:"Source code"}),defaultValue:(t==null?void 0:t.getHTML())??""})]})}function gn({children:t,onSave:e,saveButton:n,isSaving:o=!1,rightContent:s,showSidebarToggleButton:l=!0}){const r=I();return d.jsx(Ve,{showSidebarToggleButton:l,rightContent:d.jsxs(k.Fragment,{children:[d.jsx(un,{}),d.jsx(mn,{}),e&&d.jsx(bn,{onSave:()=>{e((r==null?void 0:r.getHTML())??"")},isLoading:o}),n,s]}),children:t})}function bn({onSave:t,isLoading:e}){const n=I(),s=Oe().watch("title");return d.jsx(q,{variant:"flat",size:"sm",color:"primary",className:"min-w-90",disabled:e||!s||!n,onClick:()=>t((n==null?void 0:n.getHTML())??""),children:d.jsx(w,{message:"Save"})})}const xn=re.create({name:"backgroundColor",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:t=>t.style.backgroundColor.replace(/['"]+/g,""),renderHTML:t=>t.backgroundColor?{style:`background-color: ${t.backgroundColor}`}:{}}}}]},addCommands(){return{setBackgroundColor:t=>({chain:e})=>e().setMark("textStyle",{backgroundColor:t}).run(),unsetBackgroundColor:()=>({chain:t})=>t().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()}}}),wn=U.create({name:"embed",group:"block",atom:!0,addAttributes(){return{allowfullscreen:{default:null},allow:{default:"autoplay; fullscreen; picture-in-picture"},src:{default:null}}},parseHTML(){return[{tag:"iframe"}]},renderHTML({HTMLAttributes:t}){return["iframe",P(this.options.HTMLAttributes,t)]},addCommands(){return{setEmbed:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}}}),Cn=re.create({name:"indent",addOptions:()=>({types:["listItem","paragraph"],minLevel:0,maxLevel:6}),addGlobalAttributes(){return[{types:this.options.types,attributes:{indent:{renderHTML:t=>(t==null?void 0:t.indent)>this.options.minLevel?{"data-indent":t.indent}:null,parseHTML:t=>{const e=Number(t.getAttribute("data-indent"));return e&&e>this.options.minLevel?e:null}}}}]},addCommands(){const t=(o,s,l)=>{var a;const r=(a=o==null?void 0:o.doc)==null?void 0:a.nodeAt(s);if(r){const i=(r.attrs.indent||0)+l,{minLevel:c,maxLevel:u}=this.options,f=i<c?c:i>u?u:i;if(f!==r.attrs.indent){const{indent:h,...m}=r.attrs,p=f>c?{...m,indent:f}:m;return o.setNodeMarkup(s,r.type,p,r.marks)}}return o},e=(o,s)=>{const{doc:l,selection:r}=o;if(l&&r&&(r instanceof D||r instanceof Dt)){const{from:a,to:i}=r;l.nodesBetween(a,i,(c,u)=>this.options.types.includes(c.type.name)?(o=t(o,u,s),!1):!0)}return o},n=o=>()=>({tr:s,state:l,dispatch:r})=>{const{selection:a}=l;return s=s.setSelection(a),s=e(s,o),s.docChanged?(r==null||r(s),!0):!1};return{indent:n(1),outdent:n(-1)}},addKeyboardShortcuts(){return{Tab:({editor:t})=>t.state.selection.to>t.state.selection.from?this.editor.commands.indent():!1,"Shift-Tab":({editor:t})=>t.state.selection.to>t.state.selection.from?this.editor.commands.outdent():!1}}}),yn=U.create({name:"be-info-block",group:"block",content:"block+",defining:!0,addOptions(){return{types:["important","warning","success"],defaultType:"success"}},addAttributes(){return{type:{default:this.options.defaultType,parseHTML:t=>{for(const e of this.options.types)if(t.classList.contains(e))return e;return this.options.defaultType},renderHTML:t=>({class:t.type})}}},parseHTML(){return[{tag:"div",contentElement:"p",getAttrs:t=>t.classList.contains("info-block")&&null}]},renderHTML({HTMLAttributes:t}){return["div",P(t,{class:"info-block"}),0]},addCommands(){return{addInfo:t=>({commands:e})=>e.wrapIn(this.name,t)}}});var Sn=Ke.create({name:"subscript",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"sub"},{style:"vertical-align",getAttrs(t){return t!=="sub"?!1:null}}]},renderHTML({HTMLAttributes:t}){return["sub",P(this.options.HTMLAttributes,t),0]},addCommands(){return{setSubscript:()=>({commands:t})=>t.setMark(this.name),toggleSubscript:()=>({commands:t})=>t.toggleMark(this.name),unsetSubscript:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-,":()=>this.editor.commands.toggleSubscript()}}}),An=Sn,jn=Ke.create({name:"superscript",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"sup"},{style:"vertical-align",getAttrs(t){return t!=="super"?!1:null}}]},renderHTML({HTMLAttributes:t}){return["sup",P(this.options.HTMLAttributes,t),0]},addCommands(){return{setSuperscript:()=>({commands:t})=>t.setMark(this.name),toggleSuperscript:()=>({commands:t})=>t.toggleMark(this.name),unsetSuperscript:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-.":()=>this.editor.commands.toggleSuperscript()}}}),vn=jn;let fe,he;if(typeof WeakMap<"u"){let t=new WeakMap;fe=e=>t.get(e),he=(e,n)=>(t.set(e,n),n)}else{const t=[];let n=0;fe=o=>{for(let s=0;s<t.length;s+=2)if(t[s]==o)return t[s+1]},he=(o,s)=>(n==10&&(n=0),t[n++]=o,t[n++]=s)}var y=class{constructor(t,e,n,o){this.width=t,this.height=e,this.map=n,this.problems=o}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const o=e%this.width,s=e/this.width|0;let l=o+1,r=s+1;for(let a=1;l<this.width&&this.map[e+a]==n;a++)l++;for(let a=1;r<this.height&&this.map[e+this.width*a]==n;a++)r++;return{left:o,top:s,right:l,bottom:r}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:o,right:s,top:l,bottom:r}=this.findCell(t);return e=="horiz"?(n<0?o==0:s==this.width)?null:this.map[l*this.width+(n<0?o-1:s)]:(n<0?l==0:r==this.height)?null:this.map[o+this.width*(n<0?l-1:r)]}rectBetween(t,e){const{left:n,right:o,top:s,bottom:l}=this.findCell(t),{left:r,right:a,top:i,bottom:c}=this.findCell(e);return{left:Math.min(n,r),top:Math.min(s,i),right:Math.max(o,a),bottom:Math.max(l,c)}}cellsInRect(t){const e=[],n={};for(let o=t.top;o<t.bottom;o++)for(let s=t.left;s<t.right;s++){const l=o*this.width+s,r=this.map[l];n[r]||(n[r]=!0,!(s==t.left&&s&&this.map[l-1]==r||o==t.top&&o&&this.map[l-this.width]==r)&&e.push(r))}return e}positionAt(t,e,n){for(let o=0,s=0;;o++){const l=s+n.child(o).nodeSize;if(o==t){let r=e+t*this.width;const a=(t+1)*this.width;for(;r<a&&this.map[r]<s;)r++;return r==a?l-1:this.map[r]}s=l}}static get(t){return fe(t)||he(t,Tn(t))}};function Tn(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const e=Mn(t),n=t.childCount,o=[];let s=0,l=null;const r=[];for(let c=0,u=e*n;c<u;c++)o[c]=0;for(let c=0,u=0;c<n;c++){const f=t.child(c);u++;for(let p=0;;p++){for(;s<o.length&&o[s]!=0;)s++;if(p==f.childCount)break;const b=f.child(p),{colspan:g,rowspan:x,colwidth:j}=b.attrs;for(let T=0;T<x;T++){if(T+c>=n){(l||(l=[])).push({type:"overlong_rowspan",pos:u,n:x-T});break}const B=s+T*e;for(let M=0;M<g;M++){o[B+M]==0?o[B+M]=u:(l||(l=[])).push({type:"collision",row:c,pos:u,n:g-M});const G=j&&j[M];if(G){const X=(B+M)%e*2,ae=r[X];ae==null||ae!=G&&r[X+1]==1?(r[X]=G,r[X+1]=1):ae==G&&r[X+1]++}}}s+=g,u+=b.nodeSize}const h=(c+1)*e;let m=0;for(;s<h;)o[s++]==0&&m++;m&&(l||(l=[])).push({type:"missing",row:c,n:m}),u++}(e===0||n===0)&&(l||(l=[])).push({type:"zero_sized"});const a=new y(e,n,o,l);let i=!1;for(let c=0;!i&&c<r.length;c+=2)r[c]!=null&&r[c+1]<n&&(i=!0);return i&&kn(a,r,t),a}function Mn(t){let e=-1,n=!1;for(let o=0;o<t.childCount;o++){const s=t.child(o);let l=0;if(n)for(let r=0;r<o;r++){const a=t.child(r);for(let i=0;i<a.childCount;i++){const c=a.child(i);r+c.attrs.rowspan>o&&(l+=c.attrs.colspan)}}for(let r=0;r<s.childCount;r++){const a=s.child(r);l+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}e==-1?e=l:e!=l&&(e=Math.max(e,l))}return e}function kn(t,e,n){t.problems||(t.problems=[]);const o={};for(let s=0;s<t.map.length;s++){const l=t.map[s];if(o[l])continue;o[l]=!0;const r=n.nodeAt(l);if(!r)throw new RangeError(`No cell with offset ${l} found`);let a=null;const i=r.attrs;for(let c=0;c<i.colspan;c++){const u=e[(s+c)%t.width*2];u!=null&&(!i.colwidth||i.colwidth[c]!=u)&&((a||(a=Rn(i)))[c]=u)}a&&t.problems.unshift({type:"colwidth mismatch",pos:l,colwidth:a})}}function Rn(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function A(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const o=t.nodes[n],s=o.spec.tableRole;s&&(e[s]=o)}}return e}const W=new ye("selectingCells");function _(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function Nn(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if(n==="cell"||n==="header_cell")return t.node(e)}return null}function R(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function ie(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const n=_(e.$head)||Hn(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function Hn(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const o=e.type.spec.tableRole;if(o=="cell"||o=="header_cell")return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const o=e.type.spec.tableRole;if(o=="cell"||o=="header_cell")return t.doc.resolve(n-e.nodeSize)}}function pe(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function Ln(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function Se(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Xe(t,e,n){const o=t.node(-1),s=y.get(o),l=t.start(-1),r=s.nextCell(t.pos-l,e,n);return r==null?null:t.node(0).resolve(l+r)}function O(t,e,n=1){const o={...t,colspan:t.colspan-n};return o.colwidth&&(o.colwidth=o.colwidth.slice(),o.colwidth.splice(e,n),o.colwidth.some(s=>s>0)||(o.colwidth=null)),o}function Je(t,e,n=1){const o={...t,colspan:t.colspan+n};if(o.colwidth){o.colwidth=o.colwidth.slice();for(let s=0;s<n;s++)o.colwidth.splice(e,0,0)}return o}function In(t,e,n){const o=A(e.type.schema).header_cell;for(let s=0;s<t.height;s++)if(e.nodeAt(t.map[n+s*t.width]).type!=o)return!1;return!0}var C=class z extends F{constructor(e,n=e){const o=e.node(-1),s=y.get(o),l=e.start(-1),r=s.rectBetween(e.pos-l,n.pos-l),a=e.node(0),i=s.cellsInRect(r).filter(u=>u!=n.pos-l);i.unshift(n.pos-l);const c=i.map(u=>{const f=o.nodeAt(u);if(!f)throw new RangeError(`No cell with offset ${u} found`);const h=l+u+1;return new Wt(a.resolve(h),a.resolve(h+f.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=n}map(e,n){const o=e.resolve(n.map(this.$anchorCell.pos)),s=e.resolve(n.map(this.$headCell.pos));if(pe(o)&&pe(s)&&Se(o,s)){const l=this.$anchorCell.node(-1)!=o.node(-1);return l&&this.isRowSelection()?z.rowSelection(o,s):l&&this.isColSelection()?z.colSelection(o,s):new z(o,s)}return D.between(o,s)}content(){const e=this.$anchorCell.node(-1),n=y.get(e),o=this.$anchorCell.start(-1),s=n.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o),l={},r=[];for(let i=s.top;i<s.bottom;i++){const c=[];for(let u=i*n.width+s.left,f=s.left;f<s.right;f++,u++){const h=n.map[u];if(l[h])continue;l[h]=!0;const m=n.findCell(h);let p=e.nodeAt(h);if(!p)throw new RangeError(`No cell with offset ${h} found`);const b=s.left-m.left,g=m.right-s.right;if(b>0||g>0){let x=p.attrs;if(b>0&&(x=O(x,0,b)),g>0&&(x=O(x,x.colspan-g,g)),m.left<s.left){if(p=p.type.createAndFill(x),!p)throw new RangeError(`Could not create cell with attrs ${JSON.stringify(x)}`)}else p=p.type.create(x,p.content)}if(m.top<s.top||m.bottom>s.bottom){const x={...p.attrs,rowspan:Math.min(m.bottom,s.bottom)-Math.max(m.top,s.top)};m.top<s.top?p=p.type.createAndFill(x):p=p.type.create(x,p.content)}c.push(p)}r.push(e.child(i).copy(H.from(c)))}const a=this.isColSelection()&&this.isRowSelection()?e:r;return new $(H.from(a),1,1)}replace(e,n=$.empty){const o=e.steps.length,s=this.ranges;for(let r=0;r<s.length;r++){const{$from:a,$to:i}=s[r],c=e.mapping.slice(o);e.replace(c.map(a.pos),c.map(i.pos),r?$.empty:n)}const l=F.findFrom(e.doc.resolve(e.mapping.slice(o).map(this.to)),-1);l&&e.setSelection(l)}replaceWith(e,n){this.replace(e,new $(H.from(n),0,0))}forEachCell(e){const n=this.$anchorCell.node(-1),o=y.get(n),s=this.$anchorCell.start(-1),l=o.cellsInRect(o.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s));for(let r=0;r<l.length;r++)e(n.nodeAt(l[r]),s+l[r])}isColSelection(){const e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(e,n)>0)return!1;const o=e+this.$anchorCell.nodeAfter.attrs.rowspan,s=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(o,s)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){const o=e.node(-1),s=y.get(o),l=e.start(-1),r=s.findCell(e.pos-l),a=s.findCell(n.pos-l),i=e.node(0);return r.top<=a.top?(r.top>0&&(e=i.resolve(l+s.map[r.left])),a.bottom<s.height&&(n=i.resolve(l+s.map[s.width*(s.height-1)+a.right-1]))):(a.top>0&&(n=i.resolve(l+s.map[a.left])),r.bottom<s.height&&(e=i.resolve(l+s.map[s.width*(s.height-1)+r.right-1]))),new z(e,n)}isRowSelection(){const e=this.$anchorCell.node(-1),n=y.get(e),o=this.$anchorCell.start(-1),s=n.colCount(this.$anchorCell.pos-o),l=n.colCount(this.$headCell.pos-o);if(Math.min(s,l)>0)return!1;const r=s+this.$anchorCell.nodeAfter.attrs.colspan,a=l+this.$headCell.nodeAfter.attrs.colspan;return Math.max(r,a)==n.width}eq(e){return e instanceof z&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){const o=e.node(-1),s=y.get(o),l=e.start(-1),r=s.findCell(e.pos-l),a=s.findCell(n.pos-l),i=e.node(0);return r.left<=a.left?(r.left>0&&(e=i.resolve(l+s.map[r.top*s.width])),a.right<s.width&&(n=i.resolve(l+s.map[s.width*(a.top+1)-1]))):(a.left>0&&(n=i.resolve(l+s.map[a.top*s.width])),r.right<s.width&&(e=i.resolve(l+s.map[s.width*(r.top+1)-1]))),new z(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new z(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,o=n){return new z(e.resolve(n),e.resolve(o))}getBookmark(){return new En(this.$anchorCell.pos,this.$headCell.pos)}};C.prototype.visible=!1;F.jsonID("cell",C);var En=class Ge{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Ge(e.map(this.anchor),e.map(this.head))}resolve(e){const n=e.resolve(this.anchor),o=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&o.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&o.index()<o.parent.childCount&&Se(n,o)?new C(n,o):F.near(o,1)}};function zn(t){if(!(t.selection instanceof C))return null;const e=[];return t.selection.forEachCell((n,o)=>{e.push(ue.node(o,o+n.nodeSize,{class:"selectedCell"}))}),de.create(t.doc,e)}function Fn({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let n=t.pos,o=e.pos,s=t.depth;for(;s>=0&&!(t.after(s+1)<t.end(s));s--,n++);for(let l=e.depth;l>=0&&!(e.before(l+1)>e.start(l));l--,o--);return n==o&&/row|table/.test(t.node(s).type.spec.tableRole)}function Dn({$from:t,$to:e}){let n,o;for(let s=t.depth;s>0;s--){const l=t.node(s);if(l.type.spec.tableRole==="cell"||l.type.spec.tableRole==="header_cell"){n=l;break}}for(let s=e.depth;s>0;s--){const l=e.node(s);if(l.type.spec.tableRole==="cell"||l.type.spec.tableRole==="header_cell"){o=l;break}}return n!==o&&e.parentOffset===0}function Bn(t,e,n){const o=(e||t).selection,s=(e||t).doc;let l,r;if(o instanceof $t&&(r=o.node.type.spec.tableRole)){if(r=="cell"||r=="header_cell")l=C.create(s,o.from);else if(r=="row"){const a=s.resolve(o.from+1);l=C.rowSelection(a,a)}else if(!n){const a=y.get(o.node),i=o.from+1,c=i+a.map[a.width*a.height-1];l=C.create(s,i+1,c)}}else o instanceof D&&Fn(o)?l=D.create(s,o.from):o instanceof D&&Dn(o)&&(l=D.create(s,o.$from.start(),o.$from.end()));return l&&(e||(e=t.tr)).setSelection(l),e}const Wn=new ye("fix-tables");function Ye(t,e,n,o){const s=t.childCount,l=e.childCount;e:for(let r=0,a=0;r<l;r++){const i=e.child(r);for(let c=a,u=Math.min(s,r+3);c<u;c++)if(t.child(c)==i){a=c+1,n+=i.nodeSize;continue e}o(i,n),a<s&&t.child(a).sameMarkup(i)?Ye(t.child(a),i,n+1,o):i.nodesBetween(0,i.content.size,o,n+1),n+=i.nodeSize}}function Ze(t,e){let n;const o=(s,l)=>{s.type.spec.tableRole=="table"&&(n=$n(t,s,l,n))};return e?e.doc!=t.doc&&Ye(e.doc,t.doc,0,o):t.doc.descendants(o),n}function $n(t,e,n,o){const s=y.get(e);if(!s.problems)return o;o||(o=t.tr);const l=[];for(let i=0;i<s.height;i++)l.push(0);for(let i=0;i<s.problems.length;i++){const c=s.problems[i];if(c.type=="collision"){const u=e.nodeAt(c.pos);if(!u)continue;const f=u.attrs;for(let h=0;h<f.rowspan;h++)l[c.row+h]+=c.n;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,O(f,f.colspan-c.n,c.n))}else if(c.type=="missing")l[c.row]+=c.n;else if(c.type=="overlong_rowspan"){const u=e.nodeAt(c.pos);if(!u)continue;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,{...u.attrs,rowspan:u.attrs.rowspan-c.n})}else if(c.type=="colwidth mismatch"){const u=e.nodeAt(c.pos);if(!u)continue;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,{...u.attrs,colwidth:c.colwidth})}else if(c.type=="zero_sized"){const u=o.mapping.map(n);o.delete(u,u+e.nodeSize)}}let r,a;for(let i=0;i<l.length;i++)l[i]&&(r==null&&(r=i),a=i);for(let i=0,c=n+1;i<s.height;i++){const u=e.child(i),f=c+u.nodeSize,h=l[i];if(h>0){let m="cell";u.firstChild&&(m=u.firstChild.type.spec.tableRole);const p=[];for(let g=0;g<h;g++){const x=A(t.schema)[m].createAndFill();x&&p.push(x)}const b=(i==0||r==i-1)&&a==i?c+1:f-1;o.insert(o.mapping.map(b),p)}c=f}return o.setMeta(Wn,{fixTables:!0})}function E(t){const e=t.selection,n=ie(t),o=n.node(-1),s=n.start(-1),l=y.get(o);return{...e instanceof C?l.rectBetween(e.$anchorCell.pos-s,e.$headCell.pos-s):l.findCell(n.pos-s),tableStart:s,map:l,table:o}}function Qe(t,{map:e,tableStart:n,table:o},s){let l=s>0?-1:0;In(e,o,s+l)&&(l=s==0||s==e.width?null:0);for(let r=0;r<e.height;r++){const a=r*e.width+s;if(s>0&&s<e.width&&e.map[a-1]==e.map[a]){const i=e.map[a],c=o.nodeAt(i);t.setNodeMarkup(t.mapping.map(n+i),null,Je(c.attrs,s-e.colCount(i))),r+=c.attrs.rowspan-1}else{const i=l==null?A(o.type.schema).cell:o.nodeAt(e.map[a+l]).type,c=e.positionAt(r,s,o);t.insert(t.mapping.map(n+c),i.createAndFill())}}return t}function Pn(t,e){if(!R(t))return!1;if(e){const n=E(t);e(Qe(t.tr,n,n.left))}return!0}function _n(t,e){if(!R(t))return!1;if(e){const n=E(t);e(Qe(t.tr,n,n.right))}return!0}function On(t,{map:e,table:n,tableStart:o},s){const l=t.mapping.maps.length;for(let r=0;r<e.height;){const a=r*e.width+s,i=e.map[a],c=n.nodeAt(i),u=c.attrs;if(s>0&&e.map[a-1]==i||s<e.width-1&&e.map[a+1]==i)t.setNodeMarkup(t.mapping.slice(l).map(o+i),null,O(u,s-e.colCount(i)));else{const f=t.mapping.slice(l).map(o+i);t.delete(f,f+c.nodeSize)}r+=u.rowspan}}function Vn(t,e){if(!R(t))return!1;if(e){const n=E(t),o=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let s=n.right-1;On(o,n,s),s!=n.left;s--){const l=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!l)throw new RangeError("No table found");n.table=l,n.map=y.get(l)}e(o)}return!0}function Kn(t,e,n){var o;const s=A(e.type.schema).header_cell;for(let l=0;l<t.width;l++)if(((o=e.nodeAt(t.map[l+n*t.width]))===null||o===void 0?void 0:o.type)!=s)return!1;return!0}function et(t,{map:e,tableStart:n,table:o},s){let l=n;for(let c=0;c<s;c++)l+=o.child(c).nodeSize;const r=[];let a=s>0?-1:0;Kn(e,o,s+a)&&(a=s==0||s==e.height?null:0);for(let c=0,u=e.width*s;c<e.width;c++,u++)if(s>0&&s<e.height&&e.map[u]==e.map[u-e.width]){const f=e.map[u],h=o.nodeAt(f).attrs;t.setNodeMarkup(n+f,null,{...h,rowspan:h.rowspan+1}),c+=h.colspan-1}else{var i;const f=a==null?A(o.type.schema).cell:(i=o.nodeAt(e.map[u+a*e.width]))===null||i===void 0?void 0:i.type,h=f==null?void 0:f.createAndFill();h&&r.push(h)}return t.insert(l,A(o.type.schema).row.create(null,r)),t}function qn(t,e){if(!R(t))return!1;if(e){const n=E(t);e(et(t.tr,n,n.top))}return!0}function Un(t,e){if(!R(t))return!1;if(e){const n=E(t);e(et(t.tr,n,n.bottom))}return!0}function Xn(t,{map:e,table:n,tableStart:o},s){let l=0;for(let c=0;c<s;c++)l+=n.child(c).nodeSize;const r=l+n.child(s).nodeSize,a=t.mapping.maps.length;t.delete(l+o,r+o);const i=new Set;for(let c=0,u=s*e.width;c<e.width;c++,u++){const f=e.map[u];if(!i.has(f)){if(i.add(f),s>0&&f==e.map[u-e.width]){const h=n.nodeAt(f).attrs;t.setNodeMarkup(t.mapping.slice(a).map(f+o),null,{...h,rowspan:h.rowspan-1}),c+=h.colspan-1}else if(s<e.height&&f==e.map[u+e.width]){const h=n.nodeAt(f),m=h.attrs,p=h.type.create({...m,rowspan:h.attrs.rowspan-1},h.content),b=e.positionAt(s+1,c,n);t.insert(t.mapping.slice(a).map(o+b),p),c+=m.colspan-1}}}}function Jn(t,e){if(!R(t))return!1;if(e){const n=E(t),o=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let s=n.bottom-1;Xn(o,n,s),s!=n.top;s--){const l=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!l)throw new RangeError("No table found");n.table=l,n.map=y.get(n.table)}e(o)}return!0}function Ae(t){const e=t.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function Gn({width:t,height:e,map:n},o){let s=o.top*t+o.left,l=s,r=(o.bottom-1)*t+o.left,a=s+(o.right-o.left-1);for(let i=o.top;i<o.bottom;i++){if(o.left>0&&n[l]==n[l-1]||o.right<t&&n[a]==n[a+1])return!0;l+=t,a+=t}for(let i=o.left;i<o.right;i++){if(o.top>0&&n[s]==n[s-t]||o.bottom<e&&n[r]==n[r+t])return!0;s++,r++}return!1}function je(t,e){const n=t.selection;if(!(n instanceof C)||n.$anchorCell.pos==n.$headCell.pos)return!1;const o=E(t),{map:s}=o;if(Gn(s,o))return!1;if(e){const l=t.tr,r={};let a=H.empty,i,c;for(let u=o.top;u<o.bottom;u++)for(let f=o.left;f<o.right;f++){const h=s.map[u*s.width+f],m=o.table.nodeAt(h);if(!(r[h]||!m))if(r[h]=!0,i==null)i=h,c=m;else{Ae(m)||(a=a.append(m.content));const p=l.mapping.map(h+o.tableStart);l.delete(p,p+m.nodeSize)}}if(i==null||c==null)return!0;if(l.setNodeMarkup(i+o.tableStart,null,{...Je(c.attrs,c.attrs.colspan,o.right-o.left-c.attrs.colspan),rowspan:o.bottom-o.top}),a.size>0){const u=i+1+c.content.size,f=Ae(c)?i+1:u;l.replaceWith(f+o.tableStart,u+o.tableStart,a)}l.setSelection(new C(l.doc.resolve(i+o.tableStart))),e(l)}return!0}function ve(t,e){const n=A(t.schema);return Yn(({node:o})=>n[o.type.spec.tableRole])(t,e)}function Yn(t){return(e,n)=>{const o=e.selection;let s,l;if(o instanceof C){if(o.$anchorCell.pos!=o.$headCell.pos)return!1;s=o.$anchorCell.nodeAfter,l=o.$anchorCell.pos}else{var r;if(s=Nn(o.$from),!s)return!1;l=(r=_(o.$from))===null||r===void 0?void 0:r.pos}if(s==null||l==null||s.attrs.colspan==1&&s.attrs.rowspan==1)return!1;if(n){let a=s.attrs;const i=[],c=a.colwidth;a.rowspan>1&&(a={...a,rowspan:1}),a.colspan>1&&(a={...a,colspan:1});const u=E(e),f=e.tr;for(let m=0;m<u.right-u.left;m++)i.push(c?{...a,colwidth:c&&c[m]?[c[m]]:null}:a);let h;for(let m=u.top;m<u.bottom;m++){let p=u.map.positionAt(m,u.left,u.table);m==u.top&&(p+=s.nodeSize);for(let b=u.left,g=0;b<u.right;b++,g++)b==u.left&&m==u.top||f.insert(h=f.mapping.map(p+u.tableStart,1),t({node:s,row:m,col:b}).createAndFill(i[g]))}f.setNodeMarkup(l,t({node:s,row:u.top,col:u.left}),i[0]),o instanceof C&&f.setSelection(new C(f.doc.resolve(o.$anchorCell.pos),h?f.doc.resolve(h):void 0)),n(f)}return!0}}function Zn(t,e){return function(n,o){if(!R(n))return!1;const s=ie(n);if(s.nodeAfter.attrs[t]===e)return!1;if(o){const l=n.tr;n.selection instanceof C?n.selection.forEachCell((r,a)=>{r.attrs[t]!==e&&l.setNodeMarkup(a,null,{...r.attrs,[t]:e})}):l.setNodeMarkup(s.pos,null,{...s.nodeAfter.attrs,[t]:e}),o(l)}return!0}}function Qn(t){return function(e,n){if(!R(e))return!1;if(n){const o=A(e.schema),s=E(e),l=e.tr,r=s.map.cellsInRect(t=="column"?{left:s.left,top:0,right:s.right,bottom:s.map.height}:t=="row"?{left:0,top:s.top,right:s.map.width,bottom:s.bottom}:s),a=r.map(i=>s.table.nodeAt(i));for(let i=0;i<r.length;i++)a[i].type==o.header_cell&&l.setNodeMarkup(s.tableStart+r[i],o.cell,a[i].attrs);if(l.steps.length===0)for(let i=0;i<r.length;i++)l.setNodeMarkup(s.tableStart+r[i],o.header_cell,a[i].attrs);n(l)}return!0}}function Te(t,e,n){const o=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let s=0;s<o.length;s++){const l=e.table.nodeAt(o[s]);if(l&&l.type!==n.header_cell)return!1}return!0}function J(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?Qn(t):function(n,o){if(!R(n))return!1;if(o){const s=A(n.schema),l=E(n),r=n.tr,a=Te("row",l,s),i=Te("column",l,s),c=(t==="column"?a:t==="row"&&i)?1:0,u=t=="column"?{left:0,top:c,right:1,bottom:l.map.height}:t=="row"?{left:c,top:0,right:l.map.width,bottom:1}:l,f=t=="column"?i?s.cell:s.header_cell:t=="row"?a?s.cell:s.header_cell:s.cell;l.map.cellsInRect(u).forEach(h=>{const m=h+l.tableStart,p=r.doc.nodeAt(m);p&&r.setNodeMarkup(m,f,p.attrs)}),o(r)}return!0}}J("row",{useDeprecatedLogic:!0});J("column",{useDeprecatedLogic:!0});const eo=J("cell",{useDeprecatedLogic:!0});function to(t,e){if(e<0){const n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let o=t.index(-1)-1,s=t.before();o>=0;o--){const l=t.node(-1).child(o),r=l.lastChild;if(r)return s-1-r.nodeSize;s-=l.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const n=t.node(-1);for(let o=t.indexAfter(-1),s=t.after();o<n.childCount;o++){const l=n.child(o);if(l.childCount)return s+1;s+=l.nodeSize}}return null}function Me(t){return function(e,n){if(!R(e))return!1;const o=to(ie(e),t);if(o==null)return!1;if(n){const s=e.doc.resolve(o);n(e.tr.setSelection(D.between(s,Ln(s))).scrollIntoView())}return!0}}function no(t,e){const n=t.selection.$anchor;for(let o=n.depth;o>0;o--)if(n.node(o).type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(o),n.after(o)).scrollIntoView()),!0;return!1}function Q(t,e){const n=t.selection;if(!(n instanceof C))return!1;if(e){const o=t.tr,s=A(t.schema).cell.createAndFill().content;n.forEachCell((l,r)=>{l.content.eq(s)||o.replace(o.mapping.map(r+1),o.mapping.map(r+l.nodeSize-1),new $(s,0,0))}),o.docChanged&&e(o)}return!0}function oo(t){if(t.size===0)return null;let{content:e,openStart:n,openEnd:o}=t;for(;e.childCount==1&&(n>0&&o>0||e.child(0).type.spec.tableRole=="table");)n--,o--,e=e.child(0).content;const s=e.child(0),l=s.type.spec.tableRole,r=s.type.schema,a=[];if(l=="row")for(let i=0;i<e.childCount;i++){let c=e.child(i).content;const u=i?0:Math.max(0,n-1),f=i<e.childCount-1?0:Math.max(0,o-1);(u||f)&&(c=me(A(r).row,new $(c,u,f)).content),a.push(c)}else if(l=="cell"||l=="header_cell")a.push(n||o?me(A(r).row,new $(e,n,o)).content:e);else return null;return so(r,a)}function so(t,e){const n=[];for(let s=0;s<e.length;s++){const l=e[s];for(let r=l.childCount-1;r>=0;r--){const{rowspan:a,colspan:i}=l.child(r).attrs;for(let c=s;c<s+a;c++)n[c]=(n[c]||0)+i}}let o=0;for(let s=0;s<n.length;s++)o=Math.max(o,n[s]);for(let s=0;s<n.length;s++)if(s>=e.length&&e.push(H.empty),n[s]<o){const l=A(t).cell.createAndFill(),r=[];for(let a=n[s];a<o;a++)r.push(l);e[s]=e[s].append(H.from(r))}return{height:e.length,width:o,rows:e}}function me(t,e){const n=t.createAndFill();return new Pt(n).replace(0,n.content.size,e).doc}function lo({width:t,height:e,rows:n},o,s){if(t!=o){const l=[],r=[];for(let a=0;a<n.length;a++){const i=n[a],c=[];for(let u=l[a]||0,f=0;u<o;f++){let h=i.child(f%i.childCount);u+h.attrs.colspan>o&&(h=h.type.createChecked(O(h.attrs,h.attrs.colspan,u+h.attrs.colspan-o),h.content)),c.push(h),u+=h.attrs.colspan;for(let m=1;m<h.attrs.rowspan;m++)l[a+m]=(l[a+m]||0)+h.attrs.colspan}r.push(H.from(c))}n=r,t=o}if(e!=s){const l=[];for(let r=0,a=0;r<s;r++,a++){const i=[],c=n[a%e];for(let u=0;u<c.childCount;u++){let f=c.child(u);r+f.attrs.rowspan>s&&(f=f.type.create({...f.attrs,rowspan:Math.max(1,s-f.attrs.rowspan)},f.content)),i.push(f)}l.push(H.from(i))}n=l,e=s}return{width:t,height:e,rows:n}}function ro(t,e,n,o,s,l,r){const a=t.doc.type.schema,i=A(a);let c,u;if(s>e.width)for(let f=0,h=0;f<e.height;f++){const m=n.child(f);h+=m.nodeSize;const p=[];let b;m.lastChild==null||m.lastChild.type==i.cell?b=c||(c=i.cell.createAndFill()):b=u||(u=i.header_cell.createAndFill());for(let g=e.width;g<s;g++)p.push(b);t.insert(t.mapping.slice(r).map(h-1+o),p)}if(l>e.height){const f=[];for(let p=0,b=(e.height-1)*e.width;p<Math.max(e.width,s);p++){const g=p>=e.width?!1:n.nodeAt(e.map[b+p]).type==i.header_cell;f.push(g?u||(u=i.header_cell.createAndFill()):c||(c=i.cell.createAndFill()))}const h=i.row.create(null,H.from(f)),m=[];for(let p=e.height;p<l;p++)m.push(h);t.insert(t.mapping.slice(r).map(o+n.nodeSize-2),m)}return!!(c||u)}function ke(t,e,n,o,s,l,r,a){if(r==0||r==e.height)return!1;let i=!1;for(let c=s;c<l;c++){const u=r*e.width+c,f=e.map[u];if(e.map[u-e.width]==f){i=!0;const h=n.nodeAt(f),{top:m,left:p}=e.findCell(f);t.setNodeMarkup(t.mapping.slice(a).map(f+o),null,{...h.attrs,rowspan:r-m}),t.insert(t.mapping.slice(a).map(e.positionAt(r,p,n)),h.type.createAndFill({...h.attrs,rowspan:m+h.attrs.rowspan-r})),c+=h.attrs.colspan-1}}return i}function Re(t,e,n,o,s,l,r,a){if(r==0||r==e.width)return!1;let i=!1;for(let c=s;c<l;c++){const u=c*e.width+r,f=e.map[u];if(e.map[u-1]==f){i=!0;const h=n.nodeAt(f),m=e.colCount(f),p=t.mapping.slice(a).map(f+o);t.setNodeMarkup(p,null,O(h.attrs,r-m,h.attrs.colspan-(r-m))),t.insert(p+h.nodeSize,h.type.createAndFill(O(h.attrs,0,r-m))),c+=h.attrs.rowspan-1}}return i}function Ne(t,e,n,o,s){let l=n?t.doc.nodeAt(n-1):t.doc;if(!l)throw new Error("No table found");let r=y.get(l);const{top:a,left:i}=o,c=i+s.width,u=a+s.height,f=t.tr;let h=0;function m(){if(l=n?f.doc.nodeAt(n-1):f.doc,!l)throw new Error("No table found");r=y.get(l),h=f.mapping.maps.length}ro(f,r,l,n,c,u,h)&&m(),ke(f,r,l,n,i,c,a,h)&&m(),ke(f,r,l,n,i,c,u,h)&&m(),Re(f,r,l,n,a,u,i,h)&&m(),Re(f,r,l,n,a,u,c,h)&&m();for(let p=a;p<u;p++){const b=r.positionAt(p,i,l),g=r.positionAt(p,c,l);f.replace(f.mapping.slice(h).map(b+n),f.mapping.slice(h).map(g+n),new $(s.rows[p-a],0,0))}m(),f.setSelection(new C(f.doc.resolve(n+r.positionAt(a,i,l)),f.doc.resolve(n+r.positionAt(u-1,c-1,l)))),e(f)}const io=Bt({ArrowLeft:ee("horiz",-1),ArrowRight:ee("horiz",1),ArrowUp:ee("vert",-1),ArrowDown:ee("vert",1),"Shift-ArrowLeft":te("horiz",-1),"Shift-ArrowRight":te("horiz",1),"Shift-ArrowUp":te("vert",-1),"Shift-ArrowDown":te("vert",1),Backspace:Q,"Mod-Backspace":Q,Delete:Q,"Mod-Delete":Q});function oe(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function ee(t,e){return(n,o,s)=>{if(!s)return!1;const l=n.selection;if(l instanceof C)return oe(n,o,F.near(l.$headCell,e));if(t!="horiz"&&!l.empty)return!1;const r=tt(s,t,e);if(r==null)return!1;if(t=="horiz")return oe(n,o,F.near(n.doc.resolve(l.head+e),e));{const a=n.doc.resolve(r),i=Xe(a,t,e);let c;return i?c=F.near(i,1):e<0?c=F.near(n.doc.resolve(a.before(-1)),-1):c=F.near(n.doc.resolve(a.after(-1)),1),oe(n,o,c)}}}function te(t,e){return(n,o,s)=>{if(!s)return!1;const l=n.selection;let r;if(l instanceof C)r=l;else{const i=tt(s,t,e);if(i==null)return!1;r=new C(n.doc.resolve(i))}const a=Xe(r.$headCell,t,e);return a?oe(n,o,new C(r.$anchorCell,a)):!1}}function ao(t,e){const n=t.state.doc,o=_(n.resolve(e));return o?(t.dispatch(t.state.tr.setSelection(new C(o))),!0):!1}function co(t,e,n){if(!R(t.state))return!1;let o=oo(n);const s=t.state.selection;if(s instanceof C){o||(o={width:1,height:1,rows:[H.from(me(A(t.state.schema).cell,n))]});const l=s.$anchorCell.node(-1),r=s.$anchorCell.start(-1),a=y.get(l).rectBetween(s.$anchorCell.pos-r,s.$headCell.pos-r);return o=lo(o,a.right-a.left,a.bottom-a.top),Ne(t.state,t.dispatch,r,a,o),!0}else if(o){const l=ie(t.state),r=l.start(-1);return Ne(t.state,t.dispatch,r,y.get(l.node(-1)).findCell(l.pos-r),o),!0}else return!1}function uo(t,e){var n;if(e.button!=0||e.ctrlKey||e.metaKey)return;const o=He(t,e.target);let s;if(e.shiftKey&&t.state.selection instanceof C)l(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&o&&(s=_(t.state.selection.$anchor))!=null&&((n=ce(t,e))===null||n===void 0?void 0:n.pos)!=s.pos)l(s,e),e.preventDefault();else if(!o)return;function l(i,c){let u=ce(t,c);const f=W.getState(t.state)==null;if(!u||!Se(i,u))if(f)u=i;else return;const h=new C(i,u);if(f||!t.state.selection.eq(h)){const m=t.state.tr.setSelection(h);f&&m.setMeta(W,i.pos),t.dispatch(m)}}function r(){t.root.removeEventListener("mouseup",r),t.root.removeEventListener("dragstart",r),t.root.removeEventListener("mousemove",a),W.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(W,-1))}function a(i){const c=i,u=W.getState(t.state);let f;if(u!=null)f=t.state.doc.resolve(u);else if(He(t,c.target)!=o&&(f=ce(t,e),!f))return r();f&&l(f,c)}t.root.addEventListener("mouseup",r),t.root.addEventListener("dragstart",r),t.root.addEventListener("mousemove",a)}function tt(t,e,n){if(!(t.state.selection instanceof D))return null;const{$head:o}=t.state.selection;for(let s=o.depth-1;s>=0;s--){const l=o.node(s);if((n<0?o.index(s):o.indexAfter(s))!=(n<0?0:l.childCount))return null;if(l.type.spec.tableRole=="cell"||l.type.spec.tableRole=="header_cell"){const r=o.before(s),a=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(a)?r:null}}return null}function He(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function ce(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});if(!n)return null;let{inside:o,pos:s}=n;return o>=0&&_(t.state.doc.resolve(o))||_(t.state.doc.resolve(s))}var fo=class{constructor(e,n){this.node=e,this.defaultCellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${n}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ge(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,ge(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function ge(t,e,n,o,s,l){let r=0,a=!0,i=e.firstChild;const c=t.firstChild;if(c){for(let f=0,h=0;f<c.childCount;f++){const{colspan:m,colwidth:p}=c.child(f).attrs;for(let b=0;b<m;b++,h++){const g=s==h?l:p&&p[b],x=g?g+"px":"";if(r+=g||o,g||(a=!1),i)i.style.width!=x&&(i.style.width=x),i=i.nextSibling;else{const j=document.createElement("col");j.style.width=x,e.appendChild(j)}}}for(;i;){var u;const f=i.nextSibling;(u=i.parentNode)===null||u===void 0||u.removeChild(i),i=f}a?(n.style.width=r+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=r+"px")}}const v=new ye("tableColumnResizing");function ho({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:n=100,View:o=fo,lastColumnResizable:s=!0}={}){const l=new qe({key:v,state:{init(r,a){var i;const c=(i=l.spec)===null||i===void 0||(i=i.props)===null||i===void 0?void 0:i.nodeViews,u=A(a.schema).table.name;return o&&c&&(c[u]=(f,h)=>new o(f,n,h)),new po(-1,!1)},apply(r,a){return a.apply(r)}},props:{attributes:r=>{const a=v.getState(r);return a&&a.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(r,a)=>{mo(r,a,t,s)},mouseleave:r=>{go(r)},mousedown:(r,a)=>{bo(r,a,e,n)}},decorations:r=>{const a=v.getState(r);if(a&&a.activeHandle>-1)return So(r,a.activeHandle)},nodeViews:{}}});return l}var po=class se{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){const n=this,o=e.getMeta(v);if(o&&o.setHandle!=null)return new se(o.setHandle,!1);if(o&&o.setDragging!==void 0)return new se(n.activeHandle,o.setDragging);if(n.activeHandle>-1&&e.docChanged){let s=e.mapping.map(n.activeHandle,-1);return pe(e.doc.resolve(s))||(s=-1),new se(s,n.dragging)}return n}};function mo(t,e,n,o){if(!t.editable)return;const s=v.getState(t.state);if(s&&!s.dragging){const l=wo(e.target);let r=-1;if(l){const{left:a,right:i}=l.getBoundingClientRect();e.clientX-a<=n?r=Le(t,e,"left",n):i-e.clientX<=n&&(r=Le(t,e,"right",n))}if(r!=s.activeHandle){if(!o&&r!==-1){const a=t.state.doc.resolve(r),i=a.node(-1),c=y.get(i),u=a.start(-1);if(c.colCount(a.pos-u)+a.nodeAfter.attrs.colspan-1==c.width-1)return}nt(t,r)}}}function go(t){if(!t.editable)return;const e=v.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&nt(t,-1)}function bo(t,e,n,o){var s;if(!t.editable)return!1;const l=(s=t.dom.ownerDocument.defaultView)!==null&&s!==void 0?s:window,r=v.getState(t.state);if(!r||r.activeHandle==-1||r.dragging)return!1;const a=t.state.doc.nodeAt(r.activeHandle),i=xo(t,r.activeHandle,a.attrs);t.dispatch(t.state.tr.setMeta(v,{setDragging:{startX:e.clientX,startWidth:i}}));function c(f){l.removeEventListener("mouseup",c),l.removeEventListener("mousemove",u);const h=v.getState(t.state);h!=null&&h.dragging&&(Co(t,h.activeHandle,Ie(h.dragging,f,n)),t.dispatch(t.state.tr.setMeta(v,{setDragging:null})))}function u(f){if(!f.which)return c(f);const h=v.getState(t.state);if(h&&h.dragging){const m=Ie(h.dragging,f,n);Ee(t,h.activeHandle,m,o)}}return Ee(t,r.activeHandle,i,o),l.addEventListener("mouseup",c),l.addEventListener("mousemove",u),e.preventDefault(),!0}function xo(t,e,{colspan:n,colwidth:o}){const s=o&&o[o.length-1];if(s)return s;const l=t.domAtPos(e);let r=l.node.childNodes[l.offset].offsetWidth,a=n;if(o)for(let i=0;i<n;i++)o[i]&&(r-=o[i],a--);return r/a}function wo(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function Le(t,e,n,o){const s=n=="right"?-o:o,l=t.posAtCoords({left:e.clientX+s,top:e.clientY});if(!l)return-1;const{pos:r}=l,a=_(t.state.doc.resolve(r));if(!a)return-1;if(n=="right")return a.pos;const i=y.get(a.node(-1)),c=a.start(-1),u=i.map.indexOf(a.pos-c);return u%i.width==0?-1:c+i.map[u-1]}function Ie(t,e,n){const o=e.clientX-t.startX;return Math.max(n,t.startWidth+o)}function nt(t,e){t.dispatch(t.state.tr.setMeta(v,{setHandle:e}))}function Co(t,e,n){const o=t.state.doc.resolve(e),s=o.node(-1),l=y.get(s),r=o.start(-1),a=l.colCount(o.pos-r)+o.nodeAfter.attrs.colspan-1,i=t.state.tr;for(let c=0;c<l.height;c++){const u=c*l.width+a;if(c&&l.map[u]==l.map[u-l.width])continue;const f=l.map[u],h=s.nodeAt(f).attrs,m=h.colspan==1?0:a-l.colCount(f);if(h.colwidth&&h.colwidth[m]==n)continue;const p=h.colwidth?h.colwidth.slice():yo(h.colspan);p[m]=n,i.setNodeMarkup(r+f,null,{...h,colwidth:p})}i.docChanged&&t.dispatch(i)}function Ee(t,e,n,o){const s=t.state.doc.resolve(e),l=s.node(-1),r=s.start(-1),a=y.get(l).colCount(s.pos-r)+s.nodeAfter.attrs.colspan-1;let i=t.domAtPos(s.start(-1)).node;for(;i&&i.nodeName!="TABLE";)i=i.parentNode;i&&ge(l,i.firstChild,i,o,a,n)}function yo(t){return Array(t).fill(0)}function So(t,e){const n=[],o=t.doc.resolve(e),s=o.node(-1);if(!s)return de.empty;const l=y.get(s),r=o.start(-1),a=l.colCount(o.pos-r)+o.nodeAfter.attrs.colspan-1;for(let c=0;c<l.height;c++){const u=a+c*l.width;if((a==l.width-1||l.map[u]!=l.map[u+1])&&(c==0||l.map[u]!=l.map[u-l.width])){var i;const f=l.map[u],h=r+f+s.nodeAt(f).nodeSize-1,m=document.createElement("div");m.className="column-resize-handle",!((i=v.getState(t))===null||i===void 0)&&i.dragging&&n.push(ue.node(r+f,r+f+s.nodeAt(f).nodeSize,{class:"column-resize-dragging"})),n.push(ue.widget(h,m))}}return de.create(t.doc,n)}function Ao({allowTableNodeSelection:t=!1}={}){return new qe({key:W,state:{init(){return null},apply(e,n){const o=e.getMeta(W);if(o!=null)return o==-1?null:o;if(n==null||!e.docChanged)return n;const{deleted:s,pos:l}=e.mapping.mapResult(n);return s?null:l}},props:{decorations:zn,handleDOMEvents:{mousedown:uo},createSelectionBetween(e){return W.getState(e.state)!=null?e.state.selection:null},handleTripleClick:ao,handleKeyDown:io,handlePaste:co},appendTransaction(e,n,o){return Bn(o,Ze(o,n),t)}})}var jo=U.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{var e,n;const o=t.getAttribute("colwidth"),s=o?o.split(",").map(l=>parseInt(l,10)):null;if(!s){const l=(e=t.closest("table"))==null?void 0:e.querySelectorAll("colgroup > col"),r=Array.from(((n=t.parentElement)==null?void 0:n.children)||[]).indexOf(t);if(r&&r>-1&&l&&l[r]){const a=l[r].getAttribute("width");return a?[parseInt(a,10)]:null}}return s}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",P(this.options.HTMLAttributes,t),0]}}),vo=U.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(o=>parseInt(o,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",P(this.options.HTMLAttributes,t),0]}}),To=U.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",P(this.options.HTMLAttributes,t),0]}});function be(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function ze(t,e,n,o,s,l){var r;let a=0,i=!0,c=e.firstChild;const u=t.firstChild;if(u!==null)for(let h=0,m=0;h<u.childCount;h+=1){const{colspan:p,colwidth:b}=u.child(h).attrs;for(let g=0;g<p;g+=1,m+=1){const x=s===m?l:b&&b[g],j=x?`${x}px`:"";if(a+=x||o,x||(i=!1),c){if(c.style.width!==j){const[T,B]=be(o,x);c.style.setProperty(T,B)}c=c.nextSibling}else{const T=document.createElement("col"),[B,M]=be(o,x);T.style.setProperty(B,M),e.appendChild(T)}}}for(;c;){const h=c.nextSibling;(r=c.parentNode)==null||r.removeChild(c),c=h}const f=t.attrs.style&&typeof t.attrs.style=="string"&&/\bwidth\s*:/i.test(t.attrs.style);i&&!f?(n.style.width=`${a}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${a}px`)}var Mo=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),t.attrs.style&&(this.table.style.cssText=t.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ze(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,ze(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){const e=t.target,n=this.dom.contains(e),o=this.contentDOM.contains(e);return!!(n&&!o&&(t.type==="attributes"||t.type==="childList"||t.type==="characterData"))}};function ko(t,e,n,o){let s=0,l=!0;const r=[],a=t.firstChild;if(!a)return{};for(let f=0,h=0;f<a.childCount;f+=1){const{colspan:m,colwidth:p}=a.child(f).attrs;for(let b=0;b<m;b+=1,h+=1){const g=n===h?o:p&&p[b];s+=g||e,g||(l=!1);const[x,j]=be(e,g);r.push(["col",{style:`${x}: ${j}`}])}}const i=l?`${s}px`:"",c=l?"":`${s}px`;return{colgroup:["colgroup",{},...r],tableWidth:i,tableMinWidth:c}}function Fe(t,e){return t.createAndFill()}function Ro(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const o=t.nodes[n];o.spec.tableRole&&(e[o.spec.tableRole]=o)}),t.cached.tableNodeTypes=e,e}function No(t,e,n,o,s){const l=Ro(t),r=[],a=[];for(let c=0;c<n;c+=1){const u=Fe(l.cell);if(u&&a.push(u),o){const f=Fe(l.header_cell);f&&r.push(f)}}const i=[];for(let c=0;c<e;c+=1)i.push(l.row.createChecked(null,o&&c===0?r:a));return l.table.createChecked(null,i)}function Ho(t){return t instanceof C}var ne=({editor:t})=>{const{selection:e}=t.state;if(!Ho(e))return!1;let n=0;const o=Vt(e.ranges[0].$from,l=>l.type.name==="table");return o==null||o.node.descendants(l=>{if(l.type.name==="table")return!1;["tableCell","tableHeader"].includes(l.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},Lo="";function Io(t){return(t||"").replace(/\s+/g," ").trim()}function Eo(t,e,n={}){var o;const s=(o=n.cellLineSeparator)!=null?o:Lo;if(!t||!t.content||t.content.length===0)return"";const l=[];t.content.forEach(p=>{const b=[];p.content&&p.content.forEach(g=>{let x="";g.content&&Array.isArray(g.content)&&g.content.length>1?x=g.content.map(M=>e.renderChildren(M)).join(s):x=g.content?e.renderChildren(g.content):"";const j=Io(x),T=g.type==="tableHeader";b.push({text:j,isHeader:T})}),l.push(b)});const r=l.reduce((p,b)=>Math.max(p,b.length),0);if(r===0)return"";const a=new Array(r).fill(0);l.forEach(p=>{var b;for(let g=0;g<r;g+=1){const j=(((b=p[g])==null?void 0:b.text)||"").length;j>a[g]&&(a[g]=j),a[g]<3&&(a[g]=3)}});const i=(p,b)=>p+" ".repeat(Math.max(0,b-p.length)),c=l[0],u=c.some(p=>p.isHeader);let f=`
`;const h=new Array(r).fill(0).map((p,b)=>u&&c[b]&&c[b].text||"");return f+=`| ${h.map((p,b)=>i(p,a[b])).join(" | ")} |
`,f+=`| ${a.map(p=>"-".repeat(Math.max(3,p))).join(" | ")} |
`,(u?l.slice(1):l).forEach(p=>{f+=`| ${new Array(r).fill(0).map((b,g)=>i(p[g]&&p[g].text||"",a[g])).join(" | ")} |
`}),f}var zo=Eo,Fo=U.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:Mo,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:o,tableMinWidth:s}=ko(t,this.options.cellMinWidth),l=e.style;function r(){return l||(o?`width: ${o}`:`min-width: ${s}`)}const a=["table",P(this.options.HTMLAttributes,e,{style:r()}),n,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},a]:a},parseMarkdown:(t,e)=>{const n=[];if(t.header){const o=[];t.header.forEach(s=>{o.push(e.createNode("tableHeader",{},[{type:"paragraph",content:e.parseInline(s.tokens)}]))}),n.push(e.createNode("tableRow",{},o))}return t.rows&&t.rows.forEach(o=>{const s=[];o.forEach(l=>{s.push(e.createNode("tableCell",{},[{type:"paragraph",content:e.parseInline(l.tokens)}]))}),n.push(e.createNode("tableRow",{},s))}),e.createNode("table",void 0,n)},renderMarkdown:(t,e)=>zo(t,e),addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:o,dispatch:s,editor:l})=>{const r=No(l.schema,t,e,n);if(s){const a=o.selection.from+1;o.replaceSelectionWith(r).scrollIntoView().setSelection(D.near(o.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>Pn(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>_n(t,e),deleteColumn:()=>({state:t,dispatch:e})=>Vn(t,e),addRowBefore:()=>({state:t,dispatch:e})=>qn(t,e),addRowAfter:()=>({state:t,dispatch:e})=>Un(t,e),deleteRow:()=>({state:t,dispatch:e})=>Jn(t,e),deleteTable:()=>({state:t,dispatch:e})=>no(t,e),mergeCells:()=>({state:t,dispatch:e})=>je(t,e),splitCell:()=>({state:t,dispatch:e})=>ve(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>J("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>J("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>eo(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>je(t,e)?!0:ve(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:o})=>Zn(t,e)(n,o),goToNextCell:()=>({state:t,dispatch:e})=>Me(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>Me(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&Ze(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const o=C.create(e.doc,t.anchorCell,t.headCell);e.setSelection(o)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:ne,"Mod-Backspace":ne,Delete:ne,"Mod-Delete":ne}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[ho({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Ao({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:_t(Ot(t,"tableRole",e))}}}),Do=re.create({name:"tableKit",addExtensions(){const t=[];return this.options.table!==!1&&t.push(Fo.configure(this.options.table)),this.options.tableCell!==!1&&t.push(jo.configure(this.options.tableCell)),this.options.tableHeader!==!1&&t.push(vo.configure(this.options.tableHeader)),this.options.tableRow!==!1&&t.push(To.configure(this.options.tableRow)),t}}),Bo=re.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>{const e=t.style.textAlign;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:t=>t.textAlign?{style:`text-align: ${t.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:t=>({commands:e})=>this.options.alignments.includes(t)?this.options.types.map(n=>e.updateAttributes(n,{textAlign:t})).some(n=>n):!1,unsetTextAlign:()=>({commands:t})=>this.options.types.map(e=>t.resetAttributes(e,"textAlign")).some(e=>e),toggleTextAlign:t=>({editor:e,commands:n})=>this.options.alignments.includes(t)?e.isActive({textAlign:t})?n.unsetTextAlign():n.setTextAlign(t):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),Wo=Bo;const $o=[Kt.configure({codeBlock:!1,link:{shouldAutoLink:t=>/^https?:\/\//.test(t)}}),Do.configure({table:{resizable:!0}}),Yt.configure({placeholder:"Write something..."}),qt,vn,An,Ut,Xt,xn,Cn,Jt.configure({lowlight:Gt}),Wo.configure({types:["heading","paragraph"]}),yn,wn];function Po(){const[t,e]=k.useState(!1),{trans:n}=ft(),s=Oe().watch("title"),l=n({message:"Title"}),r=t?d.jsx(Pe,{placeholder:l,autoFocus:!0,className:"mb-30",onBlur:()=>{e(!1)},name:"title",required:!0}):d.jsxs("h1",{tabIndex:0,onClick:()=>{e(!0)},onFocus:()=>{e(!0)},className:V("cursor-pointer rounded hover:bg-primary/focus",!s&&"text-muted"),children:[s||l,d.jsx(en,{className:"mx-8 mt-8 align-top text-muted icon-sm"})]});return d.jsx("div",{className:"prose mx-auto my-48 w-full flex-shrink-0 px-24 dark:prose-invert",children:r})}function ot(){const{rightSidenavStatus:t,setRightSidenavStatus:e}=k.useContext(Ue);return d.jsx(le,{label:d.jsx(w,{message:"Toggle sidebar"}),children:d.jsx(L,{size:"xs",onClick:()=>e(t==="open"?"closed":"open"),children:d.jsx(nn,{})})})}function fs({initialContent:t,onChange:e,title:n,saveButton:o,imageUploadType:s,aside:l}){const{rightSidenavStatus:r}=k.useContext(Ue);return d.jsx(Zt,{extensions:$o,initialContent:t,onChange:e,children:d.jsxs(Ft,{children:[d.jsxs("section",{className:"dashboard-grid-content dashboard-rounded-panel flex h-full min-h-0 min-w-0 flex-col",children:[d.jsx(gn,{saveButton:o,rightContent:r==="closed"?d.jsx(ot,{}):null,children:n}),d.jsx(dn,{imageUploadType:s}),d.jsxs("div",{className:"flex-auto overflow-y-auto",children:[d.jsx(Po,{}),d.jsx(Qt,{className:"prose mx-auto flex-auto px-24 dark:prose-invert"})]})]}),l&&d.jsx(tn,{position:"right",size:"w-[350px]",className:"dashboard-rounded-panel flex-shrink-0 flex-col lg:ml-8",children:d.jsx(_o,{children:l})})]})})}function _o({children:t}){return d.jsxs(k.Fragment,{children:[d.jsx(Ve,{rightContent:d.jsx(ot,{}),children:d.jsx(w,{message:"Details"})}),d.jsx("div",{className:"flex-auto overflow-y-auto p-24",children:t})]})}export{fs as A};
