import{r as l,c0 as w,j as r,c1 as F,i as D,t as I,m as C,q as A,k as P,p as W,g as M,T as g,aP as T,B,c as N,h as k,aw as E,aj as V,ax as q,az as R,bn as L}from"./client-OfhJa1Pp.js";import{D as O}from"./settings-links-D22SAe6v.js";import{o as z}from"./custom-menu-BbwshV9x.js";import{u as H}from"./use-admin-settings-page-nav-config-BVX-w9YX.js";import{D as Q}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{F as U}from"./file-upload-provider-DTPBUrkd.js";import{u as K}from"./useMutationState-V1q6F41O.js";import{W as J}from"./main-CqFMqK8-.js";import{B as _}from"./blocker-dialog-B5ey95II.js";const S="admin-settings-form",fe="f7fy8bxf0e18",$=t=>(n,a,s)=>{const e=s.subscribe;return s.subscribe=((o,u,c)=>{let f=o;if(u){const h=(c==null?void 0:c.equalityFn)||Object.is;let m=o(s.getState());f=y=>{const p=o(y);if(!h(m,p)){const j=m;u(m=p,j)}},c!=null&&c.fireImmediately&&u(m,m)}return e(f)}),t(n,a,s)},G=$,X=({defaultRoute:t,availableRoutes:n})=>F()(G((a,s)=>({isFullScreen:!1,setIsFullScreen:e=>{a({isFullScreen:e})},previewRoute:t??null,availableRoutes:n??{},setPreviewRoute:e=>{a({previewRoute:e??null})},iframeWindow:null,isDirty:!1,setIsDirty:e=>{a(()=>({isDirty:e}))},setIframeWindow:e=>{a({iframeWindow:e}),e&&e.addEventListener("message",i=>{i.data.source==="be-settings-preview"&&i.data.type==="appLoaded"&&b()})},preview:{setValues:(e,i)=>{i.merge=i.merge??!0;const o=s().iframeWindow;d(o,{type:"setValues",values:e,options:i})},setThemeFont:e=>{const i=s().iframeWindow;d(i,{type:"setThemeFont",value:e})},setThemeValue:(e,i)=>{const o=s().iframeWindow;d(o,{type:"setThemeValue",name:e,value:i})},setActiveTheme:e=>{const i=s().iframeWindow;d(i,{type:"setActiveTheme",themeId:e})},setCustomCode:(e,i)=>{const o=s().iframeWindow;d(o,{type:"setCustomCode",mode:e,value:i})},setHighlight:e=>{var u;let i=null;const o=(u=s().iframeWindow)==null?void 0:u.document;o&&e&&(i=o.querySelector(e)),i&&requestAnimationFrame(()=>{i&&i.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})}}}))),x=l.createContext(null);function Y({children:t,defaultRoute:n,availableRoutes:a}){const[s]=l.useState(()=>X({defaultRoute:n,availableRoutes:a}));return r.jsx(x.Provider,{value:s,children:t})}function v(t){const n=l.useContext(x);return w(n,t)}let b=()=>{};new Promise(t=>b=t);function d(t,n){t&&t.postMessage({source:"be-settings-editor",...n},"*")}function Z(t){return D({mutationKey:["submitAdminSettings"],mutationFn:n=>ee(n),onSuccess:n=>(I(C("Settings updated")),A.setQueryData(["fetchAdminSettings"],n)),onError:n=>z(n,t)})}function ee({files:t,...n}){const a=new FormData;Object.entries(t||{}).forEach(([s,e])=>{a.set(s,e)});for(const s in n)a.set(s,JSON.stringify(n[s]));return P.post("settings",a,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>s.data)}function ge({title:t,form:n,children:a,padding:s="p-12 md:p-24",tabs:e,docsLink:i}){return r.jsx(Y,{children:r.jsxs("div",{className:"dashboard-grid-content dashboard-rounded-panel relative flex flex-auto flex-col",children:[r.jsx(te,{title:t,tabs:e,docsLink:i}),r.jsx("div",{className:"flex-auto overflow-y-auto",children:r.jsx("div",{className:W("mx-auto @container/settings-form lg:max-w-[1440px]",s),children:r.jsx(se,{form:n,children:a})})})]})})}function te({title:t,className:n,tabs:a,allowNavigation:s,docsLink:e}){const i=v(f=>f.isDirty),o=M(),u=K({mutationKey:["submitAdminSettings"]})>0,c=r.jsx(B,{type:"submit",form:S,variant:"flat",color:"primary",size:"xs",disabled:u||!i,className:"min-w-84",children:o?r.jsx(g,{message:"Save"}):r.jsx(g,{message:"Save changes"})});return r.jsxs(l.Fragment,{children:[r.jsx(Q,{className:n,title:t,showSidebarToggleButton:!!o,border:a?"border-none":void 0,rightContent:r.jsxs(l.Fragment,{children:[o&&r.jsx(ie,{}),e?r.jsx(O,{link:e,variant:"button",size:"xs",buttonVariant:o?"icon":"text",children:r.jsx(g,{message:"Learn more"})}):null,c]})}),a,r.jsx(_,{shouldBlock:i,allowNavigation:s})]})}function se({form:t,children:n}){const a=v(e=>e.setIsDirty),s=Z(t);return l.useEffect(()=>(a(t.formState.isDirty),()=>a(!1)),[t.formState.isDirty,a]),r.jsx(U,{children:r.jsx(T,{id:S,form:t,disableNativeValidation:!0,onBeforeSubmit:()=>{const e=t.formState.errors,i=Object.keys(e).filter(o=>o.endsWith("_group"));t.clearErrors(i)},onSubmit:e=>{s.mutate(e,{onSuccess:()=>{t.reset(e),a(!1)}})},children:n})})}function ie(){const{pathname:t}=N(),n=k(),a=t.split("/").pop(),s=H();return r.jsxs(E,{selectionMode:"single",selectedValue:a,onSelectionChange:e=>{e=L(e)?e:`/admin/settings/${e}`,n(e,{state:{prevPath:t}})},children:[r.jsx(V,{children:r.jsx(J,{})}),r.jsx(q,{children:s.map(e=>r.jsx(R,{value:e.to,children:r.jsx(g,{...e.label})},e.to))})]})}export{ge as A,ie as S,Y as a,te as b,se as c,fe as s,v as u};
