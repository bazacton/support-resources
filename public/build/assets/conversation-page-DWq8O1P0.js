import{I as bs,J as Cs,r as m,n as ae,q as y,l as h,j as e,c1 as ws,cY as Ss,at as ge,z as H,c0 as Is,ak as B,aw as q,B as j,T as o,ag as W,ax as U,az as v,aL as we,h as Ns,bf as Se,aj as w,i as T,s as A,t as _,m as M,k as z,bg as Ds,g as Ie,p as F,Z as E,b4 as Ne,aR as De,aX as Z,D as G,G as le,C as de,a_ as Ms,a as Ts,A as As,P as Me,H as me,al as S,d as Te,am as k,an as V,ap as O,aP as Ae,aq as J,av as b,S as zs,L as $,d0 as fe,d1 as ve,b7 as ne,bW as Fs,u as ze,c3 as Fe,E as ks,bF as D,ae as Ps,ac as Ls,as as ke,d2 as Rs}from"./client-OfhJa1Pp.js";import{g as _s,A as Es}from"./attribute-renderer-BAh3glGI.js";import{A as Os}from"./use-create-canned-reply-CgecIWMt.js";import{I as Bs}from"./insert-canned-reply-button-BSQsPVdS.js";import{G as N,D as Pe,P as qs,h as Us}from"./main-CqFMqK8-.js";import{g as Le}from"./get-conversation-page-link-D9UhQWkr.js";import{a as Vs}from"./animating-messages-DuT2CR0j.js";import{S as Re,g as Ks}from"./get-status-color-HuOrk9nw.js";import{u as $s}from"./useMutationState-V1q6F41O.js";import{F as Qs,G as Hs,S as Ws}from"./dashboard-icons-CHop3mns.js";import{R as _e}from"./emoji-picker-button-CQGpXygB.js";import{E as Ee}from"./enhance-text-with-ai-button-CxIfCpJn.js";import{R as Oe,a as Be,U as qe,I as Ue,C as Zs,F as Gs}from"./upload-attachments-button-BWcvmOOE.js";import Ve from"./reply-composer-container-CGWK_3_X.js";import{F as Ke,R as $e}from"./floating-toolbar-Db61G721.js";import{u as Js}from"./tiptap-editor-context-BAgvnYfz.js";import{C as X}from"./chip-list-CkGaRoaT.js";import{c as Xs,b as Ys,d as et,e as Qe,T as ie,u as ue,f as st,g as tt}from"./use-active-view-name-D6uPeR5G.js";import{S as C}from"./skeleton-Cp2m1Uyc.js";import{C as at}from"./conversations-list-item-D6_xxcEr.js";import{b as Y,I as nt}from"./inbox-views-sidebar-MuCCM0pX.js";import{U as it}from"./unseen-messages-badge-BC9Ql5Uh.js";import{I as ot}from"./infinite-scroll-sentinel-sZcqy_uF.js";import{M as He}from"./messages-square-icon-CTmom_u4.js";import{T as We}from"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import{I as Ze,u as ee,o as rt,a as Ge}from"./custom-menu-BbwshV9x.js";import{A as ct}from"./attribute-input-renderer-BJ7XGaGf.js";import{g as lt}from"./get-default-values-for-form-with-attributes-htMbgWW2.js";import{a as dt}from"./agent-avatar-CN8Be1Dj.js";import{a as mt,C as Je,u as Xe}from"./customer-avatar-DNefi2od.js";import{F as ut}from"./formatted-duration-6c7isaot.js";import{B as Ye,M as xt,V as pt,a as jt,b as ht}from"./MultipleStop-B-9jf3-_.js";import{S as gt}from"./SupervisorAccount-k9OnPB-d.js";import{T as ft}from"./ThumbDown-CmU9VZYm.js";import{T as vt}from"./ThumbUp-B7v5mSGQ.js";import{E as yt,T as bt,P as Ct,D as wt,a as L}from"./envato-purchase-list-JwWt_J1A.js";import{A as St}from"./action-menu-dialog-Dkivr19T.js";import{C as se}from"./confirmation-dialog-BIOq1A-h.js";import{B as It}from"./button-group-Cs5CuUiC.js";import{a as Nt}from"./index-RecbqAl0.js";import{F as es}from"./file-upload-provider-DTPBUrkd.js";import{D as ss}from"./Delete-BhyMZiPM.js";import{E as Dt}from"./Edit-JNj6SFDx.js";import{F as ts}from"./formatted-message-body-WNPn2fpJ.js";import{L as Mt,a as Tt,M as At,b as zt,u as xe,S as Ft}from"./use-conversation-messages-DC7lqlf_.js";import{M as as}from"./MoreHoriz-hMMIYAbm.js";import{M as ns,a as is,b as os,u as kt}from"./reverse-conversation-messages-abBI68AY.js";import{O as Pt}from"./OpenInNew-Q67MT6Ae.js";import{a as te}from"./use-is-module-installed-FCoToztC.js";import{P as Lt}from"./Public-PQskOobw.js";import{A as Rt,a as _t}from"./accordion-DWEV-mKU.js";import{C as Et}from"./ConfirmationNumber-8T4bmILd.js";import{T as rs}from"./toggle-right-sidebar-icon-DXM314Tt.js";import{a as cs,F as ls,b as Ot,c as Bt,A as oe,i as qt}from"./feed-attachments-54xris-A.js";import{B as Ut}from"./bullet-seprated-items-Dl11L_1z.js";import{a as Vt}from"./file-preview-dialog-DZbR1Zhl.js";import{F as Kt}from"./normalized-model-field-COxh0lBC.js";import{u as $t,B as Qt}from"./use-unban-users-TBy06zKy.js";import{D as Ht}from"./Download-ealU7kv_.js";import{M as Wt}from"./MoreVert-Ci70_mZh.js";import{d as Zt}from"./download-file-from-url-hJ3EUwXO.js";import{A as Gt}from"./ArrowUpward-0cWC32BO.js";import{u as pe}from"./use-keybind-7f4ijAco.js";import{A as Jt}from"./ArrowBack-DcV9hHRo.js";import{D as Xt}from"./dashboard-sidenav-B5THGxpt.js";import"./variable-extension-Cjf6-ocs.js";import"./campaign-conditions-config-DJxMZaUr.js";import"./select-Dsco87dL.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./Event-7FmyLdJJ.js";import"./ToggleOn-DZgCezoB.js";import"./TextFields-8TfbEP0O.js";import"./Add-CN0r1QLK.js";import"./index-W-EjzbYI.js";import"./with-selector-CDgEpx5P.js";import"./DataObject-XQLwxsph.js";import"./article-link-xsQ04UkN.js";import"./slugify-string-aubjgLQq.js";import"./article-path-Da7o5kHE.js";import"./category-link-0Q_zOKi3.js";import"./list-buttons-BgDZUgyW.js";import"./FormatListNumbered-rvs8UAfH.js";import"./Link-DfTxpaxj.js";import"./library-icon-CHCHM-UW.js";import"./form-chip-field-sH5S7-lx.js";import"./PushPin-Df_CN_Sp.js";import"./use-filter-KNtT5Txy.js";import"./Home--R_oEr6a.js";import"./OpenInFull-HWkxb3KN.js";import"./Spellcheck-Bs1hoM4Q.js";import"./progress-bar-iRLStr1h.js";import"./image-button-ExYLUK-F.js";import"./image-up-DCwS84Wx.js";import"./use-active-upload-CCDRf1Tl.js";import"./open-upload-window-CSDcieK1.js";import"./uploaded-file-DN6fXT4v.js";import"./shallow-BSWIanyL.js";import"./file-type-icon-Dok_AF4H.js";import"./file-thumbnail-D9-TxWtC.js";import"./formatted-bytes-CmuQhzYn.js";import"./pretty-bytes-bO14ePu9.js";import"./use-upload-attachments-D0EFLOL9.js";import"./use-droppable-DqkAoZym.js";import"./paperclip-DIi_RQSY.js";import"./index-DTFmR8Ac.js";import"./core-Dg-ESrC8.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./use-datatable-search-params-CQGreY35.js";import"./useInfiniteQuery-Dr3ouRcV.js";import"./infiniteQueryObserver-dCGK3uny.js";import"./formatted-number-DuD1Sa1W.js";import"./Tune-DusFnn8x.js";import"./websocket-updates-notifier-CaEDKM_o.js";import"./helpdesk-channel-CQKSbeKg.js";import"./date-picker-CUWok1XJ.js";import"./radio-Db_caP9D.js";import"./radio-group-DQLhD511.js";import"./use-compact-agents-VrJm5fj6.js";import"./online-status-circle-QXiKm4xe.js";import"./HourglassEmpty-BpvqVftp.js";import"./use-sync-envato-purchases-BudvWHKl.js";import"./external-link-DbBk1ItZ.js";import"./combobox-pHOmOE77.js";import"./AlternateEmail-DjCOtnvc.js";import"./ViewDay-DMtpTfzM.js";import"./message-author-name-DihwIAPW.js";import"./use-widget-bootstrap-data-BlKRRco5.js";import"./isScrollable-BSEN4xi5.js";import"./accordtion-animation-BGCK95Hj.js";import"./AttachFile-DK1KiGUi.js";import"./ChevronLeft-B96ua4ZU.js";import"./ChevronRight-T5gg5A4x.js";import"./FileDownload-DoJWzr8l.js";import"./useGlobalListeners-CeWFSHKo.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";const Yt=/<be-variable name="([a-zA-Z0-9_-]+)" type="([a-zA-Z0-9_-]+)"(?:\s+fallback="([a-zA-Z0-9_-]*)")?><\/be-variable>/gi;function ea(s,t){return s.replace(Yt,(a,n,i,r)=>{const c=sa(n,i,r||"",t);return Array.isArray(c)||typeof c=="object"&&c!==null?JSON.stringify(c):String(c)})}function sa(s,t,a,n){var d,l;const i=!a||a==="null"?null:a;let r=null;const c=n.attributes.find(u=>u.type===t&&u.key===s);if(c&&(r=_s(c,c.value)),r==null&&(t==="user"?r=n.user[s]:t==="conversation"&&(r=n.conversation[s])),s==="language"&&r){const u=(d=bs().find(p=>p.code===r))==null?void 0:d.name;u&&(r=u)}if(s==="country"&&r){const u=(l=Cs().find(p=>p.code===r))==null?void 0:l.name;u&&(r=u)}return r??(i||s)}const ds=s=>`conversation-${s}-draft`,ta={body:"",attachments:[],tags:[]},aa=({conversation:s,statuses:t,storedDraft:a})=>{const n=ds(s.id),i=`${s.type}-composer-status`;return ws()((r,c)=>{var d;return{conversation:s,statuses:t,selectedStatus:s.type==="ticket"?ae(i,(d=t.find(l=>l.category===H.closed))==null?void 0:d.id):null,updateSelectedStatus:l=>{r({selectedStatus:l}),ge(i,l)},messageType:"message",setMessageType:l=>r({messageType:l}),addAttachment:l=>{const u=[...c().draft.attachments,l];r({draft:{...c().draft,attachments:u}}),c().updateDraft({attachments:u})},removeAttachment:l=>{const u=c().draft.attachments.filter(p=>p.id!==l.id);r({draft:{...c().draft,attachments:u}}),c().updateDraft({attachments:u})},removeTag:l=>{const u=c().draft.tags.filter(p=>p.id!==l.id);r({draft:{...c().draft,tags:u}}),c().updateDraft({tags:u})},draft:{...ta,...a},updateDraft:l=>{r({draft:{...c().draft,...l}}),ge(n,{...ae(n)??{},...l})},deleteDraft:()=>{Ss(n),r({draft:{body:"",attachments:[],tags:[]}})},getData:()=>c()}})},ms=m.createContext(null);function na({children:s,conversation:t}){const a=m.useRef(null);return a.current||(a.current=aa({conversation:t,statuses:y.getQueryData(h.statuses.dropdownList("agent").queryKey).statuses,storedDraft:ae(ds(t.id))})),e.jsx(ms.Provider,{value:a.current,children:s})}function g(s){const t=m.useContext(ms);return Is(t,s)}const re=m.forwardRef((s,t)=>e.jsxs(B,{...s,ref:t,children:[e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}),e.jsx("path",{d:"M13 8H7"}),e.jsx("path",{d:"M17 12H7"})]})),ye=m.forwardRef((s,t)=>e.jsxs(B,{...s,ref:t,children:[e.jsx("path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z"}),e.jsx("path",{d:"M15 3v4a2 2 0 0 0 2 2h4"})]}));function ia(){const s=g(a=>a.messageType),t=g(a=>a.setMessageType);return e.jsxs(q,{placement:"top",offset:8,selectedValue:s,selectionMode:"single",children:[e.jsx(j,{size:"xs",className:"ml-4",startIcon:s==="message"?e.jsx(re,{}):e.jsx(ye,{}),endIcon:e.jsx(W,{}),children:s==="message"?e.jsx(o,{message:"Message"}):e.jsx(o,{message:"Note"})}),e.jsxs(U,{children:[e.jsx(v,{value:"message",onSelected:()=>t("message"),startIcon:e.jsx(re,{size:"sm"}),children:e.jsx(o,{message:"Message"})}),e.jsx(v,{value:"note",onSelected:()=>t("note"),startIcon:e.jsx(ye,{size:"sm"}),children:e.jsx(o,{message:"Note"})})]})]})}function je(s){const[t]=we(),a=t.get("viewId"),n=Ns(),i=s.type==="ticket"?"next_active":"stay_on_page",[r,c]=Se(`after_reply_action.${s.type}`,i),{conversationListLayout:d}=N(),l=m.useCallback(async()=>{const u=()=>{if(d==="table")return n(`/dashboard/conversations?viewId=${a}`)};if(r==="next_active"){const x=(await y.ensureInfiniteQueryData(h.conversations.infiniteIndex(Object.fromEntries(t)))).pages[0].pagination.data??[];if(x.length>0){const I=x.findIndex(P=>P.id===s.id),f=I>-1?x[I+1]:null;f?n(Le(f,{viewId:a})):u()}}else r==="back_to_view"&&u()},[r,a,n,s.id,t,d]);return{action:r,setAction:c,perform:l}}function oa({disabled:s,conversation:t}){const{action:a,setAction:n}=je(t);return e.jsxs(q,{selectionMode:"single",selectedValue:a,onItemSelected:i=>n(i),showCheckmark:!0,children:[e.jsx(w,{size:"xs",iconSize:"sm",variant:"flat",color:"primary",radius:"rounded-r-button",disabled:s,children:e.jsx(W,{})}),e.jsxs(U,{children:[e.jsx(v,{value:"stay_on_page",children:e.jsx(o,{message:"Send and stay on page"})}),e.jsx(v,{value:"next_active",children:e.jsx(o,{message:"Send and next active"})}),e.jsx(v,{value:"back_to_view",children:e.jsx(o,{message:"Send and back to view"})})]})]})}const us=["submit-agent-reply"];function ra(s){const{perform:t}=je(s),a=g(c=>c.getData),n=g(c=>c.deleteDraft),i=g(c=>c.setMessageType),r=()=>{const c=a(),d=Ds();return Vs(d),{status_id:c.selectedStatus,type:c.messageType,attachments:c.draft.attachments.map(l=>l.id),tags:c.draft.tags.map(l=>l.id),body:c.draft.body,author:"agent",uuid:d}};return T({mutationKey:us,mutationFn:()=>z.post(`helpdesk/agent/conversations/${s.id}/messages`,r()).then(c=>c.data),onError:c=>A(c),onSuccess:async c=>{n(),i("message"),y.invalidateQueries({queryKey:h.views.invalidateKey}),await Promise.allSettled([c.message.type!=="note"?t():Promise.resolve(),y.invalidateQueries({queryKey:h.conversations.invalidateKey})]),_(M("Reply submitted"),{position:"top-center"})}})}function ca({conversation:s}){const t=Ie(),a=g(l=>l.selectedStatus),n=g(l=>l.messageType),i=g(l=>l.updateSelectedStatus),r=g(l=>l.draft.body),d=$s({mutationKey:us})>0||!r.trim();return n==="note"?e.jsx(j,{type:"submit",variant:"flat",color:"primary",size:"xs",disabled:d,className:"mr-4",children:e.jsx(o,{message:"Add note"})}):e.jsxs(m.Fragment,{children:[s.type==="ticket"&&e.jsx(la,{selectedStatus:a,onStatusChange:i}),e.jsxs("div",{className:"mr-4 flex",children:[e.jsx(j,{type:"submit",variant:"flat",color:"primary",size:"xs",disabled:d,radius:"rounded-l-button",children:t?e.jsx(o,{message:"Send"}):e.jsx(o,{message:"Send reply"})}),e.jsx("div",{className:F("w-1",d?"bg-disabled/20":"bg-primary/70")}),e.jsx(oa,{disabled:d,conversation:s})]})]})}function la({selectedStatus:s,onStatusChange:t}){const a=Ie(),n=E(h.statuses.dropdownList("agent"));if(!n.data)return null;const i=n.data.statuses.find(r=>r.id===s);return e.jsxs(q,{selectionMode:"single",selectedValue:s,children:[a?e.jsx(w,{variant:"outline",size:"xs",className:"mr-4",children:e.jsx(Qs,{})}):e.jsx(j,{variant:"outline",size:"xs",className:"mr-4",endIcon:e.jsx(W,{}),children:i==null?void 0:i.label}),e.jsx(U,{children:n.data.statuses.map(r=>e.jsx(v,{value:r.id,onSelected:()=>t(r.id),startIcon:e.jsx(Re,{category:r.category}),children:e.jsx(o,{message:r.label})},r.id))})]})}function da({data:s}){const{hasPermission:t}=Ne(),a=!t("files.create"),n=m.useRef(null),i=g(x=>x.updateDraft),r=ra(s.conversation),c=g(x=>x.draft),d=g(x=>x.messageType),l=g(x=>x.addAttachment),u=g(x=>x.removeAttachment),p=()=>{r.mutate(void 0,{onSuccess:()=>{var x;return(x=n.current)==null?void 0:x.clearContents()}})};return e.jsx("form",{onSubmit:x=>{x.preventDefault(),p()},children:e.jsx(Oe,{isDisabled:a,onUpload:l,children:e.jsxs(Ve,{ref:n,initialContent:c.body,height:"max-h-[50vh] min-h-[180px]",onChange:x=>i({body:x}),className:F("mx-16 my-16",d==="note"&&"bg-warning/15"),header:e.jsx(ia,{}),submitToClosestForm:!0,children:[e.jsx(Ke,{}),e.jsx(Be,{className:"mb-2 mt-24 px-12",attachments:c.attachments,onRemove:u}),e.jsx(ua,{}),e.jsxs($e,{submitButtons:e.jsx(ca,{conversation:s.conversation}),children:[e.jsx(ma,{data:s}),e.jsx(_e,{}),e.jsx(xa,{data:s}),!a&&e.jsx(qe,{onUpload:l}),!a&&e.jsx(Ue,{uploadType:De.conversationImages}),e.jsx(Ee,{disabled:!c.body.length})]})]})})})}function ma({data:s}){const t=Js(),a=g(i=>i.draft),n=g(i=>i.updateDraft);return e.jsx(Bs,{onSelected:i=>{t==null||t.commands.insertContent(ea(i.body,s)),setTimeout(()=>{t==null||t.commands.focus()},170),n(i)},getInitialData:()=>({body:a.body,attachments:a.attachments,tags:a.tags})})}function ua(){const s=g(a=>a.draft.tags),t=g(a=>a.removeTag);return s!=null&&s.length?e.jsx(X,{size:"xs",className:"mb-2 mt-12 px-12",children:s.map(a=>e.jsx(Z,{onRemove:()=>t(a),children:a.name},a.id))}):null}function xa({data:s}){var n,i,r,c,d;const t=(n=s.attributes)==null?void 0:n.find(l=>l.key==="category"),a=t!=null&&t.value?(d=(c=(r=(i=t.config)==null?void 0:i.options)==null?void 0:r.find(l=>l.value===t.value))==null?void 0:c.hcCategories)==null?void 0:d[0]:void 0;return e.jsx(Os,{categoryIds:a?[a]:void 0})}function pa({count:s=3}){return e.jsx(G.div,{...le,children:Array.from({length:s}).map((t,a)=>e.jsx(ja,{},a))},"chat-list-skeletons")}function ja(){return e.jsxs("div",{className:"flex gap-8 p-12",children:[e.jsx(C,{variant:"avatar",radius:"rounded-full",size:"w-24 h-24",animation:"wave"}),e.jsxs("div",{className:"flex-auto",children:[e.jsx("div",{className:"mb-4 text-base font-semibold",children:e.jsx(C,{className:"max-w-80",animation:"wave"})}),e.jsxs("div",{className:"text-[13px]",children:[e.jsx(C,{className:"max-w-280",animation:"wave"}),e.jsx(C,{className:"max-w-200",animation:"wave"})]})]})]})}function ha(){const{isMobileMode:s}=m.useContext(Pe),{conversationListOpen:t,conversationPageViewsSidebarOpen:a}=N(),n=t&&!s,i=e.jsxs(G.div,{initial:{width:0,opacity:0},animate:{width:"",opacity:1},exit:{width:0,opacity:0},transition:{duration:.1},className:F("inbox-conversation-list dashboard-rounded-panel flex flex-shrink-0 flex-col lg:ml-8",a&&"compact"),children:[e.jsx(ga,{}),e.jsx(fa,{})]});return e.jsx(de,{initial:!1,mode:"wait",children:n&&i})}function ga(){const{conversationPageViewsSidebarOpen:s,toggleConversationPageViewsSidebar:t}=N(),a=Xs();return e.jsxs(Y,{gap:"gap-4",children:[e.jsx(Ms,{placement:"bottom",label:s?e.jsx(o,{message:"Hide views sidebar"}):e.jsx(o,{message:"Show views sidebar"}),children:e.jsx(w,{size:"xs",onClick:()=>t(),children:e.jsx(We,{})})}),a?e.jsx(o,{message:a}):e.jsx(o,{message:"Conversations"}),e.jsx(Ys,{className:"ml-auto"})]})}function fa(){const{conversationId:s}=Ts(),{query:t,isEmpty:a,items:n}=et();return e.jsx("div",{className:"compact-scrollbar flex-auto overflow-y-auto",children:e.jsx(de,{initial:!1,mode:"wait",children:a?t.isLoading?e.jsx(pa,{count:3}):e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(Ze,{size:"xs",image:e.jsx(He,{size:"lg"}),imageMargin:"mb-12",imageHeight:"h-auto",title:e.jsx(o,{message:"No conversations in this view"})})}):e.jsx(m.Fragment,{children:e.jsxs(G.div,{className:"space-y-4 p-8",...le,children:[n.map(i=>e.jsx(at,{conversation:i,isActive:`${s}`==`${i.id}`,badge:e.jsx(it,{conversationId:i.id,className:"ml-auto"})},i.id)),e.jsx(ot,{query:t})]},"grouped-chats")})})})}const va=As(e.jsx("path",{d:"M18.25 3.25C18.6642 3.25 19 3.58579 19 4C19 4.33152 19.1317 4.64946 19.3661 4.88388C19.6005 5.1183 19.9185 5.25 20.25 5.25C20.6642 5.25 21 5.58579 21 6C21 6.41421 20.6642 6.75 20.25 6.75C19.9185 6.75 19.6005 6.8817 19.3661 7.11612C19.1317 7.35054 19 7.66848 19 8C19 8.41421 18.6642 8.75 18.25 8.75C17.8358 8.75 17.5 8.41421 17.5 8C17.5 7.66848 17.3683 7.35054 17.1339 7.11612C16.8995 6.8817 16.5815 6.75 16.25 6.75C15.8358 6.75 15.5 6.41421 15.5 6C15.5 5.58579 15.8358 5.25 16.25 5.25C16.5815 5.25 16.8995 5.1183 17.1339 4.88388C17.3683 4.64946 17.5 4.33152 17.5 4C17.5 3.58579 17.8358 3.25 18.25 3.25ZM18.25 5.88746C18.2318 5.90673 18.2133 5.92576 18.1945 5.94454C18.1758 5.96333 18.1567 5.98182 18.1375 6C18.1567 6.01819 18.1758 6.03667 18.1945 6.05546C18.2133 6.07424 18.2318 6.09327 18.25 6.11254C18.2682 6.09327 18.2867 6.07424 18.3055 6.05546C18.3242 6.03667 18.3433 6.01819 18.3625 6C18.3433 5.98182 18.3242 5.96333 18.3055 5.94454C18.2867 5.92576 18.2682 5.90673 18.25 5.88746ZM9.25 5.25C9.66421 5.25 10 5.58579 10 6C10 7.39239 10.5531 8.72774 11.5377 9.71231C12.5223 10.6969 13.8576 11.25 15.25 11.25C15.6642 11.25 16 11.5858 16 12C16 12.4142 15.6642 12.75 15.25 12.75C13.8576 12.75 12.5223 13.3031 11.5377 14.2877C10.5531 15.2723 10 16.6076 10 18C10 18.4142 9.66421 18.75 9.25 18.75C8.83579 18.75 8.5 18.4142 8.5 18C8.5 16.6076 7.94688 15.2723 6.96231 14.2877C5.97774 13.3031 4.64239 12.75 3.25 12.75C2.83579 12.75 2.5 12.4142 2.5 12C2.5 11.5858 2.83579 11.25 3.25 11.25C4.64239 11.25 5.97774 10.6969 6.96231 9.71231C7.94688 8.72774 8.5 7.39239 8.5 6C8.5 5.58579 8.83579 5.25 9.25 5.25ZM9.25 9.09234C8.93321 9.70704 8.52103 10.2749 8.02297 10.773C7.52491 11.271 6.95704 11.6832 6.34234 12C6.95704 12.3168 7.52491 12.729 8.02297 13.227C8.52103 13.7251 8.93321 14.293 9.25 14.9077C9.56679 14.293 9.97897 13.7251 10.477 13.227C10.9751 12.729 11.543 12.3168 12.1577 12C11.543 11.6832 10.9751 11.271 10.477 10.773C9.97897 10.2749 9.56679 9.70704 9.25 9.09234ZM18.25 15.25C18.6642 15.25 19 15.5858 19 16C19 16.3315 19.1317 16.6495 19.3661 16.8839C19.6005 17.1183 19.9185 17.25 20.25 17.25C20.6642 17.25 21 17.5858 21 18C21 18.4142 20.6642 18.75 20.25 18.75C19.9185 18.75 19.6005 18.8817 19.3661 19.1161C19.1317 19.3505 19 19.6685 19 20C19 20.4142 18.6642 20.75 18.25 20.75C17.8358 20.75 17.5 20.4142 17.5 20C17.5 19.6685 17.3683 19.3505 17.1339 19.1161C16.8995 18.8817 16.5815 18.75 16.25 18.75C15.8358 18.75 15.5 18.4142 15.5 18C15.5 17.5858 15.8358 17.25 16.25 17.25C16.5815 17.25 16.8995 17.1183 17.1339 16.8839C17.3683 16.6495 17.5 16.3315 17.5 16C17.5 15.5858 17.8358 15.25 18.25 15.25ZM18.25 17.8875C18.2318 17.9067 18.2133 17.9258 18.1945 17.9445C18.1758 17.9633 18.1567 17.9818 18.1375 18C18.1567 18.0182 18.1758 18.0367 18.1945 18.0555C18.2133 18.0742 18.2318 18.0933 18.25 18.1125C18.2682 18.0933 18.2867 18.0742 18.3055 18.0555C18.3242 18.0367 18.3433 18.0182 18.3625 18C18.3433 17.9818 18.3242 17.9633 18.3055 17.9445C18.2867 17.9258 18.2682 17.9067 18.25 17.8875Z"}),"WandSparkleIcon");function be(s,t){y.setQueryData(h.conversations.summary(s).queryKey,{summary:t})}function ya(){return T({mutationFn:({conversationId:s})=>z.delete(`helpdesk/conversations/${s}/summary`).then(t=>t.data),onError:s=>A(s)})}function ba(){return T({mutationFn:({conversationId:s})=>z.post(`helpdesk/conversations/${s}/summary/generate`).then(t=>t.data),onError:s=>A(s)})}function Ca({initialData:s}){const{conversationId:t}=ee(["conversationId"]),a=ba(),n=ya(),{data:i}=E(h.conversations.summary(t,s));return e.jsxs("div",{children:[i!=null&&i.summary?e.jsx(wa,{summary:i.summary}):null,i!=null&&i.summary?null:e.jsx("div",{className:"mb-10 text-xs text-muted",children:e.jsx(o,{message:"Use AI to generate a concise conversation summary, keywords and overall customer sentiment."})}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx(j,{variant:"flat",color:"primary",size:"xs",startIcon:a.isPending?e.jsx(Me,{isIndeterminate:!0,size:"xs"}):e.jsx(va,{}),disabled:a.isPending,onClick:()=>{a.mutate({conversationId:t},{onSuccess:r=>{be(t,r.summary)}})},children:e.jsx(o,{message:"Generate summary"})}),i!=null&&i.summary?e.jsx(j,{variant:"outline",size:"xs",disabled:n.isPending,onClick:()=>{n.mutate({conversationId:t},{onSuccess:()=>{be(t,null)}})},children:e.jsx(o,{message:"Remove"})}):null]})]})}function wa({summary:s}){var t;return e.jsxs("div",{className:"mb-24",children:[e.jsx("ul",{className:"list-inside list-disc text-sm",children:s.content.summary.map((a,n)=>e.jsx("li",{children:a},n))}),e.jsx(X,{size:"sm",className:"mt-12",children:s.content.keywords.map((a,n)=>e.jsx(Z,{children:a},n))}),e.jsxs("div",{className:"mt-12 text-xs text-muted",children:[e.jsx(o,{message:"Customer sentiment"}),": ",s.content.sentiment]}),e.jsx("div",{className:"mt-6 text-xs text-muted",children:e.jsx(o,{message:"Generated on :date by :name",values:{date:e.jsx(me,{date:s.created_at,preset:"long"}),name:((t=s.user)==null?void 0:t.name)||"agent"}})})]})}function he(s,t){return T({mutationFn:a=>z.put(`helpdesk/agent/conversations/${s}`,a).then(n=>n.data),onSuccess:async()=>{await y.invalidateQueries({queryKey:h.conversations.invalidateKey})},onError:a=>t?rt(a,t):A(a)})}function Sa({attributes:s,conversation:t}){const{close:a,formId:n}=S(),i=Te({defaultValues:lt(s)}),r=he(t.id);return e.jsxs(k,{children:[e.jsx(V,{children:e.jsx(o,{message:"Edit attributes"})}),e.jsx(O,{children:e.jsx(Ae,{id:n,form:i,onSubmit:c=>r.mutate({attributes:c},{onSuccess:()=>{_(M("Attributes updated")),a()}}),children:e.jsx("div",{className:"space-y-24",children:s.map(c=>e.jsx(ct,{attribute:c},c.id))})})}),e.jsxs(J,{children:[e.jsx(j,{onClick:()=>a(),children:e.jsx(o,{message:"Cancel"})}),e.jsx(j,{type:"submit",color:"primary",variant:"flat",form:n,disabled:r.isPending,children:e.jsx(o,{message:"Update"})})]})]})}function Ia({conversationId:s,size:t="xs",tags:a,...n}){const i=Qe();return a.length?e.jsx(X,{...n,size:t,children:a.map(r=>e.jsx(Z,{disabled:i.isPending,onRemove:()=>i.mutate({tagId:r.id,conversationIds:[s]},{onSuccess:()=>{y.invalidateQueries({queryKey:h.conversations.get(s).queryKey})}}),children:r.name},r.id))}):null}function Na({data:s}){const t=s.user,a=s.conversation.assignee,n=s.conversation.group;return e.jsxs("div",{className:"m-20",children:[e.jsx(Ma,{user:t}),e.jsx(Q,{label:e.jsx(o,{message:"Assignee"}),className:"mb-4",value:e.jsxs(b,{type:"modal",children:[e.jsx("button",{className:"contents",children:a?e.jsx(K,{image:e.jsx(dt,{user:a,size:"xs"}),children:a.name}):e.jsx(K,{image:e.jsx(gt,{size:"sm"}),children:e.jsx(o,{message:"Unassigned"})})}),e.jsx(ie,{type:"agent",conversationIds:[s.conversation.id]})]})}),e.jsx(Q,{label:e.jsx(o,{message:"Group"}),value:e.jsxs(b,{type:"modal",children:[e.jsx("button",{className:"contents",children:n?e.jsx(K,{image:e.jsx(zs,{label:n.name,size:"xs"}),children:n.name}):e.jsx(K,{image:e.jsx(Hs,{size:"sm"}),children:e.jsx(o,{message:"Unassigned"})})}),e.jsx(ie,{type:"group",conversationIds:[s.conversation.id]})]})}),e.jsx(Ia,{className:"pt-20",conversationId:s.conversation.id,tags:s.tags}),e.jsx(Da,{user:t}),s.conversation.rating!=null&&e.jsx("div",{className:"mt-12 flex items-center gap-8 text-sm",children:s.conversation.rating?e.jsxs(m.Fragment,{children:[e.jsx(vt,{className:"text-positive",size:"sm"}),e.jsx(o,{message:"Rated good"})]}):e.jsxs(m.Fragment,{children:[e.jsx(ft,{className:"text-danger",size:"sm"}),e.jsx(o,{message:"Rated bad"})]})})]})}function Da({user:s}){var a;if(!s.banned_at)return null;const t=(a=s.bans)==null?void 0:a[0];return e.jsxs(m.Fragment,{children:[e.jsxs("div",{className:"mt-12 flex items-center gap-8 text-sm text-danger",children:[e.jsx(Ye,{size:"sm"}),e.jsxs("div",{children:[e.jsx(o,{message:"Suspended user"}),(t==null?void 0:t.expired_at)&&e.jsxs(m.Fragment,{children:[" ","(",e.jsx(ut,{endDate:t.expired_at,verbose:!0}),")"]})]})]}),(t==null?void 0:t.comment)&&e.jsx("div",{className:"mt-6 text-xs text-danger",children:t.comment})]})}function Q({label:s,value:t,className:a}){return e.jsxs("div",{className:F("flex overflow-hidden py-4 text-sm",a),children:[e.jsx("div",{className:"w-84 flex-shrink-0 text-muted",children:s}),e.jsx("div",{className:"min-w-0 flex-auto",children:t})]})}function K({image:s,children:t}){return e.jsxs("div",{className:"flex items-center gap-6",children:[s,e.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap",children:t})]})}function Ma({user:s}){var t;return e.jsxs("div",{className:"mb-12 overflow-hidden border-b pb-18",children:[e.jsxs("div",{className:"flex items-center gap-12 whitespace-nowrap",children:[e.jsx($,{to:`/dashboard/customers/${s.id}`,target:"_blank",children:e.jsx(mt,{user:s,size:"w-64 h-64"})}),e.jsxs("div",{className:"min-w-0 flex-auto",children:[e.jsx($,{to:`/dashboard/customers/${s.id}`,target:"_blank",className:"hover:underline",children:e.jsx(Je,{className:"overflow-hidden overflow-ellipsis text-base font-semibold",user:s})}),s.email&&e.jsx("div",{className:"overflow-hidden overflow-ellipsis text-sm",children:s.email}),(s.country||s.city)&&e.jsxs("div",{className:"mb-2 text-sm",children:[s.country,", ",s.city]}),e.jsxs("div",{className:"text-sm text-muted",children:[e.jsx(me,{date:Ta(s.timezone),preset:"time"})," ",e.jsx(o,{message:"local time"})]})]})]}),!!((t=s.tags)!=null&&t.length)&&e.jsx(X,{size:"xs",className:"mt-18",children:s.tags.map(a=>e.jsx(Z,{children:a},a))})]})}function Ta(s){try{return fe(s??ve())}catch{return fe(ve())}}function Aa({isLoading:s}){return e.jsxs(G.div,{...le,className:"m-20",children:[e.jsxs("div",{className:"mb-12 flex items-center gap-12 border-b pb-18",children:[e.jsx(C,{variant:"avatar",radius:"rounded-full",size:"w-64 h-64",animation:s?"wave":null}),e.jsxs("div",{className:"flex-auto",children:[e.jsx(C,{className:"mb-2 max-w-80 text-base",animation:s?"wave":null}),e.jsx(C,{className:"max-w-200 text-sm",animation:s?"wave":null}),e.jsx(C,{className:"max-w-160 text-sm",animation:s?"wave":null})]})]}),e.jsx(Q,{label:e.jsx(C,{className:"min-h-24 max-w-70 text-sm",animation:s?"wave":null}),value:e.jsx(C,{className:"max-w-110",animation:s?"wave":null})}),e.jsx(Q,{label:e.jsx(C,{className:"min-h-24 max-w-50 text-sm",animation:s?"wave":null}),value:e.jsx(C,{className:"max-w-80",animation:s?"wave":null})})]},"chat-info-sidebar-skeleton")}function za({customerId:s,onSelected:t,excludeId:a}){const{data:n}=E(h.conversations.recent(s,a));return n?n.conversations.length?e.jsx("div",{className:"space-y-4",children:n.conversations.map(i=>{if(!i.description)return null;const c=e.jsx(ne,{date:i.created_at,style:"long"});return e.jsxs("div",{className:"-mx-12 cursor-pointer rounded-panel px-12 py-8 transition-button hover:bg-hover",onClick:()=>t(i),children:[e.jsx("div",{className:F("mb-4 overflow-hidden overflow-ellipsis whitespace-nowrap text-sm",i.status_category>=H.closed?"font-medium":"text-muted"),children:i.subject?i.subject:e.jsx(o,{message:"Started :time",values:{time:c}})}),e.jsx("div",{className:"text-[13px] text-muted",children:e.jsx("div",{className:"min-w-0 overflow-hidden overflow-ellipsis whitespace-nowrap",children:i.description})})]},i.id)})}):e.jsx("div",{className:"font-italic text-xs text-muted",children:e.jsx(o,{message:"No recent conversations"})}):e.jsx("div",{className:"flex justify-center",children:e.jsx(Me,{isIndeterminate:!0,size:"xs"})})}function Fa({message:s}){const t=T({mutationFn:i=>z.delete(`helpdesk/agent/messages/${i.message.id}`).then(r=>r.data),onSuccess:async()=>{await y.invalidateQueries({queryKey:h.conversations.invalidateKey})},onError:i=>A(i)});let a=e.jsx(o,{message:"Delete message"}),n=e.jsx(o,{message:"Are you sure you want to delete this message?"});return s.type==="note"&&(a=e.jsx(o,{message:"Delete note"}),n=e.jsx(o,{message:"Are you sure you want to delete this note?"})),e.jsx(se,{isDanger:!0,title:a,body:n,confirm:e.jsx(o,{message:"Delete"}),onConfirm:()=>t.mutate({message:s},{onSuccess:()=>Fs()}),isLoading:t.isPending})}function ka({replyId:s}){var r;const{base_url:t}=ze(),[a,n]=m.useState("html"),i=E(h.conversations.originalReplyEmail(s));return e.jsxs(k,{size:"fullscreen",className:"h-dialog",children:[e.jsx(V,{showDivider:!0,padding:"px-24 py-12",titleFontWeight:"font-normal",titleTextSize:"text-base",justify:"justify-start",actions:e.jsxs("div",{children:[e.jsxs(It,{variant:"outline",radius:"rounded-md",size:"xs",value:a,onChange:n,children:[e.jsx(j,{value:"html",children:e.jsx(o,{message:"HTML"})}),e.jsx(j,{value:"plain",children:e.jsx(o,{message:"Plain"})}),e.jsx(j,{value:"headers",children:e.jsx(o,{message:"Headers"})})]}),e.jsx(j,{className:"ml-34",variant:"outline",size:"xs",elementType:"a",download:!0,href:`${t}/api/v1/helpdesk/agent/messages/${s}/email/download`,children:e.jsx(o,{message:"Download"})})]}),children:e.jsx(o,{message:"Original email"})}),e.jsx(O,{children:(r=i.data)!=null&&r.email?e.jsx(Pa,{data:i.data,activeTab:a}):e.jsx(La,{query:i})})]})}function Pa({data:s,activeTab:t}){return t==="html"?s.email.body.html?e.jsx("div",{dangerouslySetInnerHTML:{__html:s.email.body.html}}):e.jsx(ce,{children:e.jsx(o,{message:"Email does not contain HTML content"})}):t==="plain"?s.email.body.plain?e.jsx("pre",{className:"whitespace-pre-wrap break-words",children:s.email.body.plain}):e.jsx(ce,{children:e.jsx(o,{message:"Email does not contain plain text content"})}):e.jsx("table",{children:e.jsx("tbody",{children:Object.entries(s.email.headers).map(([a,n])=>e.jsxs("tr",{children:[e.jsx("th",{className:"whitespace-nowrap border px-20 py-10 text-left",children:a}),e.jsx("td",{className:"whitespace-nowrap border px-20 py-10 text-left",children:n})]},a))})})}function La({query:s}){return s.isLoading?e.jsx(Fe,{className:"absolute inset-0 m-auto"}):e.jsx(ce,{children:e.jsx(o,{message:"Original email for this reply does not exist"})})}function ce({children:s}){return e.jsx(Ze,{className:"mt-40",image:e.jsx("div",{children:e.jsx(ks,{size:"xl"})}),imageHeight:"h-auto",title:s})}function xs(){return T({mutationFn:s=>z.put(`helpdesk/agent/messages/${s.messageId}`,s).then(t=>t.data),onSuccess:async s=>{await y.invalidateQueries({queryKey:h.conversations.messages(s.message.conversation_id).queryKey})},onError:s=>A(s)})}function Ra({message:s}){const{close:t,formId:a}=S(),{hasPermission:n}=Ne(),i=!n("files.create"),r=xs(),[c,d]=m.useState(s.body),[l,u]=m.useState(s.attachments||[]),p=s.type==="note"?e.jsx(o,{message:"Edit note"}):e.jsx(o,{message:"Edit reply"}),x=()=>{r.mutate({messageId:s.id,body:c,attachments:l.map(f=>f.id)},{onSuccess:()=>{t(),_(s.type==="note"?M("Updated note"):M("Updated reply"))}})},I=f=>{u([...l,f])};return e.jsxs(k,{size:"lg",children:[e.jsx(V,{children:p}),e.jsx(O,{children:e.jsxs(es,{children:[e.jsx(Oe,{isDisabled:i,onUpload:I,children:e.jsx("form",{id:a,onSubmit:f=>{f.preventDefault(),x()},children:e.jsxs(Ve,{autoFocus:"end",initialContent:s.body,onChange:d,submitToClosestForm:!0,children:[e.jsx(Ke,{}),e.jsx(Nt,{}),e.jsxs($e,{children:[e.jsx(_e,{}),!i&&e.jsx(qe,{onUpload:I}),!i&&e.jsx(Ue,{uploadType:De.conversationImages}),e.jsx(Ee,{})]})]})})}),e.jsx(Be,{attachments:l,onRemove:f=>{u(l.filter(P=>P.id!==f.id))},className:"mt-12"})]})}),e.jsxs(J,{children:[e.jsx(j,{onClick:()=>t(),children:e.jsx(o,{message:"Cancel"})}),e.jsx(j,{variant:"flat",color:"primary",disabled:r.isPending,type:"submit",form:a,children:e.jsx(o,{message:"Save"})})]})]})}const _a=m.forwardRef((s,t)=>e.jsxs(B,{...s,ref:t,children:[e.jsx("path",{d:"M22 12.5V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h7.5"}),e.jsx("path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"}),e.jsx("path",{d:"M18 21a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),e.jsx("circle",{cx:"18",cy:"18",r:"3"}),e.jsx("path",{d:"m22 22-1.5-1.5"})]}));function ps({message:s}){const{close:t}=S(),[a,n]=m.useState(""),i=[{id:"edit",title:e.jsx(o,{message:"Edit"}),startIcon:e.jsx(Dt,{size:"sm"}),onSelected:()=>{t(),D(Ra,{message:s})}},{id:"showOriginal",title:e.jsx(o,{message:"Show original email"}),startIcon:e.jsx(_a,{size:"sm"}),onSelected:()=>{t(),D(ka,{replyId:s.id})}},{id:"delete",title:e.jsx(o,{message:"Delete"}),startIcon:e.jsx(ss,{size:"sm"}),onSelected:()=>{t(),D(Fa,{message:s})}}].filter(r=>{var c;return!(r.id==="showOriginal"&&s.source!=="email"||a&&!((c=r.title.props.message)!=null&&c.toLowerCase().includes(a.toLowerCase())))});return e.jsx(St,{data:i,height:"h-[208px]",placeholder:M("Search actions..."),query:a,onQueryChange:n})}function Ea({replyId:s,attachments:t}){return t.length?e.jsx(Zs,{className:"mt-20 w-max",children:t.map((a,n)=>e.jsx(Gs,{attachments:t,index:n,onRemove:s?()=>{D(js,{replyId:s,attachmentId:a.id,attachments:t})}:void 0},a.id))}):null}function js({messageId:s,attachmentId:t,attachments:a,onSuccess:n}){const i=xs(),{close:r}=S();return e.jsx(se,{isDanger:!0,title:e.jsx(o,{message:"Delete attachment"}),body:e.jsx(o,{message:"Are you sure you want to delete this attachment?"}),confirm:e.jsx(o,{message:"Delete"}),onConfirm:()=>{i.mutate({messageId:s,attachments:a.filter(c=>c.id!==t).map(c=>c.id)},{onSuccess:()=>{n==null||n(),r()}})},isLoading:i.isPending})}function hs({buttons:s,className:t}){return e.jsx("div",{className:F("flex flex-wrap gap-6",t),children:s==null?void 0:s.map((a,n)=>e.jsx("div",{className:"whitespace-nowrap rounded-button border border-primary/50 px-12 py-4 text-xs font-medium text-primary",children:a.name},n))})}function Oa({message:s,messages:t,index:a}){switch(s.type){case"event":case"collectDetailsForm":case"cards":return e.jsx(Tt,{className:"px-24",message:s,messages:t,index:a,variant:"agent"});case"submittedFormData":return e.jsx(Mt,{message:s,messages:t,index:a,className:"px-24"});default:return e.jsx(Ba,{message:s,messages:t,index:a,className:"px-24"})}}function Ba({message:s,messages:t,index:a,className:n}){var r,c,d;const i="is_placeholder"in s;return e.jsxs(m.Fragment,{children:[e.jsxs(At,{className:n,message:s,actions:!i&&e.jsxs(b,{type:"modal",children:[e.jsx(w,{size:"xs",iconSize:"sm",className:"text-muted",children:e.jsx(as,{})}),e.jsx(ps,{message:s})]}),children:[e.jsx(ts,{className:"mr-24 text-sm",addParagraphSpacing:s.author==="bot",children:s.body}),!!((c=(r=s.data)==null?void 0:r.buttons)!=null&&c.length)&&e.jsx(hs,{className:"mt-12",buttons:(d=s.data)==null?void 0:d.buttons}),e.jsx(Ea,{replyId:i?void 0:s.id,attachments:s.attachments})]}),e.jsx(zt,{messages:t,index:a})]})}function gs({data:{conversation:s}}){var n;const t=xe(s.id),a=((n=t.data)==null?void 0:n.items)??[];return e.jsx("div",{className:"compact-scrollbar flex-auto overflow-y-auto",children:e.jsx(ns,{query:t,children:a.map((i,r)=>e.jsx(Oa,{message:i,messages:a,index:r},i.id))})})}function fs({data:s}){const t=Xe(s.user);return e.jsx(e.Fragment,{children:e.jsxs(b,{type:"modal",children:[e.jsx("h1",{className:"min-w-0 cursor-pointer overflow-hidden text-ellipsis whitespace-nowrap rounded px-4 text-lg font-semibold hover:bg-primary/focus",children:s.conversation.subject||t}),e.jsx(qa,{data:s})]})})}function qa({data:{conversation:s}}){const{close:t}=S(),[a,n]=m.useState(s.subject||""),i=he(s.id),{trans:r}=Ps(),c=()=>{i.mutate({subject:a},{onSuccess:()=>{_(r({message:"Subject updated"})),t()}})};return e.jsxs(k,{children:[e.jsx(V,{children:e.jsx(o,{message:"Edit subject"})}),e.jsx(O,{children:e.jsx(Ls,{value:a,onChange:d=>n(d.target.value),label:e.jsx(o,{message:"Subject"}),autoFocus:!0,required:!0,minLength:3,maxLength:180,className:"w-full"})}),e.jsxs(J,{children:[e.jsx(j,{onClick:()=>t(),children:e.jsx(o,{message:"Cancel"})}),e.jsx(j,{onClick:c,variant:"flat",color:"primary",disabled:i.isPending||a===s.subject||!a.trim(),children:e.jsx(o,{message:"Save"})})]})]})}function Ua({conversationId:s}){var n;const t=E(h.conversations.get(s)),a=xe(s);return!((n=t.data)!=null&&n.conversation)||!a.data?e.jsx(Fe,{}):e.jsx(k,{size:"fullscreen",className:"h-dialog",children:e.jsx(O,{className:"bg",padding:"p-0",children:e.jsx(Va,{data:t.data})})})}function Va({data:s}){const{close:t}=S();return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs(Y,{gap:"gap-4",children:[e.jsx("div",{className:"text-overflow-ellipsis ml-6 mr-24 min-w-0 overflow-hidden",children:e.jsx(fs,{data:s})}),e.jsx(j,{elementType:$,to:Le(s.conversation),onClick:()=>t(),variant:"outline",startIcon:e.jsx(Pt,{}),size:"xs",className:"ml-auto",children:e.jsx(o,{message:"Open"})}),e.jsxs(b,{type:"modal",onClose:a=>{a&&t()},children:[e.jsx(j,{variant:"outline",size:"xs",className:"mr-48",startIcon:e.jsx(xt,{}),children:e.jsx(o,{message:"Merge"})}),e.jsx(Ka,{conversation:s.conversation})]}),e.jsx(w,{onClick:()=>t(),children:e.jsx(ke,{})})]}),e.jsx(gs,{data:s})]})}function Ka({conversation:s}){const{conversationId:t}=ee(["conversationId"]),a=$a(),{close:n}=S();return e.jsx(se,{title:e.jsx(o,{message:"Merge conversations"}),isLoading:a.isPending,onConfirm:()=>{a.mutate({conversationId:t,toMerge:[s.id]},{onSuccess:i=>n(i.conversation)})},body:e.jsxs("div",{children:[e.jsx(o,{message:"Are you sure you wnt to merge this conversation with the original one behind the popup?"}),e.jsx("p",{className:"mt-12 font-semibold",children:e.jsx(o,{message:"Merged conversations cannot be unmerged."})})]}),confirm:e.jsx(o,{message:"Merge"})})}function $a(){return T({mutationFn:s=>z.post("helpdesk/agent/conversations/merge",s).then(t=>t.data),onSuccess:async(s,t)=>{await y.invalidateQueries({queryKey:h.conversations.invalidateKey,predicate:a=>!a.queryKey.some(n=>t.toMerge.includes(Number(n)))}),_(M("Merged conversations"))},onError:s=>A(s)})}function Qa({data:s}){var n;const t=s.attributes.find(i=>i.key==="category"),a=m.useMemo(()=>s.envatoPurchaseCodes.find(i=>{var r,c;return(c=(r=t==null?void 0:t.config)==null?void 0:r.options)==null?void 0:c.find(d=>{var l;return(l=d.envatoItems)==null?void 0:l.includes(i.item_id)})})||s.envatoPurchaseCodes[0],[s,(n=t==null?void 0:t.config)==null?void 0:n.options]);return e.jsxs(m.Fragment,{children:[a&&e.jsx(Ce,{href:`https://codecanyon.net/user/${a.envato_username}`,icon:e.jsx(qs,{}),children:a.envato_username}),a.domain&&e.jsx(Ce,{href:a.domain,icon:e.jsx(Lt,{}),children:a.domain}),e.jsx(yt,{userId:s.user.id,initialData:s.envatoPurchaseCodes,selectedPurchaseId:a==null?void 0:a.id})]})}function Ce({href:s,children:t,icon:a}){return e.jsxs("div",{className:"mb-8 flex items-center gap-4 text-sm",children:[m.cloneElement(a,{size:"sm"}),e.jsx("a",{href:s.includes("http")?s:`https://${s}`,target:"_blank",rel:"noreferrer",className:"hover:underline",children:t})]})}function Ha({data:s}){const{toggleRightSidebar:t}=N();return e.jsxs("div",{className:"dashboard-rounded-panel flex w-full flex-col lg:ml-8",children:[e.jsxs(Y,{children:[e.jsx(o,{message:"Details"}),e.jsx(w,{className:"ml-auto",size:"xs",onClick:()=>t(),children:e.jsx(rs,{})})]}),e.jsx("div",{className:"compact-scrollbar flex-auto overflow-y-auto stable-scrollbar",children:e.jsx(Wa,{data:s})})]})}function Wa({data:s}){const t=te("ai"),a=te("envato"),n=te("livechat"),[i,r]=Se("dash.chat.info",[0,1,2]);return e.jsx(de,{initial:!1,mode:"wait",children:s!=null&&s.user?e.jsxs(m.Fragment,{children:[e.jsx(Na,{data:s},"identity-panel"),e.jsxs(Rt,{expandedValues:i??[],onExpandedChange:c=>r(c),mode:"multiple",variant:"minimal",className:"border-t",children:[a&&s.envatoPurchaseCodes.length>0&&e.jsx(R,{label:e.jsx(o,{message:"Envato"}),children:e.jsx(Qa,{data:s})}),e.jsx(R,{label:e.jsx(o,{message:"Conversation attributes"}),children:e.jsx(Za,{data:s})}),e.jsx(R,{label:e.jsx(o,{message:"Recent conversations"}),children:e.jsx(za,{customerId:s.user.id,excludeId:s.conversation.id,onSelected:c=>{D(Ua,{conversationId:c.id})}})}),s.session&&e.jsx(R,{label:e.jsx(o,{message:"Technology"}),children:e.jsx(bt,{session:s.session})}),n&&e.jsx(R,{label:e.jsx(o,{message:"Visited pages"}),children:e.jsx(Ct,{userId:s.user.id,initialData:s.visits})}),t&&e.jsx(R,{label:e.jsx(o,{message:"Summary"}),children:e.jsx(Ca,{initialData:s.summary})})]})]}):e.jsx(Aa,{isLoading:!1})})}function Za({data:s}){return e.jsxs(m.Fragment,{children:[e.jsxs(wt,{className:"mb-16",children:[e.jsx(L,{label:e.jsx(o,{message:"Type"}),children:s.conversation.type==="chat"?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(He,{size:"xs"}),e.jsx(o,{message:"Chat"})]}):e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Et,{size:"xs"}),e.jsx(o,{message:"Ticket"})]})}),e.jsx(L,{label:e.jsx(o,{message:"ID"}),children:s.conversation.id}),e.jsx(L,{label:e.jsx(o,{message:"Started"}),children:e.jsx(ne,{date:s.conversation.created_at})}),e.jsx(L,{label:e.jsx(o,{message:"Last activity"}),children:e.jsx(ne,{date:s.conversation.updated_at})}),s.conversation.channel?e.jsx(L,{label:e.jsx(o,{message:"Channel"}),children:e.jsx(Ga,{channel:s.conversation.channel})}):null,s.attributes.map(t=>e.jsx(L,{label:e.jsx(o,{message:t.name}),children:e.jsx(Es,{attribute:t,className:"text-sm"})},t.id))]}),!!s.attributes.length&&e.jsxs(b,{type:"modal",children:[e.jsx(j,{variant:"outline",size:"xs",children:e.jsx(o,{message:"Edit"})}),e.jsx(Sa,{attributes:s.attributes,conversation:s.conversation})]})]})}function R(s){return e.jsx(_t,{...s,buttonPadding:"py-12 pl-24 pr-2r",bodyPadding:"px-24 pb-16 pt-4",labelClassName:"font-semibold",className:"border-b",children:s.children})}function Ga({channel:s}){switch(s){case"email":return e.jsx(o,{message:"Email"});case"widget":return e.jsx(o,{message:"Widget"});case"website":return e.jsx(o,{message:"Website"})}}function Ja({message:s,isLastInGroup:t}){var u,p,x,I,f,P;const a=s.author==="user"?"chip":"primary",n=s.author==="user"?"left":"right",i="is_placeholder"in s,[r,c]=m.useState(!1),d=s.body||(p=(u=s.data)==null?void 0:u.buttons)!=null&&p.length?e.jsxs(cs,{color:s.type==="note"?"note":a,allowBreak:!0,children:[e.jsx(ts,{addParagraphSpacing:s.author==="bot",children:s.body}),!!((I=(x=s.data)==null?void 0:x.buttons)!=null&&I.length)&&e.jsx(hs,{className:"mt-8",buttons:(f=s.data)==null?void 0:f.buttons})]}):null,l=!i&&d?e.jsx(Ya,{align:n,onOpenActions:()=>c(!0),children:d}):d;return e.jsxs(m.Fragment,{children:[!i&&e.jsx(b,{type:"modal",isOpen:r,onOpenChange:c,underlayTransparent:!0,underlayBlurred:!1,returnFocusToTrigger:!1,children:e.jsx(ps,{message:s})}),e.jsxs(ls,{maxWidth:"max-w-[min(86%,548px)]",align:n,avatar:e.jsx(os,{message:s,size:"sm"}),avatarInvisible:!t,className:F(t?"mb-12":"mb-4"),footer:t?e.jsxs(Ut,{children:[s.author==="bot"&&e.jsx(Bt,{}),s.created_at&&e.jsx("time",{children:e.jsx(is,{date:s.created_at})}),s.type==="note"&&e.jsx(Xa,{})]}):void 0,children:[l,!!((P=s.attachments)!=null&&P.length)&&e.jsx(Ot,{align:n,attachments:s.attachments,color:s.author==="user"?"chip":"primary",onSelected:vs=>{D(sn,{attachments:s.attachments,activeIndex:s.attachments.findIndex(ys=>ys.id===vs.id),messageId:s.id})}})]})]})}function Xa(){return e.jsxs("div",{className:"inline-flex items-center",children:[e.jsx("div",{className:"mx-6",children:"â€¢"}),e.jsx(pt,{size:"2xs"}),e.jsx("div",{className:"ml-4 text-xs text-muted",children:e.jsx(o,{message:"Internal note"})})]})}function Ya({children:s,onOpenActions:t,align:a}){return e.jsxs(b,{type:"popover",mobileType:"popover",placement:a==="right"?"bottom-start":"bottom-end",offset:{mainAxis:-20,crossAxis:a==="right"?-10:10},triggerOnHover:!0,moveFocusToDialog:!1,returnFocusToTrigger:!1,children:[s,e.jsx("div",{role:"dialog",tabIndex:-1,"aria-modal":!0,className:"overflow-hidden rounded-full border bg shadow-2xl",children:e.jsx(en,{onClick:()=>t()})})]})}function en({onClick:s}){const{close:t}=S();return e.jsx(w,{size:"xs",iconSize:"sm",onClick:()=>{t(),s()},children:e.jsx(as,{})})}function sn({attachments:s,activeIndex:t,messageId:a}){const n=s[t].id,i=Rs(r=>r.closeActiveDialog);return e.jsx(k,{size:"fullscreenTakeover",background:"bg-alt",className:"flex flex-col",children:e.jsx(Vt,{entries:s,defaultActiveIndex:t,onClose:()=>i(),headerActionsLeft:e.jsxs(b,{type:"modal",children:[e.jsx(j,{startIcon:e.jsx(ss,{}),children:e.jsx(o,{message:"Delete"})}),e.jsx(js,{messageId:a,attachmentId:n,attachments:s,onSuccess:()=>i()})]})})})}function tn({message:s,isLastInGroup:t}){switch(s.type){case"event":case"collectDetailsForm":case"cards":return e.jsx(an,{message:s});case"submittedFormData":return e.jsx(oe,{uuid:s.uuid,children:e.jsx(ls,{align:"left",maxWidth:"max-w-[min(86%,548px)]",avatar:e.jsx(os,{message:s}),footer:e.jsx(is,{date:s.created_at}),className:"mb-12",children:e.jsx(cs,{color:"chip",allowBreak:!0,children:e.jsx(Ft,{message:s})})})});default:return e.jsx(oe,{uuid:s.uuid,children:e.jsx(Ja,{message:s,isLastInGroup:t})})}}function an({message:s}){const t=kt({message:s,variant:"agent"});return t===null?null:e.jsxs(oe,{uuid:s.uuid,className:"my-24 mr-40 flex justify-end gap-3 text-xs text-muted",children:[e.jsx(o,{...t})," -",e.jsx("time",{children:e.jsx(me,{date:s.created_at,preset:"time"})})]})}function nn({data:s}){var a;const t=xe(s.conversation.id);return e.jsx("div",{className:"compact-scrollbar flex-auto overflow-y-auto px-16 py-16",children:e.jsx(ns,{query:t,children:(a=t.data)==null?void 0:a.items.map((n,i)=>{var r;return e.jsx(tn,{message:n,...qt(i,n,((r=t.data)==null?void 0:r.items)??[])},n.id)})})})}function on({conversationId:s}){const{close:t,formId:a}=S(),n=Te(),i=he(s,n);return e.jsxs(k,{children:[e.jsx(V,{children:e.jsx(o,{message:"Change customer"})}),e.jsx(O,{children:e.jsx(Ae,{id:a,form:n,onSubmit:r=>{i.mutate(r,{onSuccess:()=>t()})},children:e.jsx(Kt,{required:!0,name:"user_id",endpoint:"normalized-models/user",label:e.jsx(o,{message:"New customer"})})})}),e.jsxs(J,{children:[e.jsx(j,{onClick:()=>t(),children:e.jsx(o,{message:"Cancel"})}),e.jsx(j,{type:"submit",form:a,variant:"flat",color:"primary",disabled:i.isPending,children:e.jsx(o,{message:"Change"})})]})]})}const rn=m.forwardRef((s,t)=>e.jsxs(B,{...s,ref:t,children:[e.jsx("path",{d:"M3 12h.01"}),e.jsx("path",{d:"M3 18h.01"}),e.jsx("path",{d:"M3 6h.01"}),e.jsx("path",{d:"M8 12h13"}),e.jsx("path",{d:"M8 18h13"}),e.jsx("path",{d:"M8 6h13"})]})),cn=m.forwardRef((s,t)=>e.jsxs(B,{...s,ref:t,children:[e.jsx("path",{d:"M11.5 15H7a4 4 0 0 0-4 4v2"}),e.jsx("path",{d:"M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}),e.jsx("circle",{cx:"10",cy:"7",r:"4"})]}));function ln({data:{user:s,conversation:t}}){const{base_url:a}=ze(),n=$t([s.id]),{messagesLayout:i,setMessagesLayout:r}=N(),[c,d]=m.useState(!1),[l,u]=m.useState(!1),p=x=>{Zt(`${a}/api/v1/lc/dashboard/chats/${x}/download-transcript`)};return e.jsxs(m.Fragment,{children:[e.jsx(b,{type:"modal",isOpen:c,onOpenChange:d,children:e.jsx(ie,{conversationIds:[t.id]})}),e.jsx(b,{type:"modal",isOpen:l,onOpenChange:u,onClose:async x=>{x&&await y.invalidateQueries({queryKey:["conversations",`${t.id}`]})},children:e.jsx(Qt,{userIds:[s.id],description:e.jsx(o,{message:"Suspended users will not be able to start conversations, appear in the traffic list or receive campaigns."})})}),e.jsxs(q,{children:[e.jsx(w,{size:"xs",iconSize:"sm",className:"ml-auto",children:e.jsx(Wt,{})}),e.jsxs(U,{children:[t.type==="chat"&&e.jsx(v,{value:"downloadTranscript",startIcon:e.jsx(Ht,{size:"sm"}),onSelected:()=>{p(t.id)},children:e.jsx(o,{message:"Download transcript"})}),e.jsx(v,{value:"assign",onSelected:()=>d(!0),startIcon:e.jsx(jt,{size:"sm"}),children:e.jsx(o,{message:"Transfer conversation"})}),e.jsx(v,{value:"editUser",startIcon:e.jsx(cn,{size:"sm"}),onSelected:()=>window.open(`${a}/dashboard/customers/${s.id}`,"_blank"),children:e.jsx(o,{message:"Edit customer"})}),t.type==="ticket"&&e.jsx(v,{value:"changeCustomer",startIcon:e.jsx(ht,{size:"sm"}),onSelected:()=>D(on,{conversationId:t.id}),children:e.jsx(o,{message:"Change customer"})}),e.jsx(v,{value:"suspend",onSelected:()=>{s.banned_at?n.mutate(void 0,{onSuccess:()=>{y.invalidateQueries({queryKey:h.conversations.get(t.id).queryKey})}}):u(!0)},startIcon:e.jsx(Ye,{size:"sm"}),children:s.banned_at?e.jsx(o,{message:"Unsuspend customer"}):e.jsx(o,{message:"Suspend customer"})}),e.jsx(v,{value:"messagesLayout",startIcon:i==="feed"?e.jsx(rn,{size:"sm"}):e.jsx(re,{size:"sm"}),onSelected:()=>r(i==="feed"?"list":"feed"),children:i==="feed"?e.jsx(o,{message:"Switch to list view"}):e.jsx(o,{message:"Switch to feed view"})})]})]})]})}function dn({data:s}){return s.conversation.type==="chat"?e.jsx(mn,{data:s}):e.jsx(un,{data:s})}function mn({data:s}){const t=ue(),[a,n]=m.useState(!1),i=m.useRef(null);pe("window","s",()=>{var c;return(c=i.current)==null?void 0:c.click()});const r=s.conversation.status_category<=H.closed?e.jsx(j,{ref:i,variant:"flat",color:"primary",size:"xs",startIcon:e.jsx(Gt,{}),disabled:t.isPending,onClick:()=>t.mutate({conversationIds:[s.conversation.id],statusName:"open"}),children:e.jsx(o,{message:"Re-open"})}):e.jsx(j,{ref:i,onClick:()=>n(!0),variant:"flat",color:"primary",size:"xs",startIcon:e.jsx(ke,{}),children:e.jsx(o,{message:"Close"})});return e.jsxs(m.Fragment,{children:[e.jsx(b,{type:"modal",isOpen:a,onOpenChange:n,children:e.jsx(xn,{data:s})}),r]})}function un({data:s}){var l,u;const{perform:t}=je(s.conversation),a=E(h.statuses.dropdownList("agent")),n=(l=a.data)==null?void 0:l.statuses.find(p=>p.id===s.conversation.status_id),i=ue({onSuccessAction:t}),[r,c]=m.useState(!1);pe("window","s",()=>c(!0));const d=(n==null?void 0:n.label)??"Open";return e.jsxs(q,{isOpen:r,onOpenChange:c,selectionMode:"single",selectedValue:s.conversation.status_id,onItemSelected:p=>{i.mutate({conversationIds:[s.conversation.id],statusId:p},{onSuccess:()=>{_(M("Status changed"))}})},children:[e.jsx(j,{variant:"flat",color:Ks((n==null?void 0:n.category)??H.open).button,size:"xs",endIcon:e.jsx(W,{}),className:"capitalize",fontWeight:"font-bold",children:e.jsx(o,{message:d})}),e.jsx(U,{children:(u=a.data)==null?void 0:u.statuses.map(p=>e.jsx(v,{value:p.id,startIcon:e.jsx(Re,{category:p.category}),children:e.jsx(o,{message:p.label})},p.id))})]})}function xn({data:s}){const t=ue(),{close:a}=S();return e.jsx(se,{isDanger:!0,isLoading:t.isPending,title:e.jsx(o,{message:"Close chat"}),confirm:e.jsx(o,{message:"Close"}),body:e.jsx(o,{message:"Are you sure you want to close the chat with :user?",values:{user:e.jsx("strong",{children:e.jsx(Je,{user:s.user,className:"inline"})})}}),onConfirm:()=>{t.mutate({conversationIds:[s.conversation.id],statusName:"closed"},{onSuccess:()=>a()})}})}function pn({data:s}){return e.jsxs(Y,{gap:"gap-4",children:[e.jsx(jn,{}),e.jsx("div",{className:"text-overflow-ellipsis mr-24 min-w-0 overflow-hidden",children:e.jsx(fs,{data:s})}),e.jsx(ln,{data:s}),e.jsx(gn,{data:s}),e.jsx(dn,{data:s}),e.jsx(hn,{})]})}function jn(){const{toggleConversationList:s}=N(),{isMobileMode:t}=m.useContext(Pe),[a]=we(),n=a.get("viewId")??"all";return t?e.jsx(w,{size:"sm",elementType:$,to:`/dashboard/conversations?viewId=${n}`,children:e.jsx(Jt,{})}):e.jsx(w,{size:"xs",onClick:()=>s(),children:e.jsx(We,{})})}function hn(){const{toggleRightSidebar:s,rightSidebarOpen:t}=N();return t?null:e.jsx(w,{onClick:()=>s(),size:"xs",children:e.jsx(rs,{})})}function gn({data:s}){const[t,a]=m.useState(!1),n=s.tags.map(d=>d.id),i=st(),r=Qe(),c=()=>{y.invalidateQueries({queryKey:h.conversations.get(s.conversation.id).queryKey})};return pe("window","t",()=>a(!0)),e.jsxs(b,{type:"popover",isOpen:t,onOpenChange:a,onClose:d=>{d&&(n.includes(d.id)?r.mutate({tagId:d.id,conversationIds:[s.conversation.id]},{onSuccess:c}):i.mutate({tagId:d.id,newTagName:d.newTagName,conversationIds:[s.conversation.id]},{onSuccess:c}))},children:[e.jsx(w,{className:"mr-8",size:"xs",iconSize:"sm",children:e.jsx(Ws,{})}),e.jsx(tt,{attachedTags:n})]})}function Wo(){const{conversationId:s}=ee(["conversationId"]),t=Ge(h.conversations.get(s)),a=Xe(t.data.user);return e.jsxs(m.Fragment,{children:[e.jsx(Us,{children:t.data.conversation.subject||a}),e.jsx(nt,{location:"conversationPage"}),e.jsx(ha,{}),e.jsx(fn,{}),e.jsx(Xt,{position:"right",size:"w-[300px]",children:e.jsx(Ha,{data:t.data})})]})}function fn(){const{conversationId:s}=ee(["conversationId"]),t=Ge(h.conversations.get(s)),{messagesLayout:a}=N();return e.jsx("main",{className:"compact-scrollbar dashboard-grid-content dashboard-rounded-panel md:min-w-440 lg:ml-8",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(pn,{data:t.data}),a==="list"?e.jsx(gs,{data:t.data}):e.jsx(nn,{data:t.data}),e.jsx(es,{children:e.jsx(na,{conversation:t.data.conversation,children:e.jsx(da,{data:t.data})})},t.data.conversation.id)]})})}export{Wo as Component};
