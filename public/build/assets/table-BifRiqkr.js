import{r as x,cB as ue,j as g,ae as de,p as I,C as fe,D as he,cC as J,cD as be,b as ge,g as Z,ai as A,aA as z,a1 as xe,a0 as me}from"./client-OfhJa1Pp.js";import{C as _}from"./checkbox-C4s6ROxp.js";import{S as pe}from"./skeleton-Cp2m1Uyc.js";import{A as we}from"./ArrowDownward-mN9PlQJw.js";import{$ as q}from"./useEffectEvent-DQn3o5L0.js";import{i as M}from"./is-ctrl-key-pressed-BWsUhNJl.js";import{$ as ye}from"./useGlobalListeners-CeWFSHKo.js";function ve(e){let{ref:t,onInteractOutside:s,isDisabled:o,onInteractOutsideStart:r}=e,l=x.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),c=q(i=>{s&&Q(i,t)&&(r&&r(i),l.current.isPointerDown=!0)}),d=q(i=>{s&&s(i)});x.useEffect(()=>{let i=l.current;if(o)return;const f=t.current,n=ue(f);if(typeof PointerEvent<"u"){let u=v=>{i.isPointerDown&&Q(v,t)&&d(v),i.isPointerDown=!1};return n.addEventListener("pointerdown",c,!0),n.addEventListener("click",u,!0),()=>{n.removeEventListener("pointerdown",c,!0),n.removeEventListener("click",u,!0)}}},[t,o])}function Q(e,t){if(e.button>0)return!1;if(e.target){const s=e.target.ownerDocument;if(!s||!s.documentElement.contains(e.target)||e.target.closest("[data-react-aria-top-layer]"))return!1}return t.current?!e.composedPath().includes(t.current):!1}const j=x.createContext(null),ke={key:"checkbox",header:()=>g.jsx(Pe,{}),align:"center",width:"w-24 flex-shrink-0",body:(e,t)=>t.isPlaceholder?g.jsx(pe,{size:"w-24 h-24",variant:"rect"}):g.jsx(Ce,{item:e})};function Ce({item:e}){const{selectedRows:t,toggleRow:s}=x.useContext(j);return g.jsx(_,{checked:t.includes(e.id),onChange:()=>s(e)})}function Pe(){const{trans:e}=de(),{data:t,selectedRows:s,onSelectionChange:o}=x.useContext(j),r=!!t.length&&t.length===s.length,l=!r&&!!s.length;return g.jsx(_,{"aria-label":e({message:"Select all"}),isIndeterminate:l,checked:r,onChange:()=>{o(r?[]:t.map(c=>c.id))}})}function ee({index:e,isHeader:t}){const{columns:s,cellHeight:o="h-50",headerCellHeight:r="h-46",tableStyle:l}=x.useContext(j),c=e===0,d=s.length-1===e,i=s[e],f=t?r:o;return l==="flex"?$e(i,f):De(i,c,d,f)}function De(e,t,s,o){let r=e==null?void 0:e.padding;return r||(t?r="pl-16 pr-12":s?r="pr-16 pl-12":r="px-12"),I("overflow-hidden whitespace-nowrap outline-none focus-visible:outline focus-visible:outline-offset-2 text-left",o,e==null?void 0:e.maxWidth,e==null?void 0:e.width,r,e==null?void 0:e.className)}function $e(e,t){let s="justify-start";(e==null?void 0:e.align)==="center"?s="justify-center":(e==null?void 0:e.align)==="end"&&(s="justify-end");const o=e==null?void 0:e.padding;return I("flex items-center overflow-hidden whitespace-nowrap overflow-ellipsis outline-none focus-visible:outline focus-visible:outline-offset-2",t,(e==null?void 0:e.width)??"flex-1",e==null?void 0:e.maxWidth,e==null?void 0:e.minWidth,s,o,e==null?void 0:e.className)}function Ee({index:e}){const{columns:t,sortDescriptor:s,onSortChange:o,enableSorting:r,tableStyle:l}=x.useContext(j),c=t[e],d=ee({index:e,isHeader:!0}),[i,f]=x.useState(!1),n=c.sortingKey||c.key,u=c.allowsSorting&&r,{orderBy:v,orderDir:k}=s||{},D=u&&v===n;let p;D&&k==="asc"?p="ascending":D&&k==="desc"?p="descending":u&&(p="none");const m=()=>{if(!u)return;let P;D&&k==="desc"?P={orderDir:"asc",orderBy:n}:D&&k==="asc"?P={orderBy:void 0,orderDir:void 0}:P={orderDir:"desc",orderBy:n},o==null||o(P)},a=D||i,w={visible:{opacity:1,y:0},hidden:{opacity:0,y:"-25%"}},C=l==="html"?"th":"div";return g.jsxs(C,{role:"columnheader",tabIndex:-1,"aria-colindex":e+1,"aria-sort":p,className:I(d,"text-xs font-medium text-muted",u&&"cursor-pointer"),onMouseEnter:()=>{f(!0)},onMouseLeave:()=>{f(!1)},onKeyDown:P=>{(P.key===" "||P.key==="Enter")&&(P.preventDefault(),m())},onClick:m,children:[c.hideHeader?g.jsx("div",{className:"opacity-0",children:c.header()}):c.header(),g.jsx(fe,{children:u&&g.jsx(he.span,{variants:w,animate:a?"visible":"hidden",initial:!1,transition:{type:"tween"},className:"-mt-2 ml-6 inline-block","data-testid":"table-sort-button","aria-hidden":!a,children:g.jsx(we,{size:"xs",className:I("text-muted",k==="asc"&&v===n&&"rotate-180 transition-transform")})},"sort-icon")})]})}function je(){const{columns:e,tableStyle:t,headerRowBg:s}=x.useContext(j),o=t==="html"?"thead":x.Fragment,r=t==="html"?"tr":"div";return g.jsx(o,{children:g.jsx(r,{role:"row","aria-rowindex":1,tabIndex:-1,className:I(t==="flex"&&"flex gap-x-16 px-16",s),children:e.map((l,c)=>g.jsx(Ee,{index:c},l.key))})})}function Te(e){const{cellCount:t,rowCount:s}=e;return{onKeyDown:r=>{switch(r.key){case"ArrowLeft":E(r,{cell:{op:"decrement"}},e);break;case"ArrowRight":E(r,{cell:{op:"increment"}},e);break;case"ArrowUp":E(r,{row:{op:"decrement"}},e);break;case"ArrowDown":E(r,{row:{op:"increment"}},e);break;case"PageUp":E(r,{row:{op:"decrement",count:5}},e);break;case"PageDown":E(r,{row:{op:"increment",count:5}},e);break;case"Tab":Se(r);break;case"Home":M(r)?E(r,{row:{op:"decrement",count:s},cell:{op:"decrement",count:t}},e):E(r,{cell:{op:"decrement",count:t}},e);break;case"End":M(r)?E(r,{row:{op:"increment",count:s},cell:{op:"increment",count:t}},e):E(r,{cell:{op:"increment",count:t}},e);break}}}}function E(e,t,{cellCount:s,rowCount:o}){var D,p,m,a,w,C,P;if(((D=document.activeElement)==null?void 0:D.tagName)==="input")return;e.preventDefault();const r=e.currentTarget,l=e.target.closest("[aria-colindex]");if(!l||!r)return;const c=l.closest("[aria-rowindex]");if(!c)return;let d=parseInt(c.getAttribute("aria-rowindex")),i=parseInt(l.getAttribute("aria-colindex"));if(Number.isNaN(d)||Number.isNaN(i))return;const f=((p=t.row)==null?void 0:p.count)??1;((m=t.row)==null?void 0:m.op)==="increment"?d=Math.min(o,d+f):((a=t.row)==null?void 0:a.op)==="decrement"&&(d=Math.max(1,d-f));const n=((w=t.cell)==null?void 0:w.count)??1;((C=t.cell)==null?void 0:C.op)==="increment"?i=Math.min(s,i+n):((P=t.cell)==null?void 0:P.op)==="decrement"&&(i=Math.max(1,i-n));const u=r.querySelector(`[aria-rowindex="${d}"] [aria-colindex="${i}"]`);if(!u)return;const k=J(u).nextNode()||u;l.setAttribute("tabindex","-1"),k.setAttribute("tabindex","0"),k.focus()}function Se(e){const t=e.currentTarget;if(e.shiftKey)t.focus();else{const s=J(t,{tabbable:!0});let o,r;do r=s.lastChild(),r&&(o=r);while(r);o&&!o.contains(document.activeElement)&&be(o)}}function Ie({index:e,isSelected:t,isHeader:s}){const o=ge(),r=Z(),{hideBorder:l,hideHeaderBorder:c,enableSelection:d,collapseOnMobile:i,onAction:f,isCollapsedMode:n,tableStyle:u}=x.useContext(j);return I(u==="flex"&&"flex gap-x-16","break-inside-avoid outline-none border border-transparent",n&&"rounded-panel",f&&"cursor-pointer",r&&i&&l?"mb-8 pl-8 pr-0 rounded":"px-16",!l&&"border-b-divider",!(c??l)&&e===0&&"border-t-divider",t&&!o&&"bg-primary/selected hover:bg-primary/focus focus-visible:bg-primary/focus",t&&o&&"bg-selected hover:bg-focus focus-visible:bg-focus",!t&&!s&&(d||f)&&"focus-visible:bg-focus hover:bg-hover")}function He({rowIndex:e,rowIsHovered:t,index:s,item:o,id:r}){const{columns:l,tableStyle:c}=x.useContext(j),d=l[s],i=x.useMemo(()=>({index:e,isHovered:t,isPlaceholder:o.isPlaceholder}),[e,t,o.isPlaceholder]),f=ee({index:s,isHeader:!1}),n=c==="html"?"td":"div";let u=d.body(o,i);return i.isPlaceholder||(u=g.jsx("div",{className:"min-w-0 overflow-hidden overflow-ellipsis",children:u})),g.jsx(n,{tabIndex:-1,role:"gridcell","aria-colindex":s+1,id:r,className:f,children:u})}function Re({onMoveStart:e,onMove:t,onMoveEnd:s,minimumMovement:o=0,preventDefault:r,stopPropagation:l=!0,onPress:c,onLongPress:d,...i}){const n=x.useRef({lastPosition:{x:0,y:0},started:!1,longPressTriggered:!1}).current,{addGlobalListener:u,removeGlobalListener:v}=ye(),k=a=>{!n.el||(e==null?void 0:e(a,n.el))===!1||(n.originalTouchAction=n.el.style.touchAction,n.el.style.touchAction="none",n.originalUserSelect=document.documentElement.style.userSelect,document.documentElement.style.userSelect="none",n.started=!0)},D=a=>{var w;if(a.button===0&&n.id==null){if(n.started=!1,((w=i.onPointerDown)==null?void 0:w.call(i,a))===!1)return;l&&a.stopPropagation(),r&&a.preventDefault(),n.id=a.pointerId,n.el=a.currentTarget,n.lastPosition={x:a.clientX,y:a.clientY},d&&(n.longPressTimer=setTimeout(()=>{d(a,n.el),n.longPressTriggered=!0},400)),(e||t)&&u(window,"pointermove",p,!1),u(window,"pointerup",m,!1),u(window,"pointercancel",m,!1)}},p=a=>{if(a.pointerId===n.id){const w=a.clientX-n.lastPosition.x,C=a.clientY-n.lastPosition.y;(Math.abs(w)>=o||Math.abs(C)>=o)&&!n.started&&k(a),n.started&&(t==null||t(a,w,C),n.lastPosition={x:a.clientX,y:a.clientY})}},m=a=>{var w;if(a.pointerId===n.id){n.longPressTimer&&clearTimeout(n.longPressTimer);const C=n.longPressTriggered;n.longPressTriggered=!1,n.started&&(s==null||s(a)),n.el&&(a.type!=="pointercancel"&&((w=i.onPointerUp)==null||w.call(i,a,n.el),a.target&&n.el.contains(a.target)&&(C?d==null||d(a,n.el):c==null||c(a,n.el))),document.documentElement.style.userSelect=n.originalUserSelect||"",n.el.style.touchAction=n.originalTouchAction||""),n.id=void 0,n.started=!1,v(window,"pointermove",p,!1),v(window,"pointerup",m,!1),v(window,"pointercancel",m,!1)}};return{domProps:{onPointerDown:A(D)}}}function Ae(e){return e.shiftKey||M(e)}const Ne=["button","a","input","select","textarea"];function Oe({item:e,index:t,renderAs:s,className:o,style:r}){const{selectedRows:l,columns:c,toggleRow:d,selectRow:i,onAction:f,selectRowOnContextMenu:n,enableSelection:u,selectionStyle:v,hideHeaderRow:k,tableStyle:D}=x.useContext(j),p=x.useRef(!1),m=l.includes(e.id),[a,w]=x.useState(!1),C=h=>h.target.closest(Ne.join(",")),P=h=>{v==="highlight"&&f&&!p.current&&!C(h)&&(h.preventDefault(),h.stopPropagation(),f(e,t))},O=!!l.length,H=h=>{C(h)||(v==="checkbox"?u&&(O||!f)?d(e):f&&f(e,t):v==="highlight"&&(p.current?u&&O?d(e):f==null||f(e,t):u&&i(e,Ae(h))))},{domProps:F}=Re({onPointerDown:h=>{p.current=h.pointerType==="touch"},onPress:H,onLongPress:u?()=>{p.current&&d(e)}:void 0}),U=h=>{u&&h.key===" "?(h.preventDefault(),h.stopPropagation(),v==="checkbox"?d(e):i(e)):h.key==="Enter"&&!l.length&&f&&(h.preventDefault(),h.stopPropagation(),f(e,t))},V=h=>{n&&u&&(l.includes(e.id)||i(e)),p.current&&(h.preventDefault(),h.stopPropagation())},L=Ie({index:t,isSelected:m}),B=s||(D==="html"?"tr":"div");return g.jsx(B,{role:"row","aria-rowindex":t+1+(k?0:1),"aria-selected":m,tabIndex:-1,className:I(o,L),item:typeof B=="string"?void 0:e,onDoubleClick:A(P),onKeyDown:A(U),onContextMenu:A(V),onPointerEnter:A(()=>w(!0)),onPointerLeave:A(()=>w(!1)),style:r,...F,children:c.map((h,G)=>g.jsx(He,{rowIndex:t,rowIsHovered:a,index:G,item:e},`${e.id}-${h.key}`))})}function We({className:e,columns:t,activeColumns:s,collapseOnMobile:o=!0,hideHeaderRow:r=!1,hideHeaderBorder:l=null,headerRowBg:c,hideBorder:d=!1,data:i,selectedRows:f,defaultSelectedRows:n,onSelectionChange:u,sortDescriptor:v,onSortChange:k,enableSorting:D=!0,onDelete:p,enableSelection:m=!0,selectionStyle:a="checkbox",ariaLabelledBy:w,selectRowOnContextMenu:C,onAction:P,renderRowAs:O,tableBody:H,meta:F,tableRef:U,closeOnInteractOutside:V=!1,cellHeight:L,headerCellHeight:B,tableStyle:h="flex",...G}){const W=Z(),N=!!W&&o;N&&(r=!0,d=!0);const[y,S]=z(f,n||[],u),[te,ne]=z(v,void 0,k),re=x.useCallback(b=>{const $=[...y];if(!$.includes(b.id))$.push(b.id);else{const T=$.indexOf(b.id);$.splice(T,1)}S($)},[y,S]),se=x.useCallback((b,$)=>{let T=[];b&&(T=$?[...y==null?void 0:y.filter(R=>R!==b.id),b.id]:[b.id]),S(T)},[y,S]),K=x.useMemo(()=>{const b=t.filter(T=>{if(s&&!s.includes(T.key))return!1;const R=T.visibleInMode||"regular";if(R==="all"||R==="compact"&&N||R==="regular"&&!N)return!0});return s&&b.sort((T,R)=>{const le=s.indexOf(T.key),ce=s.indexOf(R.key);return le-ce}),m&&a!=="highlight"&&!W&&b.unshift(ke),b},[W,t,m,a,N,s]),oe={isCollapsedMode:N,cellHeight:L,headerCellHeight:B,hideHeaderBorder:l,headerRowBg:c,hideBorder:d,hideHeaderRow:r,selectedRows:y,onSelectionChange:S,enableSorting:D,enableSelection:m,selectionStyle:a,data:i,columns:K,sortDescriptor:te,onSortChange:ne,toggleRow:re,selectRow:se,onAction:P,selectRowOnContextMenu:C,meta:F,collapseOnMobile:o,tableStyle:h},ie=Te({cellCount:m?K.length+1:K.length,rowCount:i.length+1}),X={renderRowAs:O};H?H=x.cloneElement(H,X):H=g.jsx(Be,{...X});const Y=xe(U);ve({ref:Y,onInteractOutside:b=>{V&&m&&(y!=null&&y.length)&&!b.target.closest('[role="dialog"]')&&S([])}});const ae=h==="html"?"table":"div";return g.jsx(j.Provider,{value:oe,children:g.jsxs(ae,{...me(G,ie,{onKeyDown:b=>{b.key==="Escape"?(b.preventDefault(),b.stopPropagation(),y!=null&&y.length&&S([])):b.key==="Delete"?(b.preventDefault(),b.stopPropagation(),y!=null&&y.length&&(p==null||p(i.filter($=>y==null?void 0:y.includes($.id))))):M(b)&&b.key==="a"&&(b.preventDefault(),b.stopPropagation(),m&&S(i.map($=>$.id)))}}),tabIndex:0,role:"grid","aria-rowcount":i.length+1,"aria-colcount":K.length+1,ref:Y,"aria-multiselectable":m?!0:void 0,"aria-labelledby":w,className:I(e,"isolate w-full select-none text-sm outline-none focus-visible:ring-2"),children:[!r&&g.jsx(je,{}),H]})})}function Be({renderRowAs:e}){const{data:t,tableStyle:s}=x.useContext(j),o=s==="html"?"tbody":x.Fragment;return g.jsx(o,{children:t.map((r,l)=>g.jsx(Oe,{item:r,index:l,renderAs:e},r.id))})}export{We as T,j as a};
