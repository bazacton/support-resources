const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pusher-j2aqVLPd.js","./client-OfhJa1Pp.js"])))=>i.map(i=>d[i]);
import{x as E,bd as x,bY as A,y as I,j as d,a_ as z,p as M,T as h}from"./client-OfhJa1Pp.js";import{H}from"./HourglassEmpty-BpvqVftp.js";let O;function G(t){O=t}function D(){return O}let f=null;async function _(){return f?await f:(f=new Promise(async(t,s)=>{const e=E().settings.broadcasting;if(!e||e.driver==="log"||e.driver==="null")return;const[{default:i}]=await Promise.all([x(()=>import("./echo-DMWYY_yJ.js"),[],import.meta.url),x(()=>import("./pusher-j2aqVLPd.js").then(r=>r.p),__vite__mapDeps([0,1]),import.meta.url)]),o=new i({...R(),authEndpoint:D()??"broadcasting/auth",csrfToken:E().csrf_token});"pusher"in o.connector&&o.connector.pusher.connection.bind("connected",function(r){A(r.socket_id),t(o)})}),f)}function R(){const t=E().settings.broadcasting;switch(t==null?void 0:t.driver){case"pusher":return{broadcaster:"pusher",key:t.key,cluster:t.cluster,forceTLS:!0};case"reverb":return{broadcaster:"reverb",key:t.key,wsHost:t.host,wsPort:t.port,wssPort:t.port,forceTLS:(t.scheme??"https")==="https",enabledTransports:["ws","wss"]};case"ably":return{broadcaster:"pusher",key:t.key,cluster:"any",wsHost:"realtime-pusher.ably.io",wsPort:443,disableStats:!0,encrypted:!0};default:return{broadcaster:"pusher"}}}let u;const a=new Map,c=new Map,p=new Map,b=(t,s)=>{var e;return(e=c.get(t))==null?void 0:e.get(s)},F=(t,s,e)=>{c.has(t)||c.set(t,new Map),b(t,s)||c.get(t).set(s,[]),c.get(t).get(s).push(e)},j=(t,s)=>{var e;return(e=a.get(t))==null?void 0:e.globalListeners.get(s)},S=t=>{const s=c.get(t),e=p.get(t),i=!!s&&s.size>0;!(e!=null&&e.size)&&!i&&(u==null||u.leave(t),a.delete(t))},L=(t,s)=>{if(!a.has(t)&&u){let e;if(s==="public"?e=u.channel(t):s==="presence"?e=u.join(t):e=u.private(t),s==="presence"){const i=e;i.here(o=>{w.setState(r=>({presence:{...r.presence,[t]:o}}))}),i.joining(o=>{w.setState(r=>{const n=r.presence[t]||[];return{presence:{...r.presence,[t]:[...n,o]}}})}),i.leaving(o=>{w.setState(r=>{const n=r.presence[t]||[];return{presence:{...r.presence,[t]:n.filter(l=>l.id!==o.id)}}})})}a.set(t,{channel:e,globalListeners:new Map})}},w=I(()=>({presence:{},join:(t,s)=>{let e=!1;return _().then(i=>{u=i,!e&&(L(t,"presence"),p.get(t)||p.set(t,new Set),p.get(t).add(s))}),()=>{e=!0,p.get(t)&&p.delete(s),S(t)}},listen:({channel:t,events:s,callback:e,type:i})=>{let o=!1;return _().then(r=>{u=r,!o&&(L(t,i),s.forEach(n=>{F(t,n,e),j(t,n)||(a.get(t).globalListeners.set(n,l=>{b(t,n).forEach(g=>g(l))}),a.get(t).channel.listen(T(n),j(t,n)))}))}),()=>{o=!0,s.forEach(r=>{var l,g,y,k;const n=b(t,r);if(n){const C=n.filter(P=>P!==e);C.length?c.get(t).set(r,C):c.get(t).delete(r)}(l=b(t,r))!=null&&l.length||((g=a.get(t))==null||g.globalListeners.delete(r),(y=a.get(t))==null||y.channel.stopListening(T(r))),(k=c.get(t))!=null&&k.size||c.delete(t)}),S(t)}}}));function T(t){return t.startsWith(".")?t:`.${t}`}function K(){return w.getState()}function W(t){const{isOnline:s,color:e,className:i,showAwayIcon:o}=t;return d.jsx(z,{label:s?d.jsx(h,{message:"Online"}):o?d.jsx(h,{message:"Away"}):d.jsx(h,{message:"Offline"}),children:d.jsx("div",{className:M("flex items-center justify-center rounded-full border-1 border-on-primary bg-clip-padding",e||(s?"bg-positive-darker":"bg-chip"),V(t),i),children:!s&&o&&d.jsx(H,{size:"2xs",className:"text-muted"})})})}function V({size:t,showAwayIcon:s,isOnline:e}){switch(t){case"md":return"h-20 w-20";case"lg":return"h-34 w-34";default:return!e&&s?"h-18 w-18":"h-12 w-12"}}export{W as O,K as e,G as s,w as u};
