import{ae as z,i as A,s as S,q as F,l as o,t as R,m as k,k as b,al as C,r as c,h as G,d as Z,j as e,am as w,an as D,T as n,ap as E,aP as N,C as K,aq as Q,B as x,Z as f,az as g,S as p,D as T,G as _}from"./client-OfhJa1Pp.js";import{F as q}from"./form-chip-field-sH5S7-lx.js";import{F as j}from"./select-Dsco87dL.js";import{S as h}from"./skeleton-Cp2m1Uyc.js";function M(){const{trans:s}=z();return A({mutationFn:a=>B(a),onSuccess:async()=>{await F.invalidateQueries({queryKey:o.agentInvites.invalidateKey}),R(s(k("Agents invited")))},onError:a=>S(a)})}function B(s){return b.post("helpdesk/agents/invite",s).then(a=>a.data)}const P=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function H(s){return!s||s.length>320?!1:P.test(s)}function X(){const{trans:s}=z(),{close:a,formId:t}=C(),u=c.useRef(!1),i=V(),d=M(),y=G(),r=Z({defaultValues:{emails:[]}});return c.useEffect(()=>{i&&!u.current&&(r.reset({emails:[],role_id:i.defaultRoleId,group_id:i.defaultGroupId}),u.current=!0)},[i,r]),e.jsxs(w,{size:"lg",children:[e.jsx(D,{children:e.jsx(n,{message:"Invite teammates"})}),e.jsx(E,{children:e.jsxs(N,{id:t,form:r,onSubmit:l=>d.mutate(l,{onSuccess:()=>{a(),y("../invites")}}),children:[e.jsx(q,{label:e.jsx(n,{message:"Emails"}),name:"emails",valueKey:"name",validateWith:l=>{const m=!H(l.name);return{...l,invalid:m,errorMessage:m?s({message:"Not a valid email"}):void 0}},placeholder:s({message:"Type or paste address and press enter"})}),e.jsx(K,{initial:!1,mode:"wait",children:i?e.jsx(L,{roles:i.roles,groups:i.groups}):e.jsx($,{})})]})}),e.jsxs(Q,{children:[e.jsx(x,{onClick:()=>a(),children:e.jsx(n,{message:"Cancel"})}),e.jsx(x,{variant:"flat",color:"primary",type:"submit",form:t,disabled:!r.watch("emails").length||d.isPending,children:e.jsx(n,{message:"Send invites"})})]})]})}function L({roles:s,groups:a}){return e.jsxs(I,{animationKey:"real-selects",children:[e.jsx(j,{name:"role_id",selectionMode:"single",label:e.jsx(n,{message:"Role"}),size:"sm",className:"flex-auto",children:s.map(t=>e.jsx(g,{value:t.id,startIcon:e.jsx(p,{label:t.name,size:"sm"}),capitalizeFirst:!0,children:e.jsx(n,{message:t.name})},t.id))}),e.jsx(j,{name:"group_id",selectionMode:"single",label:e.jsx(n,{message:"Group"}),size:"sm",className:"flex-auto",children:a.map(t=>e.jsx(g,{value:t.id,startIcon:e.jsx(p,{label:t.name,size:"sm"}),capitalizeFirst:!0,children:e.jsx(n,{message:t.name})},t.id))})]})}function I({children:s,animationKey:a}){return e.jsx(T.div,{..._,className:"mt-16 flex items-center gap-12",children:s},a)}function $(){return e.jsxs(I,{animationKey:"select-skeletons",children:[e.jsx(v,{},"skeleton-one"),e.jsx(v,{},"skeleton-two")]})}function v(){return e.jsxs("div",{className:"flex-auto",children:[e.jsx(h,{className:"mb-4 max-w-40"}),e.jsx(h,{variant:"rect",size:"h-36 w-full"})]})}function V(){const s=f(o.roles.normalizedList("agents")),a=f(o.groups.normalizedList);return!s.data||!a.data?null:{roles:s.data.roles,groups:a.data.groups,defaultRoleId:s.data.defaultRoleId,defaultGroupId:a.data.defaultGroupId}}export{X as I};
