import{$ as I,j as n,_ as C,a0 as $,Z as k,aA as A,r as S,T as x,aD as y,p as v,ac as F,aE as N}from"./client-OfhJa1Pp.js";import{c as P,d as T,e as _,f as E}from"./main-CqFMqK8-.js";import{A as L,a as V}from"./accordion-DWEV-mKU.js";import{u as w}from"./uc-first-pSl3nM3z.js";const q=C.forwardRef(({type:a,...s},c)=>{var i;const e=(i=k(P.permissions.index()).data)==null?void 0:i.permissions,[d,t]=A(s.value,[],s.onChange);if(!e)return null;const u=D(e,d,a),r=m=>{const f=[...d],p=f.findIndex(l=>l.id===m.id);p>-1&&f.splice(p,1,m),t(f)};return n.jsx(S.Fragment,{children:n.jsx(L,{variant:"outline",ref:c,children:u.map(({groupName:m,items:f,anyChecked:p})=>n.jsx(V,{label:n.jsx(x,{message:b(m)}),startIcon:p?n.jsx(E,{size:"sm"}):void 0,children:n.jsx(T,{children:f.map(l=>{const j=d.findIndex(h=>h.id===l.id),g=j>-1;return n.jsxs("div",{children:[n.jsx(_,{onSelected:()=>{if(g){const h=[...d];h.splice(j,1),t(h)}else t([...d,l])},endSection:n.jsx(y,{tabIndex:-1,checked:g,onChange:()=>{}}),description:n.jsx(x,{message:l.description}),children:n.jsx(x,{message:l.display_name})}),g&&n.jsx(z,{permission:l,onChange:r})]},l.id)})})},m))})})});function z({permission:a,onChange:s}){var o;if(!((o=a==null?void 0:a.restrictions)!=null&&o.length))return null;const c=(e,d)=>{const t=N(a,u=>{const r=u.restrictions.find(i=>i.name===e);r&&(r.value=d)});s==null||s(t)};return n.jsx("div",{className:"px-40 py-20",children:a.restrictions.map((e,d)=>{const t=d===a.restrictions.length-1,u=n.jsx(x,{message:e.display_name?e.display_name:b(e.name)}),r=e.description?n.jsx(x,{message:e.description}):void 0;return e.type==="bool"?n.jsx(y,{description:r,className:v(!t&&"mb-30"),checked:!!e.value,onChange:i=>{c(e.name,i.target.checked)},children:u},e.name):n.jsx(F,{size:"sm",label:u,description:r,type:"number",className:v(!t&&"mb-30"),value:e.value||"",onChange:i=>{c(e.name,i.target.value===""?void 0:parseInt(i.target.value))}},e.name)})})}function J(a){const{field:{onChange:s,value:c=[],ref:o}}=I({name:a.name}),e={onChange:s,value:c};return n.jsx(q,{ref:o,...$(e,a)})}const b=a=>w(a.replace("_"," "));function D(a,s,c="users"){const o=[];return a.forEach(e=>{if((e.type||"users")!==c)return;let t=o.find(r=>r.groupName===e.group);t||(t={groupName:e.group,anyChecked:!1,items:[]},o.push(t));const u=s.findIndex(r=>r.id===e.id);if(u>-1){const r={...e,restrictions:Q(e.restrictions,s[u].restrictions)};t.anyChecked=!0,t.items.push(r)}else t.items.push(e)}),o}function Q(a,s){return a==null?void 0:a.map(c=>{const o=s==null?void 0:s.find(e=>e.name===c.name);return o?{...c,value:o.value}:c})}export{J as F,D as b,b as p};
