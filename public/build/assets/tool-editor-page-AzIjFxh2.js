const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ace-editor-DaDisMMx.js","./client-OfhJa1Pp.js"])))=>i.map(i=>d[i]);
import{r as j,j as e,c1 as te,c0 as ae,bg as ne,T as l,av as q,B as g,ae as B,d as ie,al as re,am as oe,an as le,ap as ce,aP as de,az as h,F as O,m as v,aq as ue,aj as y,p as M,a as R,i as D,cA as me,s as U,q as C,cF as Q,k as A,t as F,a_ as pe,b3 as xe,ac as V,aD as je,Z as he,A as ge,P as ve,bd as fe,h as be}from"./client-OfhJa1Pp.js";import{g as f}from"./main-CqFMqK8-.js";import{T as N}from"./tiptap-text-field-CQWqZT9l.js";import{T as W}from"./table-BifRiqkr.js";import{F as ye,S as J}from"./select-Dsco87dL.js";import{A as Z}from"./Add-CN0r1QLK.js";import{D as I}from"./Delete-BhyMZiPM.js";import{E as Ae}from"./Edit-JNj6SFDx.js";import{C as Te}from"./check-circle-filled-DBwRd3aX.js";import{u as Se}from"./custom-menu-BbwshV9x.js";import{a as K,b as Ce,A as Ve}from"./variable-extension-Cjf6-ocs.js";import{a as w,A as Re}from"./accordion-DWEV-mKU.js";import{R as L}from"./radio-Db_caP9D.js";import{R as De}from"./radio-group-DQLhD511.js";import{A as Ne}from"./admin-config-tfY5n3F7.js";import{D as Ie}from"./settings-links-D22SAe6v.js";import{D as we}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{B as ke,a as $}from"./breadcrumb-DMWJORWM.js";import{P as Pe}from"./Pause-jGXmuSlQ.js";import{C as Ee}from"./confirmation-dialog-BIOq1A-h.js";import"./emoji-picker-button-CQGpXygB.js";import"./tiptap-editor-context-BAgvnYfz.js";import"./index-RecbqAl0.js";import"./index-W-EjzbYI.js";import"./with-selector-CDgEpx5P.js";import"./DataObject-XQLwxsph.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./skeleton-Cp2m1Uyc.js";import"./ArrowDownward-mN9PlQJw.js";import"./useEffectEvent-DQn3o5L0.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./useGlobalListeners-CeWFSHKo.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./get-default-values-for-form-with-attributes-htMbgWW2.js";import"./campaign-conditions-config-DJxMZaUr.js";import"./Event-7FmyLdJJ.js";import"./ToggleOn-DZgCezoB.js";import"./TextFields-8TfbEP0O.js";import"./accordtion-animation-BGCK95Hj.js";import"./dashboard-icons-CHop3mns.js";import"./library-icon-CHCHM-UW.js";import"./messages-square-icon-CTmom_u4.js";import"./Home--R_oEr6a.js";import"./SupervisorAccount-k9OnPB-d.js";import"./Translate-Cs-ut2nW.js";import"./external-link-DbBk1ItZ.js";import"./book-open-Cbdc52Ur.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import"./ChevronRight-T5gg5A4x.js";import"./MoreHoriz-hMMIYAbm.js";var r=(s=>(s.General="general",s.ApiConnection="api-connection",s.TestResponse="test-response",s.AttributeMapping="attribute-mapping",s))(r||{});const T={[r.General]:s=>!!s.name&&!!s.description,[r.ApiConnection]:s=>!!s.url&&!!s.method&&!!s.bodyType,[r.TestResponse]:s=>!!s.selectedResponseType&&(!!s.exampleResponse||!!s.liveResponse),[r.AttributeMapping]:s=>!0},qe=s=>{const t={name:(s==null?void 0:s.name)??"",description:(s==null?void 0:s.description)??"",allow_direct_use:(s==null?void 0:s.allow_direct_use)??!1};return{isValid:T[r.General](t),values:t,isDirty:!1,errors:{}}},Me=s=>{var n,a,o,i,d,m,u,p,x,b,S,G;const t={url:((a=(n=s==null?void 0:s.config)==null?void 0:n.apiRequest)==null?void 0:a.url)??"",method:((i=(o=s==null?void 0:s.config)==null?void 0:o.apiRequest)==null?void 0:i.method)??"GET",bodyType:((m=(d=s==null?void 0:s.config)==null?void 0:d.apiRequest)==null?void 0:m.bodyType)??"json",body:((p=(u=s==null?void 0:s.config)==null?void 0:u.apiRequest)==null?void 0:p.body)??"",headers:((b=(x=s==null?void 0:s.config)==null?void 0:x.apiRequest)==null?void 0:b.headers)??[],collectedData:((G=(S=s==null?void 0:s.config)==null?void 0:S.apiRequest)==null?void 0:G.collectedData)??[]};return{isValid:T[r.ApiConnection](t),values:t,isDirty:!1,errors:{}}},Fe=s=>{var n,a,o;const t={selectedResponseType:((n=s==null?void 0:s.config)==null?void 0:n.selectedResponseType)??"live",exampleResponse:(s==null?void 0:s.example_response)??"",liveResponse:(s==null?void 0:s.live_response)??"",attributesUsed:((o=(a=s==null?void 0:s.config)==null?void 0:a.apiRequest)==null?void 0:o.attributesUsed)??[]};return{isValid:T[r.TestResponse](t),values:t,isDirty:!1,errors:{}}},ze=s=>{const t={responseSchema:(s==null?void 0:s.response_schema)??{}};return{isValid:T[r.AttributeMapping](t),values:t,isDirty:!1,errors:{}}},H=s=>({[r.General]:qe(s),[r.ApiConnection]:Me(s),[r.TestResponse]:Fe(s),[r.AttributeMapping]:ze(s)}),_e=s=>te((t,n)=>({getState:()=>n(),activeStep:r.General,setActiveStep:a=>t({activeStep:a}),...H(s),getValues:a=>n()[a].values,setValues:a=>{const o=n()[a.step],i={...o.values,...a},d=T[a.step](i),m={};for(const u in o.errors)Object.keys(a).some(p=>u.startsWith(p))||(m[u]=o.errors[u]);t({[a.step]:{...o,values:i,isValid:d,isDirty:!0,errors:m}})},setIsDirty:(a,o)=>{const i=n()[a];t({[a]:{...i,isDirty:o}})},setErrors:(a,o)=>{const i=n()[a];t({[a]:{...i,isValid:Object.keys(o).length?!1:i.isValid,errors:o}})},syncWithTool:(a,o)=>{t(H(o))}})),Y=j.createContext(null);function Ge({children:s,initialTool:t}){const[n]=j.useState(()=>_e(t));return e.jsx(Y.Provider,{value:n,children:s})}function c(s){const t=j.useContext(Y);return ae(t,s)}function Oe(){const s=c(o=>o[r.ApiConnection].values.collectedData),t=j.useMemo(()=>s.map(o=>({...o,id:ne()})),[s]),n=c(o=>o.setValues),a=o=>{n({step:r.ApiConnection,collectedData:[...s,o]})};return e.jsxs("div",{className:"mb-34",children:[e.jsxs("div",{className:"mb-16 text-sm",children:[e.jsx("div",{className:"mb-4 font-semibold",children:e.jsx(l,{message:"Collect data inputs (optional)"})}),e.jsx("div",{children:e.jsx(l,{message:"Specify the data AI agent should collect from the customer before using this tool. AI agent will collect them from conversation history or by asking the customer."})})]}),!!s.length&&e.jsx("div",{className:"mb-12 max-h-400 overflow-y-auto",children:e.jsx(W,{className:"table-fixed",tableStyle:"html",columns:Ke,data:t,enableSelection:!1})}),e.jsxs(q,{type:"modal",onClose:o=>{o&&a(o)},children:[e.jsx(g,{startIcon:e.jsx(Z,{}),children:e.jsx(l,{message:"Add"})}),e.jsx(X,{})]})]})}const Ke=[{key:"name",header:()=>e.jsx(l,{message:"Name"}),body:s=>s.name},{key:"format",header:()=>e.jsx(l,{message:"Format"}),width:"w-124",body:s=>{switch(s.format){case"string":return e.jsx(l,{message:"Text"});case"number":return e.jsx(l,{message:"Number"});case"boolean":return e.jsx(l,{message:"True of false"})}}},{key:"description",header:()=>e.jsx(l,{message:"Description"}),body:s=>s.description},{key:"actions",header:()=>e.jsx(l,{message:"Actions"}),hideHeader:!0,width:"w-124",body:(s,t)=>e.jsx(Le,{item:s,index:t.index})}];function Le({item:s,index:t}){const n=c(d=>d.getValues),a=c(d=>d.setValues),o=d=>{const m=[...n(r.ApiConnection).collectedData??[]];m[t]=d,a({step:r.ApiConnection,collectedData:m})},i=()=>{const d=n(r.ApiConnection).collectedData??[];a({step:r.ApiConnection,collectedData:d.filter((m,u)=>u!==t)})};return e.jsxs(e.Fragment,{children:[e.jsxs(q,{type:"modal",onClose:d=>{d&&o(d)},children:[e.jsx(y,{variant:"flat",size:"sm",children:e.jsx(Ae,{})}),e.jsx(X,{item:s})]}),e.jsx(y,{variant:"flat",size:"sm",onClick:()=>i(),children:e.jsx(I,{})})]})}function X({item:s}){const{trans:t}=B(),n=ie({defaultValues:{format:(s==null?void 0:s.format)??"string",name:(s==null?void 0:s.name)??"",description:(s==null?void 0:s.description)??""}}),{close:a,formId:o}=re();return e.jsxs(oe,{size:"lg",children:[e.jsx(le,{children:e.jsx(l,{message:"Collect data"})}),e.jsx(ce,{children:e.jsxs(de,{id:o,form:n,onSubmit:i=>a(i),children:[e.jsxs(ye,{name:"format",label:e.jsx(l,{message:"Format"}),className:"mb-24",required:!0,children:[e.jsx(h,{value:"string",children:e.jsx(l,{message:"Text"})}),e.jsx(h,{value:"number",children:e.jsx(l,{message:"Number"})}),e.jsx(h,{value:"boolean",children:e.jsx(l,{message:"True of false"})})]}),e.jsx(O,{required:!0,name:"name",label:e.jsx(l,{message:"Name"}),placeholder:t(v("Example: Purchase ID")),className:"mb-24"}),e.jsx(O,{required:!0,name:"description",label:e.jsx(l,{message:"Description"}),description:e.jsx(l,{message:"Definition of data required so AI agent knows how to collect it"}),descriptionPosition:"top",inputElementType:"textarea",placeholder:t(v("Example: 8 digit identifier of the purchase. A customer can find this identifier in their purchase history")),rows:2})]})}),e.jsxs(ue,{children:[e.jsx(g,{onClick:()=>a(),children:e.jsx(l,{message:"Cancel"})}),e.jsx(g,{form:o,type:"submit",variant:"flat",color:"primary",children:e.jsx(l,{message:"Save"})})]})]})}function k({isDisabled:s,showDivider:t,children:n}){return e.jsx("div",{className:M("mt-24 pt-24",t&&"border-t"),children:e.jsx(g,{variant:"flat",color:"primary",size:"sm",type:"submit",disabled:s,children:n??e.jsx(l,{message:"Save and continue"})})})}function P({isValid:s}){return s?e.jsx(Te,{size:"sm"}):e.jsx("div",{className:M("size-20 p-2"),children:e.jsx("div",{className:"size-full rounded-full bg-chip"})})}function z(s){return c(t=>{const n=Object.values(r),a=n.indexOf(s);return n.slice(0,a).every(i=>t[i].isValid&&!t[i].isDirty)})}function E(s){const{toolId:t}=R(),{aiAgentId:n}=Se(["aiAgentId"]),a=c(d=>d.getValues),o=c(d=>d.syncWithTool),i=c(d=>d.setErrors);return D({onMutate:()=>{i(s,{})},mutationFn:()=>{const d={...a(s),step:s};return(t?A.put(`lc/ai-agent/tools/${t}`,d):A.post("lc/ai-agent/tools",{...d,ai_agent_id:n})).then(m=>m.data)},onSuccess:async d=>{const m=f.tools.get(d.tool.id,"editor").queryKey;C.setQueryData(m,{tool:d.tool}),await C.invalidateQueries({queryKey:f.tools.invalidateKey,predicate:u=>!Q(u.queryKey,m)}),o(s,d.tool)},onError:d=>{if(me.isAxiosError(d)&&d.response){const m=d.response.data.errors||{};if(!m||Object.keys(m).length===0)U(d);else{const u={};for(const[p,x]of Object.entries(m))u[p]=Array.isArray(x)?x[0]:x;i(s,u)}}}})}function $e(s){const t=c(i=>i[r.ApiConnection].isValid),n=c(i=>i.setActiveStep),a=E(r.ApiConnection),o=!z(r.ApiConnection);return e.jsx(w,{...s,label:e.jsx(l,{message:"API connection"}),startIcon:e.jsx(P,{isValid:t}),value:r.ApiConnection,disabled:o,children:e.jsxs("form",{onSubmit:i=>{i.preventDefault(),a.mutate(void 0,{onSuccess:()=>{n(r.TestResponse)}})},children:[e.jsx(Oe,{}),e.jsx(He,{}),e.jsx(k,{isDisabled:a.isPending})]})})}function He(){const s=c(n=>n[r.ApiConnection].values.collectedData),t=j.useMemo(()=>(s==null?void 0:s.map(n=>{const a=n.name.replaceAll(" ","_").toLowerCase();return{name:a,displayName:n.name,type:K.CollectedData,key:`${K.CollectedData}.${a}`,isReadonly:!0}}))??[],[s]);return e.jsxs(Ce,{value:t,children:[e.jsxs("div",{className:"mb-16 text-sm",children:[e.jsx("div",{className:"mb-4 font-semibold",children:e.jsx(l,{message:"API request"})}),e.jsx("div",{children:e.jsx(l,{message:"Endpoint that should be called by AI Agent to retrieve data or send updates. You can use attributes or data collected by AI Agent in the URL, headers or request body."})})]}),e.jsxs("div",{className:"mb-24 flex items-start gap-12",children:[e.jsx(Be,{}),e.jsx(Ue,{})]}),e.jsx(Qe,{}),e.jsx(Ze,{})]})}function Be(){const s=c(a=>a[r.ApiConnection].values.method),t=c(a=>a.setValues),n=c(a=>a[r.ApiConnection].errors.method);return e.jsxs(J,{name:"method",label:e.jsx(l,{message:"Method"}),required:!0,invalid:!!n,errorMessage:n,selectionMode:"single",selectedValue:s,onSelectionChange:a=>{t({step:r.ApiConnection,method:a,bodyType:"json",body:""})},children:[e.jsx(h,{value:"GET",children:e.jsx(l,{message:"GET"})}),e.jsx(h,{value:"POST",children:e.jsx(l,{message:"POST"})}),e.jsx(h,{value:"PUT",children:e.jsx(l,{message:"PUT"})}),e.jsx(h,{value:"DELETE",children:e.jsx(l,{message:"DELETE"})})]})}function Ue(){const s=c(a=>a[r.ApiConnection].values.url),t=c(a=>a.setValues),n=c(a=>a[r.ApiConnection].errors.url);return e.jsx(N,{required:!0,errorMessage:n,invalid:!!n,name:"url",label:e.jsx(l,{message:"HTTPS URL"}),className:"flex-auto",hideEmojiPicker:!0,value:s,onChange:a=>{t({step:r.ApiConnection,url:a})}})}function Qe(){const s=c(o=>o[r.ApiConnection].values.headers),t=c(o=>o.setValues),n=o=>{t({step:r.ApiConnection,headers:s.filter((i,d)=>d!==o)})},a=()=>{t({step:r.ApiConnection,headers:[...s,{key:"",value:""}]})};return e.jsxs("div",{className:"my-24",children:[e.jsx("div",{className:"mb-12 text-sm font-semibold",children:e.jsx(l,{message:"HTTP Headers"})}),e.jsx("div",{className:"space-y-12",children:s.map((o,i)=>e.jsxs("div",{className:"flex items-start gap-12",children:[e.jsx(We,{index:i}),e.jsx(Je,{index:i}),e.jsx(y,{className:"mt-24",onClick:()=>n(i),children:e.jsx(I,{})})]},i))}),e.jsx(g,{startIcon:e.jsx(Z,{}),onClick:()=>a(),className:"-ml-14 mt-8",children:e.jsx(l,{message:"Add key value pair"})})]})}function We({index:s}){const t=c(i=>i[r.ApiConnection].values.headers[s].key),n=c(i=>i.setValues),a=c(i=>i.getValues),o=c(i=>i[r.ApiConnection].errors[`headers.${s}.key`]);return e.jsx(N,{label:s===0?e.jsx(l,{message:"Key"}):null,required:!0,name:`headers.${s}.key`,className:"flex-1",hideEmojiPicker:!0,value:t,onChange:i=>{n({step:r.ApiConnection,headers:a(r.ApiConnection).headers.map((d,m)=>m===s?{...d,key:i}:d)})},invalid:!!o,errorMessage:o})}function Je({index:s}){const t=c(i=>i[r.ApiConnection].values.headers[s].value),n=c(i=>i.setValues),a=c(i=>i.getValues),o=c(i=>i[r.ApiConnection].errors[`headers.${s}.value`]);return e.jsx(N,{label:s===0?e.jsx(l,{message:"Value"}):null,required:!0,name:`headers.${s}.value`,className:"flex-1",hideEmojiPicker:!0,value:t,onChange:i=>{n({step:r.ApiConnection,headers:a(r.ApiConnection).headers.map((d,m)=>m===s?{...d,value:i}:d)})},invalid:!!o,errorMessage:o})}function Ze(){const{trans:s}=B(),t=c(i=>i[r.ApiConnection].values.method),n=c(i=>i[r.ApiConnection].values.body),a=c(i=>i[r.ApiConnection].values.bodyType),o=c(i=>i.setValues);return t!=="POST"&&t!=="PUT"?null:e.jsxs("div",{className:"my-24",children:[e.jsx("div",{className:"mb-12 text-sm font-semibold",children:e.jsx(l,{message:"Request body"})}),e.jsxs(J,{name:"bodyType",className:"mb-12 max-w-124",required:!0,selectionMode:"single",selectedValue:a,onSelectionChange:i=>{o({step:r.ApiConnection,bodyType:i})},children:[e.jsx(h,{value:"json",children:e.jsx(l,{message:"JSON"})}),e.jsx(h,{value:"text",children:e.jsx(l,{message:"Text"})})]}),e.jsx(N,{size:"lg",multiline:!0,placeholder:s(v("Enter request body")),value:n,onChange:i=>{o({step:r.ApiConnection,body:i})}})]})}function Ye(s){const t=c(o=>o[r.AttributeMapping].isValid),n=E(r.AttributeMapping),a=!z(r.AttributeMapping);return e.jsx(w,{...s,label:e.jsx(l,{message:"Attribute mapping"}),startIcon:e.jsx(P,{isValid:t}),value:r.AttributeMapping,disabled:a,children:e.jsxs("form",{onSubmit:o=>{o.preventDefault(),n.mutate(void 0,{onSuccess:()=>{F(v("Attribute mapping updated"))}})},children:[e.jsx(Xe,{}),e.jsx(k,{isDisabled:n.isPending,showDivider:!1,children:e.jsx(l,{message:"Save"})})]})})}function Xe(){const s=c(t=>t[r.AttributeMapping].values.responseSchema);return e.jsxs("div",{children:[e.jsx("div",{className:"mb-16 text-sm",children:e.jsx("div",{children:e.jsx(l,{message:"Map any response data you want to use in custom flows. AI agent can use all data automatically, without manual mapping."})})}),e.jsx("div",{className:"max-h-400 overflow-y-auto",children:e.jsx(W,{tableStyle:"html",columns:es,data:s.properties??[],enableSelection:!1})})]})}const es=[{key:"path",visibleInMode:"all",header:()=>e.jsx(l,{message:"Data"}),className:"capitalize",body:s=>s.path.split(".").filter(t=>t!=="[root]").join(" â€º ")},{key:"value",header:()=>e.jsx(l,{message:"Example value"}),body:s=>e.jsx("div",{className:"max-w-224 truncate",children:`${s.value}`})},{key:"format",className:"capitalize",header:()=>e.jsx(l,{message:"Format"}),width:"w-100",body:s=>!s.format||s.format==="null"?e.jsx(l,{message:"Unkown"}):s.format},{key:"actions",header:()=>e.jsx(l,{message:"Attribute mapping"}),align:"end",visibleInMode:"all",body:(s,t)=>e.jsx(ss,{index:t.index})}];function ss({index:s}){const t=c(i=>i.setValues),n=c(i=>i.getValues),a=c(i=>i[r.AttributeMapping].values.responseSchema.properties[s].attribute),o=i=>{const d=n(r.AttributeMapping).responseSchema;t({step:r.AttributeMapping,responseSchema:{...d,properties:d.properties.map((m,u)=>u===s?{...m,attribute:i}:m)}})};return e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx(Ve,{className:"flex-auto",floatingWidth:"auto",size:"xs",value:a,onChange:i=>o(i)}),!!a&&e.jsx(pe,{label:e.jsx(l,{message:"Remove mapping"}),children:e.jsx(y,{size:"xs",variant:"outline",onClick:()=>o(void 0),children:e.jsx(I,{})})})]})}function ts(s){const{toolId:t}=R(),n=xe(),a=c(d=>d[r.General].isValid),o=c(d=>d.setActiveStep),i=E(r.General);return e.jsx(w,{...s,label:e.jsx(l,{message:"General"}),startIcon:e.jsx(P,{isValid:a}),value:r.General,children:e.jsxs("form",{onSubmit:d=>{d.preventDefault(),i.mutate(void 0,{onSuccess:async m=>{t||await n(`../${m.tool.id}/edit`,{relative:"path",replace:!0}),o(r.ApiConnection)}})},children:[e.jsx(as,{}),e.jsx(ns,{}),e.jsx(is,{}),e.jsx(k,{isDisabled:i.isPending})]})})}function as(){const s=c(a=>a[r.General].values.name),t=c(a=>a.setValues),n=c(a=>a[r.General].errors.name);return e.jsx(V,{name:"name",required:!0,minLength:5,maxLength:100,label:e.jsx(l,{message:"Name"}),className:"mb-24",value:s,onChange:a=>t({step:r.General,name:a.target.value}),errorMessage:n,invalid:!!n})}function ns(){const s=c(a=>a[r.General].values.description),t=c(a=>a.setValues),n=c(a=>a[r.General].errors.description);return e.jsx(V,{required:!0,name:"description",label:e.jsx(l,{message:"Description"}),descriptionPosition:"top",description:e.jsx(l,{message:"Explain when the AI agent should use this tool. Include a description of what this tool does, data it provides or actions it can perform."}),inputElementType:"textarea",rows:10,className:"mb-24",value:s,onChange:a=>t({step:r.General,description:a.target.value}),errorMessage:n,invalid:!!n})}function is(){const s=c(n=>n[r.General].values.allow_direct_use),t=c(n=>n.setValues);return e.jsx(je,{name:"allow_direct_use",description:e.jsx(l,{message:"AI Agent will use the name and description of the tool to determine when to trigger it"}),checked:s,onChange:n=>t({step:r.General,allow_direct_use:n.target.checked}),children:e.jsx(l,{message:"Allow AI Agent to use this tool directly without adding it to a flow"})})}function _(){const{toolId:s}=R(),{data:t}=he({...f.tools.get(s,"editor"),enabled:!!s});return(t==null?void 0:t.tool)??null}const ee=ge(e.jsx("path",{d:"M8 19V5l11 7Z"}),"PlayArrowFilled"),rs=j.lazy(()=>fe(()=>import("./ace-editor-DaDisMMx.js"),__vite__mapDeps([0,1]),import.meta.url));function os(s){const t=c(i=>i[r.TestResponse].isValid),n=c(i=>i.setActiveStep),a=E(r.TestResponse),o=!z(r.TestResponse);return e.jsx(w,{...s,label:e.jsx(l,{message:"Test response"}),startIcon:e.jsx(P,{isValid:t}),value:r.TestResponse,disabled:o,children:e.jsxs("form",{onSubmit:i=>{i.preventDefault(),a.mutate(void 0,{onSuccess:()=>{n(r.AttributeMapping)}})},children:[e.jsx(ls,{}),e.jsx(k,{isDisabled:a.isPending})]})})}function ls(){const s=c(t=>t[r.TestResponse].values.selectedResponseType);return e.jsxs(j.Fragment,{children:[e.jsx(cs,{}),s==="example"&&e.jsx(ms,{}),s==="live"&&e.jsx(ds,{})]})}function cs(){const s=c(n=>n[r.TestResponse].values.selectedResponseType),t=c(n=>n.setValues);return e.jsxs(De,{name:"selectedResponseType",size:"sm",orientation:"vertical",value:s,onChange:n=>{t({step:r.TestResponse,selectedResponseType:n})},children:[e.jsx(L,{name:"selectedResponseType",size:"sm",checked:s==="live",value:"live",description:e.jsx(l,{message:"Test with live response data from the API to make sure it is configured correctly"}),children:e.jsx(l,{message:"Live response"})}),e.jsx(L,{name:"selectedResponseType",size:"sm",checked:s==="example",value:"example",description:e.jsx(l,{message:"Provide example JSON data if the API is not ready yet"}),children:e.jsx(l,{message:"Example response"})})]})}function ds(){const s=_(),t=c(u=>u[r.TestResponse].values.attributesUsed),n=c(u=>u.setValues),[a,o]=j.useState([]),i=D({onMutate:()=>{o([])},mutationFn:()=>A.post("lc/ai-agent/tools/test-request",{apiRequest:s.config.apiRequest,attributes:t.map(u=>({name:u.name,type:u.type,value:u.testValue}))}).then(u=>u.data),onError:u=>U(u),onSuccess:u=>{n({step:r.TestResponse,liveResponse:JSON.stringify(u.response,null,2)}),F(v("Response is valid"))}}),d=()=>{if(t!=null&&t.some(u=>!u.testValue)){o((t==null?void 0:t.filter(u=>!u.testValue||!u.name))??[]);return}i.mutate()},m=(u,p,x)=>{n({step:r.TestResponse,attributesUsed:t==null?void 0:t.map((b,S)=>S===u?{...b,[p]:x}:b)})};return e.jsxs("div",{className:"mt-24",children:[t!=null&&t.length?e.jsxs(j.Fragment,{children:[e.jsx("div",{className:"mb-12 text-sm",children:e.jsx(l,{message:"Enter values for attributes configured in the request."})}),e.jsx("div",{className:"space-y-12",children:t==null?void 0:t.map((u,p)=>e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(V,{className:"flex-1",size:"sm",name:`attributesUsed.${p}.name`,label:p===0?e.jsx(l,{message:"Attribute"}):null,readOnly:!0,value:u.name,onChange:x=>m(p,"name",x.target.value)}),e.jsx(V,{required:!0,className:"flex-1",size:"sm",name:`attributesUsed.${p}.testValue`,label:p===0?e.jsx(l,{message:"Value"}):null,value:u.testValue,onChange:x=>m(p,"testValue",x.target.value)})]},p))})]}):null,a.length>0&&e.jsx("div",{className:"mt-12 text-sm text-danger",children:e.jsx(l,{message:"Provide a value for all attributes."})}),e.jsx(us,{}),e.jsx(g,{variant:"outline",size:"sm",className:"mt-24",startIcon:e.jsx(ee,{}),onClick:()=>d(),disabled:i.isPending,children:e.jsx(l,{message:"Test request"})})]})}function us(){const s=c(n=>n[r.TestResponse].values.liveResponse),t=c(n=>n[r.TestResponse].errors.liveResponse);return e.jsxs("div",{children:[s?e.jsx(se,{value:s,invalid:!!t,readOnly:!0}):null,t?e.jsx("div",{className:"mt-12 text-sm text-danger",children:t}):null]})}function ms(){const s=c(a=>a[r.TestResponse].values.exampleResponse),t=c(a=>a.setValues),n=c(a=>a[r.TestResponse].errors.exampleResponse);return e.jsxs("div",{children:[e.jsx(se,{defaultValue:s,onChange:a=>t({step:r.TestResponse,exampleResponse:a}),invalid:!!n}),n&&e.jsx("div",{className:"mt-12 text-sm text-danger",children:n})]})}function se({defaultValue:s,value:t,readOnly:n,onChange:a,onBlur:o,ref:i,invalid:d}){const m=j.useRef(!1);return e.jsx("div",{className:M("relative mt-24 h-240 overflow-hidden rounded-panel border",d&&"border-danger"),children:e.jsx(j.Suspense,{fallback:e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(ve,{"aria-label":"Loading editor...",isIndeterminate:!0,size:"md"})}),children:e.jsx(rs,{beautify:!0,mode:"json",readOnly:n,defaultValue:s,value:t,onFocus:()=>{m.current=!0},onChange:u=>{m.current&&(a==null||a(u))},onBlur:o,editorRef:i})})})}function xt(){const s=_();return e.jsx(Ge,{initialTool:s,children:e.jsx(ps,{})})}function ps(){const s=c(a=>a.activeStep),t=c(a=>a.setActiveStep),n=j.useMemo(()=>s?[s]:[],[s]);return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(xs,{}),e.jsx("div",{className:"flex-auto overflow-y-auto stable-scrollbar",children:e.jsx("div",{className:"container mx-auto px-24 py-56",children:e.jsxs(Re,{variant:"outline",mode:"single",size:"lg",expandedValues:n,onExpandedChange:a=>t(a[0]),children:[e.jsx(ts,{}),e.jsx($e,{}),e.jsx(os,{}),e.jsx(Ye,{})]})})})]})}function xs(){const s=_(),t=(s==null?void 0:s.active)??!1,n=c(o=>Object.values(r).every(d=>o[d].isValid)),a=D({mutationFn:()=>A.put(`lc/ai-agent/tools/${s==null?void 0:s.id}`,{active:!t}),onSuccess:()=>C.invalidateQueries({queryKey:f.tools.invalidateKey})});return e.jsx(we,{showSidebarToggleButton:!0,rightContent:e.jsxs(e.Fragment,{children:[e.jsx(Ie,{size:"xs",variant:"button",link:Ne.pages.tools,children:e.jsx(l,{message:"Learn"})}),e.jsx(g,{type:"button",variant:"flat",color:t?"chip":"positive",size:"xs",disabled:!s||!n||a.isPending,onClick:()=>a.mutate(),startIcon:t?e.jsx(Pe,{}):e.jsx(ee,{}),children:t?e.jsx(l,{message:"Pause"}):e.jsx(l,{message:"Set live"})}),!!s&&e.jsxs(q,{type:"modal",children:[e.jsx(y,{size:"xs",variant:"outline",children:e.jsx(I,{})}),e.jsx(js,{})]})]}),children:e.jsxs(ke,{size:"xl",children:[e.jsx($,{to:"../tools",children:e.jsx(l,{message:"Tools"})}),e.jsx($,{children:(s==null?void 0:s.name)??e.jsx(l,{message:"Untitled"})})]})})}function js(){const s=be(),{toolId:t}=R(),n=D({mutationFn:()=>A.delete(`lc/ai-agent/tools/${t}`),onSuccess:async()=>{await C.invalidateQueries({queryKey:f.tools.invalidateKey,predicate:a=>!Q(a.queryKey,f.tools.get(t,"editor").queryKey)}),F(v("Tool deleted")),s("../..",{relative:"path"})}});return e.jsx(Ee,{isDanger:!0,title:e.jsx(l,{message:"Delete tool"}),body:e.jsx(l,{message:"This action is permanent and can't be undone. Configuration relating to this tool will no longer be available."}),confirm:e.jsx(l,{message:"Delete"}),onConfirm:()=>n.mutate(),isLoading:n.isPending})}export{xt as Component};
