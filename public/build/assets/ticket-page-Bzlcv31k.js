import{r as c,q as y,l as g,j as t,z as u,h as b,T as i,b4 as w,i as k,s as C,k as I,t as R,m as S,aR as B,B as N,av as A,aQ as L}from"./client-OfhJa1Pp.js";import{u as x,a as M,h as D}from"./custom-menu-BbwshV9x.js";import{H as E}from"./hc-search-bar-BR0l8lH9.js";import{C as P,F as q,R as Q,a as H,U,I as z}from"./upload-attachments-button-BWcvmOOE.js";import{F as K}from"./formatted-message-body-WNPn2fpJ.js";import{u as V,L as _,a as $,M as G,b as J}from"./use-conversation-messages-DC7lqlf_.js";import{M as O}from"./reverse-conversation-messages-abBI68AY.js";import{h as f}from"./helpdesk-channel-CQKSbeKg.js";import{e as W}from"./online-status-circle-QXiKm4xe.js";import{T as X}from"./ticket-details-BWJm5pA-.js";import{R as Y}from"./emoji-picker-button-CQGpXygB.js";import Z from"./reply-composer-container-CGWK_3_X.js";import{F as tt,R as et}from"./floating-toolbar-Db61G721.js";import{N as st}from"./main-CqFMqK8-.js";import{S as ot}from"./section-helper-Cq13cJUI.js";import{F as rt}from"./file-upload-provider-DTPBUrkd.js";import{B as at,a as d}from"./breadcrumb-DMWJORWM.js";import{C as it}from"./confirmation-dialog-BIOq1A-h.js";import"./article-link-xsQ04UkN.js";import"./slugify-string-aubjgLQq.js";import"./article-path-Da7o5kHE.js";import"./category-link-0Q_zOKi3.js";import"./use-keybind-7f4ijAco.js";import"./useGlobalListeners-CeWFSHKo.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./combobox-pHOmOE77.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./image-button-ExYLUK-F.js";import"./image-up-DCwS84Wx.js";import"./use-active-upload-CCDRf1Tl.js";import"./open-upload-window-CSDcieK1.js";import"./uploaded-file-DN6fXT4v.js";import"./shallow-BSWIanyL.js";import"./tiptap-editor-context-BAgvnYfz.js";import"./file-preview-dialog-DZbR1Zhl.js";import"./file-thumbnail-D9-TxWtC.js";import"./file-type-icon-Dok_AF4H.js";import"./ChevronLeft-B96ua4ZU.js";import"./ChevronRight-T5gg5A4x.js";import"./FileDownload-DoJWzr8l.js";import"./download-file-from-url-hJ3EUwXO.js";import"./formatted-bytes-CmuQhzYn.js";import"./pretty-bytes-bO14ePu9.js";import"./progress-bar-iRLStr1h.js";import"./use-upload-attachments-D0EFLOL9.js";import"./use-droppable-DqkAoZym.js";import"./paperclip-DIi_RQSY.js";import"./AlternateEmail-DjCOtnvc.js";import"./ViewDay-DMtpTfzM.js";import"./message-author-name-DihwIAPW.js";import"./customer-avatar-DNefi2od.js";import"./use-widget-bootstrap-data-BlKRRco5.js";import"./attribute-renderer-BAh3glGI.js";import"./ThumbDown-CmU9VZYm.js";import"./ThumbUp-B7v5mSGQ.js";import"./useInfiniteQuery-Dr3ouRcV.js";import"./infiniteQueryObserver-dCGK3uny.js";import"./infinite-scroll-sentinel-sZcqy_uF.js";import"./isScrollable-BSEN4xi5.js";import"./agent-avatar-CN8Be1Dj.js";import"./use-compact-agents-VrJm5fj6.js";import"./HourglassEmpty-BpvqVftp.js";import"./conversation-priority-tSI_39cp.js";import"./variable-extension-Cjf6-ocs.js";import"./get-default-values-for-form-with-attributes-htMbgWW2.js";import"./campaign-conditions-config-DJxMZaUr.js";import"./select-Dsco87dL.js";import"./Event-7FmyLdJJ.js";import"./ToggleOn-DZgCezoB.js";import"./TextFields-8TfbEP0O.js";import"./Add-CN0r1QLK.js";import"./index-W-EjzbYI.js";import"./with-selector-CDgEpx5P.js";import"./DataObject-XQLwxsph.js";import"./index-DTFmR8Ac.js";import"./core-Dg-ESrC8.js";import"./index-RecbqAl0.js";import"./list-buttons-BgDZUgyW.js";import"./FormatListNumbered-rvs8UAfH.js";import"./Link-DfTxpaxj.js";import"./useEffectEvent-DQn3o5L0.js";import"./MoreHoriz-hMMIYAbm.js";function nt({data:e}){var a;const s=V(e.conversation.id),o=((a=s.data)==null?void 0:a.items)??[];return c.useEffect(()=>W().listen({channel:f.name,events:[f.events.conversations.newMessage],type:"presence",callback:m=>{m.conversations.every(n=>n.id===e.conversation.id)&&y.invalidateQueries({queryKey:g.conversations.messages(e.conversation.id).queryKey})}}),[e.conversation.id]),t.jsx(O,{query:s,children:o.map((m,n)=>t.jsx(mt,{message:m,messages:o,index:n},m.id))})}function mt({message:e,messages:s,index:o}){switch(e.type){case"event":case"collectDetailsForm":return t.jsx($,{message:e,messages:s,index:o,variant:"customer"},e.id);case"submittedFormData":return t.jsx(_,{message:e,messages:s,index:o});case"cards":return null;default:return t.jsx(ct,{message:e,messages:s,index:o})}}function ct({message:e,messages:s,index:o}){var a;return t.jsxs(c.Fragment,{children:[t.jsxs(G,{message:e,children:[t.jsx(K,{addParagraphSpacing:e.author==="bot",className:"mr-24 text-sm",children:e.body}),!!((a=e.attachments)!=null&&a.length)&&t.jsx(pt,{attachments:e.attachments})]}),t.jsx(J,{messages:s,index:o})]})}function pt({attachments:e}){return t.jsx(P,{className:"mt-20 w-max",children:e.map((s,o)=>t.jsx(q,{attachments:e,index:o},s.id))})}function Ve(){const{conversationId:e}=x(["conversationId"]),s=M(D.customerConversations.get(e));return t.jsxs("div",{className:"flex h-screen flex-col",children:[t.jsx(st,{menuPosition:"header",className:"customer-ticket-navbar flex-shrink-0",children:t.jsx(E,{})}),t.jsxs("div",{className:"customer-ticket-page-layout container mx-auto flex-auto overflow-y-auto px-12 pb-48 md:gap-x-64 md:px-24",children:[t.jsx(lt,{}),t.jsx(dt,{data:s.data}),t.jsx(ut,{data:s.data}),s.data.conversation.status_category!==u.locked&&t.jsx(rt,{children:t.jsx(xt,{})}),t.jsx(X,{data:s.data,className:"customer-ticket-details w-350 flex-shrink-0 self-start rounded-panel border px-20 py-10 max-lg:hidden"})]})]})}function lt(){const e=b();return t.jsxs(at,{size:"sm",className:"customer-ticket-header mb-34 mt-34 flex-shrink-0 md:mb-48",children:[t.jsx(d,{onSelected:()=>e("/hc"),children:t.jsx(i,{message:"Help center"})}),t.jsx(d,{onSelected:()=>e("/hc/tickets"),children:t.jsx(i,{message:"Tickets"})}),t.jsx(d,{children:t.jsx(i,{message:"Current ticket"})})]})}function dt({data:e}){return t.jsxs("div",{className:"customer-ticket-title mb-44 flex items-center justify-between gap-12",children:[t.jsx("h1",{className:"text-2xl",children:e.conversation.subject}),e.conversation.status_category>u.closed&&t.jsx(ht,{})]})}function ut({data:e}){return t.jsxs("main",{className:"customer-ticket-content compact-scrollbar mb-24 overflow-y-auto pr-12 stable-scrollbar",children:[e.conversation.status_category===u.locked&&t.jsx(ot,{className:"mb-44 text-center",color:"danger",title:t.jsx(i,{message:"This ticket was locked due to inactivity. To reply, create a new ticket."})}),t.jsx(nt,{data:e})]})}function xt(){const{hasPermission:e}=w(),{conversationId:s}=x(["conversationId"]),o=!e("files.create"),[a,m]=c.useState(""),[n,p]=c.useState([]),h=c.useRef(null),v=k({mutationFn:()=>I.post(`helpdesk/customer/conversations/${s}/messages`,{body:a,attachments:n==null?void 0:n.map(r=>r.id)}).then(r=>r.data),onSuccess:async()=>{var r;(r=h.current)==null||r.clearContents(),p([]),await y.invalidateQueries({queryKey:g.conversations.invalidateKey}),R(S("Reply submitted"))},onError:r=>C(r)}),j=r=>{p(l=>[...l,r])},F=r=>{p(l=>l.filter(T=>T.id!==r.id))};return t.jsxs("form",{className:"customer-ticket-editor",onSubmit:r=>{r.preventDefault(),v.mutate()},children:[t.jsx("div",{className:"mb-6 text-sm font-semibold",children:t.jsx(i,{message:"Add to conversation"})}),t.jsx(Q,{isDisabled:o,onUpload:j,children:t.jsxs(Z,{onChange:m,submitToClosestForm:!0,autoFocus:!1,ref:h,children:[t.jsx(tt,{}),t.jsx(H,{className:"mb-2 mt-24 px-12",attachments:n,onRemove:F}),t.jsxs(et,{submitButtons:t.jsx(N,{type:"submit",variant:"flat",color:"primary",size:"xs",disabled:v.isPending||!a.length,className:"mr-4",children:t.jsx(i,{message:"Send reply"})}),children:[t.jsx(Y,{}),!o&&t.jsx(U,{onUpload:j}),!o&&t.jsx(z,{uploadType:B.conversationImages})]})]})})]})}function ht(){const{conversationId:e}=x(["conversationId"]),s=k({mutationFn:()=>I.post(`helpdesk/customer/conversations/${e}/mark-as-solved`),onSuccess:()=>{R(S("Ticket marked as solved")),o("/hc/tickets")},onError:a=>C(a)}),o=b();return t.jsxs(A,{type:"modal",children:[t.jsx(N,{size:"xs",variant:"outline",startIcon:t.jsx(L,{}),children:t.jsx(i,{message:"Mark as solved"})}),({close:a})=>t.jsx(it,{onConfirm:()=>{s.mutate(void 0,{onSuccess:()=>a()})},isLoading:s.isPending,title:t.jsx(i,{message:"Mark as solved"}),body:t.jsx(i,{message:"Are you sure you want to mark this ticket as solved?"}),confirm:t.jsx(i,{message:"Confirm"})})]})}export{Ve as Component};
