import{al as h,i as y,s as D,k as f,q as C,l as j,t as S,m as P,j as e,T as t,d as w,am as v,an as T,ap as k,aP as I,F as N,aq as F,B as p,L as d,r as c,aD as E,c as B,a_ as O,aj as u,aw as _,ax as q,az as g,av as x,aZ as H}from"./client-OfhJa1Pp.js";import{G as L}from"./global-loading-progress-CKXIm6JS.js";import{D as M}from"./data-table-add-item-button-2jwTYQ5G.js";import{D as R}from"./data-table-header-CeAVoFvI.js";import{D as $}from"./data-table-pagination-footer-CEEx1VtI.js";import{u as Q}from"./use-datatable-search-params-CQGreY35.js";import{D as A}from"./data-table-emty-state-message-DLsG3g03.js";import{a as V,D as z,b as G,c as K}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{u as W}from"./use-datatable-query-BQ-GXlzU.js";import{T as U}from"./table-BifRiqkr.js";import{C as Z}from"./confirmation-dialog-BIOq1A-h.js";import{u as b,c as J}from"./email-campaign-CZFBcnz-.js";import{L as X}from"./external-link-DbBk1ItZ.js";import{B as Y}from"./BarChart-DZzEjksI.js";import{M as ee}from"./MoreVert-Ci70_mZh.js";import{S as m}from"./skeleton-Cp2m1Uyc.js";import"./main-CqFMqK8-.js";import"./custom-menu-BbwshV9x.js";import"./Add-CN0r1QLK.js";import"./FilterAlt-CXibH0wr.js";import"./select-filter-panel-C_zo36WK.js";import"./form-chip-field-sH5S7-lx.js";import"./chip-list-CkGaRoaT.js";import"./filter-operator-names-BZog1mvA.js";import"./select-Dsco87dL.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./normalized-model-field-COxh0lBC.js";import"./Edit-JNj6SFDx.js";import"./accordion-DWEV-mKU.js";import"./accordtion-animation-BGCK95Hj.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import"./ArrowDownward-mN9PlQJw.js";import"./useEffectEvent-DQn3o5L0.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./useGlobalListeners-CeWFSHKo.js";function ae({campaignId:a}){const{close:s}=h(),n=y({mutationFn:()=>f.delete(`lc/campaigns/${a}`),onSuccess:async()=>{await C.invalidateQueries({queryKey:j.campaigns.invalidateKey}),S(P("Campaign deleted")),s()},onError:i=>D(i)});return e.jsx(Z,{isLoading:n.isPending,title:e.jsx(t,{message:"Delete campaign?"}),body:e.jsx(t,{message:"This will permanently delete the campaign and cannot be undone."}),confirm:e.jsx(t,{message:"Delete"}),isDanger:!0,onConfirm:()=>n.mutate()})}function se({campaign:a}){const{formId:s,close:n}=h(),i=w({defaultValues:{name:a.name}}),o=b(a.id);return e.jsxs(v,{children:[e.jsx(T,{children:e.jsx(t,{message:"Rename campaign"})}),e.jsx(k,{children:e.jsx(I,{id:s,form:i,onSubmit:r=>o.mutate(r,{onSuccess:()=>n()}),children:e.jsx(N,{required:!0,name:"name",autoFocus:!0,label:e.jsx(t,{message:"Name"})})})}),e.jsxs(F,{children:[e.jsx(p,{type:"button",onClick:()=>n(),children:e.jsx(t,{message:"Cancel"})}),e.jsx(p,{type:"submit",disabled:o.isPending,variant:"flat",color:"primary",form:s,children:e.jsx(t,{message:"Rename"})})]})]})}const te=[{key:"name",allowsSorting:!0,visibleInMode:"all",header:()=>e.jsx(t,{message:"Name"}),body:(a,s)=>s.isPlaceholder?e.jsx(m,{variant:"rect",className:"max-w-100"}):e.jsx(d,{className:X,to:`../campaigns/${a.id}/edit`,children:a.name})},{key:"enabled",allowsSorting:!0,header:()=>e.jsx(t,{message:"Enabled"}),body:(a,s)=>s.isPlaceholder?e.jsx(m,{variant:"rect",className:"max-w-40"}):e.jsx(ie,{campaign:a})},{key:"impression_count",allowsSorting:!0,header:()=>e.jsx(t,{message:"Displayed"}),body:(a,s)=>s.isPlaceholder?e.jsx(m,{variant:"rect",className:"max-w-30"}):a.impression_count??"-"},{key:"interaction_count",allowsSorting:!0,header:()=>e.jsx(t,{message:"Interactions"}),body:(a,s)=>s.isPlaceholder?e.jsx(m,{variant:"rect",className:"max-w-30"}):a.interaction_count??"-"},{key:"conversion",allowsSorting:!1,header:()=>e.jsx(t,{message:"Conversion"}),body:(a,s)=>a.interaction_count&&a.impression_count?`${(a.interaction_count/a.impression_count*100).toFixed(2)}%`:"-"},{key:"actions",header:()=>e.jsx(t,{message:"Actions"}),hideHeader:!0,visibleInMode:"all",align:"end",width:"w-84 flex-shrink-0",body:(a,s)=>e.jsx(ne,{campaign:a,isPlaceholder:s.isPlaceholder})}];function ne({campaign:a,isPlaceholder:s}){const[n,i]=c.useState(!1),[o,r]=c.useState(!1),{pathname:l}=B();return s?e.jsx(m,{variant:"rect",size:"w-84 h-24"}):e.jsxs(c.Fragment,{children:[e.jsx(O,{label:e.jsx(t,{message:"Report"}),children:e.jsx(u,{elementType:d,to:`../campaigns/${a.id}`,state:{from:l},className:"text-muted",children:e.jsx(Y,{})})}),e.jsxs(_,{children:[e.jsx(u,{className:"text-muted",children:e.jsx(ee,{})}),e.jsxs(q,{children:[e.jsx(g,{value:"edit",elementType:d,to:`../campaigns/${a.id}/edit`,children:e.jsx(t,{message:"Edit"})}),e.jsx(g,{value:"rename",onSelected:()=>i(!0),children:e.jsx(t,{message:"Rename"})}),e.jsx(g,{value:"delete",onSelected:()=>r(!0),children:e.jsx(t,{message:"Delete"})})]})]}),e.jsx(x,{type:"modal",isOpen:n,onOpenChange:i,children:e.jsx(se,{campaign:a})}),e.jsx(x,{type:"modal",isOpen:o,onOpenChange:r,children:e.jsx(ae,{campaignId:a.id})})]})}function ie({campaign:a}){const s=b(a.id),[n,i]=c.useState(a.enabled);return e.jsx("div",{className:"w-max",children:e.jsx(E,{checked:n,disabled:s.isPending,onChange:o=>{i(o.target.checked),s.mutate({enabled:o.target.checked})}})})}function Ve(){const{searchParams:a,sortDescriptor:s,mergeIntoSearchParams:n,setSearchQuery:i}=Q(H),o=!!(a.query||a.filters),r=W(j.campaigns.index(a));return e.jsxs(V,{children:[e.jsx(L,{query:r}),e.jsx(z,{title:e.jsx(t,{message:"Campaigns"}),showSidebarToggleButton:!0}),e.jsxs(G,{children:[e.jsx(R,{searchValue:a.query,onSearchChange:i,actions:e.jsx(M,{elementType:d,to:"templates",children:e.jsx(t,{message:"New campaign"})})}),e.jsxs(K,{children:[e.jsx(U,{columns:te,data:r.items,sortDescriptor:s,onSortChange:n,enableSelection:!1,cellHeight:"h-64"}),r.isEmpty&&e.jsx(A,{isFiltering:o,image:J,title:e.jsx(t,{message:"No campaigns have been created yet"}),filteringTitle:e.jsx(t,{message:"No matching campaigns"})}),e.jsx($,{hideIfOnlyOnePage:!0,query:r,onPageChange:l=>n({page:l}),onPerPageChange:l=>n({perPage:l})})]})]})]})}export{Ve as Component};
