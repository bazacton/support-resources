import{j as e,p as h,aQ as A,L as f,r as c,aO as U,m as v,C as L,T as i,a_ as O,E as B,cj as _,ck as E,b$ as K,D as R,aj as N,as as q,P as H,al as V,am as Q,an as W,ap as $,aq as J,B as x,aR as b,ae as X,I as Z,az as w,q as S,A as G,ak as Y,av as z,b7 as ee,i as se,s as te,t as ae,k as ne,b3 as ie,aw as oe,ax as re}from"./client-OfhJa1Pp.js";import{g as D,A as le}from"./main-CqFMqK8-.js";import{u as F,a as ce}from"./custom-menu-BbwshV9x.js";import{u,r as de,F as me}from"./file-upload-provider-DTPBUrkd.js";import{F as C}from"./file-type-icon-Dok_AF4H.js";import{p as I}from"./pretty-bytes-bO14ePu9.js";import{u as k}from"./shallow-BSWIanyL.js";import{S as ue}from"./select-Dsco87dL.js";import{U as xe,C as pe}from"./UploadFile-CpvhTaSF.js";import{u as ge}from"./use-droppable-DqkAoZym.js";import{o as je}from"./open-upload-window-CSDcieK1.js";import{c as he}from"./index.module-DxgU4A3H.js";import{P as fe}from"./PriorityHigh-C-SfNUlB.js";import{S as ve}from"./Sync-6-pU802x.js";import{a as ye}from"./knowledge-preview-layout-BcsQlixa.js";import{A as we}from"./Add-CN0r1QLK.js";import{D as De}from"./Delete-BhyMZiPM.js";import{V as Ie}from"./Visibility-BkaRhH0o.js";function M(){const{aiAgentId:s}=F(["aiAgentId"]);return ce(D.knowledge.index(s))}function Ne({icon:s,title:t,description:a,children:r,action:o}){return e.jsxs("div",{className:"rounded-panel border p-20",children:[e.jsxs("div",{className:"items-center gap-16 md:flex",children:[e.jsxs("div",{className:"flex items-center gap-12 max-md:mb-20",children:[s,e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold leading-6",children:t}),e.jsx("p",{className:"text-sm text-muted",children:a})]})]}),e.jsx("div",{className:"ml-auto",children:o})]}),e.jsx("div",{className:"mt-8 divide-y empty:hidden",children:r})]})}function T({name:s,icon:t,to:a,description:r,actions:o,scanPending:l,scanFailed:d}){return e.jsxs("div",{className:"flex items-center gap-18 py-16 text-sm",children:[e.jsx("div",{className:h("ml-6 flex size-24 items-center justify-center rounded-full",l?"bg-chip text-primary":d?"bg-danger-lighter text-main":"bg-positive-lighter text-main"),children:l?e.jsx(ve,{size:"xs",className:"animate-spin"}):d?e.jsx(fe,{size:"xs"}):e.jsx(A,{size:"xs"})}),e.jsxs(f,{className:h("mr-auto flex flex-1 items-center gap-6 hover:underline",l&&"pointer-events-none"),to:a,children:[c.cloneElement(t,{size:"xs"}),e.jsx("div",{children:s})]}),r&&e.jsx("div",{className:"flex-1 text-muted",children:r}),e.jsx("div",{className:"ml-auto min-w-100 flex-shrink-0",children:o})]})}const be=c.memo(({file:s,className:t,style:a})=>e.jsxs("div",{className:h("flex items-center gap-14",t),style:a,children:[e.jsx("div",{className:"shrink-0 rounded border p-8",children:e.jsx(C,{className:"h-22 w-22",mime:s.mime})}),e.jsxs("div",{className:"min-w-0 flex-auto pr-10",children:[e.jsx("div",{className:"mb-2 flex min-w-0 items-center gap-10",children:e.jsx("div",{className:"min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:s.name})}),e.jsx(Se,{file:s})]}),e.jsx("div",{className:"mr-10",children:e.jsx(ze,{file:s})})]}),U);function Se({file:s}){const t=u(k(d=>d.fileUploads.get(s.id))),a=(t==null?void 0:t.bytesUploaded)||0,r=c.useMemo(()=>I(s.size),[s]),o=c.useMemo(()=>I(a),[a]);let l;return(t==null?void 0:t.status)==="completed"?l=e.jsx(i,{message:"Upload complete"}):(t==null?void 0:t.status)==="aborted"?l=e.jsx(i,{message:"Upload cancelled"}):(t==null?void 0:t.status)==="failed"?l=e.jsx(i,{message:"Upload failed"}):(t==null?void 0:t.status)==="pending"?l=e.jsx(c.Fragment,{children:r}):l=e.jsx(i,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:o,totalBytes:r}}),e.jsx("div",{className:"text-xs text-muted",children:l})}function ze({file:s}){const t=u(k(n=>n.fileUploads.get(s.id))),a=u(n=>n.abortUpload),r=(t==null?void 0:t.percentage)||0,o=t==null?void 0:t.status,l=t==null?void 0:t.errorMessage,[d,p]=c.useState(!1),j=e.jsx(N,{size:"xs",iconSize:"sm",onClick:()=>{a(s.id)},children:e.jsx(q,{})}),y=e.jsx(H,{"aria-label":"Upload progress",size:"w-24 h-24",value:r,isIndeterminate:r===100,trackWidth:3});let m;if(o==="failed"){const n=l||v("This file could not be uploaded");m=e.jsx(g,{children:e.jsx(O,{variant:"danger",label:e.jsx(_,{value:n}),children:e.jsx(B,{className:"text-danger",size:"md"})})})}else o==="aborted"?m=e.jsx(g,{children:e.jsx(E,{className:"text-warning",size:"md"})}):o==="completed"?m=e.jsx(g,{children:e.jsx(K,{size:"md",className:"text-positive"})}):o==="pending"?m=e.jsx(g,{children:j}):m=e.jsx(g,{onPointerEnter:n=>{n.pointerType==="mouse"&&p(!0)},onPointerLeave:n=>{n.pointerType==="mouse"&&p(!1)},children:d?j:y});return e.jsx(L,{children:m})}function g({children:s,...t}){return e.jsx(R.div,{...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:s})}function Fe(){const{close:s}=V(),{aiAgentId:t}=F(["aiAgentId"]),[a,r]=c.useState("en"),o=u(n=>n.uploadMultiple),l=u(n=>n.fileUploads.size>0),d=u(n=>n.startUpload),p=u(n=>n.uploadStarted),j=u(n=>n.pendingUploadsCount>0),y=he(()=>{S.invalidateQueries({queryKey:D.knowledge.invalidateKey})},1e3,{leading:!0,trailing:!0}),m=n=>{o(n,{uploadType:b.aiDocuments,onSuccess:()=>y(),metadata:{documentLanguage:a,aiAgentId:t}},{startUpload:!1})};return e.jsxs(Q,{size:"xl",children:[e.jsx(W,{showDivider:!0,disableDismissButton:p,children:e.jsx(i,{message:"Upload documents"})}),e.jsx($,{children:l?e.jsx(Ce,{onFilesSelected:n=>m(n)}):e.jsx(ke,{onFilesSelected:n=>m(n)})}),e.jsxs(J,{dividerTop:!0,startAction:e.jsx(Me,{value:a,onChange:r}),children:[e.jsx(x,{onClick:()=>s(),disabled:p,className:"max-md:hidden",children:e.jsx(i,{message:"Close"})}),e.jsx(x,{variant:"flat",color:"primary",disabled:p||!j,onClick:()=>d(),children:e.jsx(i,{message:"Upload"})})]})]})}function Ce({onFilesSelected:s}){const t=u(a=>[...a.fileUploads.values()]);return e.jsxs("div",{children:[e.jsx("div",{className:"mb-14 space-y-14",children:t.map(a=>e.jsx(be,{file:a.file},a.file.id))}),e.jsx(x,{variant:"outline",className:"mt-10",size:"xs",onClick:async()=>{const a=await P();s(a)},children:e.jsx(i,{message:"Add more files"})})]})}function ke({onFilesSelected:s}){const t=c.useRef(null),[a,r]=c.useState(!1),{droppableProps:o}=ge({id:"ingestDocuments",ref:t,types:["nativeFile"],onDragEnter:()=>{r(!0)},onDragLeave:()=>{r(!1)},onDrop:async l=>{if(l.type==="nativeFile"){const d=await l.getData();s(d)}}});return e.jsxs("div",{className:"items-center gap-24 md:flex",children:[e.jsxs("div",{ref:t,...o,className:h("relative flex min-h-160 flex-1 flex-col items-center justify-center rounded-panel border border-dashed",a&&"border-primary"),children:[e.jsx(x,{startIcon:e.jsx(xe,{}),variant:"flat",color:"primary",onClick:async()=>{const l=await P();s(l)},children:e.jsx(i,{message:"Select files"})}),e.jsx("div",{className:"mt-8 text-sm text-muted",children:e.jsx(i,{message:"Or drag and drop here"})})]}),e.jsx("div",{className:"flex-1 max-md:mt-24",children:e.jsxs("ul",{className:"list-inside list-disc leading-6 text-muted",children:[e.jsx("li",{children:e.jsx(i,{message:"Provide files and we'll fetch all the text data inside."})}),e.jsx("li",{children:e.jsx(i,{message:"Only text based formats are supported, including: PDF, Office, PowerPoint, Excel, CSV, JSON, XML"})}),e.jsx("li",{children:e.jsx(i,{message:"Maximum file size is 40MB."})})]})})]})}async function P(){const s=de({uploadType:b.aiDocuments});return await je({multiple:!0,types:s==null?void 0:s.allowedFileTypes})}function Me({value:s,onChange:t}){const{trans:a}=X(),r=Z();return e.jsx(ue,{required:!0,selectedValue:s,onSelectionChange:o=>t(o),name:"language",selectionMode:"single",showSearchField:!0,placeholder:a(v("Select language")),searchPlaceholder:a(v("Search...")),size:"xs",floatingWidth:"auto",children:r.map(o=>e.jsx(w,{value:o.code,children:o.name},o.code))})}const Te=G(e.jsx("path",{d:"m256-240-56-56 384-384H240v-80h480v480h-80v-344L256-240Z"}),"ArrowOutwardIcon","0 -960 960 960"),Pe=c.forwardRef((s,t)=>e.jsxs(Y,{...s,ref:t,children:[e.jsx("path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4"}),e.jsx("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),e.jsx("path",{d:"M2 15h10"}),e.jsx("path",{d:"m9 18 3-3-3-3"})]}));function as(){const{data:s}=M();return e.jsxs(Ne,{icon:e.jsx(Pe,{size:"md"}),title:e.jsx(f,{to:"../knowledge/documents",className:"hover:underline",children:e.jsx(i,{message:"Documents"})}),description:e.jsx(i,{message:"Import content from documents that are not available publicly"}),action:e.jsxs(e.Fragment,{children:[e.jsxs(z,{type:"modal",children:[e.jsx(x,{startIcon:e.jsx(we,{}),variant:"outline",size:"xs",children:e.jsx(i,{message:"Upload documents"})}),e.jsx(me,{children:e.jsx(Fe,{})})]}),e.jsx(N,{size:"xs",variant:"outline",className:"ml-6",elementType:f,to:"../knowledge/documents",children:e.jsx(Te,{})})]}),children:[s==null?void 0:s.documents.items.map(t=>e.jsx(Ue,{document:t},t.id)),e.jsx(Ae,{})]})}function Ae(){const{data:s}=M();if(!(s!=null&&s.documents.more.count))return null;const t="../knowledge/documents";return e.jsx(T,{scanPending:s.documents.more.ingesting,to:t,name:e.jsx(i,{message:"And :count more documents",values:{count:s.documents.more.count}}),icon:e.jsx(pe,{size:"sm"}),actions:e.jsx(x,{variant:"outline",size:"xs",className:"min-w-96",elementType:f,to:t,children:e.jsx(i,{message:"View all"})})})}function Ue({document:s}){return s.file_entry?e.jsx(T,{name:s.file_entry.name,to:`../knowledge/documents/${s.id}`,icon:e.jsx(C,{type:s.file_entry.type,mime:s.file_entry.mime,color:"text-main"}),scanPending:s.scan_pending,scanFailed:s.scan_failed,description:e.jsx(c.Fragment,{children:s.scan_pending?e.jsx(i,{message:"Scanning..."}):s.scan_failed?e.jsx("span",{className:"text-danger",children:e.jsx(i,{message:"Could not extract content from this document"})}):e.jsx(i,{message:"Imported: :date",values:{date:e.jsx(ee,{date:s.updated_at})}})}),actions:e.jsx(Le,{document:s})}):null}function Le({document:s}){const[t,a]=c.useState(!1),r=ie();return e.jsxs(c.Fragment,{children:[e.jsxs(oe,{children:[e.jsx(x,{variant:"outline",size:"xs",endIcon:e.jsx(le,{}),children:e.jsx(i,{message:"Manage"})}),e.jsxs(re,{children:[!(s.scan_failed&&!s.scan_pending)&&e.jsx(w,{value:"view",startIcon:e.jsx(Ie,{size:"sm"}),onSelected:()=>{r(`../knowledge/documents/${s.id}`)},children:e.jsx(i,{message:"View content"})}),e.jsx(w,{value:"delete",startIcon:e.jsx(De,{size:"sm"}),className:"text-danger",onSelected:()=>a(!0),children:e.jsx(i,{message:"Delete document"})})]})]}),t&&e.jsx(z,{type:"modal",isOpen:t,onOpenChange:a,children:e.jsx(Oe,{documentId:s.id})})]})}function Oe({documentId:s}){const t=Be();return e.jsx(ye,{onDelete:()=>t.mutateAsync({documentIds:[s]}),isPending:t.isPending})}function Be(){return se({mutationFn:async({documentIds:s})=>ne.delete(`lc/ai-agent/documents/${s}`),onSuccess:()=>(ae(v("Document deleted")),S.invalidateQueries({queryKey:D.knowledge.invalidateKey})),onError:s=>te(s)})}export{Te as A,as as D,Ne as K,M as a,T as b,Be as u};
