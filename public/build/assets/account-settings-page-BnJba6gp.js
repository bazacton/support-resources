import{r as l,d as j,j as e,aP as h,F as v,T as i,B as m,i as c,s as u,k as d,aR as A,S as P,b4 as S,t as b,av as w,P as D}from"./client-OfhJa1Pp.js";import{K as C,M as N,O as T,h as F,N as I}from"./main-CqFMqK8-.js";import{A as p,a as x,c as L}from"./account-settings-sidenav-vZbwVhm-.js";import{u as U,S as z,C as E,T as O,a as k}from"./two-factor-panel-4xntbDPG.js";import{A as V}from"./access-token-panel-DaMFTxVE.js";import{I as B}from"./image-selector-Bwr5VwEQ.js";import{F as g}from"./file-upload-provider-DTPBUrkd.js";import{A as R}from"./AlternateEmail-DjCOtnvc.js";import{u as _}from"./update-account-details-UjZzNeIq.js";import{C as M}from"./confirmation-dialog-BIOq1A-h.js";import{L as $}from"./localization-panel-CeSpid2E.js";import"./custom-menu-BbwshV9x.js";import"./use-all-social-logins-disabled-BMKvG5Ea.js";import"./PhonelinkLock-C7x0YnbT.js";import"./Lock-CrI8g69F.js";import"./Login-D6kg4ucG.js";import"./Tablet-Oq_GwDxE.js";import"./envato-DBGzmVaf.js";import"./google-Dd-KeGPQ.js";import"./use-social-login-b3ri8mei.js";import"./skeleton-Cp2m1Uyc.js";import"./external-link-DbBk1ItZ.js";import"./use-clipboard-DVaYjxFN.js";import"./use-active-upload-CCDRf1Tl.js";import"./open-upload-window-CSDcieK1.js";import"./uploaded-file-DN6fXT4v.js";import"./shallow-BSWIanyL.js";import"./AddAPhoto-eWqbbo4Z.js";import"./progress-bar-iRLStr1h.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./with-selector-CDgEpx5P.js";import"./combobox-pHOmOE77.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./select-Dsco87dL.js";function H({user:s}){const a=l.useId(),t=j({defaultValues:{name:s.name||"",image:s.image}});f(s.id);const r=_(s.id,t);return e.jsx(p,{id:x.AccountDetails,title:e.jsx(i,{message:"Update name and profile image"}),actions:e.jsx(m,{type:"submit",variant:"flat",color:"primary",form:a,disabled:r.isPending||!t.formState.isValid||!t.formState.isDirty,children:e.jsx(i,{message:"Save"})}),children:e.jsxs(h,{form:t,className:"flex flex-col items-center gap-40 md:flex-row md:gap-60",onSubmit:n=>{r.mutate(n,{onSuccess:()=>{t.reset({...t.getValues(),...n})}})},id:a,children:[e.jsx(g,{children:e.jsx(K,{user:s})}),e.jsxs("div",{className:"w-full flex-auto",children:[e.jsxs("div",{className:"mb-16 flex items-center gap-4 text-muted",children:[e.jsx(R,{size:"sm"}),s.email]}),e.jsx(v,{name:"name",label:e.jsx(i,{message:"Name"})})]})]})})}function K({user:s}){const[a,t]=l.useState(s.image),r=f(s.id);return e.jsx(g,{children:e.jsx(B,{value:a,uploadType:A.avatars,variant:"avatar",stretchPreview:!0,previewSize:"w-90 h-90",placeholderIcon:e.jsx(P,{label:s.name,size:"w-full h-full text-2xl",circle:!0}),showRemoveButton:!0,onChange:(n,o)=>{t(o==null?void 0:o.url),r.mutate({image:(o==null?void 0:o.url)??null,image_entry_id:(o==null?void 0:o.id)??null})}})})}function f(s){return c({mutationFn:a=>d.put(`users/${s}`,a).then(t=>t.data),onError:a=>u(a)})}function Y(){const{user:s}=S(),a=C();return c({mutationFn:()=>Z(s.id),onSuccess:()=>{b("Account deleted"),a.mutate()},onError:t=>u(t)})}function Z(s){return d.delete(`users/${s}`,{params:{deleteCurrentUser:!0}}).then(a=>a.data)}function q(){const s=Y(),{withConfirmedPassword:a,isLoading:t}=U(),[r,n]=l.useState(!1);return e.jsxs(p,{id:x.DeleteAccount,title:e.jsx(i,{message:"Danger zone"}),children:[e.jsx(w,{type:"modal",isOpen:r,onOpenChange:n,onClose:o=>{o&&s.mutate()},children:e.jsx(M,{isDanger:!0,title:e.jsx(i,{message:"Delete account?"}),body:e.jsx(i,{message:"Your account will be deleted immediately and permanently. Once deleted, accounts can not be restored."}),confirm:e.jsx(i,{message:"Delete"})})}),e.jsx(m,{variant:"flat",color:"danger",disabled:t||s.isPending,onClick:()=>{a(()=>{n(!0)})},children:e.jsx(i,{message:"Delete account"})})]})}function Fe({panels:s,sidenavItems:a}){const{data:t,isLoading:r}=N("me",{with:["roles","social_profiles","tokens"]});return e.jsx(T,{children:e.jsxs("div",{className:"min-h-screen bg",children:[e.jsx(F,{children:e.jsx(i,{message:"Account Settings"})}),e.jsx(I,{menuPosition:"account-settings-page",color:"bg",className:"sticky top-0 z-10"}),e.jsx("div",{children:e.jsxs("div",{className:"container mx-auto px-24 py-24",children:[e.jsx("h1",{className:"text-3xl",children:e.jsx(i,{message:"Account settings"})}),e.jsx("div",{className:"mb-40 text-base text-muted",children:e.jsx(i,{message:"View and update your account details, profile and more."})}),r||!t?e.jsx(D,{className:"my-80","aria-label":"Loading user..",isIndeterminate:!0}):e.jsxs("div",{className:"flex items-start gap-24",children:[e.jsx(L,{items:a}),e.jsxs("main",{className:"flex-auto",children:[s?s(t.user):null,e.jsx(H,{user:t.user}),e.jsx(z,{user:t.user}),e.jsx(E,{}),e.jsx(O,{user:t.user}),e.jsx(k,{}),e.jsx($,{user:t.user}),e.jsx(V,{user:t.user}),e.jsx(q,{})]})]})]})})]})})}export{Fe as AccountSettingsPage};
