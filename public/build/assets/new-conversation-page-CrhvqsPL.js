import{b4 as F,f as g,aG as j,j as t,aR as I,a3 as N,az as x,T as i,F as T,B as R,l as d,r as b,h as D,aL as k,d as B,i as w,k as A,q as E,t as P,m as M,b5 as Q,aj as V}from"./client-OfhJa1Pp.js";import{A as z}from"./attribute-input-renderer-BJ7XGaGf.js";import{g as U}from"./get-default-values-for-form-with-attributes-htMbgWW2.js";import{A as L}from"./use-create-canned-reply-CgecIWMt.js";import{I as _}from"./insert-canned-reply-button-BSQsPVdS.js";import{R as q}from"./emoji-picker-button-CQGpXygB.js";import{E as W}from"./enhance-text-with-ai-button-CxIfCpJn.js";import{R as K,U as G,I as H,a as $}from"./upload-attachments-button-BWcvmOOE.js";import J from"./reply-composer-container-CGWK_3_X.js";import{F as O,R as X}from"./floating-toolbar-Db61G721.js";import{u as Y}from"./tiptap-editor-context-BAgvnYfz.js";import{F as Z}from"./file-upload-provider-DTPBUrkd.js";import{S as tt}from"./get-status-color-HuOrk9nw.js";import{u as et}from"./use-is-module-installed-FCoToztC.js";import{F as st}from"./normalized-model-field-COxh0lBC.js";import{a as u,o as ot}from"./custom-menu-BbwshV9x.js";import{F as f}from"./select-Dsco87dL.js";import{I as rt}from"./inbox-views-sidebar-MuCCM0pX.js";import{D as y}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{D as v}from"./main-CqFMqK8-.js";import{D as at}from"./dashboard-sidenav-B5THGxpt.js";import{T as it}from"./toggle-right-sidebar-icon-DXM314Tt.js";import"./button-group-Cs5CuUiC.js";import"./date-picker-CUWok1XJ.js";import"./radio-Db_caP9D.js";import"./radio-group-DQLhD511.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./ThumbDown-CmU9VZYm.js";import"./ThumbUp-B7v5mSGQ.js";import"./variable-extension-Cjf6-ocs.js";import"./campaign-conditions-config-DJxMZaUr.js";import"./Event-7FmyLdJJ.js";import"./ToggleOn-DZgCezoB.js";import"./TextFields-8TfbEP0O.js";import"./Add-CN0r1QLK.js";import"./index-W-EjzbYI.js";import"./with-selector-CDgEpx5P.js";import"./DataObject-XQLwxsph.js";import"./action-menu-dialog-Dkivr19T.js";import"./combobox-pHOmOE77.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./article-link-xsQ04UkN.js";import"./slugify-string-aubjgLQq.js";import"./article-path-Da7o5kHE.js";import"./category-link-0Q_zOKi3.js";import"./list-buttons-BgDZUgyW.js";import"./FormatListNumbered-rvs8UAfH.js";import"./Link-DfTxpaxj.js";import"./library-icon-CHCHM-UW.js";import"./use-keybind-7f4ijAco.js";import"./useGlobalListeners-CeWFSHKo.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./form-chip-field-sH5S7-lx.js";import"./chip-list-CkGaRoaT.js";import"./PushPin-Df_CN_Sp.js";import"./use-filter-KNtT5Txy.js";import"./OpenInFull-HWkxb3KN.js";import"./Spellcheck-Bs1hoM4Q.js";import"./progress-bar-iRLStr1h.js";import"./image-button-ExYLUK-F.js";import"./image-up-DCwS84Wx.js";import"./use-active-upload-CCDRf1Tl.js";import"./open-upload-window-CSDcieK1.js";import"./uploaded-file-DN6fXT4v.js";import"./shallow-BSWIanyL.js";import"./file-preview-dialog-DZbR1Zhl.js";import"./file-thumbnail-D9-TxWtC.js";import"./file-type-icon-Dok_AF4H.js";import"./ChevronLeft-B96ua4ZU.js";import"./ChevronRight-T5gg5A4x.js";import"./FileDownload-DoJWzr8l.js";import"./download-file-from-url-hJ3EUwXO.js";import"./formatted-bytes-CmuQhzYn.js";import"./pretty-bytes-bO14ePu9.js";import"./use-upload-attachments-D0EFLOL9.js";import"./use-droppable-DqkAoZym.js";import"./paperclip-DIi_RQSY.js";import"./formatted-message-body-WNPn2fpJ.js";import"./index-DTFmR8Ac.js";import"./core-Dg-ESrC8.js";import"./index-RecbqAl0.js";import"./Edit-JNj6SFDx.js";import"./skeleton-Cp2m1Uyc.js";import"./dashboard-icons-CHop3mns.js";import"./messages-square-icon-CTmom_u4.js";import"./Delete-BhyMZiPM.js";import"./Home--R_oEr6a.js";import"./SupervisorAccount-k9OnPB-d.js";import"./formatted-number-DuD1Sa1W.js";import"./Tune-DusFnn8x.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";function nt({errorMessage:s}){const{hasPermission:o}=F(),e=!o("files.create"),n=g(),m=j({name:"message.attachments"}),l=r=>{n.setValue("message.attachments",[r,...m],{shouldDirty:!0})};return t.jsxs(Z,{children:[t.jsx(K,{isDisabled:e,onUpload:l,children:t.jsxs(J,{autoFocus:!0,submitToClosestForm:!0,onChange:r=>n.setValue("message.body",r,{shouldDirty:!0}),children:[t.jsx(O,{}),t.jsxs(X,{children:[t.jsx(mt,{}),t.jsx(L,{}),t.jsx(q,{}),!e&&t.jsx(G,{onUpload:l}),!e&&t.jsx(H,{uploadType:I.conversationImages}),t.jsx(W,{})]})]})}),s,t.jsx($,{className:"mt-12",attachments:m,onRemove:r=>{n.setValue("message.attachments",m.filter(p=>p.id!==r.id),{shouldDirty:!0})}})]})}function mt(){const s=Y(),o=g();return t.jsx(_,{onSelected:e=>{s==null||s.commands.insertContent(e.body),e.attachments.length&&o.setValue("message.attachments",e.attachments,{shouldDirty:!0})}})}function lt({onSubmit:s,isPending:o}){var r,p,c;const e=g(),n=et("livechat"),m=(c=(p=(r=e.formState.errors)==null?void 0:r.message)==null?void 0:p.body)==null?void 0:c.message,l=N();return t.jsxs("form",{onSubmit:a=>{e.clearErrors(),e.handleSubmit(s)(a)},children:[n&&t.jsxs(f,{name:"type",label:t.jsx(i,{message:"Type"}),selectionMode:"single",className:"mb-24",children:[t.jsx(x,{value:"ticket",children:t.jsx(i,{message:"Ticket"})}),t.jsx(x,{value:"chat",children:t.jsx(i,{message:"Chat"})})]}),t.jsx(st,{name:"user_id",endpoint:"helpdesk/normalized-models/customer",label:t.jsx(i,{message:"Customer"}),className:"mb-24"}),t.jsx(pt,{}),e.watch("type")==="ticket"&&t.jsx(T,{name:"subject",label:t.jsx(i,{message:"Subject"}),className:"mb-24",required:!0}),t.jsxs("div",{className:"mb-24",children:[t.jsx("div",{className:l.label,children:t.jsx(i,{message:"Message"})}),t.jsx(nt,{errorMessage:m&&t.jsx("div",{className:l.error,children:m})})]}),t.jsx(R,{variant:"flat",color:"primary",type:"submit",disabled:o,children:t.jsx(i,{message:"Create"})})]})}function pt(){const s=u(d.statuses.dropdownList("agent"));return j({name:"type"})==="chat"?null:t.jsx(f,{name:"status_id",label:t.jsx(i,{message:"Status"}),selectionMode:"single",className:"mb-24",children:s.data.statuses.map(e=>t.jsx(x,{value:e.id,startIcon:t.jsx(tt,{category:e.category}),children:e.label},e.id))})}function Xe(){const{rightSidenavStatus:s}=b.useContext(v),o=D(),[e]=k(),n=e.get("customer_id"),m=u(d.statuses.dropdownList("agent")),l=u(d.attributes.normalizedList({type:"conversation",for:"agent"})),r=B({defaultValues:{status_id:m.data.statuses[0].id,user_id:n?parseInt(n):void 0,type:"ticket",message:{body:"",attachments:[]},attributes:U(l.data.attributes.filter(a=>!C.includes(a.key)))}}),p=w({mutationFn:a=>A.post("helpdesk/agent/conversations",{...a,message:{...a.message,attachments:a.message.attachments.map(h=>h.id)}}).then(h=>h.data),onSuccess:async()=>{await E.invalidateQueries({queryKey:d.conversations.invalidateKey}),P(M("Conversation created"))},onError:a=>ot(a,r)}),c=()=>{p.mutate(r.getValues(),{onSuccess:a=>o(`/dashboard/conversations/${a.conversation.id}?viewId=mine`)})};return t.jsxs(Q,{...r,children:[t.jsx(rt,{location:"conversationsTable"}),t.jsxs("div",{className:"dashboard-rounded-panel dashboard-grid-content flex flex-col lg:ml-8",children:[t.jsx(y,{title:t.jsx(i,{message:"New conversation"}),showSidebarToggleButton:!0,rightContent:s==="closed"?t.jsx(S,{}):null}),t.jsx("div",{className:"overflow-y-auto p-24",children:t.jsx(lt,{onSubmit:()=>c(),isPending:p.isPending})})]}),t.jsx(at,{position:"right",size:"w-400",className:"dashboard-rounded-panel flex-shrink-0 flex-col lg:ml-8",children:t.jsx(dt,{})})]})}const C=["subject","description","rating"];function dt(){const s=u(d.attributes.normalizedList({type:"conversation",for:"agent"}));return t.jsxs("aside",{className:"w-full",children:[t.jsx(y,{title:t.jsx(i,{message:"Attributes"}),showSidebarToggleButton:!1,rightContent:t.jsx(S,{})}),t.jsx("div",{className:"p-24",children:s.data.attributes.map(o=>C.includes(o.key)?null:t.jsx(z,{formPrefix:"attributes",attribute:o,className:"mb-24"},o.id))})]})}function S(){const{rightSidenavStatus:s,setRightSidenavStatus:o}=b.useContext(v);return t.jsx(V,{size:"xs",onClick:()=>o(s==="open"?"closed":"open"),children:t.jsx(it,{})})}export{Xe as Component};
