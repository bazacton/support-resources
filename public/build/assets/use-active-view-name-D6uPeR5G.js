import{a as q,j as e,aw as z,aj as F,ax as I,az as w,T as l,r as d,a_ as K,B as h,av as E,i as x,k as j,ae as P,Z as S,m as y,l as m,s as T,q as f,t as C,am as M,an as V,ap as B,c3 as G,bC as R,al as O,ac as D,ad as $,S as H,aq as _,cr as L,aL as U}from"./client-OfhJa1Pp.js";import{G as W,d as Z,e as A}from"./main-CqFMqK8-.js";import{a as J,S as X}from"./dashboard-icons-CHop3mns.js";import{A as Y}from"./action-menu-dialog-Dkivr19T.js";import{P as ee}from"./PushPin-Df_CN_Sp.js";import{u as se}from"./use-keybind-7f4ijAco.js";import{A as ae}from"./agent-avatar-CN8Be1Dj.js";import{a as k,I as ne,S as te}from"./custom-menu-BbwshV9x.js";import{C as oe}from"./checkbox-C4s6ROxp.js";import{u as re}from"./use-filter-KNtT5Txy.js";import{A as ie}from"./Add-CN0r1QLK.js";import{a as ce}from"./use-is-module-installed-FCoToztC.js";import{u as Q}from"./use-datatable-search-params-CQGreY35.js";import{u as ue}from"./useInfiniteQuery-Dr3ouRcV.js";function ze({className:a,size:s="xs"}){const{conversationId:n}=q(),{conversationListLayout:t,setConversationListLayout:o}=W();return e.jsxs(z,{showCheckmark:!0,selectionMode:"single",selectedValue:t,onSelectionChange:r=>{o(r),r==="chat"&&!n?window.location.reload():r==="table"&&n&&window.location.replace("/dashboard/conversations")},children:[e.jsx(F,{className:a,size:s,children:e.jsx(J,{})}),e.jsxs(I,{children:[e.jsx(w,{value:"chat",children:e.jsx(l,{message:"Chat layout"})}),e.jsx(w,{value:"table",children:e.jsx(l,{message:"Table layout"})})]})]})}const le=d.forwardRef(({startIcon:a,endIcon:s,children:n,color:t,isCompact:o=!1,className:r,...i},u)=>o?e.jsx(K,{label:n,ref:u,children:e.jsx(F,{color:t,iconSize:"md",size:"sm",className:r,...i,children:a})}):e.jsx(h,{startIcon:a,endIcon:s,variant:"outline",color:t,size:"xs",ref:u,className:r,...i,children:n}));function Ie({conversationIds:a,onSuccess:s,className:n}){const[t,o]=d.useState(!1);se("window","t",()=>o(!0));const r=ge();return e.jsxs(E,{isOpen:t,onOpenChange:o,onClose:i=>{i&&r.mutate({tagId:i.id,newTagName:i.newTagName,conversationIds:a},{onSuccess:s})},type:"popover",children:[e.jsx(le,{startIcon:e.jsx(X,{}),isCompact:!1,className:n,children:e.jsx(l,{message:"Tags (t)"})}),e.jsx(de,{})]})}function de({attachedTags:a}){var i;const[s,n]=d.useState(""),{trans:t}=P(),o=S(m.tags.index(s)),r=((i=o.data)==null?void 0:i.tags)||[];return!o.isLoading&&!r.length&&s&&r.push({id:0,newTagName:s,name:t(y('Create tag ":name"',{values:{name:s}}))}),e.jsx(Y,{placeholder:y("Find tags.."),query:s,onQueryChange:n,isLoading:o.isLoading,isFetching:o.isFetching,data:r,itemData:u=>(u=u,{title:u.name,startIcon:e.jsx(ee,{size:"xs"}),selected:a==null?void 0:a.includes(u.id)})})}function Ke(){return x({mutationFn:a=>j.post("helpdesk/conversations/tags/remove",a)})}function ge(){return x({mutationFn:a=>j.post("helpdesk/conversations/tags/add",a)})}function Ee({onSuccessAction:a}={}){return x({mutationFn:s=>j.post("helpdesk/agent/conversations/status/change",s).then(n=>n.data),onSuccess:async()=>{f.invalidateQueries({queryKey:m.views.invalidateKey}),await Promise.allSettled([a==null?void 0:a(),f.invalidateQueries({queryKey:m.conversations.invalidateKey})])},onError:s=>T(s)})}function me(){return x({mutationFn:a=>j.post("helpdesk/agent/conversations/assignee/change",a).then(s=>s.data),onSuccess:async()=>{await Promise.allSettled([f.invalidateQueries({queryKey:m.views.invalidateKey}),f.invalidateQueries({queryKey:m.conversations.invalidateKey})]),C(y("Tickets reassigned"))},onError:a=>T(a)})}function pe(){return x({mutationFn:a=>j.post("helpdesk/agent/conversations/group/change",a).then(s=>s.data),onSuccess:async()=>await f.invalidateQueries({queryKey:m.conversations.invalidateKey}),onError:a=>T(a)})}const ve=""+new URL("transfer-CaL1w_3L.svg",import.meta.url).href;function Me({conversationIds:a,type:s="all",onTransfer:n}){const[t,o]=d.useState(null),{handleTransfer:r,isPending:i}=ye(n);return e.jsxs(M,{size:"lg",children:[e.jsx(V,{children:e.jsx(l,{message:"Transfer conversation"})}),e.jsx(B,{children:e.jsx("div",{className:"h-288 overflow-y-auto",children:e.jsx(d.Suspense,{fallback:e.jsx(G,{}),children:e.jsx(he,{type:s,selectedItem:t,onItemSelected:o})})})}),e.jsx(fe,{conversationIds:a,isDisabled:i||!t,onTransfer:(u,g)=>{t&&r(t,a,u,g)}})]})}function he({type:a,selectedItem:s,onItemSelected:n}){const{trans:t}=P(),o=k(m.agents.compact),r=k(m.groups.normalizedList),{filteredAgents:i,filteredGroups:u,searchQuery:g,setSearchQuery:p}=je(o.data.agents,r.data.groups,a);return e.jsxs(d.Fragment,{children:[e.jsx(D,{className:"mb-12",placeholder:t({message:"Search..."}),startAdornment:e.jsx($,{}),size:"sm",value:g,onChange:c=>p(c.target.value)}),!i.length&&!u.length?e.jsx(ne,{className:"mx-auto mt-44",size:"xs",image:e.jsx(te,{src:ve}),title:e.jsx(l,{message:"No matching agents or groups found. Try a different search query."})}):null,e.jsxs(Z,{children:[i.map(c=>e.jsx(A,{radius:"rounded-panel",isSelected:(s==null?void 0:s.id)===c.id&&(s==null?void 0:s.type)==="agent",onSelected:()=>n({id:c.id,type:"agent"}),startIcon:e.jsx(ae,{user:c,size:"md"}),description:c.acceptsConversations?c.activeAssignedConversationsCount?e.jsx(l,{message:"[one 1 active conversation|other :count active conversations]",values:{count:c.activeAssignedConversationsCount}}):e.jsx(l,{message:"No active conversations"}):e.jsx(l,{message:"Does not accept conversations"}),children:e.jsx("div",{children:c.name})},`agent-${c.id}`)),u.map(c=>{const v=o.data.agents.filter(b=>b.acceptsConversations&&b.groups.some(N=>N.id===c.id));return e.jsx(A,{radius:"rounded-panel",isSelected:(s==null?void 0:s.id)===c.id&&(s==null?void 0:s.type)==="group",onSelected:()=>n({id:c.id,type:"group"}),startIcon:e.jsx(H,{label:c.name}),description:v.length?e.jsx(l,{message:"[one 1 agent|other :count agents] accepting conversations",values:{count:v.length}}):e.jsx(l,{message:"No agents accepting conversations"}),children:e.jsx("div",{children:c.name})},`group-${c.id}`)})]})]})}function fe({onTransfer:a,conversationIds:s,isDisabled:n}){const t=ce("ai"),[o,r]=d.useState(!1),[i,u]=d.useState(""),[g,p]=d.useState(!1),c=e.jsxs(d.Fragment,{children:[e.jsx(h,{variant:"outline",className:"ml-10",onClick:()=>{r(!1),u("")},children:e.jsx(l,{message:"Remove note"})}),e.jsx(h,{variant:"flat",color:"primary",type:"submit",form:"private-note-form",children:e.jsx(l,{message:"Save note"})})]});return e.jsxs(d.Fragment,{children:[o?e.jsx(xe,{defaultValue:i,onSubmit:v=>{u(v),r(!1)}}):null,e.jsx(_,{startAction:t&&s.length===1?e.jsx(oe,{size:"sm",checked:g,onChange:v=>p(v.target.checked),children:e.jsx(l,{message:"Summarize conversation"})}):null,children:o?c:e.jsxs(d.Fragment,{children:[e.jsx(h,{color:"primary",startIcon:!i&&e.jsx(ie,{}),onClick:()=>r(!0),children:i?e.jsx(l,{message:"Edit private note"}):e.jsx(l,{message:"Add private note"})}),e.jsx(h,{variant:"flat",color:"primary",disabled:n,onClick:()=>a(i,g),children:e.jsx(l,{message:"Transfer"})})]})})]})}function xe({onSubmit:a,defaultValue:s}){return e.jsx("form",{id:"private-note-form",className:"mb-12 px-24",onSubmit:n=>{n.preventDefault();const t=new FormData(n.target);a(t.get("note-text"))},children:e.jsx(D,{defaultValue:s,label:e.jsx(l,{message:"Private note"}),name:"note-text",autoFocus:!0,inputElementType:"textarea",rows:2})})}function je(a,s,n){const[t,o]=d.useState(""),{contains:r}=re({sensitivity:"base"}),i=n==="group"?[]:a,u=n==="agent"?[]:s,g=i.filter(c=>r(c.name,t)),p=u.filter(c=>r(c.name,t));return{filteredAgents:g,filteredGroups:p,searchQuery:t,setSearchQuery:o}}function ye(a){const s=R(a),n=me(),t=pe(),{close:o}=O(),r=d.useCallback((u,g,p,c)=>{u.type==="agent"?n.mutate({conversationIds:g,userId:u.id,privateNote:p,shouldSummarize:c},{onSuccess:()=>{o(),C({message:"Conversation transferred"}),s()}}):u.type==="group"&&t.mutate({conversationIds:g,groupId:u.id,privateNote:p,shouldSummarize:c},{onSuccess:()=>{o(),C({message:"Conversation transferred"}),s()}})},[n,t,o,s]),i=n.isPending||t.isPending;return{handleTransfer:r,isPending:i}}function Ve(){const{searchParams:a,mergeIntoSearchParams:s,sortDescriptor:n}=Q(L),t=S(m.conversations.index(a)),{data:o,isLoading:r,isPlaceholderData:i}=t,u=(o==null?void 0:o.pagination.data)||[],g=!r&&!i&&u.length===0;return{query:t,items:u,isEmpty:g,searchParams:a,mergeIntoSearchParams:s,sortDescriptor:n}}function Be(){var r;const{searchParams:a}=Q(L),s=ue(m.conversations.infiniteIndex(a)),{data:n}=s,t=d.useMemo(()=>(n==null?void 0:n.pages.flatMap(i=>i.pagination.data))||[],[n]),o=((r=n==null?void 0:n.pages)==null?void 0:r[0].pagination.data.length)===0;return{query:s,items:t,isEmpty:o}}function Ge(){const{data:a}=S(m.conversations.inboxViews),[s]=U(),n=s.get("viewId"),t=a==null?void 0:a.views.find(o=>`${o.id}`===n||o.key===n);return(t==null?void 0:t.name)??null}export{Ie as A,le as C,Me as T,Ve as a,ze as b,Ge as c,Be as d,Ke as e,ge as f,de as g,Ee as u};
