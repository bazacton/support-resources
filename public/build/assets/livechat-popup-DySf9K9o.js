import{j as e,by as L,r as p,a as F,ae as U,ac as ae,aj as C,aK as M,B as S,i as V,s as ie,q as _,k as K,u as f,z as H,T as c,Z as I,as as B,p as k,c as re,c3 as O,L as b,aJ as G,b$ as De,av as _e,am as He,an as Be,ap as qe,bf as ne,aw as Re,ax as Qe,az as R,bF as $e,aD as Ue,al as Ve,b3 as oe,t as Q,m as $,S as le,C as z,D as h,G as y,P as ce,b7 as me,aT as de,N as Ke,aV as ue,aL as Oe,b9 as xe,b as J,ad as pe,h as je,U as Ge,bB as Je,cg as Ze,ak as Ye,aP as Xe,F as he,b4 as We,f as es,aR as ss,cG as ts,bM as as,cH as is,cI as rs,cJ as ns,cK as w}from"./client-OfhJa1Pp.js";import{A as os}from"./agent-avatar-CN8Be1Dj.js";import{M as ls,c as fe,A as cs,b as ge}from"./reverse-conversation-messages-abBI68AY.js";import{i as ms}from"./feed-attachments-54xris-A.js";import{T as ds}from"./ticket-details-BWJm5pA-.js";import{c as Z,d as N,e as ve,a as T,f as be,w as A,s as us,W as xs,g as ps,h as js,i as hs,j as fs,b as gs}from"./widget-entry-CxNqRu8v.js";import{F as ye,u as vs,r as bs}from"./file-upload-provider-DTPBUrkd.js";import{a as we,b as ys}from"./use-compact-agents-VrJm5fj6.js";import{E as ws}from"./Edit-JNj6SFDx.js";import{E as Ns}from"./Email-BEay9knN.js";import{u as Ne}from"./use-widget-bootstrap-data-BlKRRco5.js";import{H as ee}from"./HourglassEmpty-BpvqVftp.js";import{C as ks}from"./ConfirmationNumber-8T4bmILd.js";import{D as Ss}from"./Download-ealU7kv_.js";import{M as Is}from"./MoreHoriz-hMMIYAbm.js";import{S as Cs}from"./Schedule-BuWxyNlz.js";import{V as As,a as Ts,F as zs,b as Ms}from"./FullscreenExit-BVexRmJS.js";import{C as Ps}from"./confirmation-dialog-BIOq1A-h.js";import{d as Es}from"./download-file-from-url-hJ3EUwXO.js";import{M as ke}from"./message-author-name-DihwIAPW.js";import{U as Se}from"./unseen-messages-badge-BC9Ql5Uh.js";import{I as Ls}from"./infinite-scroll-sentinel-sZcqy_uF.js";import{B as Ie}from"./bullet-seprated-items-Dl11L_1z.js";import{u as Fs}from"./useInfiniteQuery-Dr3ouRcV.js";import{M as Ds}from"./messages-square-icon-CTmom_u4.js";import{S as Ce}from"./Send-CHhhtcWL.js";import{I as Ae,h as Y,S as _s,u as Hs,b as Bs,a as qs,o as Rs}from"./custom-menu-BbwshV9x.js";import{A as Te}from"./ArrowBack-DcV9hHRo.js";import{S as x}from"./skeleton-Cp2m1Uyc.js";import{s as Qs}from"./search-D3bB1V5N.js";import{g as ze,A as $s}from"./article-link-xsQ04UkN.js";import{A as Us,a as Vs}from"./article-page-feedback--zPIjw3k.js";import{O as Me}from"./OpenInNew-Q67MT6Ae.js";import{c as Ks}from"./css-props-from-bg-config-CgypBlFP.js";import{A as Os}from"./avatar-group-DoAzKV83.js";import{A as Gs}from"./attribute-input-renderer-BJ7XGaGf.js";import{u as Js,C as Zs,S as Ys}from"./use-customer-new-ticket-form-DC875_si.js";import{u as Xs}from"./use-upload-attachments-D0EFLOL9.js";import{u as Ws,C as et}from"./use-captcha-CGFhx3Qc.js";import{P as st}from"./paperclip-DIi_RQSY.js";import{P as tt}from"./progress-bar-iRLStr1h.js";import{o as at}from"./open-upload-window-CSDcieK1.js";import{W as it}from"./widget-navigation-DzRrm2db.js";import"./online-status-circle-QXiKm4xe.js";import"./isScrollable-BSEN4xi5.js";import"./customer-avatar-DNefi2od.js";import"./animating-messages-DuT2CR0j.js";import"./file-thumbnail-D9-TxWtC.js";import"./file-type-icon-Dok_AF4H.js";import"./formatted-bytes-CmuQhzYn.js";import"./pretty-bytes-bO14ePu9.js";import"./AttachFile-DK1KiGUi.js";import"./attribute-renderer-BAh3glGI.js";import"./ThumbDown-CmU9VZYm.js";import"./ThumbUp-B7v5mSGQ.js";import"./conversation-priority-tSI_39cp.js";import"./widget-flags-DGIUgINI.js";import"./get-default-values-for-form-with-attributes-htMbgWW2.js";import"./HelpOutline-BWHaeyMp.js";import"./stream-BHqpFGMu.js";import"./useMutationState-V1q6F41O.js";import"./formatted-message-body-WNPn2fpJ.js";import"./emoji-picker-button-CQGpXygB.js";import"./tiptap-editor-context-BAgvnYfz.js";import"./check-circle-filled-DBwRd3aX.js";import"./Add-CN0r1QLK.js";import"./play-conversation-sound-DRUgHrdP.js";import"./websocket-updates-notifier-CaEDKM_o.js";import"./helpdesk-channel-CQKSbeKg.js";import"./ChatBubbleOutline-BMaPdsVG.js";import"./index.module-DxgU4A3H.js";import"./uploaded-file-DN6fXT4v.js";import"./with-selector-CDgEpx5P.js";import"./infiniteQueryObserver-dCGK3uny.js";import"./slugify-string-aubjgLQq.js";import"./button-group-Cs5CuUiC.js";import"./date-picker-CUWok1XJ.js";import"./radio-Db_caP9D.js";import"./radio-group-DQLhD511.js";import"./select-Dsco87dL.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./accordtion-animation-BGCK95Hj.js";import"./Chat-Ct1un6CP.js";import"./Help-DaN2Y9a4.js";import"./Home--R_oEr6a.js";function rt({header:s,feed:t,editor:a,fixedHeader:i}){return e.jsxs("div",{className:"flex h-full min-h-0 flex-col",children:[i&&e.jsx("div",{className:"mb-20 px-20",children:i}),e.jsxs("div",{className:"compact-scrollbar min-h-0 flex-auto overflow-auto overscroll-contain px-20 stable-scrollbar",children:[s,t]}),e.jsx(ye,{children:e.jsx("div",{className:"mt-20 px-20 pb-16",children:a})})]})}function nt(){const{agents:s,isLoading:t}=we(),{isInsideSettingsPreview:a}=L(),i=Z(),[r,n]=p.useState(!(i!=null&&i.email));return(t||s.some(o=>o.wasActiveRecently))&&!a?null:e.jsx("div",{className:"mt-6 h-36",children:a||r||!(i!=null&&i.email)?e.jsx(ot,{onSaved:()=>n(!1)}):e.jsx(lt,{email:i.email,onEdit:()=>n(!0)})})}function ot({onSaved:s}){const{isInsideSettingsPreview:t}=L(),a=ct(),i=Z(),{chatId:r}=F(),{trans:n}=U();return e.jsx("form",{onSubmit:o=>{if(o.preventDefault(),t||!i)return;const l=new FormData(o.target).get("email");l&&(l===i.email?s():a.mutate({email:l,userId:i.id,conversationId:r},{onSuccess:()=>s()}))},children:e.jsx(ae,{required:!0,type:"email",name:"email",size:"sm",background:"bg",defaultValue:i==null?void 0:i.email,startAdornment:e.jsx(Ns,{}),placeholder:n({message:"Email"}),endAppend:e.jsx(C,{variant:"flat",color:"primary",type:"submit",className:"max-w-36",disabled:a.isPending,children:e.jsx(M,{})})})})}function lt({email:s,onEdit:t}){return e.jsx(S,{size:"xs",variant:"outline",startIcon:e.jsx(ws,{}),className:"my-3",onClick:()=>t(),children:s})}function ct(){return V({mutationFn:({email:s,conversationId:t})=>K.put("lc/widget/customers/email",{email:s,conversationId:t}).then(a=>a.data),onSuccess:()=>Promise.allSettled([_.invalidateQueries({queryKey:N.conversations.invalidateKey}),_.invalidateQueries({queryKey:N.customers.invalidateKey})]),onError:s=>ie(s)})}function mt({data:s}){var j,v;const t=s==null?void 0:s.conversation,a=ys(),{chatWidget:i}=f(),{aiAgent:r}=Ne(),{isInsideSettingsPreview:n,settingsEditorParams:o}=L(),l=t&&t.status_category<=H.closed,m=t&&t.type==="ticket",u=t?t.assigned_to==="bot":!!(r!=null&&r.enabled);return(l||m||u)&&!n||o!=null&&o.form?null:(!(a!=null&&a.length)||n)&&(i!=null&&i.agentsAwayMessage)?e.jsxs(se,{children:[e.jsx(ee,{size:"sm",className:"mr-4"}),e.jsx(c,{message:i.agentsAwayMessage}),e.jsx(nt,{})]}):t&&!t.assignee&&(i!=null&&i.inQueueMessage)?e.jsxs(se,{children:[e.jsx(ee,{size:"sm",className:"mr-4"}),e.jsx(c,{message:i.inQueueMessage,values:{number:(j=s.queuedChatInfo)==null?void 0:j.positionInQueue,minutes:(v=s.queuedChatInfo)==null?void 0:v.estimatedWaitTime}})]}):null}function se({children:s}){return e.jsx("div",{className:"sticky top-0 z-10 mb-20 overflow-hidden rounded-panel border bg-elevated px-10 py-8 text-sm shadow-md",children:s})}function dt(){var l,m;const{isInsideSettingsPreview:s}=L(),{chatWidget:t}=f(),a=(l=t==null?void 0:t.forms)==null?void 0:l.postChat,{conversationId:i}=F(),r=I(N.conversations.get(s?void 0:i)),n=ve(s?void 0:i),o=r.data&&!r.data.hasPostChatForm&&!!((m=a==null?void 0:a.attributes)!=null&&m.length)&&r.data.conversation.status_category<=H.closed&&!(a!=null&&a.disabled);return{conversationQuery:r,messagesQuery:n,postChatFormIsVisible:o}}function Pe(){const s=T(a=>a.isMobile),{isInline:t}=be();return!s||t?null:e.jsx(C,{onClick:()=>A().setWidgetState("closed"),children:e.jsx(B,{})})}function P({label:s,children:t,start:a,end:i,className:r}){const n=T(o=>o.isMobile);return e.jsxs("div",{className:k("flex flex-shrink-0 flex-col items-center justify-center overflow-hidden rounded-t-panel border-b bg px-8 py-10 text-main",!n&&"rounded-t-panel",r),children:[e.jsxs("div",{className:"flex w-full items-center justify-between gap-8",children:[e.jsx("div",{className:"mr-auto flex-1",children:a}),e.jsx("div",{className:"min-w-0 flex-auto overflow-hidden text-ellipsis whitespace-nowrap text-center text-lg font-semibold leading-[42px]",children:s}),e.jsxs("div",{className:"ml-auto flex flex-1 justify-end",children:[i,e.jsx(Pe,{})]})]}),t&&e.jsx("div",{className:"mt-8 w-full",children:t})]})}function te(){var l,m,u,g;const{state:s}=re(),{conversationQuery:t,messagesQuery:a,postChatFormIsVisible:i}=dt(),r=(l=t.data)==null?void 0:l.conversation;let n=null;!us((m=a.data)==null?void 0:m.items)&&!i&&(n=e.jsx(ht,{chatId:r==null?void 0:r.id}));const o=t.isLoading?e.jsx(O,{}):e.jsx(rt,{fixedHeader:t.data&&t.data.conversation.type==="ticket"&&e.jsx(jt,{data:t.data}),header:e.jsx(mt,{data:t.data}),feed:e.jsxs(ls,{query:a,children:[e.jsx(xs,{}),(u=a.data)==null?void 0:u.items.map((j,v)=>e.jsx(ps,{message:j,...ms(v,j,a.data.items)},j.uuid)),i&&r&&e.jsx(js,{chatId:r.id})]}),editor:e.jsxs("div",{children:[((g=t.data)==null?void 0:g.conversation.type)==="ticket"&&e.jsx(pt,{data:t.data}),n]})});return e.jsxs("div",{className:"relative flex min-h-0 flex-auto flex-col",children:[e.jsx(P,{className:"mb-20",start:e.jsx(C,{elementType:b,to:(s==null?void 0:s.prevPath)??"/",children:e.jsx(G,{})}),label:e.jsx(xt,{conversation:r}),end:e.jsx(ut,{conversation:r})}),o]})}function ut({conversation:s}){const{base_url:t}=f(),a=()=>{s&&Es(`${t}/api/v1/lc/widget/chats/${s.id}/download-transcript`)},[i,r]=ne("widget-chatSoundsDisabled",!1);return e.jsxs(Re,{children:[e.jsx(C,{children:e.jsx(Is,{})}),e.jsxs(Qe,{children:[e.jsx(R,{value:"closeConversation",startIcon:e.jsx(B,{}),onSelected:()=>$e(ft,{conversation:s}),children:e.jsx(c,{message:"Close conversation"})}),s&&s.type!=="ticket"&&e.jsx(R,{value:"downloadTranscript",startIcon:e.jsx(Ss,{}),onSelected:()=>a(),children:e.jsx(c,{message:"Download transcript"})}),e.jsx(R,{value:"sounds",startIcon:i?e.jsx(As,{}):e.jsx(Ts,{}),onSelected:()=>{r(!i)},children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx(c,{message:"Sounds"}),e.jsx(Ue,{checked:!i,readOnly:!0})]})})]})]})}function xt({conversation:s}){var l;const t=fe(),{branding:a}=f(),{newChatGreeting:i,aiAgent:r}=Ne();let n=t?e.jsx(le,{src:t,circle:!1,size:"w-30 h-30"}):null,o=a.site_name;return s!=null&&s.assignee?(n=e.jsx(os,{showAwayIcon:!0,user:s.assignee,size:"w-30 h-30"}),o=s.assignee.name):((s==null?void 0:s.assigned_to)==="bot"||((l=i==null?void 0:i.parts[0])==null?void 0:l.author)==="bot")&&(n=e.jsx(cs,{size:"w-30 h-30"}),o=(r==null?void 0:r.name)||"AI assistant"),e.jsxs("div",{className:"ml-auto mr-auto flex w-max items-center gap-10",children:[n,e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:o})]})}function pt({data:s}){const t=s.conversation,a=t.status_category>H.closed?e.jsx(Cs,{size:"xs"}):e.jsx(De,{size:"xs"});return e.jsxs("div",{className:"mb-8 flex items-center gap-4 text-xs text-muted justify-center-safe",children:[a,t.status]})}function jt({data:s}){return e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(_e,{type:"modal",mobileType:"modal",position:"absolute",underlayTransparent:!0,underlayBlurred:!1,children:[e.jsx(S,{variant:"outline",color:"primary",size:"sm",startIcon:e.jsx(ks,{}),className:"max-w-full",shadow:"shadow dark:shadow-none",justify:"justify-center-safe",children:e.jsx("span",{className:"overflow-hidden overflow-ellipsis",children:s.conversation.subject?s.conversation.subject:e.jsx(c,{message:"Ticket details"})})}),e.jsxs(He,{children:[e.jsx(Be,{children:e.jsx(c,{message:"Ticket details"})}),e.jsx(qe,{children:e.jsx(ds,{data:s,className:"px-20 py-10"})})]})]})})}function ht({chatId:s}){var l;const{createChat:t,submitMessage:a,isPending:i}=hs(),{chatWidget:r}=f(),{settingsEditorParams:n}=L(),o=(l=r==null?void 0:r.forms)==null?void 0:l.preChat;return n.form==="preChat"||!s&&!(o!=null&&o.disabled)&&(o!=null&&o.attributes.length)?null:e.jsx(fs,{isPending:i,onSubmit:m=>{s?a({message:m,conversationId:s}):t({message:m,startWithGreeting:!0})}})}function ft({conversation:s}){const{close:t}=Ve(),a=oe(),i=V({mutationFn:()=>K.post(`helpdesk/customer/conversations/${s.id}/mark-as-solved`),onSuccess:()=>{Q($("Conversation closed")),_.invalidateQueries({queryKey:N.conversations.invalidateKey}),A().activeConversationId===s.id&&A().setActiveConversationId(null),t(),a("/")},onError:r=>ie(r)});return e.jsx(Ps,{title:(s==null?void 0:s.type)==="ticket"?e.jsx(c,{message:"Close ticket"}):e.jsx(c,{message:"Close chat"}),body:e.jsx(c,{message:"Are you sure you want to close this conversation?"}),confirm:e.jsx(c,{message:"Close"}),isLoading:i.isPending,onConfirm:()=>{i.mutate()}})}function gt(){const s=Fs(N.conversations.index());return e.jsxs("div",{className:"relative flex min-h-0 flex-auto flex-col",children:[e.jsx(P,{label:e.jsx(c,{message:"Conversations"})}),e.jsx(z,{initial:!1,mode:"wait",children:s.data?e.jsx(vt,{query:s}):e.jsx(yt,{})}),e.jsx(S,{variant:"flat",color:"primary",elementType:b,to:"/conversations/new",state:{prevPath:"/conversations"},endIcon:e.jsx(Ce,{}),className:"absolute bottom-12 left-0 right-0 mx-auto max-w-max",children:e.jsx(c,{message:"New conversation"})})]})}function vt({query:s}){var a;const t=((a=s.data)==null?void 0:a.pages.flatMap(i=>i.pagination.data))||[];return t.length===0?e.jsx(h.div,{...y,className:"flex h-full w-full items-center justify-center",children:e.jsx(Ae,{size:"sm",image:e.jsx(Ds,{size:"md"}),imageHeight:"h-auto",imageMargin:"mb-12",title:e.jsx(c,{message:"No conversations yet"}),description:e.jsx(c,{message:"All your conversations will be shown here"})})},"no-conversations"):p.createElement(h.div,{...y,key:"coversations",className:"compact-scrollbar flex-auto overflow-y-auto"},t.map(i=>e.jsx(bt,{conversation:i},i.id)),e.jsx(Ls,{query:s},"sentinel"))}function bt({conversation:s}){const t=s.latest_message;return t?e.jsxs(b,{to:`/conversations/${s.id}`,state:{prevPath:"/conversations"},className:k("flex items-center gap-8 border-b border-divider-lighter px-20 py-16 transition-button hover:bg-hover",s.status_category<=H.closed&&"bg-alt"),children:[e.jsx(ge,{size:"lg",message:t}),e.jsxs("div",{className:"flex-auto text-sm",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs(Ie,{className:"text-muted",children:[e.jsx("div",{children:e.jsx(ke,{message:t,personalize:!0})}),e.jsx("div",{children:e.jsx(me,{style:"narrow",date:(t==null?void 0:t.created_at)??de().toAbsoluteString()})}),s.type==="ticket"&&e.jsx(c,{message:"Ticket"})]}),e.jsx(Se,{conversationId:s.id})]}),e.jsx("div",{className:"line-clamp-2",children:t.body})]}),e.jsx(M,{className:"text-primary",size:"sm"})]},s.id):null}function yt(){return e.jsx(h.div,{...y,className:"flex flex-auto items-center justify-center",children:e.jsx(ce,{isIndeterminate:!0})},"loading")}function wt(){const{state:s}=re();return s.embedUrl?e.jsxs("div",{className:"relative flex min-h-0 flex-auto flex-col",children:[e.jsx(P,{start:e.jsx(S,{elementType:b,to:(s==null?void 0:s.prevPath)??"/",startIcon:e.jsx(Te,{}),children:e.jsx(c,{message:"Back"})})}),e.jsx("div",{className:"m-8 flex grow overflow-hidden rounded-panel",children:e.jsx("div",{className:"grow overflow-auto",children:e.jsx("iframe",{src:s.embedUrl,className:"h-full w-full border-none bg-none p-0",sandbox:"allow-forms allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-storage-access-by-user-activation"})})}),e.jsx("div",{className:"mb-8 text-center text-xs text-muted",children:Nt(s.embedUrl)})]}):e.jsx(Ke,{to:"/"})}function Nt(s){return new URL(s).hostname}function X({name:s,description:t,information:a}){return e.jsxs("div",{className:"border-b-lighter border-b px-20 py-16",children:[e.jsx("div",{className:"text-base font-semibold",children:s}),t&&e.jsx("div",{className:"mt-4 text-sm",children:t}),a&&e.jsx("div",{className:"mt-4 text-sm text-muted",children:a})]})}function Ee(){return e.jsx(X,{name:e.jsx(x,{size:"w-240"}),information:e.jsx(x,{size:"w-68"})})}function kt(){var i;const{categoryId:s}=F(),a=(i=I(N.articles.hcData()).data)==null?void 0:i.categories.find(r=>`${r.id}`===s);return e.jsx(z,{initial:!1,mode:"wait",children:a?p.createElement(h.div,{...y,key:"category-screen"},e.jsx(Le,{category:a})):p.createElement(h.div,{...y,key:"category-skeleton"},e.jsx(Ee,{},"skeleton-header"),e.jsx(W,{},"skeleton-list"))})}function Le({category:s}){var t;return e.jsxs(e.Fragment,{children:[s.hide_from_structure?null:e.jsx(X,{name:s.name,description:s.description,information:e.jsx(c,{message:":count articles",values:{count:s.sections.reduce((a,i)=>a+i.articles_count,0)}})},"header"),(t=s.sections)==null?void 0:t.map(a=>e.jsx(E,{name:a.name,description:a.description,to:`/hc/categories/${s.id}/${a.id}`,information:e.jsx(c,{message:":count articles",values:{count:a.articles_count}})},a.id))]})}function St(){const s=I(N.articles.hcData());return e.jsx(z,{initial:!1,mode:"wait",children:s.data?e.jsx(It,{data:s.data}):p.createElement(h.div,{...y,key:"list-skeleton"},e.jsx(W,{}))})}function It({data:s}){return s.categories.length===1&&s.categories[0].hide_from_structure?e.jsx(Le,{category:s.categories[0]}):p.createElement(h.div,{...y,key:"category-list"},s.categories.map(t=>e.jsx(E,{name:t.name,description:t.description,to:`/hc/categories/${t.id}`,information:e.jsx(c,{message:":count articles",values:{count:t.sections.reduce((a,i)=>a+i.articles_count,0)}})},t.id)))}function E({to:s,name:t,description:a,information:i,className:r}){const n=s?b:"div";return e.jsx(n,{to:s,className:k("block transition-all",s&&"hover:bg-hover",r),children:e.jsxs("div",{className:"relative ml-20 mr-14 flex items-center gap-8 border-b border-b-lighter py-16 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t}),a&&e.jsx("div",{className:"mt-4",children:a}),i&&e.jsx("div",{className:"mt-4 text-muted",children:i})]}),s?e.jsx(M,{size:"sm",className:"ml-auto"}):null]})})}function W({hideInformation:s}){return e.jsxs(p.Fragment,{children:[e.jsx(E,{name:e.jsx(x,{size:"w-264"}),description:e.jsx(x,{size:"w-160"}),information:s?null:e.jsx(x,{size:"w-68"})},"skeleton-1"),e.jsx(E,{name:e.jsx(x,{size:"w-160"}),description:e.jsx(x,{size:"w-288"}),information:s?null:e.jsx(x,{size:"w-68"})},"skeleton-2"),e.jsx(E,{name:e.jsx(x,{size:"w-224"}),description:e.jsx(x,{size:"w-124"}),information:s?null:e.jsx(x,{size:"w-68"})},"skeleton-3")]})}function Ct(){var n,o,l;const{categoryId:s,sectionId:t}=F(),i=(n=I(N.articles.hcData()).data)==null?void 0:n.categories.find(m=>`${m.id}`===s),r=(o=i==null?void 0:i.sections)==null?void 0:o.find(m=>`${m.id}`===t);return e.jsx(z,{initial:!1,mode:"wait",children:r?p.createElement(h.div,{...y,key:"section"},e.jsx(X,{name:r.name,description:r.description,information:e.jsx(c,{message:":count articles",values:{count:r.articles_count}})},"header"),(l=r.articles)==null?void 0:l.map(m=>e.jsx(Fe,{article:m,section:r},m.id))):p.createElement(h.div,{...y,key:"section-skeleton"},e.jsx(Ee,{},"skeleton-header"),e.jsx(W,{hideInformation:!0},"skeleton-list"))})}function Fe({article:s,section:t,onClick:a}){return e.jsx(b,{to:ze(s,{section:t}),className:"block transition-all hover:bg-hover",onClick:a,children:e.jsxs("div",{className:"relative ml-20 mr-14 flex items-center gap-8 border-b border-b-lighter py-16 text-sm",children:[e.jsx("div",{children:s.title}),e.jsx(M,{size:"sm",className:"ml-auto"})]})},s.id)}function At(){var j;const s=ue(),[t,a]=Oe(),i=t.get("query")||"",r=v=>{a({query:v},{replace:!0})},{categoryId:n,sectionId:o}=F(),l=I(Y.articles.search({query:i,categoryIds:n?[n]:void 0,tag:void 0},v=>{var d;s.log({term:v.query,results:v.pagination.data,categoryId:(d=v.categoryIds)==null?void 0:d[0]})})),u=(j=I(N.articles.hcData()).data)==null?void 0:j.categories.find(v=>`${v.id}`===n);let g;return o&&!(u!=null&&u.hide_from_structure)?g=`/hc/categories/${n}`:n?g="/hc":t.get("prevRoute")==="home"&&(g="/"),e.jsxs(h.div,{...y,className:"flex min-h-0 flex-auto flex-col",children:[e.jsx(P,{label:e.jsx(c,{message:"Help"}),start:g&&e.jsx(C,{elementType:b,to:g,onClick:()=>{r("")},children:e.jsx(G,{})}),children:e.jsx(Tt,{value:i,onChange:r,isLoading:l.isFetching})}),e.jsx("div",{className:"compact-scrollbar flex-auto overflow-auto",children:i?e.jsx(zt,{query:l}):e.jsx(xe,{})})]},"help-screen")}function Tt({value:s,onChange:t,isLoading:a}){const{trans:i}=U(),r=J();let n;return a?n=e.jsx(ce,{isIndeterminate:!0,size:"sm"}):s?n=e.jsx(C,{onClick:()=>t(""),children:e.jsx(B,{})}):n=e.jsx(pe,{}),e.jsx(ae,{autoFocus:!0,value:s,onChange:o=>t(o.target.value),size:"sm",placeholder:i({message:"Search for answers"}),background:r?"bg-alt":"bg",endAdornment:n,className:"mx-8 mb-2"})}function zt({query:s}){var i;const t=ue();if(s.isLoading)return e.jsx(O,{});const a=((i=s.data)==null?void 0:i.pagination.data)||[];return a.length?e.jsx("div",{children:a.map(r=>e.jsx(Fe,{article:r,onClick:()=>t.updateLastSearch({clickedArticle:!0})},r.id))}):e.jsx(Ae,{className:"mt-48",size:"sm",image:e.jsx(_s,{src:Qs}),title:e.jsx(c,{message:"No articles match your search query"})})}function Mt(){const{categoryId:s,sectionId:t,articleId:a}=Hs(["categoryId","sectionId","articleId"]),i=I(Y.articles.getForArticlePage({articleId:a,categoryId:s,sectionId:t})),r=je(),[n,o]=ne("articleSize");return p.useEffect(()=>(A().setWidgetState(n==="maximized"?"articleMaximized":"open"),()=>{A().widgetState==="articleMaximized"&&A().setWidgetState("open")}),[n]),e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(P,{start:e.jsx(S,{relative:"path",startIcon:e.jsx(Te,{}),onClick:()=>r(-1),children:e.jsx(c,{message:"Back"})}),end:e.jsx(C,{onClick:()=>{o(n==="maximized"?"minimized":"maximized")},children:n==="minimized"?e.jsx(zs,{}):e.jsx(Ms,{})})}),e.jsx("div",{className:"compact-scrollbar flex-auto overflow-y-auto px-20 pb-20 pt-10 stable-scrollbar",children:e.jsx(z,{initial:!1,mode:"wait",children:i.data?e.jsx(Pt,{article:i.data.article}):e.jsx(Et,{})})})]})}function Pt({article:s}){const t=p.useRef(null),a=T(i=>i.widgetState);return p.useEffect(()=>{t.current&&Ge(t.current)},[]),p.createElement(h.div,{...y,key:"widget-article-body"},e.jsxs("article",{children:[e.jsx("h1",{className:"font-display text-slate-900 text-2xl tracking-tight",children:s.title}),e.jsx("div",{className:k("prose-pre:bg-slate-900 prose dark:prose-invert prose-headings:font-normal prose-a:font-normal prose-a:text-primary prose-pre:rounded-xl prose-pre:shadow-lg dark:prose-pre:shadow-none dark:prose-pre:ring-1 dark:prose-pre:ring-divider",a!=="articleMaximized"&&"text-sm"),children:e.jsx("div",{ref:t,className:"article-body whitespace-pre-wrap break-words leading-6",dangerouslySetInnerHTML:{__html:s.body}})})]},"article"),e.jsx(Us,{articleId:s.id,attachments:s.attachments},"attachments"),e.jsx("div",{className:"mt-20 flex justify-center border-t pt-20",children:e.jsx(Vs,{articleId:s.id})},"feedback"),e.jsxs("div",{className:"mt-30 flex items-center justify-center gap-4 text-sm text-muted",children:[e.jsx(Me,{size:"sm"}),e.jsx($s,{article:s,target:"_blank",children:e.jsx(c,{message:"Open in help center"})})]},"article-link"))}function Et(){return e.jsxs(h.div,{...y,children:[e.jsx(x,{variant:"rect",size:"h-20 max-w-580"}),e.jsx(x,{variant:"rect",size:"h-34 max-w-440",className:"mb-30 mt-10"}),e.jsx(x,{size:"w-full max-w-[95%]"}),e.jsx(x,{}),e.jsx(x,{size:"w-full max-w-[70%]",className:"mb-30"}),e.jsx(x,{size:"w-full max-w-[90%]"}),e.jsx(x,{size:"w-full max-w-[80%]"}),e.jsx(x,{size:"w-full max-w-[30%]"})]},"skeletons")}function D({children:s,className:t}){return e.jsx("div",{className:k("overflow-hidden rounded-panel border bg-elevated text-sm shadow-[0_2px_8px_rgba(0,0,0,.06)]",t),children:s})}function Lt(){var r;const s=J(),{chatWidget:t}=f(),a=!(t!=null&&t.hideHomeArticles),i=I(N.articles.homeArticleList());return e.jsxs(D,{className:k(a&&"p-8"),children:[e.jsx(S,{elementType:b,to:"/hc?prevRoute=home",justify:"justify-between",variant:"flat",color:a||s?"chip":"white",endIcon:e.jsx(pe,{}),className:k("w-full",a?"min-h-40":"min-h-54"),children:e.jsx(c,{message:"Search for help"})}),a&&e.jsx("div",{className:"mt-10 text-sm",children:e.jsx(z,{initial:!1,mode:"wait",children:i.data?e.jsx(h.div,{...y,children:(r=i.data)==null?void 0:r.articles.map(n=>e.jsxs(Je,{justify:"justify-between",className:"w-full rounded-panel px-12 py-8 hover:bg-hover",elementType:b,to:ze(n),children:[n.title,e.jsx(M,{size:"sm"})]},n.id))},"article-list"):e.jsx(Ft,{})})})]})}function Ft(){return e.jsx(h.div,{...y,children:[1,2,3,4].map(s=>e.jsx("div",{className:"px-12 py-8",children:e.jsx(x,{})},s))},"article-skeletons")}function Dt(s){return s==null?void 0:s.replace(/<\/?[^>]+(>|$)/g,"")}const _t=Ze(Dt);function Ht({chatId:s}){var u,g,j;const t=I(N.conversations.get(s)),a=ve(s),{chatWidget:i}=f(),{trans:r}=U();if(!((u=t.data)!=null&&u.conversation)||!((g=t.data)!=null&&g.items))return null;const{conversation:n}=t.data,o=(j=a.data)==null?void 0:j.items.at(-1);if(!o)return null;const l=(o==null?void 0:o.type)==="message"?_t(o.body):r({message:(i==null?void 0:i.defaultMessage)??""}),m=(o==null?void 0:o.created_at)??de().toAbsoluteString();return e.jsx(D,{children:e.jsx("div",{className:"bg-elevated px-20 py-16 transition-button hover:bg-hover",children:e.jsxs(b,{to:`/conversations/${n.id}`,className:"block",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between gap-8",children:[e.jsx("div",{className:"font-semibold",children:e.jsx(c,{message:"Recent message"})}),e.jsx(Se,{conversationId:n.id,className:"ml-auto"})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx(ge,{message:o,size:"lg",agentWithIndicator:!0}),e.jsxs("div",{className:"min-w-0 flex-auto overflow-hidden",children:[e.jsxs(Ie,{className:"text-xs text-muted",children:[e.jsx(ke,{message:o}),e.jsx("div",{children:e.jsx(me,{date:m,style:"narrow"})})]}),e.jsx("div",{className:"line-clamp-2 text-sm",dangerouslySetInnerHTML:{__html:l}})]}),e.jsx(M,{className:"text-primary",size:"sm"})]})]})})})}const Bt=p.forwardRef((s,t)=>e.jsxs(Ye,{...s,ref:t,children:[e.jsx("path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"}),e.jsx("path",{d:"M9 12h6"}),e.jsx("path",{d:"M12 9v6"})]}));function qt(){const s=T(i=>i.isMobile),{chatWidget:t}=f(),a=T(i=>i.activeConversationId);return e.jsx("div",{className:k("compact-scrollbar h-full min-h-0 overflow-y-auto overflow-x-hidden",!s&&"rounded-t-panel"),children:e.jsxs("div",{className:"relative isolate",children:[e.jsx(Rt,{}),e.jsxs("div",{className:"relative z-20",children:[e.jsx($t,{}),e.jsxs("div",{className:"space-y-16 px-20 pb-20",children:[a?e.jsx(Ht,{chatId:a}):e.jsx(Ut,{}),(t==null?void 0:t.homeShowTickets)&&e.jsx(Vt,{}),e.jsx(Kt,{}),(t==null?void 0:t.showHcCard)&&e.jsx(Lt,{})]})]})]})})}function Rt(){const{chatWidget:s}=f(),t=J(),a=p.useMemo(()=>Ks(s==null?void 0:s.background),[s]);return t?null:e.jsxs("div",{className:"absolute left-0 right-0 top-0 z-10 h-[320px]",children:[e.jsx("div",{className:"absolute h-full w-full",style:a}),(s==null?void 0:s.fadeBg)&&e.jsx("div",{className:"widget-header-fade-gradient absolute h-full w-full"})]})}function Qt(){T(i=>i.isMobile);const{agents:s}=we(),{chatWidget:t}=f(),a=fe();return e.jsxs("div",{className:"mb-100 flex items-center gap-12",children:[a&&e.jsx("img",{className:"mr-auto max-h-36 max-w-full object-cover",src:a,alt:"logo"}),(t==null?void 0:t.showAvatars)&&e.jsx(Os,{showMore:!1,className:"ml-auto",children:s.slice(0,4).map(i=>e.jsx(le,{src:i.image,label:i.name,fallback:"initials"},i.id))}),e.jsx(Pe,{})]})}function $t(){var i;const{chatWidget:s}=f(),t=Z(),a=t!=null&&t.name&&(s!=null&&s.greeting)?s.greeting:s==null?void 0:s.greetingAnonymous;return e.jsxs("div",{className:"px-40 py-30",children:[e.jsx(Qt,{}),e.jsxs("div",{className:"leanding break-words text-[32px] font-bold leading-10",style:{color:s!=null&&s.fadeBg||(i=s==null?void 0:s.background)==null?void 0:i.color},children:[a&&e.jsx("h1",{children:e.jsx(c,{message:a,values:{...t==null?void 0:t.attributes,name:t==null?void 0:t.name,email:t==null?void 0:t.email}})}),(s==null?void 0:s.introduction)&&e.jsx("h2",{children:e.jsx(c,{message:s.introduction})})]})]})}function Ut(){const{chatWidget:s}=f();return e.jsx(D,{children:e.jsx("div",{className:"bg-elevated px-20 py-16 transition-button hover:bg-hover",children:e.jsxs(b,{to:"/conversations/new",className:"flex items-center justify-between gap-8",children:[e.jsxs("div",{children:[(s==null?void 0:s.homeNewChatTitle)&&e.jsx("div",{className:"font-semibold",children:e.jsx(c,{message:s.homeNewChatTitle})}),(s==null?void 0:s.homeNewChatSubtitle)&&e.jsx("div",{children:e.jsx(c,{message:s.homeNewChatSubtitle})})]}),e.jsx(Ce,{className:"text-primary"})]})})})}function Vt(){const{chatWidget:s}=f();return e.jsx(D,{children:e.jsx("div",{className:"px-20 py-16 transition-button hover:bg-hover",children:e.jsxs(b,{to:"/tickets/new",className:"flex items-center justify-between gap-8",children:[e.jsxs("div",{children:[(s==null?void 0:s.homeNewTicketTitle)&&e.jsx("div",{className:"font-semibold",children:e.jsx(c,{message:s.homeNewTicketTitle})}),(s==null?void 0:s.homeNewTicketSubtitle)&&e.jsx("div",{children:e.jsx(c,{message:s.homeNewTicketSubtitle})})]}),e.jsx(Bt,{className:"text-primary",size:"sm"})]})})})}function Kt(){var t;const{chatWidget:s}=f();return e.jsx("div",{className:"space-y-16 text-sm",children:(t=s==null?void 0:s.homeLinks)==null?void 0:t.map(a=>e.jsxs(D,{className:"flex cursor-pointer items-center justify-between gap-8 px-20 py-16 hover:bg-hover",children:[e.jsx(Bs,{item:a}),e.jsx(Me,{className:"text-muted",size:"sm"})]},a.id))})}function Ot(){const s=qs(Y.customerConversations.newTicketPageData());return e.jsxs("div",{className:"relative flex min-h-0 flex-auto flex-col",children:[e.jsx(P,{start:e.jsx(C,{elementType:b,to:"/",children:e.jsx(G,{})}),label:e.jsx(c,{message:"New ticket"})}),e.jsx("div",{className:"compact-scrollbar h-full overflow-y-auto p-20",children:s.data?e.jsx(Gt,{data:s.data}):e.jsx(O,{})})]})}function Gt({data:s}){const t=oe(),{captchaToken:a,captchaEnabled:i,resetCaptcha:r}=Ws("new_ticket"),{form:n,attachments:o,searchQuery:l,searchTermLogger:m,attributes:u,hcCategoryIds:g}=Js(s),j=V({mutationFn:d=>K.post("lc/widget/tickets",{...d,message:{...d.message,attachments:d.message.attachments.map(q=>q.id)},captcha_token:a}).then(q=>q.data),onSuccess:async d=>{m.updateLastSearch({createdTicket:!0}),await _.invalidateQueries({queryKey:N.conversations.invalidateKey}),A().activeConversationId||A().setActiveConversationId(d.conversation.id),Q($("Ticket created")),t(`/conversations/${d.conversation.id}`)},onError:d=>(r(),Rs(d,n))}),v=async()=>{if(i&&!a){Q.danger($("Please solve the captcha challenge."));return}j.mutate(n.getValues())};return e.jsxs(Xe,{form:n,onSubmit:v,children:[!s.customerHasVerifiedEmail&&e.jsx(he,{name:"email",type:"email",label:e.jsx(c,{message:"Your email address"}),className:"mb-24",required:!0}),u.map(d=>d?d.key==="category"?e.jsx(Zs,{attribute:d},d.id):d.key==="subject"?e.jsx(Ys,{searchQuery:l,hcCategoryIds:g,attribute:d},d.id):d.key==="description"?e.jsx(ye,{children:e.jsx(Jt,{attribute:d,attachments:o})},d.id):e.jsx(Gs,{formPrefix:"attributes",attribute:d,className:"mb-24"},d.id):null),i&&e.jsx(et,{className:"mb-24"}),e.jsxs("div",{className:"flex flex-col items-center gap-8",children:[e.jsx(S,{variant:"flat",color:"primary",type:"submit",disabled:j.isPending,className:"min-w-140",children:e.jsx(c,{message:s.config.submitButtonText})}),e.jsx(S,{elementType:b,to:"/",children:e.jsx(c,{message:"Cancel"})})]})]})}function Jt({attribute:s,attachments:t}){const{hasPermission:a}=We(),i=!a("files.create"),r=vs(l=>[...l.fileUploads.entries()].filter(([m,u])=>u.status==="inProgress").map(([m,u])=>u.percentage).reduce((m,u)=>m+u,0)/100),n=es(),o=Xs({onSuccess:l=>{n.setValue("message.attachments",[l,...n.getValues("message.attachments")],{shouldDirty:!0})}});return e.jsxs("div",{className:"mb-24",children:[e.jsx(he,{name:"message.body",inputElementType:"textarea",label:e.jsx(c,{message:s.name}),rows:3}),r?e.jsx(tt,{value:r,size:"xs"}):null,i?null:e.jsx(S,{size:"2xs",variant:"outline",className:"mt-10",startIcon:e.jsx(st,{}),onClick:async()=>{const l=bs({uploadType:ss.conversationAttachments}),m=await at({multiple:!0,types:l==null?void 0:l.allowedFileTypes});m.length&&o(m)},children:e.jsx(c,{message:"Attach files"})}),e.jsx("div",{className:"mt-12 flex flex-wrap items-center gap-8",children:t.map(l=>e.jsx(Zt,{name:l.name,onRemove:()=>{n.setValue("message.attachments",t.filter(m=>m.id!==l.id),{shouldDirty:!0})}},l.id))})]})}const Zt=({name:s,onRemove:t})=>e.jsxs("div",{className:k("flex min-h-30 w-max flex-shrink-0 items-center gap-6 rounded-button border pl-8"),children:[e.jsx("div",{className:"max-w-124 overflow-hidden overflow-ellipsis whitespace-nowrap text-xs font-bold text-muted",children:s}),e.jsx(C,{onClick:()=>t(),size:"xs",className:"text-muted",children:e.jsx(B,{})})]});function zi(){const s=p.useRef(null),{isInline:t}=be(),{chatWidget:a}=f(),i=je(),r=(a==null?void 0:a.defaultScreen)??"/",n=p.useRef(!1),o=r==="/"||r==="",{paddingSide:l}=gs(),m=T(u=>u.isMobile);return p.useLayoutEffect(()=>{ts(s.current)},[]),p.useLayoutEffect(()=>{!o&&!n.current&&(i(r,{replace:!0}),n.current=!0)},[r,o,i]),!o&&!n.current?null:e.jsx(h.div,{...t?{}:as,style:{paddingLeft:m?"0px":l,paddingRight:m?"0px":l,paddingTop:m?"0px":l},className:k("ml-auto min-h-0 w-full flex-auto",!m&&"pb-16"),children:e.jsxs("div",{className:k("livechat-popup-inner relative flex h-full min-h-0 w-full flex-col overflow-hidden bg text",!m&&"rounded-panel shadow-widget-popup"),ref:s,children:[e.jsx(is,{toastPosition:"absolute",toastPlacement:"top-center"}),e.jsx(rs,{}),e.jsxs(ns,{children:[e.jsxs(w,{path:"",element:e.jsxs(p.Fragment,{children:[e.jsx(z,{initial:!1,children:e.jsx(xe,{})}),!(a!=null&&a.hideNavigation)&&e.jsx(it,{})]}),children:[e.jsx(w,{index:!0,element:e.jsx(qt,{})}),e.jsx(w,{path:"conversations",element:e.jsx(gt,{})}),e.jsxs(w,{path:"hc",element:e.jsx(At,{}),children:[e.jsx(w,{index:!0,element:e.jsx(St,{})}),e.jsx(w,{path:"categories/:categoryId",element:e.jsx(kt,{})}),e.jsx(w,{path:"categories/:categoryId/:sectionId",element:e.jsx(Ct,{})})]})]}),e.jsx(w,{path:"tickets/new",element:e.jsx(Ot,{})}),e.jsx(w,{path:"conversations/new",element:e.jsx(te,{})}),e.jsx(w,{path:"conversations/:conversationId",element:e.jsx(te,{})}),e.jsx(w,{path:"hc/articles/:categoryId/:sectionId/:articleId/:articleSlug",element:e.jsx(Mt,{})}),e.jsx(w,{path:"embed",element:e.jsx(wt,{})})]})]})},"livechat-popup")}export{zi as default};
