import{r as j,f as b,j as e,aw as z,aj as B,ax as L,az as y,T as l,av as w,t as q,m as f,d as _,al as A,am as $,an as M,ap as E,aP as O,aq as R,B as T,F as H,e as D,A as U,c2 as G,bH as K,x as J,aG as Q,bG as X,bB as Y,p as Z}from"./client-OfhJa1Pp.js";import{A as ee}from"./admin-config-tfY5n3F7.js";import{u as v}from"./settings-layout-ByStjXMl.js";import{a as se,S as k}from"./settings-section-button-TsaY1Jcy.js";import{u as F}from"./use-admin-settings-BobgiTFU.js";import{D as te}from"./Delete-BhyMZiPM.js";import{M as ae}from"./MoreVert-Ci70_mZh.js";import{R as re}from"./RestartAlt-BBLLDvr_.js";import{T as ie}from"./Tune-DusFnn8x.js";import{C as le}from"./confirmation-dialog-BIOq1A-h.js";import{A as ne}from"./Add-CN0r1QLK.js";import{S as oe,F as me}from"./select-Dsco87dL.js";import{C as de}from"./color-picker-dialog-C1vQg-H6.js";import{l as ce}from"./main-CqFMqK8-.js";import{F as ue}from"./font-selector-X9xeL-3L.js";import{A as he,a as N}from"./accordion-DWEV-mKU.js";import"./dashboard-icons-CHop3mns.js";import"./library-icon-CHCHM-UW.js";import"./messages-square-icon-CTmom_u4.js";import"./Home--R_oEr6a.js";import"./SupervisorAccount-k9OnPB-d.js";import"./Translate-Cs-ut2nW.js";import"./TextFields-8TfbEP0O.js";import"./settings-links-D22SAe6v.js";import"./external-link-DbBk1ItZ.js";import"./book-open-Cbdc52Ur.js";import"./custom-menu-BbwshV9x.js";import"./use-admin-settings-page-nav-config-BVX-w9YX.js";import"./datatable-page-with-header-layout-B1YkbSHJ.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import"./file-upload-provider-DTPBUrkd.js";import"./uploaded-file-DN6fXT4v.js";import"./pretty-bytes-bO14ePu9.js";import"./with-selector-CDgEpx5P.js";import"./useMutationState-V1q6F41O.js";import"./blocker-dialog-B5ey95II.js";import"./OpenInFull-HWkxb3KN.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./use-filter-KNtT5Txy.js";import"./skeleton-Cp2m1Uyc.js";import"./accordtion-animation-BGCK95Hj.js";function fe({selectedThemeId:a,initialThemeId:r,onSelectedThemeChange:i}){const n=v(u=>u.preview),[d,m]=j.useState(!1),[s,h]=j.useState(!1),{setValue:o,getValues:c}=b(),{data:{defaults:x}}=F(),t=()=>{if(c("themes").length<=1){q.danger(f("At least one theme is required"));return}if(a){o("themes",c("themes").filter(p=>p.id!==a),{shouldDirty:!0});const u=c("themes").find(p=>p.id===r);r===a?window.location.reload():i(u?r:c("themes")[0].id)}},g=()=>{const p=`themes.${c("themes").findIndex(C=>C.id===a)}`,S=c(`${p}.is_dark`)?x.themes.dark:x.themes.light;Object.entries(S).forEach(([C,W])=>{n.setThemeValue(C,W)}),n.setThemeFont(null),o(`${p}.values`,S,{shouldDirty:!0}),o(`${p}.font`,void 0,{shouldDirty:!0})};return e.jsxs(j.Fragment,{children:[e.jsxs(z,{children:[e.jsx(B,{variant:"outline",size:"sm",children:e.jsx(ae,{})}),e.jsxs(L,{children:[e.jsx(y,{value:"settings",startIcon:e.jsx(ie,{}),onSelected:()=>h(!0),children:e.jsx(l,{message:"Settings"})}),e.jsx(y,{value:"reset",startIcon:e.jsx(re,{}),onSelected:()=>g(),children:e.jsx(l,{message:"Reset to default"})}),e.jsx(y,{value:"delete",startIcon:e.jsx(te,{}),onSelected:()=>m(!0),children:e.jsx(l,{message:"Delete"})})]})]}),e.jsx(w,{type:"modal",isOpen:d,onClose:u=>{u&&t(),m(!1)},children:e.jsx(le,{isDanger:!0,title:e.jsx(l,{message:"Delete theme"}),body:e.jsx(l,{message:"Are you sure you want to delete this theme?"}),confirm:e.jsx(l,{message:"Delete"})})}),e.jsx(w,{type:"modal",isOpen:s,onClose:()=>h(!1),children:e.jsx(xe,{theme:c("themes").find(u=>u.id===a)})})]})}function xe({theme:a}){const r=b(),i=_({defaultValues:a}),{close:n,formId:d}=A();j.useEffect(()=>{const s=i.watch((h,{name:o})=>{o==="default_light"&&h.default_light&&i.setValue("default_dark",!1),o==="default_dark"&&h.default_dark&&i.setValue("default_light",!1)});return()=>s.unsubscribe()},[i]);const m=s=>{r.getValues("themes").forEach((h,o)=>{if(h.id===s.id){r.setValue(`themes.${o}`,s,{shouldDirty:!0});return}if(s.default_light){r.setValue(`themes.${o}`,{...h,default_light:!1},{shouldDirty:!0});return}if(s.default_dark){r.setValue(`themes.${o}`,{...h,default_dark:!1},{shouldDirty:!0});return}})};return e.jsxs($,{children:[e.jsx(M,{children:e.jsx(l,{message:"Update settings"})}),e.jsx(E,{children:e.jsx(O,{form:i,id:d,onSubmit:s=>{m(s),n()},children:e.jsx(P,{})})}),e.jsxs(R,{children:[e.jsx(T,{onClick:()=>{n()},children:e.jsx(l,{message:"Cancel"})}),e.jsx(T,{variant:"flat",color:"primary",type:"submit",form:d,disabled:!i.formState.isDirty,children:e.jsx(l,{message:"Save"})})]})]})}function P(){return e.jsxs(j.Fragment,{children:[e.jsx(H,{name:"name",label:e.jsx(l,{message:"Name"}),className:"mb-24",autoFocus:!0,required:!0}),e.jsx(D,{name:"is_dark",className:"mb-20 border-b pb-20",description:e.jsx(l,{message:"Whether this theme has light text on dark background."}),children:e.jsx(l,{message:"Dark theme"})}),e.jsx(D,{name:"default_light",className:"mb-24",description:e.jsx(l,{message:"When light mode is selected, this theme will be used."}),children:e.jsx(l,{message:"Default for light mode"})}),e.jsx(D,{name:"default_dark",description:e.jsx(l,{message:"When dark mode is selected, this theme will be used."}),children:e.jsx(l,{message:"Default for dark mode"})})]})}function ge(a=1,r=1e4){const i=new Uint32Array(1);window.crypto.getRandomValues(i);const n=i[0]/4294967296;return a=Math.ceil(a),r=Math.floor(r),Math.floor(n*(r-a+1))+a}function pe({type:a="site",onCreated:r}){return e.jsxs(w,{type:"modal",onClose:i=>{i!=null&&(r==null||r(i))},children:[e.jsx(B,{variant:"outline",shadow:"shadow",size:"sm",className:"ml-auto",children:e.jsx(ne,{})}),e.jsx(je,{type:a})]})}function je({type:a}){const{formId:r,close:i}=A(),{data:{defaults:n}}=F(),d=b(),m=_({defaultValues:{default_dark:!1,default_light:!1,is_dark:!1}}),s=h=>{const o=h.is_dark?n.themes.dark:n.themes.light,c=d.getValues("themes"),x=ge(100,1e3);d.setValue("themes",[...c,{...h,id:x,type:a,values:o}],{shouldDirty:!0}),i(x)};return e.jsxs($,{children:[e.jsx(M,{children:e.jsx(l,{message:"New theme"})}),e.jsx(E,{children:e.jsx(O,{id:r,form:m,onSubmit:s,children:e.jsx(P,{})})}),e.jsxs(R,{children:[e.jsx(T,{onClick:()=>i(),children:e.jsx(l,{message:"Cancel"})}),e.jsx(T,{variant:"flat",color:"primary",type:"submit",form:r,disabled:!m.formState.isDirty,children:e.jsx(l,{message:"Save"})})]})]})}function be({selectedThemeId:a,onSelectionChange:r,allThemes:i}){return e.jsx(oe,{size:"sm",selectionMode:"single",selectedValue:a,onSelectionChange:n=>r(n),appearance:"dropdown",children:i.map(n=>e.jsx(y,{value:n.id,children:n.name},n.id))})}const ye=U(e.jsx("path",{stroke:"#E0E0E0",d:"M24,44c-7.168,0-13-5.816-13-12.971C11,24,24,4,24,4s13,20,13,27.029C37,38.184,31.168,44,24,44z"}));function I(a){return G(a).toString("rgb").replace("rgb(","").replace(")","").replace(/, ?/g," ")}function ve({label:a,colorName:r,initialThemeValue:i,themeId:n,size:d="lg"}){const m=v(t=>t.preview),{setValue:s,getValues:h}=b(),[o,c]=j.useState(i),x=t=>{c(t),m.setThemeValue(r,t)};return j.useEffect(()=>{c(i)},[i]),e.jsxs(w,{value:K(o),type:"popover",placement:"right",offset:10,onValueChange:t=>{x(I(t))},onClose:(t,{valueChanged:g,initialValue:u})=>{if(t&&g){const p=h("themes").findIndex(S=>S.id===n);s(`themes.${p}.values.${r}`,I(t),{shouldDirty:!0})}else x(u?I(u):"")},children:[e.jsx(se,{size:d,radius:"rounded-panel",startIcon:e.jsx(ye,{viewBox:"0 0 48 48",className:"icon-lg",style:{fill:o.startsWith("#")?o:`rgb(${o})`}}),children:a}),e.jsx(de,{})]})}const Se=[{label:f("Background"),key:"--be-background"},{label:f("Background alt"),key:"--be-bg-alt"},{label:f("Background elevated"),key:"--be-bg-elevated"},{label:f("Foreground"),key:"--be-fg-base"},{label:f("Accent light"),key:"--be-primary-light"},{label:f("Accent"),key:"--be-primary"},{label:f("Accent dark"),key:"--be-primary-dark"},{label:f("Text on accent"),key:"--be-on-primary"},{label:f("Chip"),key:"--be-bg-chip"}],ke={"rounded-none":{label:f("Square"),value:"0px"},rounded:{label:f("Small"),value:"0.25rem"},"rounded-md":{label:f("Medium"),value:"0.375rem"},"rounded-lg":{label:f("Large"),value:"0.5rem"},"rounded-xl":{label:f("Larger"),value:"0.75rem"},"rounded-full":{label:f("Pill"),value:"9999px"}};function fs(){var d,m;const{data:a}=F(),{auth:r}=j.use(ce),i=a.themes.filter(s=>s.type==="site"),n=_({defaultValues:{themes:i,client:{themes:{default_id:(d=a.client.themes)!=null&&d.default_id?parseInt(a.client.themes.default_id):0,user_change:((m=a.client.themes)==null?void 0:m.user_change)??!1}}}});return e.jsxs(k,{title:e.jsx(l,{message:"Themes"}),defaultRoute:J().auth_redirect_uri??"/",docsLink:ee.settings.themes,children:[e.jsx(k.Content,{children:e.jsxs(k.Form,{form:n,children:[e.jsxs("div",{className:"mb-20 border-b pb-20",children:[e.jsxs(me,{className:"mb-20",size:"sm",name:"client.themes.default_id",selectionMode:"single",label:e.jsx(l,{message:"Default site theme"}),children:[e.jsx(y,{value:0,children:e.jsx(l,{message:"System"})}),i.map(s=>e.jsx(y,{value:s.id,children:s.name},s.id))]}),e.jsx(D,{name:"client.themes.user_change",children:e.jsx(l,{message:"Allow users to switch theme"})})]}),e.jsx(De,{})]})}),e.jsx(k.Preview,{})]})}function De({size:a="lg",type:r="site"}){var x;const i=v(t=>t.preview),n=b(),d=Q({name:"themes"}).filter(t=>t.type===r),{selectedTheme:m}=X(),[s,h]=j.useState(()=>{var g;const t=d.find(u=>u.id===m.id);return t?t.id:(g=d[0])==null?void 0:g.id}),o=n.watch("themes").find(t=>t.id===s),c=t=>{if(t===s)return;h(t);const g=n.getValues("themes").find(u=>u.id===t);g&&i.setActiveTheme(g.id)};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-24 flex items-center gap-8",children:[e.jsx(be,{selectedThemeId:s,onSelectionChange:c,allThemes:d}),e.jsx(fe,{selectedThemeId:s,initialThemeId:m.id,onSelectedThemeChange:c}),e.jsx(pe,{type:r,onCreated:c})]}),e.jsxs(he,{variant:"outline",size:a,className:"mb-10",children:[e.jsx(N,{fontClassName:"text-sm",label:e.jsx(l,{message:"Font"}),descriptionClassName:"overflow-hidden text-ellipsis whitespace-nowrap text-xs text-muted",description:(x=o==null?void 0:o.font)!=null&&x.family?o.font.family:e.jsx(l,{message:"System"}),children:e.jsx(we,{themeId:s})}),e.jsxs(N,{label:e.jsx(l,{message:"Rounding"}),fontClassName:"text-sm",children:[e.jsx(V,{label:e.jsx(l,{message:"Button rounding"}),name:"button-radius",themeId:s,className:"mb-24"}),e.jsx(V,{label:e.jsx(l,{message:"Input rounding"}),name:"input-radius",themeId:s,className:"mb-24"}),e.jsx(V,{label:e.jsx(l,{message:"Panel rounding"}),name:"panel-radius",hidePill:!0,themeId:s})]})]}),Se.map(t=>e.jsx(ve,{colorName:t.key,size:a,label:e.jsx(l,{...t.label}),initialThemeValue:(o==null?void 0:o.values[t.key])??"",themeId:s},t.key))]})}function we({themeId:a}){const r=v(s=>s.preview),{setValue:i,watch:n}=b(),m=`themes.${n("themes").findIndex(s=>s.id===a)}.font`;return e.jsx(ue,{value:n(m),onChange:s=>{i(m,s,{shouldDirty:!0}),r.setThemeFont(s)}})}function V({label:a,name:r,hidePill:i,themeId:n,className:d}){const m=v(t=>t.preview),{watch:s,setValue:h}=b(),c=`themes.${s("themes").findIndex(t=>t.id===n)}.values.--be-${r}`,x=s(c);return e.jsxs("div",{className:d,children:[e.jsx("div",{className:"mb-10 text-sm font-semibold",children:a}),e.jsx("div",{className:"grid grid-cols-3 gap-10 text-sm",children:Object.entries(ke).filter(([t])=>!i||!t.includes("full")).map(([t,{label:g,value:u}])=>e.jsx(Y,{display:"block",className:Z("h-36 border-2 hover:bg-hover",t,u===x&&"border-primary"),onClick:()=>{h(c,u,{shouldDirty:!0}),m.setThemeValue(`--be-${r}`,u)},children:e.jsx(l,{...g})},t))})]})}export{fs as Component,De as ThemeEditor};
