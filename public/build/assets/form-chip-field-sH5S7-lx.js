import{r as g,a1 as U,a3 as q,a7 as X,j as d,ab as G,bP as J,p as _,aA as Q,aC as Z,aX as Y,S as ee,a6 as se,aN as ne,aa as te,a9 as ae,ah as re,a0 as B,ai as oe,P as le,ag as ie,a4 as ue,$ as ce}from"./client-OfhJa1Pp.js";import{C as de}from"./chip-list-CkGaRoaT.js";function z(s){return{id:s,name:`${s}`,description:`${s}`}}function fe({ref:s,...t}){const l=g.useRef(null),o=U(s),{displayWith:i=R=>R.name,validateWith:u,getItemForPresentation:p,children:f,suggestions:r,isLoading:c,inputValue:a,onInputValueChange:x,onItemSelected:w,placeholder:I,onOpenChange:K,chipSize:C="sm",openMenuOnFocus:v=!0,showEmptyMessage:A,value:y,defaultValue:h,onChange:M,valueKey:$,isAsync:D,allowCustomValue:E=!0,showDropdownArrow:V,onChipClick:L,alwaysShowAvatar:N=!1,readOnly:k,maxItems:W,...F}=t,S=q({...t,flexibleHeight:!0}),[P,O]=he(t),[e,n]=g.useState(!1),b=d.jsx(le,{isIndeterminate:!0,size:"w-24 h-24","aria-label":"loading..."}),m=V?d.jsx(ie,{}):null,{fieldProps:j,inputProps:H}=X({...F,focusRef:o,endAdornment:c&&e?b:m});return d.jsx(G,{fieldClassNames:S,...j,children:d.jsxs(J,{ref:l,className:_("flex flex-wrap items-center",S.input),onClick:()=>{var R;(R=o.current)==null||R.focus()},children:[d.jsx(pe,{displayChipUsing:i,onChipClick:L,items:P,setItems:O,chipSize:C,alwaysShowAvatar:N,readOnly:k,getItemForPresentation:p}),d.jsx(xe,{size:t.size,showEmptyMessage:A,inputProps:H,inputValue:a,onInputValueChange:x,fieldRef:l,inputRef:o,chips:P,setChips:O,validateWith:u,isLoading:c,suggestions:r,placeholder:I,openMenuOnFocus:v,listboxIsOpen:e,setListboxIsOpen:n,allowCustomValue:E,readOnly:k,children:f})]})})}function pe({items:s,setItems:t,displayChipUsing:l,chipSize:o,onChipClick:i,alwaysShowAvatar:u,readOnly:p,getItemForPresentation:f}){const r=Z(),c=g.useCallback(a=>{const x=s.findIndex(I=>I.id===a),w=[...s];return x>-1&&(w.splice(x,1),t(w)),w},[s,t]);return d.jsx(de,{className:_("max-w-full flex-shrink-0 flex-wrap",o==="xs"?"my-6":"my-8"),size:o,selectable:!0,children:s.map(a=>(a=(f==null?void 0:f(a))??a,d.jsx(Y,{errorMessage:a.errorMessage,adornment:a.image||u?d.jsx(ee,{circle:!0,src:a.image,fallback:"initials",label:a.name}):null,onClick:()=>i==null?void 0:i(a),onRemove:p?void 0:()=>{c(a.id).length?r==null||r.focusPrevious({tabbable:!0}):r==null||r.focusLast()},children:l(a)},a.id)))})}function xe(s){const{inputRef:t,fieldRef:l,validateWith:o,setChips:i,chips:u,suggestions:p,inputProps:f,placeholder:r,openMenuOnFocus:c,listboxIsOpen:a,setListboxIsOpen:x,allowCustomValue:w,isLoading:I,size:K,readOnly:C}=s,v=Z(),A=g.useCallback(e=>{e=(e||[]).filter(n=>{const b=!n||!n.id||!n.name;return!(u.findIndex(j=>j.id===(n==null?void 0:n.id))>-1)&&!b}),e.length&&(o&&(e=e.map(n=>o(n))),i([...u,...e]))},[u,i,o]),y=se({...s,clearInputOnItemSelection:!0,isOpen:a,onOpenChange:x,items:p,selectionMode:"none",role:"listbox",virtualFocus:!0,onItemSelected:e=>{F(e)}}),{state:{activeIndex:h,setActiveIndex:M,isOpen:$,setIsOpen:D,inputValue:E,setInputValue:V},refs:L,listboxId:N,collection:k,onInputChange:W}=y,F=e=>{const n=k.size&&h!=null?[...k.values()][h]:null;n!=null&&n.item?A([n.item]):w&&A([z(n?n.value:e)]),V(""),M(null),D(!1)};ne(()=>{l.current&&L.reference.current!==l.current&&y.reference(l.current)},[l,y,L]);const{handleTriggerKeyDown:S,handleListboxKeyboardNavigation:P}=te(y),O=oe(()=>{c&&!$&&D(!0)});return d.jsx(ae,{listbox:y,mobileOverlay:re,isLoading:I,onPointerDown:e=>{e.preventDefault()},children:d.jsx("input",{readOnly:C,type:"text",className:_("mx-8 my-4 min-w-30 flex-[1_1_60px] bg-transparent text-sm outline-none",K==="xs"?"h-20":"h-30"),placeholder:r,...B(f,{required:!1,ref:t,value:E,onChange:W,onPaste:e=>{const b=e.clipboardData.getData("text").match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);if(b){e.preventDefault();const m=window.getSelection();m!=null&&m.rangeCount&&(m.deleteFromDocument(),A(b.map(j=>z(j))))}},"aria-autocomplete":"list","aria-controls":$?N:void 0,autoComplete:"off",autoCorrect:"off",spellCheck:"false",onKeyDown:e=>{if(C)return;const n=e.target;if(e.key==="Enter"){e.preventDefault(),F(n.value);return}if(e.key==="Escape"&&$&&(D(!1),V("")),e.key==="ArrowUp"&&$&&(h===0||h==null)){M(null);return}if(h!=null&&(e.key==="ArrowLeft"||e.key==="ArrowRight")){e.preventDefault();return}if((e.key==="ArrowLeft"||e.key==="Backspace"||e.key==="Delete")&&n.selectionStart===0&&h==null&&u.length){v==null||v.focusPrevious({tabbable:!0});return}S(e)||P(e)},onFocus:C?void 0:O,onClick:C?void 0:O})})})}function he({onChange:s,value:t,defaultValue:l,valueKey:o,maxItems:i}){const u=g.useMemo(()=>T(t),[t]),p=g.useMemo(()=>T(l),[l]),f=g.useCallback(r=>{let c=o?r.map(a=>a[o]):r;i&&(c=c.slice(0,i)),s==null||s(c)},[s,o]);return Q(u||void 0,p||[],f)}function T(s){if(s)return Array.isArray(s)?s.map(t=>typeof t!="object"?z(t):t):[z(s)]}function ge({children:s,...t}){const l=ue({...t,multiSelect:!0}),{field:{onChange:o,onBlur:i,value:u=[],ref:p},fieldState:{invalid:f,error:r}}=ce({name:t.name,rules:l}),c={onChange:o,onBlur:i,value:u,invalid:f,errorMessage:r==null?void 0:r.message};return d.jsx(fe,{ref:p,...B(c,t),children:s})}export{fe as C,ge as F};
