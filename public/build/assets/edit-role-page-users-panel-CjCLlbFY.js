import{al as P,r as h,ae as A,j as e,am as N,an as R,T as t,ap as k,ac as q,m as j,ad as F,aq as E,B as g,p as Q,S as K,i as S,s as b,t as D,k as I,av as C,q as T,H as M,o as V}from"./client-OfhJa1Pp.js";import{k as z,c as f,V as H}from"./main-CqFMqK8-.js";import{G as L}from"./global-loading-progress-CKXIm6JS.js";import{a as $}from"./name-with-avatar-DcHWBlN8.js";import{D as B}from"./data-table-header-CeAVoFvI.js";import{D as G}from"./data-table-pagination-footer-CEEx1VtI.js";import{u as _}from"./use-datatable-search-params-CQGreY35.js";import{D as U}from"./data-table-emty-state-message-DLsG3g03.js";import{c as W}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{D as J}from"./paginated-resources-BrzANtLm.js";import{u as O}from"./use-datatable-query-BQ-GXlzU.js";import{I as X,S as Y,u as Z,a as ee}from"./custom-menu-BbwshV9x.js";import{T as se}from"./table-BifRiqkr.js";import{t as v}from"./team-DYmDDGxN.js";import{C as ae}from"./confirmation-dialog-BIOq1A-h.js";import"./skeleton-Cp2m1Uyc.js";import"./FilterAlt-CXibH0wr.js";import"./select-filter-panel-C_zo36WK.js";import"./form-chip-field-sH5S7-lx.js";import"./chip-list-CkGaRoaT.js";import"./filter-operator-names-BZog1mvA.js";import"./select-Dsco87dL.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./normalized-model-field-COxh0lBC.js";import"./Edit-JNj6SFDx.js";import"./accordion-DWEV-mKU.js";import"./accordtion-animation-BGCK95Hj.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import"./ArrowDownward-mN9PlQJw.js";import"./useEffectEvent-DQn3o5L0.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./useGlobalListeners-CeWFSHKo.js";function re({multiple:s=!1,endpoint:a="normalized-models/user"}){var y;const{close:r}=P(),[o,p]=h.useState(""),{trans:m}=A(),c=z(a,{query:o,perPage:14}),u=((y=c.data)==null?void 0:y.results)||[],[i,n]=h.useState([]),w=e.jsx(X,{className:"pt-20",size:"sm",title:e.jsx(t,{message:"No matching users"}),description:e.jsx(t,{message:"Try another search query"}),image:e.jsx(Y,{src:v})});return e.jsxs(N,{size:"lg",children:[e.jsx(R,{children:s?e.jsx(t,{message:"Select users"}):e.jsx(t,{message:"Select a user"})}),e.jsxs(k,{children:[e.jsx(q,{autoFocus:!0,size:"sm",className:"mb-20",startAdornment:e.jsx(F,{}),placeholder:m(j("Search for user by name or email")),value:o,onChange:d=>{p(d.target.value)}}),!c.isLoading&&!u.length&&w,e.jsx("div",{className:"grid grid-cols-2 gap-x-10",children:u.map(d=>e.jsx(te,{isSelected:!!i.find(l=>l.id===d.id),user:d,onSelected:l=>{s?i.find(x=>x.id===l.id)?n(i.filter(x=>x.id!==l.id)):n([...i,l]):r(l)}},d.id))})]}),s&&e.jsxs(E,{children:[e.jsx(g,{onClick:()=>r(),children:e.jsx(t,{message:"Cancel"})}),e.jsx(g,{variant:"flat",color:"primary",onClick:()=>r(i),disabled:!i.length,children:e.jsx(t,{message:"Select"})})]})]})}function te({user:s,onSelected:a,isSelected:r}){return e.jsxs("div",{className:Q("flex items-center gap-10 rounded-panel border-1 p-10 outline-none ring-offset-4 focus-visible:ring",r?"border-primary bg-primary/5 hover:bg-primary/10":"border-transparent hover:bg-hover"),role:"button",tabIndex:0,onClick:()=>{a(s)},onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),a(s))},children:[e.jsx(K,{src:s.image,label:s.name??"Visitor",circle:!0}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:s.name??e.jsx(t,{message:"Visitor"})}),e.jsx("div",{className:"overflow-hidden text-ellipsis text-muted",children:s.description})]})]},s.id)}function oe(s){return S({mutationFn:({userIds:a})=>ie({userIds:a,roleId:s.id}),onSuccess:(a,r)=>{D(j("Assigned [one 1 user|other :count users] to :role",{values:{count:r.userIds.length,role:s.name}}))},onError:a=>b(a)})}function ie({roleId:s,userIds:a}){return I.post(`roles/${s}/add-users`,{userIds:a}).then(r=>r.data)}function ne(s){return S({mutationFn:({userIds:a})=>le({userIds:a,roleId:s.id}),onSuccess:(a,r)=>{D(j("Removed [one 1 user|other :count users] from “{role}“",{values:{count:r.userIds.length,role:s.name}}))},onError:a=>b(a)})}function le({roleId:s,userIds:a}){return I.post(`roles/${s}/remove-users`,{userIds:a}).then(r=>r.data)}const me=[{key:"email",allowsSorting:!0,sortingKey:"email",visibleInMode:"all",header:()=>e.jsx(t,{message:"User"}),body:s=>e.jsx($,{image:s.image,label:s.name??e.jsx(t,{message:"Visitor"}),description:s.email,alwaysShowAvatar:!0,avatarLabel:"Visitor"})},{key:"created_at",allowsSorting:!0,header:()=>e.jsx(t,{message:"Assigned at"}),body:s=>e.jsx(M,{date:s.created_at})}];function We(){const{roleId:s}=Z(["roleId"]),a=ee(f.roles.get(s));return a.data.role.guests||a.data.role.type==="workspace"?e.jsx("div",{className:"pb-10 pt-30",children:e.jsx(U,{image:v,title:e.jsx(t,{message:"Users can't be assigned to this role"})})}):e.jsx(de,{role:a.data.role})}function de({role:s}){const[a,r]=h.useState([]),{searchParams:o,sortDescriptor:p,mergeIntoSearchParams:m,setSearchQuery:c,isFiltering:u}=_(H),i=O({...f.users.index({...o,roleId:`${s.id}`}),placeholderData:V});return e.jsxs("div",{children:[e.jsx(L,{query:i}),e.jsx(B,{searchValue:o.query,onSearchChange:c,actions:e.jsx(ce,{role:s}),selectedItems:a,selectedActions:e.jsx(ue,{role:s,selectedIds:a})}),e.jsxs(W,{children:[e.jsx(se,{columns:me,data:i.items,sortDescriptor:p,onSortChange:m,enableSelection:!0,selectedRows:a,onSelectionChange:n=>r(n)}),i.isEmpty?e.jsx(U,{image:v,isFiltering:u,title:e.jsx(t,{message:"No users have been assigned to this role yet"}),filteringTitle:e.jsx(t,{message:"No matching users"})}):null,e.jsx(G,{query:i,onPageChange:n=>m({page:n}),onPerPageChange:n=>m({perPage:n})})]})]})}function ce({role:s}){const a=oe(s);return e.jsxs(C,{type:"modal",onClose:r=>{r&&a.mutate({userIds:[r.id]},{onSuccess:()=>{T.invalidateQueries({queryKey:J("users",{roleId:`${s.id}`})})}})},children:[e.jsx(g,{variant:"flat",color:"primary",disabled:a.isPending,children:e.jsx(t,{message:"Assign user"})}),e.jsx(re,{})]})}function ue({role:s,selectedIds:a}){const r=ne(s);return e.jsxs(C,{type:"modal",onClose:o=>{o&&r.mutate({userIds:a},{onSuccess:()=>{T.invalidateQueries({queryKey:f.users.invalidateKey})}})},children:[e.jsx(g,{variant:"flat",color:"danger",disabled:r.isPending,children:e.jsx(t,{message:"Remove users"})}),e.jsx(ae,{title:e.jsx(t,{message:"Remove users from role?"}),body:e.jsx(t,{message:"This will permanently remove the users from this role."}),confirm:e.jsx(t,{message:"Remove"}),isDanger:!0})]})}export{We as Component,ue as RemoveUsersAction};
