import{b3 as I,aZ as k,l as p,j as e,T as s,L as v,i as w,s as D,k as b,q as y,r as l,av as A,aw as N,aj as V,ax as H,az as c,al as R,a0 as E,p as M,_ as q,aQ as h,H as L,t as j,m as f}from"./client-OfhJa1Pp.js";import{A as B}from"./admin-config-tfY5n3F7.js";import{D as F}from"./dashboard-icons-CHop3mns.js";import{u as O}from"./use-update-view-E-C7Pulc.js";import{s as Q}from"./search-D3bB1V5N.js";import{D as $}from"./settings-links-D22SAe6v.js";import{G as K}from"./global-loading-progress-CKXIm6JS.js";import{a as z}from"./name-with-avatar-DcHWBlN8.js";import{D as U}from"./data-table-add-item-button-2jwTYQ5G.js";import{D as W}from"./data-table-header-CeAVoFvI.js";import{D as _}from"./data-table-pagination-footer-CEEx1VtI.js";import{u as G}from"./use-datatable-search-params-CQGreY35.js";import{D as Z}from"./data-table-emty-state-message-DLsG3g03.js";import{a as J,D as X,b as Y,c as ee}from"./datatable-page-with-header-layout-B1YkbSHJ.js";import{u as ae}from"./use-datatable-query-BQ-GXlzU.js";import{T as se,a as te}from"./table-BifRiqkr.js";import{D as re}from"./DragHandle-DNpm5kSf.js";import{M as ie}from"./MoreVert-Ci70_mZh.js";import{u as oe,D as ne}from"./is-touch-device-C5S2y1Hk.js";import{u as me,m as le}from"./use-sortable-DQoLtUe2.js";import{C as de}from"./confirmation-dialog-BIOq1A-h.js";import"./Translate-Cs-ut2nW.js";import"./main-CqFMqK8-.js";import"./custom-menu-BbwshV9x.js";import"./TextFields-8TfbEP0O.js";import"./library-icon-CHCHM-UW.js";import"./messages-square-icon-CTmom_u4.js";import"./Delete-BhyMZiPM.js";import"./Home--R_oEr6a.js";import"./SupervisorAccount-k9OnPB-d.js";import"./external-link-DbBk1ItZ.js";import"./book-open-Cbdc52Ur.js";import"./skeleton-Cp2m1Uyc.js";import"./Add-CN0r1QLK.js";import"./FilterAlt-CXibH0wr.js";import"./select-filter-panel-C_zo36WK.js";import"./form-chip-field-sH5S7-lx.js";import"./chip-list-CkGaRoaT.js";import"./filter-operator-names-BZog1mvA.js";import"./select-Dsco87dL.js";import"./combobox-end-adornment-CaH5Sr_u.js";import"./normalized-model-field-COxh0lBC.js";import"./Edit-JNj6SFDx.js";import"./accordion-DWEV-mKU.js";import"./accordtion-animation-BGCK95Hj.js";import"./checkbox-C4s6ROxp.js";import"./CheckBoxOutlineBlank-DQZJM1Yc.js";import"./use-toggle-dashboard-left-sidebar-CnzMOFB9.js";import"./toggle-left-sidebar-icon-Dq5ZwqwZ.js";import"./ArrowDownward-mN9PlQJw.js";import"./useEffectEvent-DQn3o5L0.js";import"./is-ctrl-key-pressed-BWsUhNJl.js";import"./useGlobalListeners-CeWFSHKo.js";import"./isScrollable-BSEN4xi5.js";import"./use-droppable-DqkAoZym.js";import"./uploaded-file-DN6fXT4v.js";const ce=[{key:"dragHandle",width:"w-42 flex-shrink-0",header:()=>e.jsx(s,{message:"Drag handle"}),hideHeader:!0,body:()=>e.jsx(re,{className:"cursor-pointer text-muted hover:text"})},{key:"name",width:"flex-3 min-w-200",visibleInMode:"all",header:()=>e.jsx(s,{message:"Name"}),body:a=>e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(F,{name:a.icon,size:"sm"}),a.name]})},{key:"owner_id",allowsSorting:!0,header:()=>e.jsx(s,{message:"User"}),body:a=>a.user&&e.jsx(z,{image:a.user.image,label:a.user.name,description:a.user.email,avatarCircle:!0})},{key:"access",allowsSorting:!0,header:()=>e.jsx(s,{message:"Available for"}),body:a=>{var t;switch(a.access){case"anyone":return e.jsx(s,{message:"Any agent"});case"owner":return e.jsx(s,{message:"View owner"});case"group":return e.jsx(s,{message:"Agents in :name",values:{name:(t=a.group)==null?void 0:t.name}})}}},{key:"pinned",allowsSorting:!0,header:()=>e.jsx(s,{message:"Pinned"}),width:"w-96",body:a=>a.pinned&&e.jsx(h,{className:"text-muted"})},{key:"active",allowsSorting:!0,header:()=>e.jsx(s,{message:"Active"}),width:"w-96",body:a=>a.active&&e.jsx(h,{className:"text-muted"})},{key:"updatedAt",allowsSorting:!0,width:"w-124",header:()=>e.jsx(s,{message:"Last updated"}),body:a=>e.jsx("time",{children:e.jsx(L,{date:a.updated_at})})},{key:"actions",header:()=>e.jsx(s,{message:"Actions"}),width:"w-42 flex-shrink-0",hideHeader:!0,align:"end",visibleInMode:"all",body:a=>e.jsx(xe,{view:a})}];function va(){const a=I(),{searchParams:t,sortDescriptor:i,mergeIntoSearchParams:r,setSearchQuery:d}=G(k),m=!!(t.query||t.filters),o=ae(p.views.index(t));return e.jsxs(J,{children:[e.jsx(K,{query:o}),e.jsx(X,{title:e.jsx(s,{message:"Views"}),showSidebarToggleButton:!0,rightContent:e.jsx($,{variant:"button",link:B.pages.views,size:"xs"})}),e.jsxs(Y,{children:[e.jsx(W,{searchValue:t.query,onSearchChange:d,actions:e.jsx(U,{elementType:v,to:"new",children:e.jsx(s,{message:"Add view"})})}),e.jsxs(ee,{children:[e.jsx(se,{columns:ce,data:o.items,sortDescriptor:i,onSortChange:r,enableSelection:!1,cellHeight:"h-64",renderRowAs:ue,onAction:n=>a(`${n.id}/update`)}),o.isEmpty&&e.jsx(Z,{isFiltering:m,image:Q,title:e.jsx(s,{message:"No views have been created yet"}),filteringTitle:e.jsx(s,{message:"No matching views"})}),e.jsx(_,{hideIfOnlyOnePage:!0,query:o,onPageChange:n=>r({page:n}),onPerPageChange:n=>r({perPage:n})})]})]})]})}function ue({item:a,children:t,className:i,...r}){const d=oe(),{data:m}=l.useContext(te),o=l.useRef(null),n=ge(),g=l.useRef(null),[x,S]=l.useState(null),{sortableProps:P}=me({ref:o,disabled:d??!1,item:a,items:m,type:"viewsTableItem",preview:g,strategy:"line",onDropPositionChange:u=>{S(u)},onSortEnd:(u,T)=>{n.mutate({viewIds:le(m.map(C=>C.id),u,T)})}});return e.jsxs("div",{className:M(i,x==="before"&&"sort-preview-before",x==="after"&&"sort-preview-after"),ref:o,...E(P,r),children:[t,!a.isPlaceholder&&e.jsx(pe,{item:a,ref:g})]})}const pe=q.forwardRef(({item:a},t)=>e.jsx(ne,{ref:t,children:()=>e.jsx("div",{className:"rounded bg-chip p-8 text-base shadow",children:a.name})}));function ge(){return w({mutationFn:a=>b.post("helpdesk/views/reorder",a).then(t=>t.data),onSuccess:()=>y.invalidateQueries({queryKey:p.views.invalidateKey}),onError:a=>D(a)})}function xe({view:a}){const[t,i]=l.useState(!1),r=O(a.id),d=()=>r.mutate({active:!0},{onSuccess:()=>j(f("Activated view"))}),m=()=>r.mutate({active:!1},{onSuccess:()=>j(f("Deactivated view"))});return e.jsxs(l.Fragment,{children:[t&&e.jsx(A,{type:"modal",isOpen:t,onOpenChange:i,children:e.jsx(he,{view:a})}),e.jsxs(N,{children:[e.jsx(V,{className:"text-muted",disabled:r.isPending,children:e.jsx(ie,{})}),e.jsxs(H,{children:[e.jsx(c,{value:"edit",elementType:v,to:`${a.id}/update`,children:e.jsx(s,{message:"Edit"})}),!a.active&&e.jsx(c,{value:"activate",onSelected:()=>d(),children:e.jsx(s,{message:"Activate"})}),a.active&&e.jsx(c,{value:"deactivate",onSelected:()=>m(),isDisabled:a.internal,children:e.jsx(s,{message:"Deactivate"})}),e.jsx(c,{value:"delete",className:"text-danger",onSelected:()=>i(!0),isDisabled:a.internal,children:e.jsx(s,{message:"Delete"})})]})]})]})}function he({view:a}){const t=w({mutationFn:()=>b.delete(`helpdesk/views/${a.id}`),onSuccess:()=>y.invalidateQueries({queryKey:p.views.invalidateKey}),onError:r=>D(r)}),{close:i}=R();return e.jsx(de,{isDanger:!0,isLoading:t.isPending,title:e.jsx(s,{message:"Delete view"}),body:e.jsx(s,{message:"Are you sure you want to delete this view?"}),confirm:e.jsx(s,{message:"Delete"}),onConfirm:()=>{t.mutate(void 0,{onSuccess:()=>i()})}})}export{xe as ActionsButton,va as Component,he as DeleteViewDialog,ge as useReorderViews};
